import{u as _,a as L,b as j,j as e}from"./vendor-query-2ZprUnmA.js";import{r as m}from"./vendor-router-CyR0tpch.js";import{j as u}from"./index-B81xHCoA.js";import{C as S,c as T}from"./Card-DbNYCSnq.js";import{B as p}from"./Button-DOJd5Ro7.js";import{I as E}from"./Input-WTtiBIO6.js";import{B as w}from"./Badge-Cu_cxnAa.js";import{ao as k,P as I,e as $,U as A,s as B,r as U,ap as V,aq as G,n as O,ar as R,Z as K,X as D,m as X,_ as Z}from"./vendor-icons-BeDautqo.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";function H({type:s,isOpen:c,onClose:r,onSuccess:x}){const d=_(),n=!!s,[i,l]=m.useState({name:s?.name||"",code:s?.code||"",description:s?.description||""}),[g,o]=m.useState(""),f=j({mutationFn:t=>u.create(t),onSuccess:()=>{d.invalidateQueries(["signatory-types"]),x?.(),r()},onError:t=>{o(t.response?.data?.error||t.response?.data?.errors?.join(", ")||"Error al crear tipo de firmante")}}),h=j({mutationFn:t=>u.update(s.id,t),onSuccess:()=>{d.invalidateQueries(["signatory-types"]),x?.(),r()},onError:t=>{o(t.response?.data?.error||t.response?.data?.errors?.join(", ")||"Error al actualizar tipo de firmante")}}),v=t=>{if(t.preventDefault(),o(""),!i.name.trim()){o("El nombre es requerido");return}n?h.mutate(i):f.mutate(i)};return c?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:n?"Editar Tipo de Firmante":"Nuevo Tipo de Firmante"}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:v,className:"p-4 space-y-4",children:[g&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:g})]}),e.jsx(E,{label:"Nombre",value:i.name,onChange:t=>l({...i,name:t.target.value}),placeholder:"Ej: Gerente de Operaciones",required:!0}),!n&&e.jsx(E,{label:"Codigo (se genera automaticamente)",value:i.code,onChange:t=>l({...i,code:t.target.value}),placeholder:"Ej: operations_manager",hint:"Solo letras minusculas, numeros y guiones bajos"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripcion"}),e.jsx("textarea",{value:i.description,onChange:t=>l({...i,description:t.target.value}),placeholder:"Descripcion del tipo de firmante...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:r,children:"Cancelar"}),e.jsxs(p,{type:"submit",loading:f.isPending||h.isPending,children:[e.jsx(Z,{className:"w-4 h-4"}),n?"Guardar Cambios":"Crear Tipo"]})]})]})]})}):null}function J({type:s,isOpen:c,onClose:r}){return!c||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Detalle del Tipo de Firmante"}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Nombre"}),e.jsx("p",{className:"text-sm font-medium mt-0.5",children:s.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Codigo"}),e.jsx("p",{className:"mt-0.5",children:e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:s.code})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Descripcion"}),e.jsx("p",{className:"text-sm text-gray-700 mt-0.5",children:s.description||"Sin descripcion"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("p",{className:"mt-0.5",children:e.jsx(w,{variant:s.is_system?"secondary":"default",className:"text-xs",children:s.is_system?"Sistema":"Personalizado"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Estado"}),e.jsx("p",{className:"mt-0.5",children:e.jsx(w,{variant:s.active?"success":"secondary",className:"text-xs",children:s.active?"Activo":"Inactivo"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Uso"}),e.jsx("p",{className:"text-sm mt-0.5",children:s.in_use?`${s.usage_count} plantilla(s)`:"Sin usar"})]})]})]}),e.jsx("div",{className:"flex justify-end p-4 border-t",children:e.jsx(p,{variant:"secondary",onClick:r,children:"Cerrar"})})]})})}function W({type:s,onEdit:c,onToggle:r,onDelete:x,onView:d}){const n=s.is_system;return e.jsxs("tr",{className:`${s.active?"":"opacity-50 bg-gray-50"}`,children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsx(B,{className:"w-3 h-3 text-gray-400"}),e.jsx(U,{className:"w-4 h-4 text-primary-500"}),e.jsx("span",{className:"font-medium",children:s.name})]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 ml-6",children:s.description})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:s.code})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(w,{variant:n?"secondary":"default",className:"text-xs",children:n?"Sistema":"Personalizado"})}),e.jsx("td",{className:"px-4 py-3",children:s.in_use?e.jsxs("span",{className:"text-sm text-gray-600",children:[s.usage_count," plantilla(s)"]}):e.jsx("span",{className:"text-sm text-gray-400",children:"Sin usar"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>r(s),className:`p-1 rounded ${s.active?"text-green-600":"text-gray-400"}`,title:s.active?"Desactivar":"Activar",children:s.active?e.jsx(V,{className:"w-5 h-5"}):e.jsx(G,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>d(s),className:"p-1.5 hover:bg-blue-50 rounded text-blue-600",title:"Ver detalle",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(s),className:"p-1.5 hover:bg-gray-100 rounded text-gray-600",title:"Editar",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x(s),className:`p-1.5 rounded ${s.in_use?"text-gray-300 cursor-not-allowed":"hover:bg-red-50 text-red-500"}`,title:s.in_use?"No se puede eliminar (en uso)":"Eliminar",disabled:s.in_use,children:e.jsx(K,{className:"w-4 h-4"})})]})})]})}function ce(){const s=_(),[c,r]=m.useState(!1),[x,d]=m.useState(null),[n,i]=m.useState(null),[l,g]=m.useState(""),[o,f]=m.useState(""),{data:h,isLoading:v}=L({queryKey:["signatory-types",{type:o}],queryFn:()=>u.list({type:o||void 0})}),t=j({mutationFn:a=>u.toggleActive(a),onSuccess:()=>s.invalidateQueries(["signatory-types"])}),F=j({mutationFn:a=>u.delete(a),onSuccess:()=>s.invalidateQueries(["signatory-types"]),onError:a=>{alert(a.response?.data?.error||"Error al eliminar")}}),N=j({mutationFn:()=>u.seedSystem(),onSuccess:()=>{s.invalidateQueries(["signatory-types"])}}),M=a=>{i(a)},z=a=>{d(a),r(!0)},P=a=>{t.mutate(a.id)},Q=a=>{if(a.in_use){alert(`No se puede eliminar este tipo porque esta siendo usado en ${a.usage_count} plantilla(s)`);return}confirm(`Â¿Esta seguro de eliminar el tipo de firmante "${a.name}"?`)&&F.mutate(a.id)},q=()=>{r(!1),d(null)},y=h?.data?.data||[],C=h?.data?.meta||{},b=l?y.filter(a=>a.name.toLowerCase().includes(l.toLowerCase())||a.code.toLowerCase().includes(l.toLowerCase())):y;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tipos de Firmante"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona los tipos de firmante disponibles para plantillas"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"secondary",onClick:()=>N.mutate(),loading:N.isPending,children:[e.jsx(k,{className:"w-4 h-4"}),"Inicializar Sistema"]}),e.jsxs(p,{onClick:()=>r(!0),children:[e.jsx(I,{className:"w-4 h-4"}),"Nuevo Tipo"]})]})]}),e.jsx(S,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar tipos de firmante...",value:l,onChange:a=>g(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsxs("select",{value:o,onChange:a=>f(a.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"system",children:"Sistema"}),e.jsx("option",{value:"custom",children:"Personalizados"})]})]})})}),e.jsx(S,{children:e.jsx(T,{className:"p-0",children:v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay tipos de firmante"}),e.jsx("p",{className:"text-gray-500 mb-4",children:y.length===0?"Inicializa los tipos del sistema o crea uno personalizado":"No se encontraron tipos con los filtros aplicados"}),y.length===0&&e.jsxs(p,{onClick:()=>N.mutate(),loading:N.isPending,children:[e.jsx(k,{className:"w-4 h-4"}),"Inicializar Tipos del Sistema"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nombre"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Codigo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Uso"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:b.map(a=>e.jsx(W,{type:a,onView:M,onEdit:z,onToggle:P,onDelete:Q},a.id))})]})})})}),C.total>0&&e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["Mostrando ",b.length," de ",C.total," tipos de firmante"]}),e.jsx(H,{type:x,isOpen:c,onClose:q}),e.jsx(J,{type:n,isOpen:!!n,onClose:()=>i(null)})]})}export{ce as default};
