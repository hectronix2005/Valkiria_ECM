import{b as T,u as P,c as p,j as e}from"./vendor-query-BtlmzfbD.js";import{r as m}from"./vendor-router-CyR0tpch.js";import{i as x}from"./index-D3UX-zL7.js";import{C as w,c as C}from"./Card-CVFC4agM.js";import{B as h}from"./Button-Cc42oWsS.js";import{I as S}from"./Input-DPOK3q6H.js";import{B as Q}from"./Badge-Cv3EzJhT.js";import{an as E,P as _,e as q,U as z,n as L,ag as B,ao as I,ap as $,aq as A,W as U,X as G,l as R,Y as O}from"./vendor-icons-YtD_Ipmm.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";function K({type:s,isOpen:u,onClose:i,onSuccess:d}){const n=T(),l=!!s,[r,o]=m.useState({name:s?.name||"",code:s?.code||"",description:s?.description||""}),[g,c]=m.useState(""),j=p({mutationFn:t=>x.create(t),onSuccess:()=>{n.invalidateQueries(["signatory-types"]),d?.(),i()},onError:t=>{c(t.response?.data?.error||t.response?.data?.errors?.join(", ")||"Error al crear tipo de firmante")}}),y=p({mutationFn:t=>x.update(s.id,t),onSuccess:()=>{n.invalidateQueries(["signatory-types"]),d?.(),i()},onError:t=>{c(t.response?.data?.error||t.response?.data?.errors?.join(", ")||"Error al actualizar tipo de firmante")}}),N=t=>{if(t.preventDefault(),c(""),!r.name.trim()){c("El nombre es requerido");return}l?y.mutate(r):j.mutate(r)};return u?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:l?"Editar Tipo de Firmante":"Nuevo Tipo de Firmante"}),e.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:N,className:"p-4 space-y-4",children:[g&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:g})]}),e.jsx(S,{label:"Nombre",value:r.name,onChange:t=>o({...r,name:t.target.value}),placeholder:"Ej: Gerente de Operaciones",required:!0}),!l&&e.jsx(S,{label:"Codigo (se genera automaticamente)",value:r.code,onChange:t=>o({...r,code:t.target.value}),placeholder:"Ej: operations_manager",hint:"Solo letras minusculas, numeros y guiones bajos"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripcion"}),e.jsx("textarea",{value:r.description,onChange:t=>o({...r,description:t.target.value}),placeholder:"Descripcion del tipo de firmante...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:i,children:"Cancelar"}),e.jsxs(h,{type:"submit",loading:j.isPending||y.isPending,children:[e.jsx(O,{className:"w-4 h-4"}),l?"Guardar Cambios":"Crear Tipo"]})]})]})]})}):null}function W({type:s,onEdit:u,onToggle:i,onDelete:d}){const n=s.is_system;return e.jsxs("tr",{className:`${s.active?"":"opacity-50 bg-gray-50"}`,children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsx(L,{className:"w-3 h-3 text-gray-400"}),e.jsx(B,{className:"w-4 h-4 text-primary-500"}),e.jsx("span",{className:"font-medium",children:s.name})]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 ml-6",children:s.description})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:s.code})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(Q,{variant:n?"secondary":"default",className:"text-xs",children:n?"Sistema":"Personalizado"})}),e.jsx("td",{className:"px-4 py-3",children:s.in_use?e.jsxs("span",{className:"text-sm text-gray-600",children:[s.usage_count," plantilla(s)"]}):e.jsx("span",{className:"text-sm text-gray-400",children:"Sin usar"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>i(s),className:`p-1 rounded ${s.active?"text-green-600":"text-gray-400"}`,title:s.active?"Desactivar":"Activar",children:s.active?e.jsx(I,{className:"w-5 h-5"}):e.jsx($,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-1",children:!n&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(s),className:"p-1.5 hover:bg-gray-100 rounded text-gray-600",title:"Editar",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d(s),className:`p-1.5 rounded ${s.in_use?"text-gray-300 cursor-not-allowed":"hover:bg-red-50 text-red-500"}`,title:s.in_use?"No se puede eliminar (en uso)":"Eliminar",disabled:s.in_use,children:e.jsx(U,{className:"w-4 h-4"})})]})})})]})}function re(){const s=T(),[u,i]=m.useState(!1),[d,n]=m.useState(null),[l,r]=m.useState(""),[o,g]=m.useState(""),{data:c,isLoading:j}=P({queryKey:["signatory-types",{type:o}],queryFn:()=>x.list({type:o||void 0})}),y=p({mutationFn:a=>x.toggleActive(a),onSuccess:()=>s.invalidateQueries(["signatory-types"])}),N=p({mutationFn:a=>x.delete(a),onSuccess:()=>s.invalidateQueries(["signatory-types"]),onError:a=>{alert(a.response?.data?.error||"Error al eliminar")}}),t=p({mutationFn:()=>x.seedSystem(),onSuccess:()=>{s.invalidateQueries(["signatory-types"])}}),F=a=>{n(a),i(!0)},k=a=>{y.mutate(a.id)},M=a=>{if(a.in_use){alert(`No se puede eliminar este tipo porque esta siendo usado en ${a.usage_count} plantilla(s)`);return}confirm(`Â¿Esta seguro de eliminar el tipo de firmante "${a.name}"?`)&&N.mutate(a.id)},D=()=>{i(!1),n(null)},f=c?.data?.data||[],b=c?.data?.meta||{},v=l?f.filter(a=>a.name.toLowerCase().includes(l.toLowerCase())||a.code.toLowerCase().includes(l.toLowerCase())):f;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tipos de Firmante"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona los tipos de firmante disponibles para plantillas"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"secondary",onClick:()=>t.mutate(),loading:t.isPending,children:[e.jsx(E,{className:"w-4 h-4"}),"Inicializar Sistema"]}),e.jsxs(h,{onClick:()=>i(!0),children:[e.jsx(_,{className:"w-4 h-4"}),"Nuevo Tipo"]})]})]}),e.jsx(w,{children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar tipos de firmante...",value:l,onChange:a=>r(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsxs("select",{value:o,onChange:a=>g(a.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"system",children:"Sistema"}),e.jsx("option",{value:"custom",children:"Personalizados"})]})]})})}),e.jsx(w,{children:e.jsx(C,{className:"p-0",children:j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):v.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay tipos de firmante"}),e.jsx("p",{className:"text-gray-500 mb-4",children:f.length===0?"Inicializa los tipos del sistema o crea uno personalizado":"No se encontraron tipos con los filtros aplicados"}),f.length===0&&e.jsxs(h,{onClick:()=>t.mutate(),loading:t.isPending,children:[e.jsx(E,{className:"w-4 h-4"}),"Inicializar Tipos del Sistema"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nombre"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Codigo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Uso"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:v.map(a=>e.jsx(W,{type:a,onEdit:F,onToggle:k,onDelete:M},a.id))})]})})})}),b.total>0&&e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["Mostrando ",v.length," de ",b.total," tipos de firmante"]}),e.jsx(K,{type:d,isOpen:u,onClose:D})]})}export{re as default};
