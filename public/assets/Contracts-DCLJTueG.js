import{b as pe,u as G,c as V,j as e}from"./vendor-query-BtlmzfbD.js";import{r as d,a as na,L as ia}from"./vendor-router-CyR0tpch.js";import{u as ca,d as I,n as ie,h as Y,p as ce,o as da}from"./index-96AcdiF-.js";import{C as Te,c as oa}from"./Card-CVFC4agM.js";import{B as y}from"./Button-C8xCGhNf.js";import{I as w}from"./Input-DPOK3q6H.js";import{S as q}from"./Select-DLsgzIyk.js";import{M as J}from"./Modal-it_GQaMG.js";import{B as X}from"./Badge-Cv3EzJhT.js";import{F as U,as as ge,al as Pe,U as Ae,P as te,o as Le,c as he,O as Q,J as K,e as qe,a4 as de,m as oe,D as me,aF as xe,a1 as Me,a6 as ae,B as Re,aa as ma,t as xa,aB as ua,aq as be,Y as pa,aG as ga,l as Ie,i as ha,a8 as Ve,aw as De,X as Ee,r as ba,ao as ya,ap as ja,a9 as va,g as Na,ae as fa,af as _a,ag as Ca}from"./vendor-icons-BMeEPn6p.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const wa=[{value:"NIT",label:"NIT"},{value:"CC",label:"Cédula de Ciudadanía"},{value:"CE",label:"Cédula de Extranjería"},{value:"PA",label:"Pasaporte"}],se={third_party:"Tercero",contract:"Contrato",organization:"Organización",system:"Sistema",custom:"Personalizado"},Oe=[{value:"string",label:"Texto"},{value:"date",label:"Fecha"},{value:"number",label:"Número"},{value:"boolean",label:"Si/No"},{value:"email",label:"Email"}],Sa={third_party:"indigo",contract:"blue",organization:"purple",system:"gray",custom:"orange"};function ka({mapping:t,isOpen:S,onClose:N,onSuccess:P}){const v=pe(),u=!!t,[f,n]=d.useState({name:t?.name||"",key:t?.key||"",category:t?.category||"custom",description:t?.description||"",data_type:t?.data_type||"string"}),[k,g]=d.useState("");d.useEffect(()=>{t&&S?n({name:t.name||"",key:t.key||"",category:t.category||"custom",description:t.description||"",data_type:t.data_type||"string"}):!t&&S&&n({name:"",key:"",category:"custom",description:"",data_type:"string"})},[t,S]);const r=V({mutationFn:c=>u?Y.update(t.id,c):Y.create(c),onSuccess:()=>{v.invalidateQueries(["variable-mappings-legal"]),P?.(),N()},onError:c=>{g(c.response?.data?.error||"Error al guardar")}}),p=c=>{c.preventDefault(),g(""),r.mutate(f)};return S?e.jsx(J,{isOpen:S,onClose:N,title:u?"Editar Variable":"Nueva Variable",children:e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[k&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:k}),e.jsx(w,{label:"Nombre de la Variable",value:f.name,onChange:c=>n({...f,name:c.target.value}),placeholder:"Ej: Nombre del Tercero",required:!0}),e.jsx(w,{label:"Clave (key)",value:f.key,onChange:c=>n({...f,key:c.target.value}),placeholder:"Ej: third_party.display_name",required:!0,disabled:u}),e.jsx(q,{label:"Categoría",value:f.category,onChange:c=>n({...f,category:c.target.value}),options:Object.entries(se).map(([c,m])=>({value:c,label:m}))}),e.jsx(q,{label:"Tipo de Dato",value:f.data_type,onChange:c=>n({...f,data_type:c.target.value}),options:Oe}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{value:f.description,onChange:c=>n({...f,description:c.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Descripción de la variable..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:N,children:"Cancelar"}),e.jsx(y,{type:"submit",loading:r.isPending,children:u?"Guardar":"Crear"})]})]})}):null}function Ta({isOpen:t,onClose:S}){const[N,P]=d.useState(""),[v,u]=d.useState(""),[f,n]=d.useState(!1),[k,g]=d.useState(null),[r,p]=d.useState("name"),[c,m]=d.useState("asc"),x=pe(),{data:A,isLoading:T}=G({queryKey:["variable-mappings-legal"],queryFn:()=>Y.list(),enabled:t}),b=V({mutationFn:l=>Y.toggle(l),onSuccess:()=>{x.invalidateQueries(["variable-mappings-legal"])}}),j=V({mutationFn:()=>Y.seedSystem(),onSuccess:()=>{x.invalidateQueries(["variable-mappings-legal"])}}),D=Object.keys(se),_=(A?.data?.data||[]).filter(l=>D.includes(l.category));let E=_.filter(l=>{const M=!N||l.name.toLowerCase().includes(N.toLowerCase())||l.key.toLowerCase().includes(N.toLowerCase()),L=!v||l.category===v;return M&&L});E=[...E].sort((l,M)=>{const L=l[r]||"",W=M[r]||"",Z=L.localeCompare(W);return c==="asc"?Z:-Z});const a=l=>{r===l?m(c==="asc"?"desc":"asc"):(p(l),m("asc"))},i=({field:l})=>r!==l?e.jsx(fa,{className:"h-3 w-3 text-gray-400"}):c==="asc"?e.jsx(_a,{className:"h-3 w-3 text-indigo-600"}):e.jsx(Ca,{className:"h-3 w-3 text-indigo-600"}),C=l=>{g(l),n(!0)};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Variables de Contratos"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestiona las variables para documentos comerciales"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{size:"sm",variant:"secondary",onClick:()=>j.mutate(),loading:j.isPending,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Sincronizar"]}),e.jsxs(y,{size:"sm",onClick:()=>{g(null),n(!0)},children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Nueva Variable"]}),e.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(Ee,{className:"h-5 w-5 text-gray-500"})})]})]}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre o clave...",value:N,onChange:l=>P(l.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("select",{value:v,onChange:l=>u(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),Object.entries(se).map(([l,M])=>e.jsx("option",{value:l,children:M},l))]}),(N||v)&&e.jsxs("button",{onClick:()=>{P(""),u("")},className:"flex items-center gap-1 text-gray-500 hover:text-gray-700",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Limpiar"]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:T?e.jsx("div",{className:"p-4 space-y-3",children:[1,2,3,4,5].map(l=>e.jsx("div",{className:"animate-pulse h-12 bg-gray-100 rounded-lg"},l))}):E.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay variables"}),e.jsx("p",{className:"text-gray-500 mb-4",children:N||v?"No se encontraron variables con los filtros aplicados":'Haz clic en "Sincronizar" para cargar las variables del sistema'}),!N&&!v&&e.jsxs(y,{onClick:()=>j.mutate(),children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Sincronizar Sistema"]})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100",onClick:()=>a("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Variable ",e.jsx(i,{field:"name"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100",onClick:()=>a("category"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Categoría ",e.jsx(i,{field:"category"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{children:E.map(l=>{const M=Sa[l.category]||"gray";return e.jsxs("tr",{className:"hover:bg-gray-50 border-b border-gray-100",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[l.is_system&&e.jsx(ba,{className:"h-3 w-3 text-gray-400",title:"Variable del sistema"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:l.name}),e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:l.key})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(X,{status:M,children:se[l.category]||l.category})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600",children:Oe.find(L=>L.value===l.data_type)?.label||l.data_type})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>b.mutate(l.id),className:`p-1 rounded transition-colors ${l.active?"text-green-600 hover:bg-green-50":"text-gray-400 hover:bg-gray-100"}`,title:l.active?"Activa":"Inactiva",children:l.active?e.jsx(ya,{className:"h-5 w-5"}):e.jsx(ja,{className:"h-5 w-5"})})}),e.jsx("td",{className:"px-4 py-3 text-right",children:!l.is_system&&e.jsx("button",{onClick:()=>C(l),className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",title:"Editar",children:e.jsx(be,{className:"h-4 w-4"})})})]},l.id)})})]})}),E.length>0&&e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50 text-sm text-gray-600",children:["Mostrando ",E.length," de ",_.length," variables"]}),e.jsx(ka,{mapping:k,isOpen:f,onClose:()=>{n(!1),g(null)}})]})}):null}function Da({template:t,onSubmit:S,onCancel:N,isLoading:P,thirdPartyTypes:v}){const[u,f]=d.useState("juridical"),[n,k]=d.useState({third_party_type:"provider",person_type:"juridical",identification_type:"NIT",identification_number:"",verification_digit:"",business_name:"",trade_name:"",first_name:"",last_name:"",email:"",phone:"",mobile:"",address:"",city:"",state:"",country:"Colombia",legal_rep_name:"",legal_rep_id_type:"CC",legal_rep_id_number:"",legal_rep_id_city:"",legal_rep_email:"",legal_rep_phone:"",bank_name:"",bank_account_type:"",bank_account_number:"",tax_regime:"",industry:"",website:""}),[g,r]=d.useState({}),{data:p,isLoading:c}=G({queryKey:["template-requirements",t?.id],queryFn:()=>ce.getThirdPartyRequirements(t.id),enabled:!!t?.id}),m=p?.data?.data||{},x=m.required_fields||[],A=x.map(a=>a.field);d.useEffect(()=>{m.suggested_person_type&&(f(m.suggested_person_type),k(a=>({...a,person_type:m.suggested_person_type,identification_type:m.suggested_person_type==="juridical"?"NIT":"CC",third_party_type:m.default_third_party_type||a.third_party_type})))},[m]);const T=a=>["identification_number","email"].includes(a)||u==="juridical"&&a==="business_name"||u==="natural"&&["first_name","last_name"].includes(a)?!0:A.includes(a),b=a=>{if(["identification_type","identification_number","email","phone"].includes(a))return!0;if(u==="juridical"){if(["business_name","trade_name","verification_digit"].includes(a))return!0}else if(["first_name","last_name"].includes(a))return!0;return A.includes(a)},j=(a,i)=>{k(C=>({...C,[a]:i})),g[a]&&r(C=>({...C,[a]:null}))},D=a=>{f(a),k(i=>({...i,person_type:a,identification_type:a==="juridical"?"NIT":"CC"}))},o=()=>{const a={};return n.identification_number.trim()||(a.identification_number="Número de identificación requerido"),n.email.trim()||(a.email="Correo electrónico requerido"),u==="juridical"&&!n.business_name.trim()&&(a.business_name="Razón social requerida"),u==="natural"&&(n.first_name.trim()||(a.first_name="Nombre requerido"),n.last_name.trim()||(a.last_name="Apellido requerido")),x.forEach(i=>{i.person_type&&i.person_type!==u||n[i.field]?.toString().trim()||(a[i.field]=`${i.label} es requerido por el template`)}),r(a),Object.keys(a).length===0},_=a=>{a.preventDefault(),o()&&S(n)};if(c)return e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando requisitos del template..."})]});const E=m.variables_count??m.variables?.length??0;return e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[t&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ie,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-blue-900",children:["Crear tercero para: ",t.name," (",c?"...":E," variables)"]}),x.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("p",{className:"text-sm text-blue-700 font-medium flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Datos del Tercero (",x.length," campos a completar):"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:x.map((a,i)=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded",children:a.variable},i))})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-green-700 font-medium flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Datos del Contrato (se toman del formulario):"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(m.variables||[]).filter(a=>["Valor","Periodicidad de Pago","Monto","Condiciones de Pago"].some(i=>a.toLowerCase().includes(i.toLowerCase()))).map((a,i)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded",children:[a," ✓"]},i))})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-600 font-medium flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full"}),"Automático (fecha del sistema):"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:(m.variables||[]).filter(a=>a.toLowerCase().includes("fecha")||a.toLowerCase().includes("dia")||a.toLowerCase().includes("año")||a.toLowerCase().includes("ano")).map((a,i)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:[a," ✓"]},i))})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>D("juridical"),className:`p-4 border-2 rounded-lg text-left transition-all ${u==="juridical"?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(va,{className:`h-6 w-6 mb-2 ${u==="juridical"?"text-indigo-600":"text-gray-400"}`}),e.jsx("p",{className:`font-medium ${u==="juridical"?"text-indigo-900":"text-gray-700"}`,children:"Persona Jurídica"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Empresa, sociedad"})]}),e.jsxs("button",{type:"button",onClick:()=>D("natural"),className:`p-4 border-2 rounded-lg text-left transition-all ${u==="natural"?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(Na,{className:`h-6 w-6 mb-2 ${u==="natural"?"text-indigo-600":"text-gray-400"}`}),e.jsx("p",{className:`font-medium ${u==="natural"?"text-indigo-900":"text-gray-700"}`,children:"Persona Natural"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Individuo, freelancer"})]})]}),e.jsx(q,{label:"Tipo de Tercero",value:n.third_party_type,onChange:a=>j("third_party_type",a.target.value),options:v.map(a=>({value:a.code,label:a.name}))}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(q,{label:"Tipo ID",value:n.identification_type,onChange:a=>j("identification_type",a.target.value),options:wa}),e.jsx(w,{label:"Número de Identificación *",value:n.identification_number,onChange:a=>j("identification_number",a.target.value),placeholder:u==="juridical"?"900123456":"12345678",error:g.identification_number}),u==="juridical"&&e.jsx(w,{label:"Dígito Verificación",value:n.verification_digit,onChange:a=>j("verification_digit",a.target.value),placeholder:"7",maxLength:1})]}),u==="juridical"?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(w,{label:"Razón Social *",value:n.business_name,onChange:a=>j("business_name",a.target.value),placeholder:"EMPRESA S.A.S.",error:g.business_name}),e.jsx(w,{label:"Nombre Comercial",value:n.trade_name,onChange:a=>j("trade_name",a.target.value),placeholder:"Mi Empresa"})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(w,{label:"Nombre *",value:n.first_name,onChange:a=>j("first_name",a.target.value),placeholder:"Juan",error:g.first_name}),e.jsx(w,{label:"Apellido *",value:n.last_name,onChange:a=>j("last_name",a.target.value),placeholder:"Pérez",error:g.last_name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(w,{label:"Correo Electrónico *",type:"email",value:n.email,onChange:a=>j("email",a.target.value),placeholder:"contacto@empresa.com",error:g.email}),e.jsx(w,{label:"Teléfono",value:n.phone,onChange:a=>j("phone",a.target.value),placeholder:"(601) 234-5678"})]}),(b("address")||b("city"))&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b("address")&&e.jsx(w,{label:`Dirección${T("address")?" *":""}`,value:n.address,onChange:a=>j("address",a.target.value),placeholder:"Calle 123 # 45-67",error:g.address}),b("city")&&e.jsx(w,{label:`Ciudad${T("city")?" *":""}`,value:n.city,onChange:a=>j("city",a.target.value),placeholder:"Bogotá",error:g.city})]}),u==="juridical"&&(b("legal_rep_name")||b("legal_rep_id_number")||b("legal_rep_id_city"))&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Representante Legal"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b("legal_rep_name")&&e.jsx(w,{label:`Nombre${T("legal_rep_name")?" *":""}`,value:n.legal_rep_name,onChange:a=>j("legal_rep_name",a.target.value),placeholder:"Carlos García",error:g.legal_rep_name}),b("legal_rep_id_number")&&e.jsx(w,{label:`Cédula${T("legal_rep_id_number")?" *":""}`,value:n.legal_rep_id_number,onChange:a=>j("legal_rep_id_number",a.target.value),placeholder:"12345678",error:g.legal_rep_id_number}),b("legal_rep_id_city")&&e.jsx(w,{label:`Ciudad Expedición Cédula${T("legal_rep_id_city")?" *":""}`,value:n.legal_rep_id_city,onChange:a=>j("legal_rep_id_city",a.target.value),placeholder:"Bogotá",error:g.legal_rep_id_city}),b("legal_rep_email")&&e.jsx(w,{label:`Email${T("legal_rep_email")?" *":""}`,type:"email",value:n.legal_rep_email,onChange:a=>j("legal_rep_email",a.target.value),placeholder:"representante@empresa.com",error:g.legal_rep_email})]})]}),(b("bank_name")||b("bank_account_number"))&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Información Bancaria"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[b("bank_name")&&e.jsx(w,{label:`Banco${T("bank_name")?" *":""}`,value:n.bank_name,onChange:a=>j("bank_name",a.target.value),placeholder:"Bancolombia",error:g.bank_name}),b("bank_account_type")&&e.jsx(q,{label:`Tipo Cuenta${T("bank_account_type")?" *":""}`,value:n.bank_account_type,onChange:a=>j("bank_account_type",a.target.value),options:[{value:"",label:"Seleccionar..."},{value:"savings",label:"Ahorros"},{value:"checking",label:"Corriente"}],error:g.bank_account_type}),b("bank_account_number")&&e.jsx(w,{label:`Número Cuenta${T("bank_account_number")?" *":""}`,value:n.bank_account_number,onChange:a=>j("bank_account_number",a.target.value),placeholder:"1234567890",error:g.bank_account_number})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:N,children:"Cancelar"}),e.jsxs(y,{type:"submit",loading:P,children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Crear Tercero"]})]})]})}const ue=[{value:"services",label:"Prestación de Servicios"},{value:"purchase",label:"Compraventa"},{value:"nda",label:"Confidencialidad (NDA)"},{value:"lease",label:"Arrendamiento"},{value:"partnership",label:"Alianza/Asociación"},{value:"consulting",label:"Consultoría"},{value:"maintenance",label:"Mantenimiento"},{value:"license",label:"Licencia"},{value:"other",label:"Otro"}],Fe={draft:{color:"gray",bg:"bg-gray-100",text:"text-gray-700",icon:U,label:"Borrador"},pending_approval:{color:"yellow",bg:"bg-yellow-100",text:"text-yellow-700",icon:Le,label:"En Aprobación"},pending_signatures:{color:"purple",bg:"bg-purple-100",text:"text-purple-700",icon:he,label:"Pendiente Firmas"},approved:{color:"blue",bg:"bg-blue-100",text:"text-blue-700",icon:Q,label:"Aprobado"},rejected:{color:"red",bg:"bg-red-100",text:"text-red-700",icon:ae,label:"Rechazado"},active:{color:"green",bg:"bg-green-100",text:"text-green-700",icon:Q,label:"Activo"},expired:{color:"orange",bg:"bg-orange-100",text:"text-orange-700",icon:K,label:"Vencido"},terminated:{color:"gray",bg:"bg-gray-100",text:"text-gray-600",icon:ae,label:"Terminado"},cancelled:{color:"gray",bg:"bg-gray-100",text:"text-gray-600",icon:ae,label:"Cancelado"},archived:{color:"slate",bg:"bg-slate-100",text:"text-slate-600",icon:ge,label:"Archivado"}};function Ea({template:t,thirdParties:S,thirdPartyTypes:N,onSubmit:P,onCancel:v,onBack:u,isLoading:f,onEditThirdParty:n,onCreateThirdParty:k,creatingThirdParty:g}){const[r,p]=d.useState({title:"",description:"",contract_type:"services",third_party_id:"",start_date:"",end_date:"",amount:"",currency:"COP",payment_terms:"",payment_frequency:"",template_id:t?.id||""}),[c,m]=d.useState(!0),[x,A]=d.useState(null),[T,b]=d.useState(!1),[j,D]=d.useState(!1);d.useEffect(()=>{const i=setTimeout(async()=>{if(!t?.id||!r.third_party_id){A(null);return}b(!0);try{const C=await I.validateTemplate({template_id:t.id,third_party_id:r.third_party_id,amount:r.amount||0,start_date:r.start_date,end_date:r.end_date,description:r.description,contract_type:r.contract_type,payment_terms:r.payment_terms,payment_frequency:r.payment_frequency});A(C.data)}catch(C){console.error("Validation error:",C),A(null)}finally{b(!1)}},500);return()=>clearTimeout(i)},[t?.id,r.third_party_id,r.amount,r.start_date,r.end_date,r.payment_terms||"",r.payment_frequency||""]);const o=()=>{const a=ue.find(l=>l.value===r.contract_type)?.label||"",i=S.find(l=>l.id===r.third_party_id),C=i?.trade_name||i?.business_name||i?.display_name||"";return a&&C?`${a} - ${C}`:""};d.useEffect(()=>{if(c){const a=o();a&&p(i=>({...i,title:a}))}},[r.contract_type,r.third_party_id,c]);const _=(a,i)=>{a==="title"&&m(!1),p(C=>({...C,[a]:i}))},E=a=>{a.preventDefault(),P(r)};return e.jsxs(e.Fragment,{children:[j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Crear Nuevo Tercero"}),e.jsx("p",{className:"text-sm text-gray-500",children:"El tercero se creará con los campos requeridos por el template"})]}),e.jsx("div",{className:"p-6",children:e.jsx(Da,{template:t,thirdPartyTypes:N,onSubmit:a=>{k(a,i=>{p(C=>({...C,third_party_id:i.id})),D(!1)})},onCancel:()=>D(!1),isLoading:g})})]})}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:e.jsx(he,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:"Template seleccionado"}),e.jsx("p",{className:"font-semibold text-indigo-900",children:t?.name}),e.jsxs("p",{className:"text-xs text-indigo-500",children:[t?.variables_count??t?.variables?.length??0," variables configuradas"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(q,{label:"Tipo de Contrato",value:r.contract_type,onChange:a=>_("contract_type",a.target.value),options:ue,required:!0}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tercero *"}),e.jsxs("button",{type:"button",onClick:()=>D(!0),className:"text-xs text-indigo-600 hover:text-indigo-800 flex items-center gap-1",children:[e.jsx(Ve,{className:"h-3 w-3"}),"Crear nuevo"]})]}),e.jsxs("select",{value:r.third_party_id,onChange:a=>_("third_party_id",a.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"",children:"Seleccionar tercero..."}),S.map(a=>e.jsxs("option",{value:a.id,children:[a.display_name," (",a.code,")"]},a.id))]}),S.length===0&&e.jsx("p",{className:"mt-1 text-xs text-amber-600",children:"No hay terceros activos. Crea uno nuevo para continuar."})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Título del Contrato"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:a=>{if(m(a.target.checked),a.target.checked){const i=o();i&&p(C=>({...C,title:i}))}},className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-600",children:"Sugerir nombre"})]})]}),e.jsx("input",{type:"text",value:r.title,onChange:a=>_("title",a.target.value),placeholder:c?"Selecciona tipo y tercero...":"Ej: Contrato de Servicios TI 2025",required:!0,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 ${c?"border-primary-300 bg-primary-50":"border-gray-300"}`}),c&&o()&&e.jsx("p",{className:"mt-1 text-xs text-primary-600",children:"Nombre generado automáticamente desde Tipo + Tercero"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{value:r.description||"",onChange:a=>_("description",a.target.value),rows:3,placeholder:"Describe el objeto del contrato...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(w,{label:"Fecha Inicio",type:"date",value:r.start_date,onChange:a=>_("start_date",a.target.value),required:!0}),e.jsx(w,{label:"Fecha Fin",type:"date",value:r.end_date,onChange:a=>_("end_date",a.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(w,{label:"Monto",type:"number",value:r.amount,onChange:a=>_("amount",a.target.value),placeholder:"0",required:!0}),e.jsx(q,{label:"Moneda",value:r.currency,onChange:a=>_("currency",a.target.value),options:[{value:"COP",label:"COP (Pesos)"},{value:"USD",label:"USD (Dólares)"},{value:"EUR",label:"EUR (Euros)"}]}),e.jsx(q,{label:"Periodicidad de Pago",value:r.payment_frequency,onChange:a=>_("payment_frequency",a.target.value),options:[{value:"",label:"Seleccionar..."},{value:"monthly",label:"Mensual"},{value:"bimonthly",label:"Bimestral"},{value:"quarterly",label:"Trimestral"},{value:"semiannual",label:"Semestral"},{value:"annual",label:"Anual"},{value:"one_time",label:"Pago Único"}]}),e.jsx(w,{label:"Condiciones de Pago",value:r.payment_terms||"",onChange:a=>_("payment_terms",a.target.value),placeholder:"Ej: 30 días"})]}),r.amount&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Nivel de aprobación estimado:"})," ",Number(r.amount)<=1e7&&"Nivel 1 (Jefe de Área)",Number(r.amount)>1e7&&Number(r.amount)<=5e7&&"Nivel 2 (Jefe de Área → Legal)",Number(r.amount)>5e7&&Number(r.amount)<=2e8&&"Nivel 3 (Jefe de Área → Legal → Gerente)",Number(r.amount)>2e8&&"Nivel 4 (Jefe de Área → Legal → Gerente → CEO)"]})}),T&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Validando datos del template..."})]})}),x&&!T&&(x.valid?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-700",children:["Todos los datos están completos (",x.validation.resolved_count,"/",x.template.total_variables," variables)"]})]})}):e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(K,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-red-700 mb-2",children:["Faltan datos para generar el documento (",x.validation.missing_count," de ",x.template.total_variables,")"]}),e.jsxs("div",{className:"space-y-1",children:[x.validation.missing_by_source?.third_party?.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-red-600",children:"Datos del Tercero:"}),e.jsx("ul",{className:"ml-4 list-disc text-red-600",children:x.validation.missing_by_source.third_party.map((a,i)=>e.jsx("li",{children:a.label},i))})]}),x.validation.missing_by_source?.contract?.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-red-600",children:"Datos del Contrato:"}),e.jsx("ul",{className:"ml-4 list-disc text-red-600",children:x.validation.missing_by_source.contract.map((a,i)=>e.jsx("li",{children:a.label},i))})]}),x.validation.missing_by_source?.unmapped?.length>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-amber-600",children:"Variables sin mapear:"}),e.jsx("ul",{className:"ml-4 list-disc text-amber-600",children:x.validation.missing_by_source.unmapped.map((a,i)=>e.jsx("li",{children:a.variable},i))})]})]}),e.jsx("p",{className:"text-xs text-red-500 mt-2",children:"Complete los datos faltantes del tercero o contacte a un administrador para mapear las variables."}),x.validation.missing_by_source?.third_party?.length>0&&r.third_party_id&&n&&e.jsxs(y,{type:"button",variant:"secondary",size:"sm",className:"mt-3",onClick:()=>{const a=S.find(i=>i.id===r.third_party_id);a&&n(a,x.validation.missing_by_source.third_party)},children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Completar datos del tercero"]})]})]})})),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx(y,{type:"button",variant:"ghost",onClick:u,children:"← Cambiar Template"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:v,children:"Cancelar"}),e.jsxs(y,{type:"submit",loading:f,disabled:T||x&&!x.valid,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Crear Contrato"]})]})]})]})]})}function Fa({templates:t,onSelect:S,onCancel:N,isLoading:P}){const[v,u]=d.useState(""),f=t.find(r=>r.id===v),n=t.filter(r=>r.module_type==="legal"||r.main_category==="comercial"),k=t.filter(r=>r.module_type==="hr"||r.main_category==="laboral"),g=r=>e.jsx("div",{onClick:()=>u(r.id),className:`
        p-4 border-2 rounded-lg cursor-pointer transition-all
        ${v===r.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}
      `,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${v===r.id?"bg-indigo-100":"bg-gray-100"}`,children:e.jsx(U,{className:`h-5 w-5 ${v===r.id?"text-indigo-600":"text-gray-500"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${v===r.id?"text-indigo-900":"text-gray-900"}`,children:r.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.category_label," • ",r.variables_count??r.variables?.length??0," variables"]})]})]}),v===r.id&&e.jsx(Q,{className:"h-5 w-5 text-indigo-600"})]})},r.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ie,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Selecciona un template"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Los contratos se generan a partir de templates predefinidos. Selecciona el template que mejor se ajuste al tipo de contrato."})]})]})}),t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay templates disponibles"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Para crear contratos, primero debes crear templates en las categorías Legal o Recursos Humanos."}),e.jsx(y,{variant:"secondary",onClick:N,children:"Cerrar"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[n.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-1.5 bg-purple-100 rounded-lg",children:e.jsx(Re,{className:"h-4 w-4 text-purple-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Gestión Legal"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",n.length,")"]})]}),e.jsx("div",{className:"grid gap-3",children:n.map(g)})]}),k.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-1.5 bg-green-100 rounded-lg",children:e.jsx(Ae,{className:"h-4 w-4 text-green-600"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Recursos Humanos"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",k.length,")"]})]}),e.jsx("div",{className:"grid gap-3",children:k.map(g)})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(y,{variant:"secondary",onClick:N,children:"Cancelar"}),e.jsxs(y,{onClick:()=>S(f),disabled:!v,children:["Continuar",e.jsx(ha,{className:"h-4 w-4 ml-2"})]})]})]})]})}function Pa({contract:t,onView:S,onEdit:N,onSubmit:P,onDownload:v,onViewDocument:u,onGenerate:f,onDelete:n,onArchive:k,onUnarchive:g,isAdmin:r,showArchived:p}){const[c,m]=d.useState(!1),x=Fe[t.status]||Fe.draft,A=x.icon,T=(_,E)=>new Intl.NumberFormat("es-CO",{style:"currency",currency:E||"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(_),b=_=>_?new Date(_).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"-",j=["approved","active"].includes(t.status)&&!t.has_document,D=t.status==="draft",o=t.status==="draft";return e.jsxs("tr",{className:"hover:bg-gray-50 border-b border-gray-100",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${x.bg}`,children:e.jsx(A,{className:`h-4 w-4 ${x.text}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[200px]",title:t.title,children:t.title}),e.jsx("p",{className:"text-xs text-gray-500",children:t.contract_number})]})]})}),e.jsx("td",{className:"px-4 py-3",children:t.third_party?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900 truncate max-w-[150px]",title:t.third_party.display_name,children:t.third_party.display_name})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-700",children:t.type_label})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ma,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:T(t.amount,t.currency)})]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(xa,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{children:b(t.start_date)}),e.jsx("span",{className:"text-gray-400",children:"→"}),e.jsx("span",{children:b(t.end_date)})]}),t.expiring_soon&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(K,{className:"h-3 w-3 text-orange-500"}),e.jsxs("span",{className:"text-xs text-orange-600",children:["Vence en ",t.days_until_expiry," días"]})]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(X,{status:x.color,children:x.label})}),e.jsx("td",{className:"px-4 py-3",children:t.status==="pending_approval"?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-1.5 w-20",children:e.jsx("div",{className:"bg-yellow-500 h-1.5 rounded-full transition-all",style:{width:`${t.approval_progress}%`}})}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.approval_progress,"%"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 truncate",title:t.current_approver_label,children:["→ ",t.current_approver_label]})]}):t.status==="approved"||t.status==="active"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-xs text-green-600",children:"Completa"})]}):t.status==="rejected"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-xs text-red-600",children:"Rechazado"})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"relative flex items-center justify-end gap-1",children:[D&&e.jsx("button",{onClick:()=>P(t.id),className:"p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Enviar a Aprobación",children:e.jsx(Me,{className:"h-4 w-4"})}),j&&e.jsx("button",{onClick:()=>f(t),className:"p-1.5 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Generar Documento",children:e.jsx(de,{className:"h-4 w-4"})}),t.has_document&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(t),className:"p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Ver Documento",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>v(t.id),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Descargar PDF",children:e.jsx(me,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>m(!c),className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ua,{className:"h-4 w-4"})}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>m(!1)}),e.jsxs("div",{className:"absolute right-0 bottom-full mb-1 bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-20 min-w-[160px]",children:[e.jsxs("button",{onClick:()=>{S(t.id),m(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Ver Detalle"]}),o&&e.jsxs("button",{onClick:()=>{N(t),m(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Editar"]}),t.can_delete&&e.jsxs("button",{onClick:()=>{confirm("¿Estás seguro de eliminar este contrato? Esta acción no se puede deshacer.")&&n(t.id),m(!1)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(pa,{className:"h-4 w-4"}),"Eliminar"]}),r&&!p&&["active","expired","terminated","cancelled"].includes(t.status)&&e.jsxs("button",{onClick:()=>{k(t.id),m(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2 border-t border-gray-100",children:[e.jsx(ge,{className:"h-4 w-4"}),"Archivar"]}),r&&p&&t.status==="archived"&&e.jsxs("button",{onClick:()=>{g(t.id),m(!1)},className:"w-full px-4 py-2 text-left text-sm text-green-600 hover:bg-green-50 flex items-center gap-2",children:[e.jsx(ga,{className:"h-4 w-4"}),"Restaurar"]})]})]})]})]})})]})}function Aa(){return e.jsx("tbody",{children:[1,2,3,4,5].map(t=>e.jsxs("tr",{className:"border-b border-gray-100 animate-pulse",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-10 bg-gray-200 rounded w-48"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-5 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-5 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-5 bg-gray-200 rounded w-28"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-5 bg-gray-200 rounded w-36"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-6 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-5 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-8 bg-gray-200 rounded w-24"})})]},t))})}function Ja(){const[t,S]=d.useState(""),[N,P]=d.useState(""),[v,u]=d.useState(""),[f,n]=d.useState(!1),[k,g]=d.useState(1),[r,p]=d.useState(null),[c,m]=d.useState(!1),[x,A]=d.useState(null),[T,b]=d.useState(""),[j,D]=d.useState(!1),[o,_]=d.useState(null),[E,a]=d.useState(null),[i,C]=d.useState([]),[l,M]=d.useState(null),[L,W]=d.useState(null),[Z,ye]=d.useState(!1),[ze,je]=d.useState(!1),[O,$e]=d.useState(!1);na();const z=pe(),{isAdmin:ve}=ca(),{data:Be,isLoading:Ge}=G({queryKey:["contracts",t,N,v,O],queryFn:()=>I.list({search:t||void 0,type:N||void 0,status:v||void 0,archived:O?"true":void 0})}),{data:Ue}=G({queryKey:["third-parties-active"],queryFn:()=>ie.list({status:"active",per_page:100})}),{data:Qe}=G({queryKey:["templates-comercial"],queryFn:()=>ce.list({main_category:"comercial"})}),{data:Je}=G({queryKey:["templates-laboral"],queryFn:()=>ce.list({main_category:"laboral"})}),{data:Ke}=G({queryKey:["third-party-types-active"],queryFn:()=>da.list({active:"true"})}),Ne=V({mutationFn:async s=>{const h=await I.create(s),F=h.data?.data;if(F?.id&&s.template_id)try{await I.generateDocument(F.id,s.template_id)}catch(R){console.warn("Auto-generate failed:",R)}return h},onSuccess:()=>{z.invalidateQueries(["contracts"]),ee()},onError:s=>{const h=s.response?.data?.error||s.response?.data?.errors?.join(", ")||"Error al crear contrato";alert(h)}}),re=V({mutationFn:s=>I.submit(s),onSuccess:()=>{z.invalidateQueries(["contracts"])}}),He=V({mutationFn:s=>I.delete(s),onSuccess:()=>{z.invalidateQueries(["contracts"]),alert("Contrato eliminado correctamente")},onError:s=>{alert(s.response?.data?.error||s.response?.data?.errors?.join(", ")||"Error al eliminar contrato")}}),Ye=V({mutationFn:s=>I.archive(s),onSuccess:()=>{z.invalidateQueries(["contracts"])},onError:s=>{alert(s.response?.data?.error||"Error al archivar contrato")}}),Xe=V({mutationFn:s=>I.unarchive(s),onSuccess:()=>{z.invalidateQueries(["contracts"])},onError:s=>{alert(s.response?.data?.error||"Error al restaurar contrato")}}),le=V({mutationFn:({contractId:s,templateId:h})=>I.generateDocument(s,h),onSuccess:()=>{z.invalidateQueries(["contracts"]),m(!1),A(null),b("")},onError:s=>{alert(s.response?.data?.error||s.response?.data?.missing_variables||"Error al generar documento")}}),fe=V({mutationFn:({id:s,data:h})=>ie.update(s,h),onSuccess:()=>{z.invalidateQueries(["third-parties-active"]),a(null),C([])}}),_e=V({mutationFn:s=>ie.create(s),onSuccess:s=>(z.invalidateQueries(["third-parties-active"]),s.data?.data),onError:s=>{const h=s.response?.data?.errors||[],F=h.length>0?h.join(", "):s.response?.data?.error||"Error al crear tercero";alert(F)}}),$=Be?.data?.data||[],We=Ue?.data?.data||[],Ze=Qe?.data?.data||[],ea=Je?.data?.data||[],B=[...Ze,...ea],aa=Ke?.data?.data||[],ee=()=>{n(!1),g(1),p(null)},sa=s=>{p(s),g(2)},Ce=async s=>{try{const h=await I.downloadDocument(s),F=new Blob([h.data],{type:"application/pdf"}),R=window.URL.createObjectURL(F),ne=document.createElement("a");ne.href=R,ne.download=`contrato-${s}.pdf`,ne.click(),window.URL.revokeObjectURL(R)}catch(h){console.error("Error downloading document:",h);const F=h.response?.data?.error||"Error al descargar el documento";alert(F)}},we=async s=>{M(s),ye(!0);try{const h=await I.downloadDocument(s.id),F=new Blob([h.data],{type:"application/pdf"}),R=URL.createObjectURL(F);W(R)}catch(h){console.error("Error loading document:",h);const F=h.response?.data?.error||"Error al cargar el documento";alert(F),M(null)}finally{ye(!1)}},Se=()=>{L&&URL.revokeObjectURL(L),M(null),W(null)},ke=s=>{s.template_id?le.mutate({contractId:s.id,templateId:s.template_id}):(A(s),b(""),m(!0))},ta=s=>{confirm("¿Estás seguro de eliminar este contrato?")&&He.mutate(s)},ra=s=>{confirm("¿Estás seguro de archivar este contrato? Los contratos archivados no aparecen en la lista principal.")&&Ye.mutate(s)},la=s=>{confirm("¿Restaurar este contrato del archivo?")&&Xe.mutate(s)},H={total:$.length,pending:$.filter(s=>s.status==="pending_approval").length,pendingSignatures:$.filter(s=>s.status==="pending_signatures").length,active:$.filter(s=>s.status==="active").length,expiring:$.filter(s=>s.expiring_soon).length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:O?"Contratos Archivados":"Contratos"}),e.jsx("p",{className:"text-gray-500",children:O?"Contratos que han sido archivados":"Gestión de contratos con aprobación multinivel"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ve&&e.jsx(y,{variant:O?"primary":"secondary",onClick:()=>$e(!O),children:O?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Ver Activos"]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Ver Archivados"]})}),e.jsxs(y,{variant:"secondary",onClick:()=>je(!0),children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Variables"]}),e.jsx(ia,{to:"/legal/third-parties",children:e.jsxs(y,{variant:"secondary",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Terceros"]})}),!O&&e.jsxs(y,{onClick:()=>n(!0),disabled:B.length===0,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Nuevo Contrato"]})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(U,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:H.total}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(Le,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:H.pending}),e.jsx("p",{className:"text-sm text-gray-500",children:"En Aprobación"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(he,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:H.pendingSignatures}),e.jsx("p",{className:"text-sm text-gray-500",children:"Pend. Firmas"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Q,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:H.active}),e.jsx("p",{className:"text-sm text-gray-500",children:"Activos"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(K,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:H.expiring}),e.jsx("p",{className:"text-sm text-gray-500",children:"Por Vencer"})]})]})})]}),B.length===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(K,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-900",children:"No hay templates de contratos"}),e.jsx("p",{className:"text-sm text-yellow-700",children:'Para crear contratos, primero debes crear templates en la categoría "Comercial" desde Administración → Templates.'})]})]})}),e.jsx(Te,{children:e.jsx(oa,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por título, número, tercero...",value:t,onChange:s=>S(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsx(q,{value:N,onChange:s=>P(s.target.value),options:[{value:"",label:"Todos los tipos"},...ue],className:"w-48"}),e.jsx(q,{value:v,onChange:s=>u(s.target.value),options:[{value:"",label:"Todos los estados"},{value:"draft",label:"Borrador"},{value:"pending_approval",label:"En Aprobación"},{value:"pending_signatures",label:"Pendiente Firmas"},{value:"approved",label:"Aprobado"},{value:"active",label:"Activo"},{value:"rejected",label:"Rechazado"},{value:"expired",label:"Vencido"}],className:"w-48"})]})})}),e.jsx(Te,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Contrato"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Tercero"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Vigencia"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Aprobación"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Acciones"})]})}),Ge?e.jsx(Aa,{}):$.length===0?e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-4 py-12 text-center",children:[e.jsx(U,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay contratos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:B.length===0?"Primero crea un template de contrato comercial":"Comienza creando tu primer contrato"}),B.length>0&&e.jsxs(y,{onClick:()=>n(!0),children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Nuevo Contrato"]})]})})}):e.jsx("tbody",{children:$.map(s=>e.jsx(Pa,{contract:s,onView:h=>{const F=$.find(R=>R.id===h);F&&(_(F),D(!0))},onEdit:h=>{_(h),D(!0)},onSubmit:h=>re.mutate(h),onDownload:Ce,onViewDocument:we,onGenerate:ke,onDelete:ta,onArchive:ra,onUnarchive:la,isAdmin:ve,showArchived:O},s.id))})]})})}),e.jsx(J,{isOpen:f,onClose:ee,title:k===1?"Nuevo Contrato - Seleccionar Template":"Nuevo Contrato - Información",size:"lg",children:k===1?e.jsx(Fa,{templates:B,onSelect:sa,onCancel:ee}):e.jsx(Ea,{template:r,thirdParties:We,thirdPartyTypes:aa,onSubmit:s=>Ne.mutate(s),onCancel:ee,onBack:()=>g(1),isLoading:Ne.isPending,onEditThirdParty:(s,h)=>{a(s),C(h)},onCreateThirdParty:(s,h)=>{_e.mutate(s,{onSuccess:F=>{const R=F.data?.data;R&&h&&h(R)}})},creatingThirdParty:_e.isPending})}),e.jsx(J,{isOpen:c,onClose:()=>{m(!1),A(null),b("")},title:"Generar Documento",children:e.jsxs("div",{className:"space-y-4",children:[x&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:x.title}),e.jsx("p",{className:"text-sm text-gray-500",children:x.contract_number}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Tercero: ",x.third_party?.display_name]})]})]})}),e.jsx(q,{label:"Template para Generar",value:T,onChange:s=>b(s.target.value),options:[{value:"",label:"Seleccionar template..."},...B.map(s=>({value:s.id,label:`${s.name} (${s.variables_count??s.variables?.length??0} variables)`}))]}),B.length===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"No hay templates de contratos comerciales activos."})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(y,{variant:"secondary",onClick:()=>{m(!1),A(null),b("")},children:"Cancelar"}),e.jsxs(y,{onClick:()=>le.mutate({contractId:x.id,templateId:T}),loading:le.isPending,disabled:!T,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Generar"]})]})]})}),e.jsx(J,{isOpen:j,onClose:()=>{D(!1),_(null)},title:"Detalle del Contrato",size:"lg",children:o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:o.title}),e.jsx("p",{className:"text-sm text-gray-500",children:o.contract_number})]}),e.jsx(X,{variant:o.status,children:o.status_label||o.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Tercero"}),e.jsx("p",{className:"font-medium",children:o.third_party?.display_name||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Tipo"}),e.jsx("p",{className:"font-medium",children:o.type_label||o.contract_type})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Monto"}),e.jsx("p",{className:"font-medium text-green-600",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:o.currency||"COP"}).format(o.amount||0)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Nivel de Aprobación"}),e.jsx("p",{className:"font-medium",children:o.approval_level_label||o.approval_level})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fecha Inicio"}),e.jsx("p",{className:"font-medium",children:o.start_date?new Date(o.start_date).toLocaleDateString("es-CO"):"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Fecha Fin"}),e.jsx("p",{className:"font-medium",children:o.end_date?new Date(o.end_date).toLocaleDateString("es-CO"):"N/A"})]})]}),o.description&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Descripción"}),e.jsx("p",{className:"text-gray-700",children:o.description})]}),o.payment_terms&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Términos de Pago"}),e.jsx("p",{className:"text-gray-700",children:o.payment_terms})]}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Documento del Contrato"})]}),o.has_document?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{size:"sm",variant:"secondary",onClick:()=>{D(!1),we(o)},children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Ver Documento"]}),e.jsxs(y,{size:"sm",variant:"secondary",onClick:()=>Ce(o.id),children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"Descargar"]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-sm text-amber-600",children:"Sin documento"}),e.jsxs(y,{size:"sm",variant:"secondary",onClick:()=>{D(!1),ke(o)},children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Generar"]})]})]})}),o.approvals&&o.approvals.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Aprobaciones"}),e.jsx("div",{className:"space-y-2",children:o.approvals.map((s,h)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.role_label||s.role}),s.approver_name&&e.jsx("p",{className:"text-xs text-gray-500",children:s.approver_name})]}),e.jsx(X,{variant:s.status==="approved"?"success":s.status==="rejected"?"error":"warning",children:s.status==="approved"?"Aprobado":s.status==="rejected"?"Rechazado":"Pendiente"})]},h))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(y,{variant:"secondary",onClick:()=>{D(!1),_(null)},children:"Cerrar"}),o.status==="draft"&&e.jsxs(y,{onClick:()=>{re.mutate(o.id),D(!1),_(null)},loading:re.isPending,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Enviar a Aprobación"]})]})]})}),e.jsx(J,{isOpen:!!E,onClose:()=>{a(null),C([])},title:"Completar datos del tercero",size:"lg",children:E&&e.jsx(La,{thirdParty:E,missingFields:i,onSubmit:s=>fe.mutate({id:E.id,data:s}),onCancel:()=>{a(null),C([])},isLoading:fe.isPending})}),e.jsx(J,{isOpen:!!l,onClose:Se,title:`Documento: ${l?.contract_number||""}`,size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[l&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Contrato:"}),e.jsx("p",{className:"font-medium",children:l.title})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Tercero:"}),e.jsx("p",{className:"font-medium",children:l.third_party?.display_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Monto:"}),e.jsx("p",{className:"font-medium text-green-600",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:l.currency||"COP"}).format(l.amount)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(X,{variant:l.status,children:l.status_label||l.status})]})]})}),Z?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-500",children:"Cargando documento..."})]}):L?e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",style:{height:"60vh"},children:e.jsx("iframe",{src:L,className:"w-full h-full",title:"Contract Document"})}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(xe,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No se pudo cargar el documento"})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs(y,{variant:"secondary",onClick:()=>{if(L){const s=document.createElement("a");s.href=L,s.download=`${l?.contract_number||"contrato"}.pdf`,s.click()}},disabled:!L,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Descargar PDF"]}),e.jsx(y,{variant:"secondary",onClick:Se,children:"Cerrar"})]})]})}),e.jsx(Ta,{isOpen:ze,onClose:()=>je(!1)})]})}function La({thirdParty:t,missingFields:S,onSubmit:N,onCancel:P,isLoading:v}){const[u,f]=d.useState({...t}),n=(p,c)=>{f(m=>({...m,[p]:c}))},k=p=>{p.preventDefault(),N(u)},g=p=>({legal_rep_name:{label:"Nombre del Representante Legal",type:"text",field:"legal_rep_name"},legal_rep_id:{label:"Cédula del Representante Legal",type:"text",field:"legal_rep_id_number"},legal_rep_email:{label:"Email del Representante Legal",type:"email",field:"legal_rep_email"},display_name:{label:"Nombre",type:"text",field:"business_name"},business_name:{label:"Razón Social",type:"text",field:"business_name"},trade_name:{label:"Nombre Comercial",type:"text",field:"trade_name"},identification_number:{label:"Número de Identificación",type:"text",field:"identification_number"},address:{label:"Dirección",type:"text",field:"address"},city:{label:"Ciudad",type:"text",field:"city"},phone:{label:"Teléfono",type:"text",field:"phone"},email:{label:"Email",type:"email",field:"email"},bank_name:{label:"Banco",type:"text",field:"bank_name"},bank_account_number:{label:"Número de Cuenta",type:"text",field:"bank_account_number"},bank_account_type:{label:"Tipo de Cuenta",type:"select",field:"bank_account_type",options:[{value:"",label:"Seleccionar..."},{value:"savings",label:"Ahorros"},{value:"checking",label:"Corriente"}]}})[p]||null,r=[...new Set(S.map(p=>p.field))].map(p=>g(p)).filter(Boolean);return e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(K,{className:"h-5 w-5 text-amber-600 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-amber-900",children:["Datos faltantes para ",t.display_name]}),e.jsx("p",{className:"text-sm text-amber-700",children:"Complete los siguientes campos para poder generar el documento del contrato."})]})]})}),e.jsx("div",{className:"space-y-4",children:r.map((p,c)=>e.jsx("div",{children:p.type==="select"?e.jsx(q,{label:p.label,value:u[p.field]||"",onChange:m=>n(p.field,m.target.value),options:p.options,required:!0}):e.jsx(w,{label:p.label,type:p.type,value:u[p.field]||"",onChange:m=>n(p.field,m.target.value),required:!0})},c))}),r.length===0&&e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("p",{children:"No se pudieron determinar los campos faltantes."}),e.jsx("p",{className:"text-sm",children:"Por favor, edite el tercero desde la sección de Terceros."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:P,children:"Cancelar"}),e.jsxs(y,{type:"submit",loading:v,disabled:r.length===0,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Guardar y Continuar"]})]})]})}export{Ja as default};
