import{u as ge,a as he,b as A,j as e}from"./vendor-query-2ZprUnmA.js";import{r as d,u as Ae,a as Se,d as Qe,N as ze}from"./vendor-router-CyR0tpch.js";import{v as z,p as Be,u as Ge,c as X,t as ye}from"./index-BT4dF-Ry.js";import{C as R,c as V}from"./Card-DbNYCSnq.js";import{B as p}from"./Button-C7qsOZ-2.js";import{B as oe}from"./Badge-Cu_cxnAa.js";import{M as ee}from"./Modal-5XVQlMCF.js";import{I as le}from"./Input-WTtiBIO6.js";import{S as re}from"./Select-vfGwgvIr.js";import{P as me,G as He,$ as Ye,a0 as Oe,u as Ee,n as ve,a1 as Re,V as ie,a2 as $e,X as De,Z as Ce,Q as se,F as ae,U as Ke,m as $,a3 as ke,a4 as te,p as xe,d as Me,O as we,a5 as We,D as Ie,c as Xe,_ as Ze,A as Je}from"./vendor-icons-7sl6YsZj.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const Ue=[{value:"vacation",label:"Vacaciones"},{value:"personal",label:"Día Personal"},{value:"sick",label:"Enfermedad"},{value:"bereavement",label:"Duelo"},{value:"unpaid",label:"Sin Goce"}],es=[{value:"",label:"Todos"},{value:"draft",label:"Borrador"},{value:"pending",label:"Solicitada"},{value:"approved",label:"Aprobada"},{value:"enjoyed",label:"Disfrutada"},{value:"rejected",label:"Rechazada"},{value:"cancelled",label:"Cancelada"}];function ss({onClose:l,onSuccess:f,balance:_,bookedRanges:N=[]}){const[h,v]=d.useState(1),[c,m]=d.useState({vacation_type:"vacation",start_date:"",end_date:"",days_requested:"",reason:""}),[i,k]=d.useState(null),[w,g]=d.useState(null),[o,D]=d.useState(null),[Q,Y]=d.useState(!1),[P,S]=d.useState(""),[M,F]=d.useState(null),q=ge(),x=Se(),{data:t}=he({queryKey:["vacation-template"],queryFn:async()=>(await Be.list({category:"vacation"})).data?.data?.[0]||null}),r=t,y=A({mutationFn:a=>z.create(a),onSuccess:async a=>{const n=a.data?.data,u=a.data?.document;if(k(n),g(u),S(""),n?.id&&n?.pdf_ready)try{const b=await z.downloadDocument(n.id),E=new Blob([b.data],{type:"application/pdf"});D(URL.createObjectURL(E))}catch(b){console.error("Error loading PDF:",b),D(null)}else D(null);v(2)},onError:a=>{const n=a.response?.data,u=a.response?.status;console.error("Vacation create error:",{status:u,data:n,message:a.message}),n?.missing_fields&&Array.isArray(n.missing_fields)?(F(n.missing_fields),S(n.message||"Faltan datos requeridos")):Array.isArray(n?.errors)&&n.errors.length>0?(S(n.error?`${n.error}: ${n.errors.join(". ")}`:n.errors.join(". ")),F(null)):n?.error?(S(n.error),F(null)):(S(`Error al crear la solicitud (${u||"sin respuesta"}): ${a.message}`),F(null))}}),I=A({mutationFn:a=>z.signDocument(a),onSuccess:a=>{g(a.data?.document),k(a.data?.data),je()},onError:a=>{S(a.response?.data?.error||"Error al firmar el documento")}}),Z=A({mutationFn:a=>z.submit(a),onSuccess:a=>{k(a.data?.data),v(3),q.invalidateQueries(["vacations"])},onError:a=>{S(a.response?.data?.error||"Error al enviar la solicitud")}}),je=async()=>{if(i?.id&&i?.pdf_ready)try{const a=await z.downloadDocument(i.id),n=new Blob([a.data],{type:"application/pdf"});o&&URL.revokeObjectURL(o),D(URL.createObjectURL(n))}catch(a){console.error("Error reloading PDF:",a)}},Fe=a=>{const n=a%19,u=Math.floor(a/100),b=a%100,E=Math.floor(u/4),G=u%4,H=Math.floor((u+8)/25),L=Math.floor((u-H+1)/3),C=(19*n+u-E-L+15)%30,fe=Math.floor(b/4),Ne=b%4,s=(32+2*G+2*fe-C-Ne)%7,j=Math.floor((n+11*C+22*s)/451),O=Math.floor((C+s-7*j+114)/31),de=(C+s-7*j+114)%31+1;return new Date(a,O-1,de)},T=a=>{const n=new Date(a),u=n.getDay();return u===0?n.setDate(n.getDate()+1):u!==1&&n.setDate(n.getDate()+(8-u)),n},J=a=>{const n=[],u=Fe(a);n.push(new Date(a,0,1)),n.push(new Date(a,4,1)),n.push(new Date(a,6,20)),n.push(new Date(a,7,7)),n.push(new Date(a,11,8)),n.push(new Date(a,11,25)),n.push(T(new Date(a,0,6))),n.push(T(new Date(a,2,19))),n.push(T(new Date(a,5,29))),n.push(T(new Date(a,7,15))),n.push(T(new Date(a,9,12))),n.push(T(new Date(a,10,1))),n.push(T(new Date(a,10,11)));const b=new Date(u);b.setDate(u.getDate()-3),n.push(b);const E=new Date(u);E.setDate(u.getDate()-2),n.push(E);const G=new Date(u);G.setDate(u.getDate()+39),n.push(T(G));const H=new Date(u);H.setDate(u.getDate()+60),n.push(T(H));const L=new Date(u);return L.setDate(u.getDate()+68),n.push(T(L)),n},K=(a,n)=>{const u=a.toISOString().split("T")[0];return n.some(b=>b.toISOString().split("T")[0]===u)},ce=(a,n)=>{let u=0;const b=new Date(a),E=new Date(n),G=b.getFullYear(),H=E.getFullYear();let L=[];for(let C=G;C<=H;C++)L=L.concat(J(C));for(;b<=E;){const C=b.getDay();C!==0&&C!==6&&!K(b,L)&&u++,b.setDate(b.getDate()+1)}return u};d.useEffect(()=>{if(c.start_date&&c.end_date){const a=new Date(c.start_date+"T00:00:00"),n=new Date(c.end_date+"T00:00:00");if(n>=a){const u=ce(a,n);m(b=>({...b,days_requested:u.toString()}))}}},[c.start_date,c.end_date]);const W=(()=>{if(!c.start_date||!c.end_date||!N.length)return null;const a=new Date(c.start_date+"T00:00:00"),n=new Date(c.end_date+"T00:00:00");if(n<a)return null;for(const u of N){const b=new Date(u.start_date+"T00:00:00"),E=new Date(u.end_date+"T00:00:00");if(a<=E&&n>=b){const G=a>b?a:b,H=n<E?n:E,L=[],C=new Date(G);for(;C<=H;)C.getDay()!==0&&C.getDay()!==6&&L.push(C.toLocaleDateString("es-ES",{day:"numeric",month:"short"})),C.setDate(C.getDate()+1);if(L.length>0)return{requestNumber:u.request_number,days:L}}}return null})();d.useEffect(()=>()=>{o&&URL.revokeObjectURL(o)},[o]);const B=a=>{a.preventDefault(),!W&&y.mutate(c)},Te=()=>{S(""),i?.id&&I.mutate(i.id)},U=()=>{S(""),i?.id&&Z.mutate(i.id)},qe=()=>{q.invalidateQueries(["vacations"]),f?.(),l()},be=()=>{o&&window.open(o,"_blank")},ue=w?.employee_signed||!1,ne=i?.pdf_ready===!1,Pe=ue||ne;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-6",children:[1,2,3].map(a=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${h>=a?"bg-primary-500 text-white":"bg-gray-200 text-gray-500"}`,children:h>a?e.jsx(se,{className:"w-5 h-5"}):a}),a<3&&e.jsx("div",{className:`w-12 h-1 mx-1 ${h>a?"bg-primary-500":"bg-gray-200"}`})]},a))}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-4 mb-6",children:[e.jsx("span",{className:h>=1?"text-primary-600 font-medium":"",children:"Datos"}),e.jsx("span",{className:h>=2?"text-primary-600 font-medium":"",children:"Firmar"}),e.jsx("span",{className:h>=3?"text-primary-600 font-medium":"",children:"Enviado"})]}),h===1&&e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[r&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:r.name}),e.jsx("p",{className:"text-sm text-blue-700",children:"Se generará el documento oficial para tu firma"}),r.signatories_count>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-blue-600",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.signatories_count," firmantes requeridos"]})]})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg flex items-center justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Días disponibles para solicitar:"}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:Math.floor(_?.available||0)})]}),e.jsx(re,{label:"Tipo de Solicitud",options:Ue,value:c.vacation_type,onChange:a=>m({...c,vacation_type:a.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(le,{label:"Fecha Inicio",type:"date",value:c.start_date,min:new Date().toISOString().split("T")[0],onChange:a=>{m({...c,start_date:a.target.value}),S(""),F(null)},required:!0}),e.jsx(le,{label:"Fecha Fin",type:"date",value:c.end_date,min:c.start_date||new Date().toISOString().split("T")[0],onChange:a=>{m({...c,end_date:a.target.value}),S(""),F(null)},required:!0})]}),e.jsx(le,{label:"Días Solicitados",type:"number",step:"0.5",min:"0.5",value:c.days_requested,onChange:a=>m({...c,days_requested:a.target.value}),required:!0}),parseFloat(c.days_requested)>(_?.available||0)&&e.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center gap-2 text-amber-700",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Los días solicitados exceden tu saldo disponible"})]}),W&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-red-800",children:["Fechas en conflicto con ",W.requestNumber]}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Ya tienes una solicitud que incluye: ",e.jsx("strong",{children:W.days.join(", ")})]}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"Selecciona fechas que no se solapen con solicitudes existentes."})]})]})}),P&&!M&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:P})]}),M&&M.length>0&&e.jsx("div",{className:"p-4 bg-amber-50 border border-amber-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-amber-800 mb-2",children:"Faltan datos requeridos para generar la solicitud"}),e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Por favor complete los siguientes datos antes de continuar:"}),e.jsx("ul",{className:"text-sm text-amber-700 space-y-1 mb-4",children:M.map((a,n)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),e.jsx("span",{children:a.label||a.field}),a.source==="employee"&&e.jsx("span",{className:"text-xs text-amber-500",children:"(Perfil del empleado)"}),a.source==="organization"&&e.jsx("span",{className:"text-xs text-amber-500",children:"(Configuración de la empresa)"})]},n))}),M.some(a=>a.source==="employee")&&e.jsx(p,{type:"button",variant:"secondary",size:"sm",onClick:()=>x("/profile"),children:"Ir a mi Perfil para completar datos"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo (opcional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3,value:c.reason,onChange:a=>m({...c,reason:a.target.value}),placeholder:"Describe el motivo de tu solicitud..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:l,children:"Cancelar"}),e.jsx(p,{type:"submit",loading:y.isPending,disabled:!!W,children:"Continuar"})]})]}),h===2&&i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"font-medium text-gray-900",children:["Solicitud ",i.request_number]}),e.jsx(oe,{status:i.status})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("p",{className:"font-medium",children:Ue.find(a=>a.value===i.vacation_type)?.label})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Fechas:"}),e.jsxs("p",{className:"font-medium",children:[new Date(i.start_date).toLocaleDateString("es-ES")," - ",new Date(i.end_date).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Días:"}),e.jsx("p",{className:"font-bold text-primary-600",children:i.days_requested})]})]})]}),o?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Documento de Solicitud"}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:be,children:[e.jsx(ke,{className:"w-4 h-4"}),"Abrir en nueva pestaña"]})]}),e.jsx("iframe",{src:o,className:"w-full h-[400px] border-0",title:"Vista previa del documento"})]}):i?.pdf_ready===!1?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-amber-50 border-amber-200",children:[e.jsx($,{className:"w-8 h-8 mx-auto text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-700 font-medium",children:"El documento está pendiente de generación"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"El PDF se generará próximamente. Puedes continuar con el proceso."})]}):e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(te,{className:"w-8 h-8 animate-spin mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]}),e.jsxs("div",{className:"p-4 bg-white border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Firmas Requeridas"]}),e.jsx("div",{className:"space-y-3",children:w?.signatures?.map((a,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${a.signed?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:a.signed?e.jsx(se,{className:"w-5 h-5"}):n+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.label}),a.signed&&e.jsxs("p",{className:"text-xs text-green-600",children:["Firmado por ",a.signed_by," - ",new Date(a.signed_at).toLocaleString("es-ES")]})]})]}),a.signatory_type_code==="employee"&&!a.signed&&e.jsxs(p,{size:"sm",onClick:Te,loading:I.isPending,children:[e.jsx(ie,{className:"w-4 h-4"}),"Firmar"]}),a.signatory_type_code!=="employee"&&!a.signed&&e.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-200 rounded",children:"Pendiente"})]},n))})]}),P&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:P})]}),ne&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"Documento pendiente de generación"}),e.jsx("p",{className:"mt-1",children:"Puedes enviar la solicitud ahora. El documento se generará y firmará posteriormente."})]})]}),!ne&&!ue&&e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-3",children:[e.jsx($,{className:"w-5 h-5 text-amber-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-medium",children:"Debes firmar el documento antes de enviar"}),e.jsx("p",{className:"mt-1",children:'Haz clic en el botón "Firmar" junto a tu nombre para continuar.'})]})]}),!ne&&ue&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"¡Documento firmado!"}),e.jsx("p",{className:"mt-1",children:"Ahora puedes enviar la solicitud para aprobación del supervisor y RRHH."})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx(p,{variant:"secondary",onClick:()=>v(1),children:"Volver"}),e.jsxs(p,{onClick:U,loading:Z.isPending,disabled:!Pe,children:[e.jsx($e,{className:"w-4 h-4"}),"Enviar Solicitud"]})]})]}),h===3&&i&&e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(se,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"¡Solicitud Enviada!"}),e.jsxs("p",{className:"text-gray-600",children:["Tu solicitud ",e.jsx("span",{className:"font-medium",children:i.request_number})," ha sido enviada correctamente."]}),o&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Documento firmado:"}),e.jsxs(p,{variant:"secondary",onClick:be,children:[e.jsx(Re,{className:"w-4 h-4"}),"Ver Documento PDF"]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Próximos pasos:"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Tu supervisor recibirá la solicitud para aprobación y firma"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Recursos Humanos revisará y firmará la solicitud"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Recibirás notificación cuando sea aprobada"})]})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(p,{onClick:qe,children:"Cerrar"})})]})]})}function as({vacation:l,onSubmit:f,onCancel:_,onDelete:N,onView:h,onDownload:v,onSign:c}){const m={vacation:"Vacaciones",personal:"Día Personal",sick:"Enfermedad",bereavement:"Duelo",unpaid:"Sin Goce"};return e.jsx(R,{className:"hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-50 rounded-lg",children:e.jsx(Ee,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:m[l.vacation_type]||l.vacation_type}),e.jsx("p",{className:"text-sm text-gray-500",children:l.request_number}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[new Date(l.start_date).toLocaleDateString("es-ES")," - ",new Date(l.end_date).toLocaleDateString("es-ES")]}),e.jsxs("p",{className:"text-sm font-medium text-primary-600 mt-1",children:[l.days_requested," días"]})]})]}),e.jsx(oe,{status:l.status})]}),e.jsxs("div",{className:"flex justify-end gap-1 mt-4 pt-4 border-t border-gray-100",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>h(l),title:"Ver detalles",children:e.jsx(ve,{className:"w-4 h-4"})}),l.pdf_ready&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>v(l.id),title:"Descargar documento",children:e.jsx(Re,{className:"w-4 h-4"})}),l.status==="draft"&&l.needs_employee_signature&&e.jsxs(p,{variant:"secondary",size:"sm",onClick:()=>c(l),title:"Firmar documento",children:[e.jsx(ie,{className:"w-4 h-4"}),"Firmar"]}),l.status==="draft"&&!l.needs_employee_signature&&e.jsx(p,{variant:"primary",size:"sm",onClick:()=>f(l.id),title:"Enviar solicitud",children:e.jsx($e,{className:"w-4 h-4"})}),["draft","pending"].includes(l.status)&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>_(l.id),title:"Cancelar solicitud",children:e.jsx(De,{className:"w-4 h-4"})}),l.can_delete&&e.jsx(p,{variant:"danger",size:"sm",onClick:()=>N(l.id),title:"Eliminar solicitud",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})})}function ts({vacation:l,onClose:f,onDownload:_,onRefresh:N}){const[h,v]=d.useState(null),[c,m]=d.useState(!1),[i,k]=d.useState(null),[w,g]=d.useState(null),[o,D]=d.useState(""),Q=ge(),Y={vacation:"Vacaciones",personal:"Día Personal",sick:"Enfermedad",bereavement:"Duelo",unpaid:"Sin Goce"},P=async()=>{try{const x=await z.get(l.id);k(x.data?.data),g(x.data?.document)}catch(x){console.error("Error fetching vacation detail:",x)}};d.useEffect(()=>{P()},[l.id]);const S=A({mutationFn:x=>z.signDocument(x),onSuccess:x=>{g(x.data?.document),D(""),Q.invalidateQueries(["vacations"]),h&&(URL.revokeObjectURL(h),v(null)),F(),P()},onError:x=>{D(x.response?.data?.error||"Error al firmar el documento")}}),M=()=>{D(""),S.mutate(l.id)};d.useEffect(()=>(l.pdf_ready&&l.id&&F(),()=>{h&&URL.revokeObjectURL(h)}),[l.id,l.pdf_ready]);const F=async()=>{m(!0);try{const x=await z.downloadDocument(l.id),t=new Blob([x.data],{type:"application/pdf"});v(URL.createObjectURL(t))}catch(x){console.error("Error loading PDF:",x)}finally{m(!1)}},q=()=>{h&&window.open(h,"_blank")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Número:"}),e.jsx("p",{className:"font-medium",children:l.request_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Estado:"}),e.jsx("div",{className:"mt-1",children:e.jsx(oe,{status:l.status})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Tipo:"}),e.jsx("p",{className:"font-medium",children:Y[l.vacation_type]||l.vacation_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Días:"}),e.jsx("p",{className:"font-bold text-primary-600",children:l.days_requested})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Fechas:"}),e.jsxs("p",{className:"font-medium",children:[new Date(l.start_date).toLocaleDateString("es-ES")," - ",new Date(l.end_date).toLocaleDateString("es-ES")]})]})]}),l.reason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 block mb-1",children:"Motivo:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded-lg",children:l.reason})]}),l.decision_reason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 block mb-1",children:"Comentario del aprobador:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded-lg",children:l.decision_reason})]}),l.has_document&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-primary-600"}),"Documento de Solicitud"]}),c?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(te,{className:"w-8 h-8 animate-spin mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]}):h?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Vista Previa del Documento"}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:q,children:[e.jsx(ke,{className:"w-4 h-4"}),"Abrir en nueva pestaña"]})]}),e.jsx("iframe",{src:h,className:"w-full h-[350px] border-0",title:"Vista previa del documento"})]}):l.pdf_ready===!1?e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-amber-50 border-amber-200",children:[e.jsx($,{className:"w-8 h-8 mx-auto text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-700 font-medium",children:"Documento pendiente de generación"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"El PDF se generará próximamente"})]}):e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-gray-50",children:[e.jsx(ae,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No se pudo cargar el documento"})]}),w?.signatures&&w.signatures.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-white border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Firmas del Documento"]}),e.jsx("div",{className:"space-y-3",children:w.signatures.map((x,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${x.signed?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:x.signed?e.jsx(se,{className:"w-5 h-5"}):x.position||t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:x.label}),e.jsxs("p",{className:"text-xs text-gray-500",children:[x.signatory_type_code==="employee"&&"Empleado Solicitante",x.signatory_type_code==="supervisor"&&"Supervisor Directo",x.signatory_type_code==="hr"&&"Recursos Humanos"]}),x.signed&&e.jsxs("p",{className:"text-xs text-green-600 mt-0.5",children:["Firmado por ",x.signed_by," - ",new Date(x.signed_at).toLocaleString("es-ES")]})]})]}),x.signatory_type_code==="employee"&&!x.signed&&e.jsxs(p,{size:"sm",onClick:M,loading:S.isPending,children:[e.jsx(ie,{className:"w-4 h-4"}),"Firmar"]}),x.signatory_type_code!=="employee"&&!x.signed&&e.jsx("span",{className:"text-xs text-amber-600 px-2 py-1 bg-amber-100 rounded",children:"Pendiente"})]},t))}),o&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:o})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[l.pdf_ready&&e.jsxs(p,{variant:"secondary",onClick:()=>_(l.id),children:[e.jsx(Re,{className:"w-4 h-4"}),"Descargar PDF"]}),e.jsx(p,{onClick:f,children:"Cerrar"})]})]})}function rs(){const[l,f]=d.useState(!1),[_,N]=d.useState(!1),[h,v]=d.useState(null),[c,m]=d.useState(""),i=ge(),k=Ae(),w=Se();d.useEffect(()=>{k.state?.openNew&&(f(!0),w(k.pathname,{replace:!0,state:{}}))},[k.state,k.pathname,w]);const{data:g,isLoading:o}=he({queryKey:["vacations",{status:c}],queryFn:()=>z.list({status:c||void 0})}),D=A({mutationFn:r=>z.submit(r),onSuccess:()=>{i.invalidateQueries(["vacations"])}}),Q=A({mutationFn:r=>z.cancel(r),onSuccess:()=>{i.invalidateQueries(["vacations"])}}),Y=A({mutationFn:r=>z.delete(r),onSuccess:()=>{i.invalidateQueries(["vacations"])},onError:r=>{alert(r.response?.data?.error||"Error al eliminar la solicitud")}}),P=A({mutationFn:r=>z.signDocument(r),onSuccess:()=>{i.invalidateQueries(["vacations"]),alert("Documento firmado exitosamente. Ahora puedes enviar la solicitud.")},onError:r=>{const y=r.response?.data?.error||"Error al firmar el documento";r.response?.data?.action_required?.type==="configure_signature"?window.confirm("No tienes firma digital configurada. ¿Deseas configurarla ahora?")&&w("/profile"):alert(y)}}),S=r=>{window.confirm("¿Estás seguro de que deseas eliminar esta solicitud? Esta acción no se puede deshacer.")&&Y.mutate(r)},M=r=>{P.mutate(r.id)},F=g?.data?.data||[],q=g?.data?.meta?.vacation_balance||{},x=r=>{v(r),N(!0)},t=async r=>{try{const y=await z.downloadDocument(r),I=new Blob([y.data],{type:"application/pdf"}),Z=window.URL.createObjectURL(I);window.open(Z,"_blank")}catch(y){console.error("Error downloading document:",y),alert("Error al descargar el documento")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Vacaciones"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona tus solicitudes de vacaciones"})]}),e.jsxs(p,{onClick:()=>f(!0),children:[e.jsx(me,{className:"w-4 h-4"}),"Nueva Solicitud"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{className:"bg-blue-50 border-blue-200",children:e.jsx(V,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(He,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:Math.floor((q.accrued||0)-(q.enjoyed||0))}),e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Días por Contrato"}),e.jsx("p",{className:"text-xs text-blue-500",children:"Acumulados - Disfrutados"})]})]})})}),e.jsx(R,{className:"bg-amber-50 border-amber-200",children:e.jsx(V,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-amber-100 rounded-xl",children:e.jsx(Ye,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:Math.floor(q.scheduled||0)}),e.jsx("p",{className:"text-sm text-amber-700 font-medium",children:"Días Programados"}),e.jsx("p",{className:"text-xs text-amber-500",children:"Aprobados sin disfrutar"})]})]})})}),e.jsx(R,{className:"bg-green-50 border-green-300 ring-2 ring-green-200",children:e.jsx(V,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx(me,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:Math.floor(q.available||0)}),e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Días Vacaciones"}),e.jsx("p",{className:"text-xs text-green-500",children:"Para solicitar"})]})]})})})]}),e.jsx(R,{children:e.jsx(V,{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Oe,{className:"w-4 h-4 text-gray-400"}),e.jsx(re,{options:es,value:c,onChange:r=>m(r.target.value),className:"w-48"})]})})}),o?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(r=>e.jsx(R,{className:"animate-pulse",children:e.jsx(V,{className:"p-4",children:e.jsx("div",{className:"h-24 bg-gray-100 rounded"})})},r))}):F.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:F.map(r=>e.jsx(as,{vacation:r,onSubmit:y=>D.mutate(y),onCancel:y=>Q.mutate(y),onDelete:S,onView:x,onDownload:t,onSign:M},r.id))}):e.jsx(R,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx(Ee,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tienes solicitudes de vacaciones"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Crea tu primera solicitud de vacaciones"}),e.jsxs(p,{onClick:()=>f(!0),children:[e.jsx(me,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})}),e.jsx(ee,{isOpen:l,onClose:()=>f(!1),title:"Nueva Solicitud de Vacaciones",size:"xl",children:e.jsx(ss,{onClose:()=>f(!1),onSuccess:()=>i.invalidateQueries(["vacations"]),balance:q,bookedRanges:q?.booked_ranges||[]})}),e.jsx(ee,{isOpen:_,onClose:()=>N(!1),title:"Detalle de Solicitud",size:"xl",children:h&&e.jsx(ts,{vacation:h,onClose:()=>N(!1),onDownload:t})})]})}const ns=[{value:"bank",label:"Entidad Bancaria / Crédito"},{value:"visa",label:"Trámite de Visa"},{value:"rental",label:"Arrendamiento / Inmobiliaria"},{value:"government",label:"Trámite Gubernamental"},{value:"legal",label:"Proceso Legal"},{value:"other",label:"Otro"}],ls=[{value:"es",label:"Español"},{value:"en",label:"Inglés"}],is=[{value:"",label:"Todos los estados"},{value:"pending",label:"Pendiente"},{value:"processing",label:"En Proceso"},{value:"completed",label:"Completado"},{value:"rejected",label:"Rechazado"},{value:"cancelled",label:"Cancelado"}],_e={employment:"Certificación Laboral",salary:"Con Salario",position:"Certificación de Cargo",full:"Certificación Completa",custom:"Personalizada"},Ve={bank:"Entidad Bancaria",visa:"Trámite de Visa",rental:"Arrendamiento",government:"Trámite Gubernamental",legal:"Proceso Legal",other:"Otro"},Le={employment:1,salary:2,position:1,full:3,custom:3};function cs({onSubmit:l,onCancel:f,loading:_,initialType:N,availableTypes:h}){const v=h?.length>0?h:[],c=N&&v.find(g=>g.value===N)?N:v[0]?.value||"employment",[m,i]=d.useState({certification_type:c,purpose:"bank",purpose_details:"",language:"es",addressee:"",special_instructions:""});d.useEffect(()=>{N&&v.find(g=>g.value===N)&&i(g=>({...g,certification_type:N}))},[N,v]);const k=g=>{g.preventDefault(),l(m)},w=m.certification_type;return v.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(we,{className:"w-5 h-5 text-amber-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"No hay tipos de certificación configurados"}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"El administrador debe configurar los tipos de certificación y asociar cada uno a un template antes de poder crear solicitudes."})]})]})}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(p,{variant:"secondary",onClick:f,children:"Cerrar"})})]}):e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx(re,{label:"Tipo de Certificación",options:v,value:m.certification_type,onChange:g=>i({...m,certification_type:g.target.value}),required:!0}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Tiempo estimado: ",Le[w]," día",Le[w]>1?"s":""," hábil",Le[w]>1?"es":""]})]})}),e.jsx(re,{label:"Propósito",options:ns,value:m.purpose,onChange:g=>i({...m,purpose:g.target.value}),required:!0}),m.purpose==="other"&&e.jsx(le,{label:"Especifique el propósito",value:m.purpose_details,onChange:g=>i({...m,purpose_details:g.target.value}),placeholder:"Describa el propósito de la certificación...",required:!0}),e.jsx(re,{label:"Idioma",options:ls,value:m.language,onChange:g=>i({...m,language:g.target.value})}),e.jsx(le,{label:"Dirigido a (opcional)",value:m.addressee,onChange:g=>i({...m,addressee:g.target.value}),placeholder:"Ej: A quien corresponda, Banco XYZ, Embajada..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Instrucciones especiales (opcional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3,value:m.special_instructions,onChange:g=>i({...m,special_instructions:g.target.value}),placeholder:"Información adicional o requisitos especiales..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:f,children:"Cancelar"}),e.jsx(p,{type:"submit",loading:_,children:"Solicitar Certificación"})]})]})}const ds={pending:e.jsx(xe,{className:"w-4 h-4 text-yellow-500"}),processing:e.jsx(xe,{className:"w-4 h-4 text-blue-500 animate-pulse"}),completed:e.jsx(se,{className:"w-4 h-4 text-green-500"}),rejected:e.jsx($,{className:"w-4 h-4 text-red-500"}),cancelled:e.jsx(De,{className:"w-4 h-4 text-gray-400"})};function os({onClose:l,onNavigateToTemplate:f}){const[_,N]=d.useState([]),[h,v]=d.useState(!1),[c,m]=d.useState(null),[i,k]=d.useState({code:"",label:"",description:"",template_id:""}),w=ge(),{data:g,isLoading:o}=he({queryKey:["admin-certification-templates"],queryFn:()=>ye.list({category:"certification",status:"active"})}),D=g?.data?.data||[];d.useEffect(()=>{if(D.length>0){const t=D.filter(r=>r.certification_type).map(r=>({code:r.certification_type,label:r.certification_type_label||_e[r.certification_type]||r.certification_type,description:"",template_id:r.id,template_name:r.name,variables:r.variables||[]}));N(t)}},[D]);const Q=t=>D.filter(r=>!r.certification_type||r.id===t),Y=D.filter(t=>!t.certification_type),P=()=>{if(!i.code||!i.template_id){alert("Debe ingresar un código y seleccionar un template");return}if(_.find(r=>r.code===i.code)){alert("Ya existe un tipo con ese código");return}const t=D.find(r=>r.id===i.template_id);N([..._,{...i,template_name:t?.name,variables:t?.variables||[]}]),k({code:"",label:"",description:"",template_id:""})},S=t=>{N(_.filter(r=>r.code!==t)),c===t&&m(null)},M=t=>{m(c===t?null:t)},F=(t,r)=>{const y=D.find(I=>I.id===r);N(_.map(I=>I.code===t?{...I,template_id:r,template_name:y?.name,variables:y?.variables||[]}:I))},q=(t,r)=>{N(_.map(y=>y.code===t?{...y,label:r}:y))},x=async()=>{v(!0);try{for(const t of D){const r=_.find(y=>y.template_id===t.id);t.certification_type&&!r?await ye.update(t.id,{template:{certification_type:null,certification_type_label:null}}):t.certification_type&&r&&t.certification_type!==r.code&&await ye.update(t.id,{template:{certification_type:r.code,certification_type_label:r.label}})}for(const t of _)t.template_id&&await ye.update(t.template_id,{template:{certification_type:t.code,certification_type_label:t.label}});w.invalidateQueries(["certification-available-types"]),w.invalidateQueries(["admin-certification-templates"]),alert("Configuración guardada exitosamente"),l()}catch(t){console.error("Error saving certification types:",t),alert("Error al guardar: "+(t.response?.data?.error||t.message))}finally{v(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Configure los tipos de certificación disponibles. Cada tipo debe tener un template asociado."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Tipos Configurados"}),_.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No hay tipos configurados"}):e.jsx("div",{className:"space-y-2",children:_.map(t=>e.jsx("div",{className:`p-3 border rounded-lg ${c===t.code?"bg-blue-50 border-blue-300":"bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-sm font-mono bg-gray-200 px-2 py-0.5 rounded",children:t.code}),c===t.code?e.jsx("input",{type:"text",value:t.label,onChange:r=>q(t.code,r.target.value),className:"flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Etiqueta"}):e.jsx("span",{className:"font-medium",children:t.label})]}),c===t.code?e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Template asociado:"}),e.jsx("select",{value:t.template_id,onChange:r=>F(t.code,r.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:Q(t.template_id).map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))})]}):e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-600",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsxs("button",{onClick:()=>f(t.template_id),className:"text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1",title:"Ir al template",children:[t.template_name,e.jsx(ke,{className:"w-3 h-3"})]})]}),t.variables?.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Variables requeridas:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.variables.slice(0,5).map((r,y)=>e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:r},y)),t.variables.length>5&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",t.variables.length-5," más"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>M(t.code),className:`p-1 rounded ${c===t.code?"text-blue-600 bg-blue-100":"text-gray-400 hover:text-blue-600 hover:bg-blue-50"}`,title:c===t.code?"Cerrar edición":"Editar",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(t.code),className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded",title:"Eliminar",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})},t.code))})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Agregar Nuevo Tipo"}),Y.length===0&&D.length>0?e.jsx("p",{className:"text-sm text-amber-600",children:"Todos los templates de certificación ya tienen un tipo asignado. Para agregar más tipos, primero suba nuevos templates de certificación."}):o?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(te,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Cargando templates..."})]}):D.length===0?e.jsx("p",{className:"text-sm text-amber-600",children:'No hay templates de certificación disponibles. Primero debe subir templates con categoría "certification" desde Administración → Templates.'}):e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(le,{label:"Código",value:i.code,onChange:t=>k({...i,code:t.target.value.toLowerCase().replace(/\s/g,"_")}),placeholder:"ej: employment, salary"}),e.jsx(le,{label:"Etiqueta",value:i.label,onChange:t=>k({...i,label:t.target.value}),placeholder:"ej: Certificación Laboral"}),e.jsx("div",{className:"col-span-2",children:e.jsx(re,{label:"Template Asociado",options:[{value:"",label:"Seleccione un template..."},...Y.map(t=>({value:t.id,label:t.name}))],value:i.template_id,onChange:t=>k({...i,template_id:t.target.value})})}),e.jsx("div",{className:"col-span-2",children:e.jsxs(p,{type:"button",variant:"secondary",onClick:P,disabled:!i.code||!i.template_id,children:[e.jsx(me,{className:"w-4 h-4"}),"Agregar Tipo"]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{variant:"ghost",onClick:l,children:"Cancelar"}),e.jsxs(p,{onClick:x,loading:h,children:[e.jsx(Ze,{className:"w-4 h-4"}),"Guardar Configuración"]})]})]})}function ms(){const[l,f]=d.useState(!1),[_,N]=d.useState(!1),[h,v]=d.useState(!1),[c,m]=d.useState(!1),[i,k]=d.useState(null),[w,g]=d.useState(null),[o,D]=d.useState(null),[Q,Y]=d.useState(""),[P,S]=d.useState(""),[M,F]=d.useState(null),[q,x]=d.useState(null),[t,r]=d.useState(null),[y,I]=d.useState(null),[Z,je]=d.useState(null),[Fe,T]=d.useState(null),J=ge(),K=Se(),ce=Ae(),{isHR:W,isAdmin:B}=Ge();d.useEffect(()=>{ce.state?.openNew&&(f(!0),K(ce.pathname,{replace:!0,state:{}}))},[ce.state,ce.pathname,K]);const{data:Te}=he({queryKey:["certification-available-types"],queryFn:()=>X.getAvailableTypes(),staleTime:300*1e3}),U=Te?.data?.data||[],qe=[{value:"",label:"Todos los tipos"},...U.map(s=>({value:s.value,label:s.label}))],{data:be,isLoading:ue}=he({queryKey:["certifications",{status:Q,type:P}],queryFn:()=>X.list({status:Q||void 0,type:P||void 0})}),ne=A({mutationFn:s=>X.create(s),onSuccess:()=>{J.invalidateQueries(["certifications"]),f(!1)}}),Pe=A({mutationFn:s=>X.cancel(s),onSuccess:()=>{J.invalidateQueries(["certifications"])}}),a=A({mutationFn:s=>X.generateDocument(s),onSuccess:()=>{J.invalidateQueries(["certifications"]),F(null)},onError:s=>{console.error("Error generating document:",s),F(null);const j=s.response?.data;j?.error_type==="missing_variables"?(k({message:j.error,missingData:j.missing_data,actions:j.action_required||[]}),v(!0)):alert(j?.error||"Error al generar documento")}}),n=A({mutationFn:s=>X.delete(s),onSuccess:()=>{J.invalidateQueries(["certifications"]),g(null)},onError:s=>{console.error("Error deleting certification:",s),alert(s.response?.data?.error||"Error al eliminar certificación")}}),u=A({mutationFn:s=>X.signDocument(s),onSuccess:s=>{J.invalidateQueries(["certifications"]),r(null);const j=s.data.document;j.all_signed?alert("Documento firmado y completado exitosamente"):alert(`Documento firmado. Firmas pendientes: ${j.pending_signatures.join(", ")}`)},onError:s=>{console.error("Error signing document:",s),r(null);const j=s.response?.data;j?.action_required?.type==="configure_signature"?confirm("No tienes firma digital configurada. ¿Deseas configurarla ahora?")&&K("/profile"):alert(j?.error||"Error al firmar documento")}}),b=be?.data?.data||[],E=b.filter(s=>s.is_mine).some(s=>["pending","processing"].includes(s.status)),G=s=>{D(s),N(!0)},H=async s=>{F(s),a.mutate(s)},L=async s=>{if(s.response?.data instanceof Blob)try{const j=await s.response.data.text();return JSON.parse(j)}catch{return null}return s.response?.data},C=async s=>{try{x(s.id);const j=await X.downloadDocument(s.id),O=new Blob([j.data],{type:"application/pdf"}),de=URL.createObjectURL(O),pe=document.createElement("a");pe.href=de,pe.download=`${s.request_number}.pdf`,document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),URL.revokeObjectURL(de)}catch(j){console.error("Error downloading document:",j);const O=await L(j);alert(O?.error||O?.message||"Error al descargar documento")}finally{x(null)}},fe=async s=>{try{je(s.id);const j=await X.downloadDocument(s.id),O=new Blob([j.data],{type:"application/pdf"}),de=URL.createObjectURL(O);I(de)}catch(j){console.error("Error previewing document:",j);const O=await L(j);alert(O?.error||O?.message||"Error al previsualizar documento")}finally{je(null)}},Ne=()=>{y&&URL.revokeObjectURL(y),I(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Certificaciones"}),e.jsx("p",{className:"text-gray-500",children:"Solicita certificaciones laborales para distintos trámites"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[B&&e.jsxs(p,{variant:"secondary",onClick:()=>m(!0),title:"Configurar tipos de certificación",children:[e.jsx(Me,{className:"w-4 h-4"}),"Configurar Tipos"]}),e.jsxs(p,{onClick:()=>f(!0),disabled:U.length===0||E,title:U.length===0?"No hay tipos de certificación disponibles":E?"Certificados en trámite":"",children:[e.jsx(me,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})]}),e.jsx(R,{children:e.jsx(V,{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Oe,{className:"w-4 h-4 text-gray-400"}),e.jsx(re,{options:is,value:Q,onChange:s=>Y(s.target.value),className:"w-48"}),e.jsx(re,{options:qe,value:P,onChange:s=>S(s.target.value),className:"w-56"})]})})}),U.length>0&&!E?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[U.find(s=>s.value==="employment")&&e.jsx(R,{className:"bg-blue-50 border-blue-200 cursor-pointer hover:shadow-md hover:border-blue-300 transition-all",onClick:()=>{T("employment"),f(!0)},children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Certificación Laboral"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Confirma tu vínculo laboral actual"})]})]})})}),U.find(s=>s.value==="salary")&&e.jsx(R,{className:"bg-green-50 border-green-200 cursor-pointer hover:shadow-md hover:border-green-300 transition-all",onClick:()=>{T("salary"),f(!0)},children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Con Información Salarial"}),e.jsx("p",{className:"text-sm text-green-700",children:"Incluye detalles de tu compensación"})]})]})})}),U.find(s=>s.value==="full")&&e.jsx(R,{className:"bg-purple-50 border-purple-200 cursor-pointer hover:shadow-md hover:border-purple-300 transition-all",onClick:()=>{T("full"),f(!0)},children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-purple-900",children:"Certificación Completa"}),e.jsx("p",{className:"text-sm text-purple-700",children:"Incluye toda tu información laboral"})]})]})})}),U.find(s=>s.value==="position")&&e.jsx(R,{className:"bg-amber-50 border-amber-200 cursor-pointer hover:shadow-md hover:border-amber-300 transition-all",onClick:()=>{T("position"),f(!0)},children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-8 h-8 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"Certificación de Cargo"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Detalla cargo y responsabilidades"})]})]})})}),U.find(s=>s.value==="custom")&&e.jsx(R,{className:"bg-gray-50 border-gray-200 cursor-pointer hover:shadow-md hover:border-gray-300 transition-all",onClick:()=>{T("custom"),f(!0)},children:e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-8 h-8 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Certificación Personalizada"}),e.jsx("p",{className:"text-sm text-gray-700",children:"Contenido según necesidad"})]})]})})})]}):e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{className:"w-6 h-6 text-amber-600 flex-shrink-0"}),e.jsx("div",{children:E?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"Los certificados existentes configurados ya están en trámite"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Por favor esperar que sean finalizados para solicitar otro certificado."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"No hay tipos de certificación disponibles"}),e.jsx("p",{className:"text-sm text-amber-700",children:B?"Configura los tipos de certificación y asocia cada uno a un template.":"Contacta al administrador para configurar los templates de certificación."})]})})]}),B&&!E&&e.jsxs(p,{variant:"secondary",size:"sm",onClick:()=>m(!0),className:"flex-shrink-0",children:[e.jsx(Me,{className:"w-4 h-4"}),"Configurar Tipos"]})]})}),e.jsxs(R,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-fixed",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[15%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"w-[18%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"w-[17%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Propósito"}),e.jsx("th",{className:"w-[12%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"w-[10%] px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Días"}),e.jsx("th",{className:"w-[13%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"w-[15%] px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:ue?[...Array(3)].map((s,j)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-28"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8 mx-auto"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16 mx-auto"})})]},j)):b.length>0?b.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"text-sm font-mono text-primary-600 bg-primary-50 px-2 py-0.5 rounded",children:s.request_number})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:_e[s.certification_type]||s.certification_type})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600 truncate block",children:Ve[s.purpose]||s.purpose})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[ds[s.status],e.jsx(oe,{status:s.status})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm text-gray-600",children:s.estimated_days})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(Ee,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"short"})})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>G(s),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 rounded transition-colors",title:"Ver detalle",children:e.jsx(ve,{className:"w-4 h-4"})}),(W||B)&&s.status==="pending"&&!s.document_uuid&&e.jsx("button",{onClick:()=>H(s.id),disabled:M===s.id,className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:opacity-50",title:"Generar documento",children:M===s.id?e.jsx(te,{className:"w-4 h-4 animate-spin"}):e.jsx(We,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.can_download&&e.jsx("button",{onClick:()=>fe(s),disabled:Z===s.id,className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:opacity-50",title:"Previsualizar",children:Z===s.id?e.jsx(te,{className:"w-4 h-4 animate-spin"}):e.jsx(ve,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.can_download&&e.jsx("button",{onClick:()=>C(s),disabled:q===s.id,className:"p-1.5 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded transition-colors disabled:opacity-50",title:"Descargar",children:q===s.id?e.jsx(te,{className:"w-4 h-4 animate-spin"}):e.jsx(Ie,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.pending_signatures?.length>0&&(W||B)&&e.jsx("button",{onClick:()=>{r(s.id),u.mutate(s.id)},disabled:t===s.id,className:"p-1.5 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors disabled:opacity-50",title:`Firmar documento (Pendiente: ${s.document_info?.pending_signatures?.join(", ")})`,children:t===s.id?e.jsx(te,{className:"w-4 h-4 animate-spin"}):e.jsx(ie,{className:"w-4 h-4"})}),s.document_uuid&&!s.document_info?.pdf_ready&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs text-blue-700 bg-blue-50 rounded",title:"El PDF se está generando",children:[e.jsx(te,{className:"w-3 h-3 mr-1 animate-spin"}),"PDF pendiente"]}),s.document_uuid&&s.document_info?.pdf_ready&&!s.document_info?.can_download&&!(W||B)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs text-amber-700 bg-amber-50 rounded",title:`Pendiente: ${s.document_info?.pending_signatures?.join(", ")}`,children:[e.jsx(xe,{className:"w-3 h-3 mr-1"}),"Firma pendiente"]}),["pending","processing"].includes(s.status)&&!B&&e.jsx("button",{onClick:()=>Pe.mutate(s.id),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Cancelar",children:e.jsx(De,{className:"w-4 h-4"})}),B&&e.jsx("button",{onClick:()=>g(s),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Eliminar",children:e.jsx(Ce,{className:"w-4 h-4"})})]})})]},s.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-4 py-12 text-center",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-base font-medium text-gray-900 mb-1",children:"No tienes solicitudes de certificaciones"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Solicita una certificación laboral para tus trámites"}),e.jsxs(p,{size:"sm",onClick:()=>f(!0),disabled:U.length===0||E,children:[e.jsx(me,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})})})]})}),b.length>0&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("p",{className:"text-sm text-gray-500",children:[b.length," solicitud",b.length!==1?"es":""]})})]}),e.jsx(ee,{isOpen:l,onClose:()=>{f(!1),T(null)},title:"Nueva Solicitud de Certificación",size:"lg",children:e.jsx(cs,{onSubmit:s=>ne.mutate(s),onCancel:()=>{f(!1),T(null)},loading:ne.isPending,initialType:Fe,availableTypes:U})}),e.jsx(ee,{isOpen:_,onClose:()=>N(!1),title:"Detalle de Certificación",size:"md",children:o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Número:"}),e.jsx("span",{className:"font-medium",children:o.request_number})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(oe,{status:o.status})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("span",{children:_e[o.certification_type]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Propósito:"}),e.jsx("span",{children:Ve[o.purpose]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Tiempo estimado:"}),e.jsxs("span",{children:[o.estimated_days," día",o.estimated_days>1?"s":""," hábil",o.estimated_days>1?"es":""]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha solicitud:"}),e.jsx("span",{children:new Date(o.created_at).toLocaleDateString("es-ES")})]}),o.language&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Idioma:"}),e.jsx("span",{children:o.language==="es"?"Español":"Inglés"})]}),o.status==="completed"&&o.completed_at&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha completado:"}),e.jsx("span",{className:"text-green-600 font-medium",children:new Date(o.completed_at).toLocaleDateString("es-ES")})]}),o.status==="rejected"&&o.rejection_reason&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"Motivo de rechazo:"}),e.jsx("p",{className:"text-red-700",children:o.rejection_reason})]}),o.processed_by&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Procesado por:"}),e.jsx("p",{className:"text-gray-600",children:o.processed_by.name})]}),o.document_uuid&&o.document_info?.can_download&&e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsxs(p,{className:"w-full",variant:"primary",onClick:()=>fe(o),loading:Z===o.id,children:[e.jsx(ve,{className:"w-4 h-4"}),"Previsualizar Documento"]}),e.jsxs(p,{className:"w-full",variant:"secondary",onClick:()=>C(o),loading:q===o.id,children:[e.jsx(Ie,{className:"w-4 h-4"}),"Descargar Certificación"]})]})]})}),e.jsx(ee,{isOpen:h,onClose:()=>v(!1),title:"No se puede generar el documento",size:"md",children:i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(we,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Información faltante"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:i.message})]})]}),i.missingData?.by_source?.employee?.length>0&&e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-amber-800 mb-2",children:"Datos del empleado requeridos:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-amber-700 space-y-1",children:i.missingData.by_source.employee.map((s,j)=>e.jsx("li",{children:s.field_label||s.field},j))})]}),i.missingData?.by_source?.organization?.length>0&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-2",children:"Datos de la organización requeridos:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-blue-700 space-y-1",children:i.missingData.by_source.organization.map((s,j)=>e.jsx("li",{children:s.field_label||s.field},j))})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t",children:[i.actions?.map((s,j)=>e.jsxs(p,{variant:j===0?"primary":"secondary",className:"w-full justify-center",onClick:()=>{v(!1),s.type==="edit_employee"&&s.employee_id?K(`/hr/employees?edit=${s.employee_id}`):s.type==="edit_organization"?K("/admin/organization"):s.type==="configure_mappings"&&K("/admin/variable-mappings")},children:[e.jsx(ke,{className:"w-4 h-4"}),s.label,s.employee_name&&` (${s.employee_name})`]},j)),e.jsx(p,{variant:"ghost",className:"w-full justify-center",onClick:()=>v(!1),children:"Cerrar"})]})]})}),e.jsx(ee,{isOpen:!!w,onClose:()=>g(null),title:"Eliminar Certificación",size:"sm",children:w&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(we,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"¿Eliminar esta certificación?"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Esta acción no se puede deshacer. Se eliminará permanentemente la solicitud"," ",e.jsx("strong",{children:w.request_number}),"."]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("span",{className:"font-medium",children:_e[w.certification_type]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(oe,{status:w.status})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(p,{variant:"ghost",className:"flex-1",onClick:()=>g(null),children:"Cancelar"}),e.jsxs(p,{variant:"danger",className:"flex-1",loading:n.isPending,onClick:()=>n.mutate(w.id),children:[e.jsx(Ce,{className:"w-4 h-4"}),"Eliminar"]})]})]})}),e.jsx(ee,{isOpen:!!y,onClose:Ne,title:"Previsualización de Documento",size:"full",children:e.jsxs("div",{className:"flex flex-col h-[80vh]",children:[y&&e.jsx("iframe",{src:y,className:"w-full flex-1 border rounded-lg bg-gray-100",title:"Vista previa del documento"}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t mt-4",children:e.jsxs(p,{variant:"secondary",onClick:Ne,children:[e.jsx(De,{className:"w-4 h-4"}),"Cerrar"]})})]})}),e.jsx(ee,{isOpen:c,onClose:()=>m(!1),title:"Configurar Tipos de Certificación",size:"lg",children:e.jsx(os,{onClose:()=>{m(!1),J.invalidateQueries(["certification-available-types"])},onNavigateToTemplate:s=>{m(!1),K(`/admin/templates/${s}`)}})})]})}const xs=[{id:"vacations",name:"Vacaciones",icon:Ee,path:"/hr/my-requests/vacations"},{id:"certifications",name:"Certificaciones",icon:Je,path:"/hr/my-requests/certifications"}];function Ds(){const{tab:l}=Qe(),f=Se();if(!l)return e.jsx(ze,{to:"/hr/my-requests/vacations",replace:!0});if(!["vacations","certifications"].includes(l))return e.jsx(ze,{to:"/hr/my-requests/vacations",replace:!0});const N=l;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:xs.map(h=>{const v=h.icon,c=N===h.id;return e.jsxs("button",{onClick:()=>f(h.path),className:`
                  group inline-flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm
                  ${c?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx(v,{className:`w-5 h-5 ${c?"text-primary-500":"text-gray-400 group-hover:text-gray-500"}`}),h.name]},h.id)})})}),e.jsxs("div",{children:[N==="vacations"&&e.jsx(rs,{}),N==="certifications"&&e.jsx(ms,{})]})]})}export{Ds as default};
