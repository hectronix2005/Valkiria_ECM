import{u as W,a as $,b as k,j as e}from"./vendor-query-2ZprUnmA.js";import{r as d}from"./vendor-router-CyR0tpch.js";import{b as f,c as ce}from"./index-DGmn3wGL.js";import{C as E,c as R}from"./Card-DbNYCSnq.js";import{B as i}from"./Button-DOJd5Ro7.js";import{B as X}from"./Badge-Cu_cxnAa.js";import{M as se}from"./Modal-DzLd-7Tu.js";import{p as ae,a7 as te,u as H,A as K,Q as L,F as b,n as de,V as U,a8 as J,h as ne,a5 as G,a4 as ie,m as F}from"./vendor-icons-BeDautqo.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";function re({request:s,type:x,onApprove:_,onReject:u,onView:n,onSign:l,signingId:o,showActions:c=!0}){const p=x==="vacation",j=p?H:K;return e.jsx(E,{className:"hover:shadow-md transition-shadow",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${p?"bg-blue-50":"bg-purple-50"}`,children:e.jsx(j,{className:`w-6 h-6 ${p?"text-blue-600":"text-purple-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.employee?.name||"Empleado"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.employee?.department," • ",s.employee?.job_title]})]}),e.jsx(X,{status:s.status})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Solicitud:"})," ",s.request_number]}),p?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",s.vacation_type]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Fechas:"})," ",new Date(s.start_date).toLocaleDateString("es-ES")," -"," ",new Date(s.end_date).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsxs("p",{className:"text-sm font-medium text-primary-600",children:[Math.floor(s.days_requested)," dias solicitados"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium text-green-600",children:Math.floor(s.employee?.available_vacation_days||0)})," dias disponibles"]})]}),s.has_document&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-sm text-blue-600",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:"Documento adjunto"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," Certificacion ",s.certification_type]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Proposito:"})," ",s.purpose]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Tiempo estimado: ",s.estimated_days," dias"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>n(s,x),children:[e.jsx(de,{className:"w-4 h-4"}),"Detalle"]}),c&&e.jsxs(e.Fragment,{children:[s.can_sign&&s.has_document&&e.jsxs(i,{variant:"secondary",size:"sm",onClick:()=>l(s,x),loading:o===s.id,className:"text-purple-700 border-purple-300 hover:bg-purple-50",children:[e.jsx(U,{className:"w-4 h-4"}),"Firmar"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(i,{variant:"danger",size:"sm",onClick:()=>u(s,x),children:[e.jsx(J,{className:"w-4 h-4"}),"Rechazar"]}),e.jsxs(i,{variant:"success",size:"sm",onClick:()=>_(s,x),children:[e.jsx(L,{className:"w-4 h-4"}),"Aprobar"]})]})]})]})]})})})}function oe({request:s,onClose:x,onApprove:_,onReject:u}){const[n,l]=d.useState(null),[o,c]=d.useState(!1),[p,j]=d.useState(""),v=W();d.useEffect(()=>(s.pdf_ready&&s.document_uuid&&w(),()=>{n&&URL.revokeObjectURL(n)}),[s.id,s.document_uuid,s.pdf_ready]);const w=async()=>{c(!0);try{const t=await f.downloadDocument(s.id),g=new Blob([t.data],{type:"application/pdf"});l(URL.createObjectURL(g))}catch(t){console.error("Error loading PDF:",t)}finally{c(!1)}},m=k({mutationFn:t=>f.signDocument(t),onSuccess:()=>{v.invalidateQueries(["approvals"]),j(""),n&&(URL.revokeObjectURL(n),l(null)),w()},onError:t=>{j(t.response?.data?.error||"Error al firmar el documento")}}),P=()=>{j(""),m.mutate(s.id)},A=()=>{n&&window.open(n,"_blank")},h=s.document,S=h?.signatures?.find(t=>t.signatory_type_code==="supervisor"),C=h?.signatures?.find(t=>t.signatory_type_code==="hr");h?.signatures?.find(t=>t.signatory_type_code==="employee");const T=S&&!S.signed||C&&!C.signed;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.employee?.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.employee?.department," • ",s.employee?.job_title]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Numero de Solicitud"}),e.jsx("p",{className:"font-medium",children:s.request_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estado"}),e.jsx(X,{status:s.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tipo"}),e.jsx("p",{className:"font-medium",children:s.vacation_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Dias Solicitados"}),e.jsx("p",{className:"font-medium text-primary-600",children:s.days_requested})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fecha Inicio"}),e.jsx("p",{className:"font-medium",children:new Date(s.start_date).toLocaleDateString("es-ES")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fecha Fin"}),e.jsx("p",{className:"font-medium",children:new Date(s.end_date).toLocaleDateString("es-ES")})]})]}),s.reason&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Motivo"}),e.jsx("p",{className:"p-3 bg-gray-50 rounded-lg text-gray-700",children:s.reason})]}),s.has_document&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-primary-600"}),"Documento de Solicitud"]}),o?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(G,{className:"w-8 h-8 animate-spin mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]}):n?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Vista Previa del Documento"}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:A,children:[e.jsx(ie,{className:"w-4 h-4"}),"Abrir en nueva pestana"]})]}),e.jsx("iframe",{src:n,className:"w-full h-[350px] border-0",title:"Vista previa del documento"})]}):s.pdf_ready===!1?e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-amber-50 border-amber-200",children:[e.jsx(F,{className:"w-8 h-8 mx-auto text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-700 font-medium",children:"Documento pendiente de generacion"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"El PDF se generara proximamente"})]}):e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-gray-50",children:[e.jsx(b,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No se pudo cargar el documento"})]}),h?.signatures&&h.signatures.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-white border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Firmas del Documento"]}),e.jsx("div",{className:"space-y-3",children:h.signatures.map((t,g)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${t.signed?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:t.signed?e.jsx(L,{className:"w-5 h-5"}):t.position||g+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.label}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.signatory_type_code==="employee"&&"Empleado Solicitante",t.signatory_type_code==="supervisor"&&"Supervisor Directo",t.signatory_type_code==="hr"&&"Recursos Humanos"]}),t.signed&&e.jsxs("p",{className:"text-xs text-green-600 mt-0.5",children:["Firmado por ",t.signed_by_name," - ",new Date(t.signed_at).toLocaleString("es-ES")]})]})]}),!t.signed&&e.jsx("span",{className:"text-xs text-amber-600 px-2 py-1 bg-amber-100 rounded",children:"Pendiente"})]},g))}),T&&s.status==="pending"&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs(i,{onClick:P,loading:m.isPending,className:"w-full",children:[e.jsx(U,{className:"w-4 h-4"}),"Firmar Documento"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"Tu firma se aplicara en el espacio correspondiente a tu rol"})]})]}),p&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:p})]})]}),s.status==="pending"&&e.jsxs("div",{className:"pt-4 border-t",children:[s.has_document&&h?.signatures?.some(t=>!t.signed)&&e.jsxs("div",{className:"mb-3 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center gap-2 text-amber-700",children:[e.jsx(F,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:"Para aprobar esta solicitud, primero deben completarse todas las firmas del documento."})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(i,{variant:"secondary",onClick:x,children:"Cerrar"}),e.jsxs(i,{variant:"danger",onClick:()=>u(s),children:[e.jsx(J,{className:"w-4 h-4"}),"Rechazar"]}),e.jsxs(i,{variant:"success",onClick:()=>_(s),disabled:s.has_document&&h?.signatures?.some(t=>!t.signed),children:[e.jsx(L,{className:"w-4 h-4"}),"Aprobar"]})]})]}),s.status!=="pending"&&e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx(i,{variant:"secondary",onClick:x,children:"Cerrar"})})]})}function me({request:s,onClose:x,onApprove:_,onReject:u,onGenerateDocument:n,isGenerating:l,generateError:o}){const[c,p]=d.useState(null),[j,v]=d.useState(!1),[w,m]=d.useState(""),[P,A]=d.useState(!1),h=W();d.useEffect(()=>{!s.has_document&&!P&&n&&!l&&(A(!0),n(s.id))},[s.id,s.has_document]),d.useEffect(()=>(s.pdf_ready&&s.document_uuid&&S(),()=>{c&&URL.revokeObjectURL(c)}),[s.id,s.document_uuid,s.pdf_ready]);const S=async()=>{v(!0);try{const r=await f.downloadDocument(s.id),y=new Blob([r.data],{type:"application/pdf"});p(URL.createObjectURL(y))}catch(r){console.error("Error loading PDF:",r)}finally{v(!1)}},C=k({mutationFn:r=>f.signDocument(r),onSuccess:()=>{h.invalidateQueries(["approvals"]),m(""),c&&(URL.revokeObjectURL(c),p(null)),S()},onError:r=>{m(r.response?.data?.error||"Error al firmar el documento")}}),T=()=>{m(""),C.mutate(s.id)},t=()=>{c&&window.open(c,"_blank")},g=s.document,z=g?.signatures?.some(r=>!r.signed);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.employee?.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.employee?.department," • ",s.employee?.job_title]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Numero de Solicitud"}),e.jsx("p",{className:"font-medium",children:s.request_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estado"}),e.jsx(X,{status:s.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tipo de Certificacion"}),e.jsx("p",{className:"font-medium",children:s.certification_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Proposito"}),e.jsx("p",{className:"font-medium",children:s.purpose})]})]}),s.has_document?e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-primary-600"}),"Documento de Certificacion"]}),j?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(G,{className:"w-8 h-8 animate-spin mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]}):c?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Vista Previa del Documento"}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:t,children:[e.jsx(ie,{className:"w-4 h-4"}),"Abrir en nueva pestana"]})]}),e.jsx("iframe",{src:c,className:"w-full h-[350px] border-0",title:"Vista previa del documento"})]}):s.pdf_ready===!1?e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-amber-50 border-amber-200",children:[e.jsx(F,{className:"w-8 h-8 mx-auto text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-700 font-medium",children:"Documento pendiente de generacion"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"El PDF se generara proximamente"})]}):e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-gray-50",children:[e.jsx(b,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No se pudo cargar el documento"})]}),g?.signatures&&g.signatures.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-white border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Firmas del Documento"]}),e.jsx("div",{className:"space-y-3",children:g.signatures.map((r,y)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${r.signed?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:r.signed?e.jsx(L,{className:"w-5 h-5"}):r.position||y+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.label}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.signatory_type_code==="hr"&&"Recursos Humanos",r.signatory_type_code==="supervisor"&&"Supervisor",r.signatory_type_code==="legal"&&"Legal"]}),r.signed&&e.jsxs("p",{className:"text-xs text-green-600 mt-0.5",children:["Firmado por ",r.signed_by_name," - ",new Date(r.signed_at).toLocaleString("es-ES")]})]})]}),!r.signed&&e.jsx("span",{className:"text-xs text-amber-600 px-2 py-1 bg-amber-100 rounded",children:"Pendiente"})]},y))}),z&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs(i,{onClick:T,loading:C.isPending,className:"w-full",children:[e.jsx(U,{className:"w-4 h-4"}),"Firmar Documento"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"Tu firma se aplicara en el espacio correspondiente a tu rol"})]})]}),w&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:w})]})]}):e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-primary-600"}),"Documento de Certificacion"]}),l?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(G,{className:"w-8 h-8 animate-spin mx-auto text-primary-500 mb-2"}),e.jsx("p",{className:"text-gray-700 font-medium",children:"Generando documento..."}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Esto puede tomar unos segundos"})]}):o?e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-red-50 border-red-200",children:[e.jsx(F,{className:"w-8 h-8 mx-auto text-red-500 mb-2"}),e.jsx("p",{className:"text-red-700 font-medium",children:"Error al generar documento"}),e.jsx("p",{className:"text-red-600 text-sm mt-1 mb-4",children:o}),n&&e.jsxs(i,{onClick:()=>n(s.id),children:[e.jsx(b,{className:"w-4 h-4"}),"Reintentar"]})]}):e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-blue-50 border-blue-200",children:[e.jsx(b,{className:"w-8 h-8 mx-auto text-blue-500 mb-2"}),e.jsx("p",{className:"text-blue-700 font-medium",children:"Documento no generado"}),e.jsx("p",{className:"text-blue-600 text-sm mt-1 mb-4",children:"Genera el documento de certificacion para revisarlo antes de aprobar"}),n&&e.jsxs(i,{onClick:()=>n(s.id),children:[e.jsx(b,{className:"w-4 h-4"}),"Generar Documento"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(i,{variant:"secondary",onClick:x,children:"Cerrar"}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"danger",onClick:()=>u(s),children:[e.jsx(J,{className:"w-4 h-4"}),"Rechazar"]}),e.jsxs(i,{variant:"success",onClick:()=>_(s),children:[e.jsx(L,{className:"w-4 h-4"}),"Aprobar"]})]})]})]})}function ve(){const[s,x]=d.useState("pending"),[_,u]=d.useState(!1),[n,l]=d.useState(!1),[o,c]=d.useState(null),[p,j]=d.useState(null),[v,w]=d.useState(""),m=W(),{data:P,isLoading:A}=$({queryKey:["approvals","pending"],queryFn:()=>f.list({status:"pending"})}),{data:h,isLoading:S}=$({queryKey:["approvals","history"],queryFn:()=>f.list({status:"history"}),enabled:s==="history"}),{data:C}=$({queryKey:["approval-detail",o?.id],queryFn:()=>f.get(o.id),enabled:!!o?.id&&n}),T=k({mutationFn:({id:a})=>f.approve(a,{}),onSuccess:()=>{m.invalidateQueries(["approvals"]),m.invalidateQueries(["approvals-count"]),l(!1)},onError:a=>{alert(a.response?.data?.error||"Error al aprobar la solicitud")}}),t=k({mutationFn:({id:a,reason:N})=>f.reject(a,N),onSuccess:()=>{m.invalidateQueries(["approvals"]),m.invalidateQueries(["approvals-count"]),u(!1),w("")},onError:a=>{alert(a.response?.data?.error||"Error al rechazar la solicitud")}}),[g,z]=d.useState(null),r=k({mutationFn:a=>f.signDocument(a),onSuccess:()=>{m.invalidateQueries(["approvals"]),z(null)},onError:a=>{z(null),alert(a.response?.data?.error||"Error al firmar el documento")}}),y=k({mutationFn:a=>ce.generateDocument(a),onSuccess:a=>{m.invalidateQueries(["approvals"]),m.invalidateQueries(["approval-detail"]),a.data?.data?.certification&&c(N=>({...N,document_uuid:a.data.data.certification.document_uuid,has_document:!0,pdf_ready:!0,status:a.data.data.certification.status}))},onError:()=>{}}),M=P?.data?.data||{vacation_requests:[],certification_requests:[]},O=h?.data?.data||{vacation_requests:[],certification_requests:[]},B=(M.vacation_requests?.length||0)+(M.certification_requests?.length||0),Y=(O.vacation_requests?.length||0)+(O.certification_requests?.length||0),Q=(a,N)=>{window.confirm("Estas seguro de aprobar esta solicitud?")&&T.mutate({id:a.id,type:N})},V=(a,N)=>{c(a),j(N),u(!0)},Z=(a,N)=>{c(a),j(N),l(!0)},q=a=>{z(a.id),r.mutate(a.id)},le=()=>{if(!v.trim()){alert("Debes proporcionar un motivo de rechazo");return}t.mutate({id:o.id,reason:v})},D=s==="pending"?M:O,I=s==="pending"?A:S,ee=C?.data?.data||o;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion de Aprobaciones"}),e.jsx("p",{className:"text-gray-500",children:"Administra las solicitudes de vacaciones y certificaciones"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>x("pending"),className:`py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${s==="pending"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(ae,{className:"w-4 h-4"}),"Pendientes",B>0&&e.jsx("span",{className:"bg-danger-500 text-white text-xs px-2 py-0.5 rounded-full",children:B})]}),e.jsxs("button",{onClick:()=>x("history"),className:`py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${s==="history"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(te,{className:"w-4 h-4"}),"Historial",s==="history"&&Y>0&&e.jsx("span",{className:"bg-gray-200 text-gray-700 text-xs px-2 py-0.5 rounded-full",children:Y})]})]})}),s==="pending"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(E,{children:e.jsxs(R,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"p-3 bg-yellow-50 rounded-xl",children:e.jsx(ae,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:B}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Pendientes"})]})]})}),e.jsx(E,{children:e.jsxs(R,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-xl",children:e.jsx(H,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:M.vacation_requests?.length||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"Vacaciones"})]})]})}),e.jsx(E,{children:e.jsxs(R,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-xl",children:e.jsx(K,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:M.certification_requests?.length||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"Certificaciones"})]})]})})]}),I&&e.jsx("div",{className:"space-y-4",children:[1,2,3].map(a=>e.jsx(E,{className:"animate-pulse",children:e.jsx(R,{className:"p-4",children:e.jsx("div",{className:"h-24 bg-gray-100 rounded"})})},a))}),!I&&D.vacation_requests?.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600"}),"Solicitudes de Vacaciones"]}),e.jsx("div",{className:"space-y-4",children:D.vacation_requests.map(a=>e.jsx(re,{request:a,type:"vacation",onApprove:Q,onReject:V,onView:Z,onSign:q,signingId:g,showActions:s==="pending"},a.id))})]}),!I&&D.certification_requests?.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-purple-600"}),"Solicitudes de Certificacion"]}),e.jsx("div",{className:"space-y-4",children:D.certification_requests.map(a=>e.jsx(re,{request:a,type:"certification",onApprove:Q,onReject:V,onView:Z,onSign:q,signingId:g,showActions:s==="pending"},a.id))})]}),!I&&D.vacation_requests?.length===0&&D.certification_requests?.length===0&&e.jsx(E,{children:e.jsx(R,{className:"py-12 text-center",children:s==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-16 h-16 mx-auto text-green-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Todo al dia!"}),e.jsx("p",{className:"text-gray-500",children:"No tienes solicitudes pendientes de aprobacion"})]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sin historial"}),e.jsx("p",{className:"text-gray-500",children:"Aun no hay solicitudes procesadas"})]})})}),e.jsx(se,{isOpen:_,onClose:()=>u(!1),title:"Rechazar Solicitud",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:["Por favor, proporciona el motivo del rechazo para la solicitud"," ",e.jsx("span",{className:"font-medium",children:o?.request_number}),"."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo del Rechazo *"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:4,value:v,onChange:a=>w(a.target.value),placeholder:"Explica el motivo del rechazo...",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(i,{variant:"secondary",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(i,{variant:"danger",onClick:le,loading:t.isPending,children:"Confirmar Rechazo"})]})]})}),e.jsx(se,{isOpen:n,onClose:()=>l(!1),title:"Detalle de Solicitud",size:"xl",children:o&&p==="vacation"?e.jsx(oe,{request:ee,onClose:()=>l(!1),onApprove:a=>{l(!1),Q(a,"vacation")},onReject:a=>{l(!1),V(a,"vacation")}}):o&&p==="certification"?e.jsx(me,{request:ee,onClose:()=>l(!1),onApprove:a=>{l(!1),Q(a,"certification")},onReject:a=>{l(!1),V(a,"certification")},onGenerateDocument:a=>y.mutate(a),isGenerating:y.isPending,generateError:y.isError?y.error?.response?.data?.error||"Error al generar documento":null}):null})]})}export{ve as default};
