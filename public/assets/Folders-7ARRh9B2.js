import{b as M,u as D,c as w,j as e}from"./vendor-query-BtlmzfbD.js";import{r as i}from"./vendor-router-CyR0tpch.js";import{m as N,g as R}from"./index-dWciXlne.js";import{C as S,c as E}from"./Card-CVFC4agM.js";import{B as j}from"./Button-C8xCGhNf.js";import{I as B}from"./Input-DPOK3q6H.js";import{az as I,H as $,i as Q,a as G,aA as K,aB as T,ar as V,Y as H,a4 as X,F as k,P as _,X as q,l as Y,e as J}from"./vendor-icons-BMeEPn6p.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const U=[{value:"#6366f1",label:"Indigo"},{value:"#8b5cf6",label:"Violeta"},{value:"#ec4899",label:"Rosa"},{value:"#f43f5e",label:"Rojo"},{value:"#f97316",label:"Naranja"},{value:"#eab308",label:"Amarillo"},{value:"#22c55e",label:"Verde"},{value:"#14b8a6",label:"Teal"},{value:"#0ea5e9",label:"Azul"},{value:"#6b7280",label:"Gris"}];function W({isOpen:m,onClose:n,folder:r=null,parentId:b=null}){const c=M(),[g,o]=i.useState(""),[y,u]=i.useState(""),[f,d]=i.useState("#6366f1"),[v,x]=i.useState(""),h=!!r;i.useEffect(()=>{m&&(r?(o(r.name||""),u(r.description||""),d(r.color||"#6366f1")):(o(""),u(""),d("#6366f1")),x(""))},[r,m]);const t=w({mutationFn:a=>N.create(a),onSuccess:()=>{c.invalidateQueries(["folders"]),p()},onError:a=>x(a.response?.data?.error||"Error al crear carpeta")}),C=w({mutationFn:a=>N.update(r.id,a),onSuccess:()=>{c.invalidateQueries(["folders"]),p()},onError:a=>x(a.response?.data?.error||"Error al actualizar carpeta")}),p=()=>{o(""),u(""),d("#6366f1"),x(""),n()},l=a=>{if(a.preventDefault(),!g.trim()){x("El nombre es requerido");return}const F={name:g,description:y,color:f,parent_id:b};h?C.mutate(F):t.mutate(F)};return m?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:h?"Editar Carpeta":"Nueva Carpeta"}),e.jsx("button",{onClick:p,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:l,className:"p-4 space-y-4",children:[v&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:v})]}),e.jsx(B,{label:"Nombre",value:g,onChange:a=>o(a.target.value),placeholder:"Ej: Contratos 2024",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción (opcional)"}),e.jsx("textarea",{value:y,onChange:a=>u(a.target.value),placeholder:"Descripción de la carpeta...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:U.map(a=>e.jsx("button",{type:"button",onClick:()=>d(a.value),className:`w-8 h-8 rounded-full border-2 transition-transform ${f===a.value?"border-gray-900 scale-110":"border-transparent"}`,style:{backgroundColor:a.value},title:a.label},a.value))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:p,children:"Cancelar"}),e.jsx(j,{type:"submit",loading:t.isPending||C.isPending,children:h?"Guardar":"Crear Carpeta"})]})]})]})}):null}function Z({isOpen:m,onClose:n,folder:r}){const b=M(),[c,g]=i.useState(""),[o,y]=i.useState(""),{data:u,isLoading:f}=D({queryKey:["available-documents"],queryFn:()=>R.list({per_page:100}),enabled:m}),d=w({mutationFn:t=>N.addDocument(r.id,t),onSuccess:()=>{b.invalidateQueries(["folders"]),b.invalidateQueries(["folder",r.id])},onError:t=>y(t.response?.data?.error||"Error al agregar documento")}),v=u?.data?.data||[],x=r?.documents?.map(t=>t.id)||[],h=v.filter(t=>x.includes(t.id)?!1:c?t.name.toLowerCase().includes(c.toLowerCase()):!0);return!m||!r?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:['Agregar Documento a "',r.name,'"']}),e.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar documentos...",value:c,onChange:t=>g(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),o&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:o})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:f?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):h.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:c?"No se encontraron documentos":"No hay documentos disponibles"}):e.jsx("div",{className:"space-y-2",children:h.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(k,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.template_name})]})]}),e.jsx(j,{size:"sm",variant:"secondary",onClick:()=>d.mutate(t.id),loading:d.isPending,children:e.jsx(_,{className:"w-4 h-4"})})]},t.id))})}),e.jsx("div",{className:"p-4 border-t",children:e.jsx(j,{variant:"secondary",onClick:n,className:"w-full",children:"Cerrar"})})]})})}function oe(){const m=M(),[n,r]=i.useState(null),[b,c]=i.useState(!1),[g,o]=i.useState(!1),[y,u]=i.useState(null),[f,d]=i.useState(null),{data:v}=D({queryKey:["folder",n],queryFn:()=>N.get(n),enabled:!!n}),{data:x,isLoading:h}=D({queryKey:["folders",n||"root"],queryFn:()=>N.list({parent_id:n||"root"})}),t=w({mutationFn:s=>N.delete(s),onSuccess:()=>{m.invalidateQueries(["folders"]),d(null)}}),C=w({mutationFn:({folderId:s,documentId:L})=>N.removeDocument(s,L),onSuccess:()=>{m.invalidateQueries(["folders"]),m.invalidateQueries(["folder",n])}}),p=x?.data?.data||[],l=v?.data?.data,a=l?.ancestors||[],F=s=>{r(s.id)},z=(s=null)=>{r(s)},P=s=>{u(s),c(!0),d(null)},O=s=>{if(s.documents_count>0||s.subfolders_count>0){alert("No se puede eliminar una carpeta que contiene documentos o subcarpetas");return}confirm(`¿Eliminar la carpeta "${s.name}"?`)&&t.mutate(s.id)},A=()=>{u(null),c(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Carpetas"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Organiza tus documentos en carpetas"})]}),e.jsxs(j,{onClick:A,children:[e.jsx(I,{className:"w-4 h-4"}),"Nueva Carpeta"]})]}),e.jsx(S,{children:e.jsx(E,{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("button",{onClick:()=>z(null),className:`flex items-center gap-1 hover:text-primary-600 ${n?"text-gray-600":"text-primary-600 font-medium"}`,children:[e.jsx($,{className:"w-4 h-4"}),"Inicio"]}),a.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-400"}),e.jsx("button",{onClick:()=>z(s.id),className:"text-gray-600 hover:text-primary-600",children:s.name})]},s.id)),l&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-primary-600 font-medium",children:l.name})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(S,{children:e.jsx(E,{className:"p-0",children:h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):p.length===0&&!l?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(G,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay carpetas"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Crea tu primera carpeta para organizar documentos"}),e.jsxs(j,{onClick:A,children:[e.jsx(I,{className:"w-4 h-4"}),"Nueva Carpeta"]})]}):e.jsxs("div",{className:"divide-y",children:[p.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-50 group",children:[e.jsxs("button",{onClick:()=>F(s),className:"flex items-center gap-3 flex-1 text-left",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${s.color}20`},children:e.jsx(K,{className:"w-5 h-5",style:{color:s.color}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.documents_count," documentos",s.subfolders_count>0&&` • ${s.subfolders_count} subcarpetas`]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>d(f===s.id?null:s.id),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(T,{className:"w-4 h-4"})}),f===s.id&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border rounded-lg shadow-lg py-1 z-10 w-36",children:[e.jsxs("button",{onClick:()=>P(s),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"Editar"]}),e.jsxs("button",{onClick:()=>O(s),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2 text-red-600",children:[e.jsx(H,{className:"w-4 h-4"}),"Eliminar"]})]})]})]},s.id)),p.length===0&&l&&e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No hay subcarpetas"})]})})})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(S,{children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:l?"Documentos":"Selecciona una carpeta"}),l&&e.jsx(j,{size:"sm",variant:"secondary",onClick:()=>o(!0),children:e.jsx(X,{className:"w-4 h-4"})})]}),l?l.documents?.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 text-sm",children:[e.jsx(k,{className:"w-10 h-10 text-gray-300 mx-auto mb-2"}),"No hay documentos en esta carpeta",e.jsxs(j,{size:"sm",variant:"secondary",className:"mt-3",onClick:()=>o(!0),children:[e.jsx(_,{className:"w-4 h-4"}),"Agregar"]})]}):e.jsx("div",{className:"space-y-2",children:l.documents.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg hover:bg-gray-50 group",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(k,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm truncate",children:s.name})]}),e.jsx("button",{onClick:()=>C.mutate({folderId:l.id,documentId:s.id}),className:"p-1 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100",title:"Quitar de carpeta",children:e.jsx(q,{className:"w-4 h-4"})})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 text-sm",children:[e.jsx(k,{className:"w-10 h-10 text-gray-300 mx-auto mb-2"}),"Abre una carpeta para ver sus documentos"]})]})})})]}),e.jsx(W,{isOpen:b,onClose:()=>{c(!1),u(null)},folder:y,parentId:n}),e.jsx(Z,{isOpen:g,onClose:()=>o(!1),folder:l})]})}export{oe as default};
