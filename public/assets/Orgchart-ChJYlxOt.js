import{a as C,j as e}from"./vendor-query-2ZprUnmA.js";import{r as j}from"./vendor-router-CyR0tpch.js";import{e as E}from"./index-3EbJ9gtK.js";import{B as v,U as y,h as L,q as S,e as $,ak as R,al as k,i as q,j as A}from"./vendor-icons-BeDautqo.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";function N({employee:a,employees:i,expanded:r,onToggle:c,level:o=0}){const n=i.filter(l=>l.supervisor_id===a.id),x=n.length>0,u=r[a.id]!==!1,p=l=>{if(!l||l.length===0)return null;const m=l[0],g={admin:{bg:"bg-purple-100",text:"text-purple-700",label:"Admin"},hr:{bg:"bg-emerald-100",text:"text-emerald-700",label:"RRHH"},hr_manager:{bg:"bg-green-100",text:"text-green-700",label:"Gerente RRHH"},legal:{bg:"bg-orange-100",text:"text-orange-700",label:"Legal"},manager:{bg:"bg-blue-100",text:"text-blue-700",label:"Gerente"},employee:{bg:"bg-gray-100",text:"text-gray-700",label:"Empleado"},viewer:{bg:"bg-slate-100",text:"text-slate-600",label:"Visitante"}},h=g[m]||g.employee;return e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${h.bg} ${h.text}`,children:h.label})},t=l=>{switch(l){case"active":return"bg-green-500";case"inactive":return"bg-gray-400";case"on_leave":return"bg-yellow-500";default:return"bg-gray-400"}};return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:`
          relative bg-white rounded-xl border-2 shadow-sm hover:shadow-md transition-all
          ${o===0?"border-primary-400 bg-primary-50/30":"border-gray-200 hover:border-primary-300"}
          ${x?"cursor-pointer":""}
        `,onClick:()=>x&&c(a.id),style:{minWidth:"200px",maxWidth:"240px"},children:[e.jsx("div",{className:`absolute top-3 right-3 w-2.5 h-2.5 rounded-full ${t(a.employment_status)}`,title:a.employment_status==="active"?"Activo":a.employment_status}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsxs("div",{className:`w-14 h-14 rounded-full flex items-center justify-center text-lg font-semibold
              ${o===0?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600"}`,children:[a.first_name?.[0],a.last_name?.[0]]})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 text-center truncate",children:a.full_name||`${a.first_name} ${a.last_name}`}),e.jsx("p",{className:"text-xs text-gray-500 text-center truncate mt-1",children:a.job_title||"Sin cargo"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2 flex-wrap",children:[a.department&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-600",children:a.department_label||a.department}),p(a.roles)]}),x&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-3 text-xs text-gray-500",children:[e.jsx(y,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[n.length," colaborador",n.length!==1?"es":""]}),u?e.jsx(q,{className:"w-3.5 h-3.5"}):e.jsx(A,{className:"w-3.5 h-3.5"})]})]})]}),x&&u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-0.5 h-6 bg-gray-300"}),n.length>1&&e.jsx("div",{className:"relative w-full flex justify-center",children:e.jsx("div",{className:"h-0.5 bg-gray-300",style:{width:`${Math.min(n.length*220,880)}px`,maxWidth:"100%"}})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-4 pt-2",children:n.map(l=>e.jsxs("div",{className:"flex flex-col items-center",children:[n.length>1&&e.jsx("div",{className:"w-0.5 h-4 bg-gray-300"}),e.jsx(N,{employee:l,employees:i,expanded:r,onToggle:c,level:o+1})]},l.id))})]})]})}function f({icon:a,label:i,value:r,color:c}){return e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${c}`,children:e.jsx(a,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r}),e.jsx("p",{className:"text-sm text-gray-500",children:i})]})]})})}function W(){const[a,i]=j.useState({}),[r,c]=j.useState(""),[o,n]=j.useState(100),{data:x,isLoading:u,error:p}=C({queryKey:["employees-orgchart"],queryFn:()=>E.list({per_page:500})}),t=x?.data?.data||[],l=new Set(t.map(s=>s.id)),m=t.filter(s=>!s.supervisor_id||!l.has(s.supervisor_id)),g=r?t.filter(s=>s.full_name?.toLowerCase().includes(r.toLowerCase())||s.first_name?.toLowerCase().includes(r.toLowerCase())||s.last_name?.toLowerCase().includes(r.toLowerCase())||s.job_title?.toLowerCase().includes(r.toLowerCase())||s.department?.toLowerCase().includes(r.toLowerCase())):t,h=s=>{i(d=>({...d,[s]:d[s]===!1}))},w=()=>{const s={};t.forEach(d=>{s[d.id]=!0}),i(s)},_=()=>{const s={};t.forEach(d=>{s[d.id]=!1}),i(s)},b={total:t.length,active:t.filter(s=>s.employment_status==="active").length,departments:[...new Set(t.map(s=>s.department).filter(Boolean))].length,conEquipo:t.filter(s=>t.some(d=>d.supervisor_id===s.id)).length};return u?e.jsx("div",{className:"flex items-center justify-center py-24",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):p?e.jsxs("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg",children:["Error al cargar el organigrama: ",p.message]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(v,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Organigrama"}),e.jsx("p",{className:"text-gray-500",children:"Estructura organizacional de la empresa"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(f,{icon:y,label:"Total Empleados",value:b.total,color:"bg-blue-100 text-blue-600"}),e.jsx(f,{icon:L,label:"Activos",value:b.active,color:"bg-green-100 text-green-600"}),e.jsx(f,{icon:v,label:"Departamentos",value:b.departments,color:"bg-purple-100 text-purple-600"}),e.jsx(f,{icon:S,label:"Con Colaboradores",value:b.conEquipo,color:"bg-amber-100 text-amber-600"})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar empleado...",value:r,onChange:s=>c(s.target.value),className:"w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 border border-gray-300 rounded-lg px-2",children:[e.jsx("button",{onClick:()=>n(s=>Math.max(50,s-10)),className:"p-1.5 hover:bg-gray-100 rounded",title:"Reducir",children:e.jsx(R,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("span",{className:"text-sm text-gray-600 w-12 text-center",children:[o,"%"]}),e.jsx("button",{onClick:()=>n(s=>Math.min(150,s+10)),className:"p-1.5 hover:bg-gray-100 rounded",title:"Ampliar",children:e.jsx(k,{className:"w-4 h-4 text-gray-600"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:w,className:"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",children:"Expandir Todo"}),e.jsx("button",{onClick:_,className:"px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",children:"Colapsar Todo"})]})]})}),r&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3",children:["Resultados de búsqueda (",g.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:g.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-primary-100 text-primary-700 flex items-center justify-center font-medium",children:[s.first_name?.[0],s.last_name?.[0]]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:s.full_name}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:s.job_title})]})]},s.id))})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6 overflow-auto",children:e.jsx("div",{className:"min-w-max flex justify-center",style:{transform:`scale(${o/100})`,transformOrigin:"top center"},children:m.length>0?e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[m.length>1&&e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:[m.length," líderes principales"]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-8",children:m.map(s=>e.jsx(N,{employee:s,employees:t,expanded:a,onToggle:h,level:0},s.id))})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No hay empleados registrados"})]})})})]})}export{W as default};
