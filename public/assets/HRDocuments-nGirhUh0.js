import{u as ue,a as de,b as P,j as e}from"./vendor-query-2ZprUnmA.js";import{a as Je,r as i}from"./vendor-router-CyR0tpch.js";import{u as Re,g as S,i as T,s as Xe}from"./index-BQIwnqAF.js";import{C as D,c as k}from"./Card-DbNYCSnq.js";import{B as n}from"./Button-DOJd5Ro7.js";import{B as me}from"./Badge-Cu_cxnAa.js";import{M as E}from"./Modal-DzLd-7Tu.js";import{I as Ee}from"./Input-WTtiBIO6.js";import{a8 as Ze,Q as se,V as z,F as B,m as Le,am as ze,p as Pe,e as Te,X as Ye,an as ce,h as We,q as es,n as ss,D as oe,Z as Q,$ as as,j as ts,ah as Fe,s as qe,O as rs,af as ls,ag as ns,ao as is,P as cs,ap as os,aq as ds,ar as ms,_ as xs}from"./vendor-icons-BeDautqo.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const L={draft:{label:"Borrador",color:"bg-gray-100 text-gray-700",icon:B},pending_signatures:{label:"Pendiente de firmas",color:"bg-amber-100 text-amber-700",icon:z},completed:{label:"Completado",color:"bg-green-100 text-green-700",icon:se},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-700",icon:Ze}},ee={contract:"Contrato",employee_contract:"Contrato Laboral",certification:"Certificacion",vacation:"Vacaciones",employee:"Empleado",other:"Otro"},Me={contract:"bg-blue-100 text-blue-700",employee_contract:"bg-indigo-100 text-indigo-700",certification:"bg-purple-100 text-purple-700",vacation:"bg-green-100 text-green-700",employee:"bg-orange-100 text-orange-700",other:"bg-gray-100 text-gray-700"},xe={employee:"Empleado",organization:"Organización",request:"Solicitud",system:"Sistema",custom:"Personalizado"},us=["employee","organization","request","system","custom"],Ue=[{value:"string",label:"Texto"},{value:"date",label:"Fecha"},{value:"number",label:"Número"},{value:"boolean",label:"Si/No"},{value:"email",label:"Email"}],hs=[{value:"",label:"Sin formato",example:"1234567"},{value:"currency_cop",label:"Moneda (COP)",example:"$1.234.567"},{value:"currency_usd",label:"Moneda (USD)",example:"$1,234.56"},{value:"date_short",label:"Fecha corta",example:"15/01/2024"},{value:"date_long",label:"Fecha larga",example:"15 de enero de 2024"},{value:"text_upper",label:"Mayúsculas",example:"JUAN PÉREZ"},{value:"text_title",label:"Título",example:"Juan Pérez"}];function ps({mapping:c,isOpen:g,onClose:y,onSuccess:f}){const j=ue(),x=!!c,[a,d]=i.useState({name:"",key:"",category:"custom",description:"",data_type:"string",format_pattern:"",source_model:"",source_field:""}),[v,u]=i.useState("");i.useEffect(()=>{d(c?{name:c.name||"",key:c.key||"",category:c.category||"custom",description:c.description||"",data_type:c.data_type||"string",format_pattern:c.format_pattern||"",source_model:c.source_model||"",source_field:c.source_field||""}:{name:"",key:"",category:"custom",description:"",data_type:"string",format_pattern:"",source_model:"",source_field:""}),u("")},[c,g]);const b=P({mutationFn:r=>T.create(r),onSuccess:()=>{j.invalidateQueries(["variable-mappings"]),f?.(),y()},onError:r=>{u(r.response?.data?.error||"Error al crear mapeo")}}),N=P({mutationFn:r=>T.update(c.id,r),onSuccess:()=>{j.invalidateQueries(["variable-mappings"]),f?.(),y()},onError:r=>{u(r.response?.data?.error||"Error al actualizar mapeo")}}),q=r=>{if(r.preventDefault(),u(""),!a.name.trim()){u("El nombre es requerido");return}if(x){const{key:w,..._}=a;N.mutate(_)}else b.mutate(a)};return g?e.jsx(E,{isOpen:g,onClose:y,title:x?"Editar Variable":"Nueva Variable",size:"lg",children:e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[v&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:v})]}),e.jsx(Ee,{label:"Nombre",value:a.name,onChange:r=>d({...a,name:r.target.value}),placeholder:"Ej: Salario Mensual",required:!0}),!x&&e.jsx(Ee,{label:"Clave",value:a.key,onChange:r=>d({...a,key:r.target.value}),placeholder:"Ej: custom.salario_mensual"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoría"}),e.jsx("select",{value:a.category,onChange:r=>d({...a,category:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:Object.entries(xe).map(([r,w])=>e.jsx("option",{value:r,children:w},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Dato"}),e.jsx("select",{value:a.data_type,onChange:r=>d({...a,data_type:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:Ue.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{value:a.description,onChange:r=>d({...a,description:r.target.value}),placeholder:"Descripción de la variable...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Formato"}),e.jsx("select",{value:a.format_pattern||"",onChange:r=>d({...a,format_pattern:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:hs.map(r=>e.jsxs("option",{value:r.value,children:[r.label," ",r.example&&`(${r.example})`]},r.value))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(n,{type:"button",variant:"secondary",onClick:y,children:"Cancelar"}),e.jsxs(n,{type:"submit",loading:b.isPending||N.isPending,children:[e.jsx(xs,{className:"w-4 h-4"}),x?"Guardar":"Crear"]})]})]})}):null}function gs({isOpen:c,onClose:g}){const{isAdmin:y}=Re(),f=ue(),[j,x]=i.useState(!1),[a,d]=i.useState(null),[v,u]=i.useState(""),[b,N]=i.useState(""),{data:q,isLoading:r}=de({queryKey:["variable-mappings"],queryFn:()=>T.list(),enabled:c}),w=P({mutationFn:t=>T.toggleActive(t),onSuccess:()=>f.invalidateQueries(["variable-mappings"])}),_=P({mutationFn:t=>T.delete(t),onSuccess:()=>f.invalidateQueries(["variable-mappings"])}),F=P({mutationFn:()=>T.seedSystem(),onSuccess:()=>f.invalidateQueries(["variable-mappings"])}),H=t=>{d(t),x(!0)},h=t=>{confirm(`¿Eliminar "${t.name}"?`)&&_.mutate(t.id)},U=(q?.data?.data||[]).filter(t=>us.includes(t.category)),C=U.filter(t=>{if(v){const p=v.toLowerCase();if(!t.name.toLowerCase().includes(p)&&!t.key.toLowerCase().includes(p))return!1}return!(b&&t.category!==b)});return c?e.jsxs(E,{isOpen:c,onClose:g,title:"Variables de HR",size:"full",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar variables...",value:v,onChange:t=>u(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("select",{value:b,onChange:t=>N(t.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),Object.entries(xe).map(([t,p])=>e.jsx("option",{value:t,children:p},t))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"secondary",size:"sm",onClick:()=>F.mutate(),loading:F.isPending,children:[e.jsx(is,{className:"w-4 h-4"}),"Inicializar"]}),e.jsxs(n,{size:"sm",onClick:()=>{d(null),x(!0)},children:[e.jsx(cs,{className:"w-4 h-4"}),"Nueva Variable"]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden max-h-[60vh] overflow-y-auto",children:r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ze,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay variables"}),e.jsx("p",{className:"text-gray-500 mb-4",children:U.length===0?"Inicializa las variables del sistema":"No se encontraron variables con los filtros aplicados"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Clave"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nombre"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Categoría"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:C.map(t=>e.jsxs("tr",{className:`${t.active?"":"opacity-50 bg-gray-50"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-xs font-medium",children:t.key})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.is_system&&e.jsx(qe,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"font-medium text-sm",children:t.name})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:t.description})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(me,{variant:"secondary",className:"text-xs",children:xe[t.category]||t.category})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600",children:Ue.find(p=>p.value===t.data_type)?.label||t.data_type})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>w.mutate(t.id),className:`p-1 rounded ${t.active?"text-green-600":"text-gray-400"}`,children:t.active?e.jsx(os,{className:"w-5 h-5"}):e.jsx(ds,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>H(t),className:"p-1.5 hover:bg-gray-100 rounded text-gray-600",children:e.jsx(ms,{className:"w-4 h-4"})}),(y||!t.is_system)&&e.jsx("button",{onClick:()=>h(t),className:"p-1.5 hover:bg-red-50 rounded text-red-500",children:e.jsx(Q,{className:"w-4 h-4"})})]})})]},t.id))})]})}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[C.length," de ",U.length," variables"]}),e.jsx(n,{variant:"secondary",onClick:g,children:"Cerrar"})]})]}),e.jsx(ps,{mapping:a,isOpen:j,onClose:()=>{x(!1),d(null)}})]}):null}function ks(){const{isAdmin:c,isHR:g}=Re(),y=ue(),f=Je(),[j,x]=i.useState(1),[a,d]=i.useState(null),[v,u]=i.useState(!1),[b,N]=i.useState(!1),[q,r]=i.useState(!1),[w,_]=i.useState(null),[F,H]=i.useState(null),[h,M]=i.useState(null),[U,C]=i.useState(!1),[t,p]=i.useState(!1),[R,he]=i.useState(null),[Ae,pe]=i.useState(!1),[I,ge]=i.useState(null),[Oe,je]=i.useState(!1),[G,ye]=i.useState(""),[K,fe]=i.useState(""),[J,Ne]=i.useState(""),[ae,Ve]=i.useState("created_at"),[te,ve]=i.useState("desc"),{data:be,isLoading:we,isError:$e}=de({queryKey:["hr-documents",j,K,J,G],queryFn:()=>S.list({page:j,per_page:20,module:"hr",status:K||void 0,category:J||void 0,q:G||void 0})}),{data:Be}=de({queryKey:["signatures"],queryFn:()=>Xe.list()}),Qe=()=>(Be?.data?.data||[]).some(l=>l.active),_e=P({mutationFn:s=>S.delete(s),onSuccess:()=>{y.invalidateQueries(["hr-documents"]),N(!1),_(null),u(!1),d(null)},onError:s=>{alert(s.response?.data?.error||"Error al eliminar el documento")}}),X=P({mutationFn:s=>S.sign(s),onSuccess:()=>{y.invalidateQueries(["hr-documents"]),a&&S.get(a.id).then(s=>{d(s.data.data)}),le(),alert("Documento firmado exitosamente")},onError:s=>{alert(s.response?.data?.error||"Error al firmar el documento")}}),A=be?.data?.data||[],Z=be?.data?.meta||{},Y=Z.total_pages||1,re=[...A].sort((s,l)=>{let o,m;switch(ae){case"employee_name":o=(s.employee_name||s.requested_by||"").toLowerCase(),m=(l.employee_name||l.requested_by||"").toLowerCase();break;case"template_name":o=(s.template_name||"").toLowerCase(),m=(l.template_name||"").toLowerCase();break;case"template_category":o=ee[s.template_category]||s.template_category||"",m=ee[l.template_category]||l.template_category||"";break;case"status":o=L[s.status]?.label||s.status||"",m=L[l.status]?.label||l.status||"";break;case"created_at":default:o=s.created_at?new Date(s.created_at).getTime():0,m=l.created_at?new Date(l.created_at).getTime():0}return o<m?te==="asc"?-1:1:o>m?te==="asc"?1:-1:0}),O=s=>{ae===s?ve(l=>l==="asc"?"desc":"asc"):(Ve(s),ve("asc"))},He=()=>{ye(""),fe(""),Ne(""),x(1)},Ce=G||K||J,V=({column:s})=>ae!==s?e.jsx(ls,{className:"w-3 h-3 text-gray-400"}):te==="asc"?e.jsx(ns,{className:"w-3 h-3 text-primary-600"}):e.jsx(Fe,{className:"w-3 h-3 text-primary-600"}),Ie=async s=>{try{const l=await S.get(s.id);d(l.data.data),u(!0)}catch(l){console.error("Error loading document details:",l),d(s),u(!0)}},Se=s=>{_(s),N(!0)},Ge=()=>{w&&_e.mutate(w.id)},De=async s=>{if(!s.user_has_digital_signature&&!Qe()){p(!0);return}if(!s.can_sign&&s.has_pending_signature){const l=s.signatures?.find(o=>o.status==="pending"&&o.waiting_for?.length>0);if(l?.waiting_for?.length>0){alert(`Debes esperar las firmas de: ${l.waiting_for.join(", ")}`);return}}he(s),pe(!0),je(!0);try{const l=await S.download(s.id),o=new Blob([l.data],{type:"application/pdf"}),m=window.URL.createObjectURL(o);ge(m)}catch(l){console.error("Error loading preview:",l)}finally{je(!1)}},Ke=()=>{R&&X.mutate(R.id)},le=()=>{I&&window.URL.revokeObjectURL(I),pe(!1),he(null),ge(null)},ne=async s=>{if(!s.pdf_ready){alert("El PDF aún no está disponible. El documento está pendiente de generación.");return}try{H(s.id);const l=await S.download(s.id),o=new Blob([l.data],{type:"application/pdf"}),m=window.URL.createObjectURL(o),$=window.document.createElement("a");$.href=m,$.download=s.file_name||`${s.name}.pdf`,window.document.body.appendChild($),$.click(),window.document.body.removeChild($),window.URL.revokeObjectURL(m)}catch(l){alert("Error al descargar el documento"),console.error("Download error:",l)}finally{H(null)}},ke=async s=>{if(!s.pdf_ready){alert("El PDF aún no está disponible. El documento está pendiente de generación.");return}try{M(s),C(!0);const l=await S.download(s.id),o=new Blob([l.data],{type:"application/pdf"}),m=window.URL.createObjectURL(o);M({...s,blobUrl:m})}catch(l){console.error("Preview error:",l),alert("Error al cargar la vista previa. El PDF puede no estar disponible."),C(!1),M(null)}},ie=s=>s?new Date(s).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",W={total:A.length,pending:A.filter(s=>s.status==="pending_signatures").length,completed:A.filter(s=>s.status==="completed").length,draft:A.filter(s=>s.status==="draft").length};return we?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Documentacion HR"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Documentos generados por Recursos Humanos"})]})}),e.jsx(D,{children:e.jsx(k,{className:"p-8",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))})})})]}):$e?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Documentacion HR"})}),e.jsx(D,{children:e.jsxs(k,{className:"p-8 text-center",children:[e.jsx(Le,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Error al cargar los documentos"})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Documentacion HR"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Documentos generados por Recursos Humanos"})]}),(c||g)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"secondary",onClick:()=>f("/admin/templates/hr"),children:[e.jsx(B,{className:"w-4 h-4"}),"Templates"]}),e.jsxs(n,{variant:"secondary",onClick:()=>r(!0),children:[e.jsx(ze,{className:"w-4 h-4"}),"Variables"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(D,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(B,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Z.total_count||W.total}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total documentos"})]})]})})}),e.jsx(D,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(z,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:W.pending}),e.jsx("p",{className:"text-sm text-gray-500",children:"Pendientes de firma"})]})]})})}),e.jsx(D,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(se,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:W.completed}),e.jsx("p",{className:"text-sm text-gray-500",children:"Completados"})]})]})})}),e.jsx(D,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(Pe,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:W.draft}),e.jsx("p",{className:"text-sm text-gray-500",children:"Borradores"})]})]})})})]}),e.jsx(D,{children:e.jsxs(k,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por empleado, documento...",value:G,onChange:s=>{ye(s.target.value),x(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsxs("select",{value:K,onChange:s=>{fe(s.target.value),x(1)},className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"draft",children:"Borrador"}),e.jsx("option",{value:"pending_signatures",children:"Pendiente de firmas"}),e.jsx("option",{value:"completed",children:"Completado"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]}),e.jsxs("select",{value:J,onChange:s=>{Ne(s.target.value),x(1)},className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Tipo de documento"}),e.jsx("option",{value:"employee_contract",children:"Contrato Laboral"}),e.jsx("option",{value:"certification",children:"Certificacion"}),e.jsx("option",{value:"vacation",children:"Vacaciones"}),e.jsx("option",{value:"employee",children:"Empleado"})]}),Ce&&e.jsxs("button",{onClick:He,className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg flex items-center gap-1",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Limpiar"]})]}),!we&&e.jsxs("div",{className:"mt-3 text-sm text-gray-500",children:["Mostrando ",e.jsx("strong",{children:re.length})," de ",e.jsx("strong",{children:Z.total_count||0})," documentos"]})]})}),e.jsx(D,{children:e.jsx(k,{className:"p-0",children:re.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(ce,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay documentos"}),e.jsx("p",{className:"text-gray-500",children:Ce?"No se encontraron documentos con los filtros aplicados":"Los documentos generados por HR apareceran aqui"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>O("employee_name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Empleado",e.jsx(V,{column:"employee_name"})]})}),e.jsx("th",{onClick:()=>O("template_name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Documento",e.jsx(V,{column:"template_name"})]})}),e.jsx("th",{onClick:()=>O("template_category"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Tipo",e.jsx(V,{column:"template_category"})]})}),e.jsx("th",{onClick:()=>O("created_at"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Fecha",e.jsx(V,{column:"created_at"})]})}),e.jsx("th",{onClick:()=>O("status"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Estado",e.jsx(V,{column:"status"})]})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:re.map(s=>{const l=L[s.status]||L.draft,o=l.icon,m=Me[s.template_category]||Me.other;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(We,{className:"w-4 h-4 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:s.employee_name||s.requested_by||"-"}),s.employee_number&&e.jsx("p",{className:"text-xs text-gray-500",children:s.employee_number})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-900",children:s.name}),s.template_name&&e.jsx("p",{className:"text-xs text-gray-500",children:s.template_name})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${m}`,children:[e.jsx(es,{className:"w-3 h-3"}),ee[s.template_category]||s.template_category||"Otro"]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600",children:ie(s.created_at)}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${l.color}`,children:[e.jsx(o,{className:"w-3.5 h-3.5"}),l.label]})}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>ke(s),title:s.pdf_ready?"Previsualizar":"PDF pendiente de generación",className:s.pdf_ready?"":"opacity-50 cursor-not-allowed",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>Ie(s),title:"Ver detalles",children:e.jsx(ss,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>ne(s),loading:F===s.id,title:s.pdf_ready?"Descargar PDF":"PDF pendiente de generación",className:s.pdf_ready?"":"opacity-50 cursor-not-allowed",children:e.jsx(oe,{className:"w-4 h-4"})}),(s.can_sign||s.has_pending_signature)&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>De(s),loading:X.isPending,title:"Firmar documento",className:"text-primary-600 hover:text-primary-700 hover:bg-primary-50",children:e.jsx(z,{className:"w-4 h-4"})}),(c||g)&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>Se(s),title:"Eliminar documento",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Q,{className:"w-4 h-4"})})]})})]},s.id)})})]})})})}),Y>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Pagina ",j," de ",Y," (",Z.total_count," documentos)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"secondary",size:"sm",onClick:()=>x(s=>Math.max(1,s-1)),disabled:j===1,children:[e.jsx(as,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs(n,{variant:"secondary",size:"sm",onClick:()=>x(s=>Math.min(Y,s+1)),disabled:j===Y,children:["Siguiente",e.jsx(ts,{className:"w-4 h-4"})]})]})]}),e.jsx(E,{isOpen:v,onClose:()=>u(!1),title:"Detalle del Documento",size:"lg",children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.name}),a.template_name&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Template: ",a.template_name]})]})]}),e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium ${L[a.status]?.color||"bg-gray-100 text-gray-700"}`,children:L[a.status]?.label||a.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Empleado"}),e.jsx("p",{className:"text-sm font-medium",children:a.employee_name||"-"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Creado"}),e.jsx("p",{className:"text-sm font-medium",children:ie(a.created_at)})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Tipo"}),e.jsx("p",{className:"text-sm font-medium",children:ee[a.template_category]||a.template_category||"Otro"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Solicitado por"}),e.jsx("p",{className:"text-sm font-medium",children:a.requested_by||"-"})]})]}),a.signatures&&a.signatures.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Firmas"}),a.sequential_signing&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3 h-3"}),"Firma secuencial"]})]}),e.jsx("div",{className:"space-y-2",children:a.signatures.map((s,l)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg ${s.status==="signed"?"bg-green-50":s.can_sign_now===!1?"bg-gray-100 opacity-60":"bg-amber-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-gray-200 text-gray-600 text-xs flex items-center justify-center font-medium",children:l+1}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${s.status==="signed"?"bg-green-100":s.can_sign_now===!1?"bg-gray-200":"bg-amber-100"}`,children:s.status==="signed"?e.jsx(se,{className:"w-4 h-4 text-green-600"}):s.can_sign_now===!1?e.jsx(qe,{className:"w-4 h-4 text-gray-400"}):e.jsx(Pe,{className:"w-4 h-4 text-amber-600"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.signatory_label}),e.jsx("p",{className:"text-xs text-gray-500",children:s.status==="signed"?`Firmado por ${s.signed_by_name} - ${ie(s.signed_at)}`:s.can_sign_now===!1&&s.waiting_for?.length>0?`Esperando: ${s.waiting_for.join(", ")}`:s.user_name||"Pendiente"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.required&&e.jsx(me,{variant:"secondary",size:"sm",children:"Requerida"}),s.status!=="signed"&&s.can_sign_now===!1&&e.jsx(me,{variant:"secondary",size:"sm",className:"bg-gray-200 text-gray-600",children:"Bloqueada"})]})]},l))}),e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:["Progreso: ",a.completed_signatures_count||0," de ",a.total_required_signatures||0," firmas",a.next_signatory&&e.jsxs("span",{className:"ml-2 text-primary-600",children:["• Siguiente: ",a.next_signatory]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs("div",{className:"flex gap-2",children:[(c||g)&&e.jsxs(n,{variant:"danger",onClick:()=>Se(a),children:[e.jsx(Q,{className:"w-4 h-4"}),"Eliminar"]}),(a.can_sign||a.has_pending_signature)&&e.jsxs(n,{variant:"primary",onClick:()=>De(a),loading:X.isPending,children:[e.jsx(z,{className:"w-4 h-4"}),"Firmar"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{variant:"secondary",onClick:()=>u(!1),children:"Cerrar"}),a.pdf_ready&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"secondary",onClick:()=>{u(!1),ke(a)},children:[e.jsx(ce,{className:"w-4 h-4"}),"Previsualizar"]}),e.jsxs(n,{onClick:()=>ne(a),loading:F===a.id,children:[e.jsx(oe,{className:"w-4 h-4"}),"Descargar PDF"]})]}),!a.pdf_ready&&e.jsx("span",{className:"text-sm text-amber-600",children:"PDF pendiente de generación"})]})]})]})}),e.jsx(E,{isOpen:b,onClose:()=>{N(!1),_(null)},title:"Confirmar eliminacion",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 rounded-lg",children:[e.jsx(Q,{className:"w-8 h-8 text-red-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Esta seguro que desea eliminar el documento:"}),e.jsx("p",{className:"font-medium text-gray-900 mt-1",children:w?.name})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Esta accion no se puede deshacer. El archivo PDF sera eliminado permanentemente."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(n,{variant:"secondary",onClick:()=>{N(!1),_(null)},children:"Cancelar"}),e.jsxs(n,{variant:"danger",onClick:Ge,loading:_e.isPending,children:[e.jsx(Q,{className:"w-4 h-4"}),"Eliminar"]})]})]})}),e.jsx(gs,{isOpen:q,onClose:()=>r(!1)}),e.jsx(E,{isOpen:U,onClose:()=>{h?.blobUrl&&window.URL.revokeObjectURL(h.blobUrl),C(!1),M(null)},title:h?.name||"Previsualización",size:"full",children:h&&e.jsxs("div",{className:"h-[calc(100vh-200px)]",children:[h.blobUrl?e.jsx("iframe",{src:h.blobUrl,className:"w-full h-full border-0 rounded-lg",title:"Vista previa del documento"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"})}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-500",children:h.template_name&&e.jsxs("span",{children:["Template: ",h.template_name]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{variant:"secondary",onClick:()=>{C(!1),M(null)},children:"Cerrar"}),e.jsxs(n,{onClick:()=>ne(h),loading:F===h.id,children:[e.jsx(oe,{className:"w-4 h-4"}),"Descargar PDF"]})]})]})]})}),e.jsx(E,{isOpen:t,onClose:()=>p(!1),title:"Firma Digital Requerida",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-amber-50 rounded-lg",children:[e.jsx(rs,{className:"w-8 h-8 text-amber-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"No tienes una firma digital configurada"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Para firmar documentos necesitas crear tu firma digital primero."})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Ve a tu perfil para crear tu firma digital. Puedes dibujarla o usar una firma estilizada con tu nombre."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(n,{variant:"secondary",onClick:()=>p(!1),children:"Cancelar"}),e.jsxs(n,{onClick:()=>{p(!1),f("/profile")},children:[e.jsx(z,{className:"w-4 h-4"}),"Ir a Crear Firma"]})]})]})}),e.jsx(E,{isOpen:Ae,onClose:le,title:"Confirmar Firma",size:"full",children:R&&e.jsxs("div",{className:"flex flex-col h-[calc(100vh-200px)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-4 border-b",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:R.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[R.template_name," • ",R.employee_name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Listo para firmar"})]})]}),e.jsx("div",{className:"flex-1 bg-gray-100 rounded-lg overflow-hidden",children:Oe?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]})}):I?e.jsx("iframe",{src:I,className:"w-full h-full border-0",title:"Vista previa del documento a firmar"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500",children:"No se pudo cargar la vista previa"})})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Al firmar, aceptas el contenido de este documento con tu firma digital."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{variant:"secondary",onClick:le,children:"Cancelar"}),e.jsxs(n,{onClick:Ke,loading:X.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(z,{className:"w-4 h-4"}),"Confirmar y Firmar"]})]})]})]})})]})}export{ks as default};
