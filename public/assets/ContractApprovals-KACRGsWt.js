import{b as me,u as xe,c as W,j as e}from"./vendor-query-BtlmzfbD.js";import{r as i}from"./vendor-router-CyR0tpch.js";import{d as se,q as B}from"./index-CcNvXfKS.js";import{C as k,c as T}from"./Card-CVFC4agM.js";import{B as u}from"./Button-C8xCGhNf.js";import{M as I}from"./Modal-it_GQaMG.js";import{B as O}from"./Badge-CLufSCSl.js";import{F as K,o as te,Q as L,O as z,aF as ae,D as ue,a6 as H,c as pe,m as he,l as Z}from"./vendor-icons-BMeEPn6p.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const ge={pending:"yellow",approved:"green",rejected:"red",signed:"green"},ee={pending_approval:{color:"yellow",icon:te,label:"En Aprobación"},pending_signatures:{color:"purple",icon:pe,label:"Pendiente Firmas"}},je={area_manager:"blue",legal:"purple",general_manager:"orange",ceo:"red"};function be({approvals:s}){return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-4",children:s.map((t,d)=>e.jsxs("div",{className:"relative flex items-start gap-4 pl-10",children:[e.jsxs("div",{className:`absolute left-2 w-4 h-4 rounded-full ${t.status==="approved"?"bg-green-500":t.status==="rejected"?"bg-red-500":"bg-gray-300"}`,children:[t.status==="approved"&&e.jsx(z,{className:"w-4 h-4 text-white"}),t.status==="rejected"&&e.jsx(H,{className:"w-4 h-4 text-white"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{status:je[t.role]||"gray",children:t.role_label}),e.jsx(O,{status:ge[t.status],children:t.status==="pending"?"Pendiente":t.status==="approved"?"Aprobado":"Rechazado"})]}),t.approver_name&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Por: ",t.approver_name,t.decided_at&&e.jsx("span",{className:"ml-2 text-gray-400",children:new Date(t.decided_at).toLocaleString()})]}),t.notes&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1 italic",children:['"',t.notes,'"']}),t.reason&&e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["Motivo: ",t.reason]})]})]},d))})]})}function fe({signatures:s}){return!s||s.length===0?null:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-3",children:s.map((t,d)=>e.jsxs("div",{className:"relative flex items-start gap-4 pl-10",children:[e.jsx("div",{className:`absolute left-2 w-4 h-4 rounded-full flex items-center justify-center ${t.status==="signed"?"bg-green-500":"bg-gray-300"}`,children:t.status==="signed"&&e.jsx(z,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:t.signatory_label}),e.jsx(O,{status:t.status==="signed"?"green":"gray",children:t.status==="signed"?"Firmado":"Pendiente"})]}),t.user_name&&e.jsx("p",{className:"text-sm text-gray-600",children:t.user_name}),t.signed_at&&e.jsx("p",{className:"text-xs text-gray-400",children:new Date(t.signed_at).toLocaleString()})]})]},d))})]})}function Ne({contract:s,onApprove:t,onReject:d,onSign:g,onViewDetail:c,onViewDocument:j}){const b=(m,y)=>new Intl.NumberFormat("es-CO",{style:"currency",currency:y||"COP",minimumFractionDigits:0}).format(m),p=s.status==="pending_signatures",n=ee[s.status]||ee.pending_approval,S=n.icon;return e.jsx(k,{className:"hover:shadow-md transition-shadow",children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${p?"bg-purple-100":"bg-yellow-100"}`,children:e.jsx(S,{className:`h-5 w-5 ${p?"text-purple-600":"text-yellow-600"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500",children:s.contract_number})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{status:n.color,children:n.label}),e.jsx(O,{status:"blue",children:s.type_label})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Tercero"}),e.jsx("p",{className:"font-medium",children:s.third_party?.display_name||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Monto"}),e.jsx("p",{className:"font-medium",children:b(s.amount,s.currency)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Solicitado por"}),e.jsx("p",{className:"font-medium",children:s.requested_by?.name||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Nivel de Aprobación"}),e.jsx("p",{className:"font-medium",children:s.approval_level_label})]})]}),!p&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progreso de Aprobación"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.approval_progress,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${s.approval_progress}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Pendiente: ",e.jsx("strong",{children:s.current_approver_label})]})]}),s.approvals&&s.approvals.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-2",children:"Aprobaciones"}),e.jsx(be,{approvals:s.approvals})]}),p&&s.document_signatures&&s.document_signatures.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700",children:"Progreso de Firmas"}),s.document_signatures_status&&e.jsxs("span",{className:"text-sm text-purple-600",children:[s.document_signatures_status.signed,"/",s.document_signatures_status.total]})]}),s.document_signatures_status&&e.jsx("div",{className:"w-full bg-purple-200 rounded-full h-2 mb-3",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all",style:{width:`${s.document_signatures_status.signed/s.document_signatures_status.total*100}%`}})}),e.jsx(fe,{signatures:s.document_signatures})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Documento del Contrato"})]}),s.has_document?e.jsxs(u,{size:"sm",variant:"secondary",onClick:()=>j(s),children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Ver Documento"]}):e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Sin documento generado"})]})]}),!s.has_document&&!p&&e.jsx("p",{className:"text-xs text-amber-700 mt-2",children:"Este contrato no tiene un documento generado. Se recomienda generar el documento antes de aprobar."})]}),s.can_approve&&e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-end gap-2",children:[e.jsxs(u,{variant:"danger",size:"sm",onClick:()=>d(s),children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"Rechazar"]}),e.jsxs(u,{variant:"primary",size:"sm",onClick:()=>t(s),children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Aprobar"]})]}),s.can_sign&&e.jsx("div",{className:"mt-4 pt-4 border-t flex justify-end gap-2",children:e.jsxs(u,{variant:"primary",size:"sm",onClick:()=>g(s),className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Firmar Documento"]})})]})})}function ve({contract:s,onConfirm:t,onCancel:d,isLoading:g}){const[c,j]=i.useState("");return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(z,{className:"h-6 w-6 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:"Aprobar Contrato"}),e.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Estás a punto de aprobar el contrato ",e.jsx("strong",{children:s.contract_number})]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notas (opcional)"}),e.jsx("textarea",{value:c,onChange:b=>j(b.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Agregar comentarios sobre la aprobación..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(u,{variant:"secondary",onClick:d,children:"Cancelar"}),e.jsx(u,{variant:"primary",onClick:()=>t(c),loading:g,children:"Confirmar Aprobación"})]})]})}function ye({contract:s,onConfirm:t,onCancel:d,isLoading:g}){const[c,j]=i.useState("");return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{className:"h-6 w-6 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900",children:"Rechazar Contrato"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Estás a punto de rechazar el contrato ",e.jsx("strong",{children:s.contract_number}),". Esta acción detendrá el flujo de aprobación."]})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Motivo del Rechazo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:c,onChange:b=>j(b.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Explica el motivo del rechazo...",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(u,{variant:"secondary",onClick:d,children:"Cancelar"}),e.jsx(u,{variant:"danger",onClick:()=>t(c),loading:g,disabled:!c.trim(),children:"Confirmar Rechazo"})]})]})}function we({contract:s,onConfirm:t,onCancel:d,isLoading:g}){const[c,j]=i.useState(null),[b,p]=i.useState(!0),[n,S]=i.useState(350),[m,y]=i.useState(700),[w,Y]=i.useState({width:200,height:80}),[P,$]=i.useState(!1),[C,R]=i.useState({x:0,y:0}),[X,F]=i.useState(1),M=i.useRef(null),_=i.useRef(null),N=s.pdf_width||612,o=s.pdf_height||792,x=s.document_page_count||1,v=.65,a=N*v,h=o*v,q=h*x,f=s.document_signatures?.find(l=>l.status==="pending"&&l.is_mine),Q=Math.floor(m/o)+1;i.useEffect(()=>((async()=>{p(!0);try{const r=await se.downloadDocument(s.id),A=new Blob([r.data],{type:"application/pdf"}),E=URL.createObjectURL(A);if(j(E),f){const D=f.page_number||x,U=f.y_position||700,V=U<o?(D-1)*o+U:U;S(f.x_position||350),y(V),Y({width:f.width||200,height:f.height||80}),F(D),setTimeout(()=>{if(_.current){const G=(D-1)*h;_.current.scrollTo({top:G,behavior:"smooth"})}},300)}else{const D=(x-1)*o+600;y(D),F(x)}}catch(r){console.error("Error loading PDF:",r)}finally{p(!1)}})(),()=>{c&&URL.revokeObjectURL(c)}),[s.id]);const re=l=>{const r=l.target.scrollTop,A=Math.floor(r/h)+1;F(Math.min(Math.max(1,A),x))},ne=l=>{l.preventDefault(),l.stopPropagation();const r=M.current.getBoundingClientRect(),A=(l.clientX-r.left)/v,E=(l.clientY-r.top)/v;R({x:A-n,y:E-m}),$(!0)},le=l=>{if(!P||!M.current)return;const r=M.current.getBoundingClientRect(),A=(l.clientX-r.left)/v,E=(l.clientY-r.top)/v,D=A-C.x,U=E-C.y,V=o*x,G=Math.max(0,Math.min(N-w.width,D)),de=Math.max(0,Math.min(V-w.height,U));S(Math.round(G)),y(Math.round(de))},J=()=>{$(!1)},ie=l=>{if(_.current){const r=(l-1)*h;_.current.scrollTo({top:r,behavior:"smooth"})}},oe=()=>{const l=Math.floor(m/o)+1,r=m-(l-1)*o;t({x_position:Math.round(n),y_position:Math.round(r),width:w.width,height:w.height,page_number:l})},ce=m-(Q-1)*o;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{className:"h-5 w-5 text-purple-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-900",children:"Firmar Documento"}),e.jsxs("p",{className:"text-sm text-purple-700",children:["Contrato ",e.jsx("strong",{children:s.contract_number})]})]})]}),f&&e.jsx("span",{className:"text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded",children:f.signatory_label})]})}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-100 px-3 py-2 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-600",children:["Página ",X," de ",x]}),x>1&&e.jsx("div",{className:"flex gap-1",children:[...Array(Math.min(x,10))].map((l,r)=>e.jsx("button",{onClick:()=>ie(r+1),className:`w-5 h-5 text-[10px] rounded ${X===r+1?"bg-purple-500 text-white":"bg-white text-gray-600 hover:bg-gray-200"}`,children:r+1},r))})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["X=",n,", Y=",ce," en Pág ",Q]}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsxs("span",{children:[N>600?"Carta":"A4"," (",Math.round(N),"x",Math.round(o),")"]})]})]}),e.jsx("div",{className:"border-2 border-gray-300 rounded-lg overflow-hidden bg-gray-100",children:b?e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),e.jsx("span",{className:"ml-3 text-gray-500",children:"Cargando documento..."})]}):c?e.jsx("div",{ref:_,className:"mx-auto overflow-auto",style:{width:a+24,maxHeight:450,padding:10},onScroll:re,children:e.jsx("div",{style:{width:a,height:q,margin:"0 auto"},children:e.jsxs("div",{ref:M,className:"relative origin-top-left",style:{width:N,height:o*x,transform:`scale(${v})`,transformOrigin:"top left"},onMouseMove:le,onMouseUp:J,onMouseLeave:J,children:[e.jsx("iframe",{src:`${c}#toolbar=0&navpanes=0&scrollbar=0`,className:"absolute inset-0 pointer-events-none",style:{width:N,height:o*x,border:"none"},title:"PDF Preview"}),[...Array(x)].map((l,r)=>e.jsx("div",{className:"absolute border border-gray-200",style:{width:N,height:o,top:r*o,left:0,boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:e.jsxs("div",{className:"absolute top-2 right-2 bg-gray-100/80 text-gray-500 text-xs px-2 py-1 rounded",children:["Página ",r+1]})},r)),x>1&&[...Array(x-1)].map((l,r)=>e.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-purple-300 pointer-events-none",style:{top:o*(r+1)},children:e.jsxs("span",{className:"absolute left-2 -top-4 bg-purple-100 px-2 py-0.5 text-xs text-purple-600 rounded",children:["Página ",r+2]})},r)),e.jsx("div",{className:`absolute cursor-move transition-all duration-100 ${P?"z-50":"z-10"}`,style:{left:n,top:m,width:w.width,height:w.height,backgroundColor:"rgba(147, 51, 234, 0.3)",border:"2px dashed #9333ea",borderRadius:4,boxShadow:P?"0 8px 20px rgba(0,0,0,0.2)":"0 0 0 3px rgba(147, 51, 234, 0.2), 0 4px 12px rgba(0,0,0,0.15)",pointerEvents:"auto"},onMouseDown:ne,children:e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-purple-700",children:[e.jsx(L,{style:{width:20,height:20,opacity:.8}}),e.jsx("span",{className:"font-medium text-center px-1",style:{fontSize:11},children:f?.signatory_label||"Tu firma"}),e.jsxs("span",{style:{fontSize:9,color:"#7c3aed"},children:["Pág. ",Q]})]})})]})})}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Z,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No se pudo cargar el documento"})]})}),e.jsx("div",{className:"p-3 bg-amber-50 rounded-lg text-sm border border-amber-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-amber-800",children:[e.jsx("p",{className:"font-medium",children:"Arrastra el cuadro morado para posicionar tu firma."}),e.jsx("p",{className:"text-amber-600 mt-1",children:"Usa el scroll para navegar entre páginas. La firma se moverá con el arrastre."})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(u,{variant:"secondary",onClick:d,children:"Cancelar"}),e.jsxs(u,{onClick:oe,loading:g,disabled:b,className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Confirmar Firma"]})]})]})}function Te(){const[s,t]=i.useState("pending"),[d,g]=i.useState(null),[c,j]=i.useState(null),[b,p]=i.useState(null),[n,S]=i.useState(null),[m,y]=i.useState(null),[w,Y]=i.useState(!1),P=me(),$=async a=>{S(a),Y(!0);try{const h=await se.downloadDocument(a.id),q=new Blob([h.data],{type:"application/pdf"}),f=URL.createObjectURL(q);y(f)}catch(h){console.error("Error loading document:",h),alert("Error al cargar el documento")}finally{Y(!1)}},C=()=>{m&&URL.revokeObjectURL(m),S(null),y(null)},{data:R,isLoading:X}=xe({queryKey:["contract-approvals",s],queryFn:()=>B.list({status:s})}),F=W({mutationFn:({id:a,notes:h})=>B.approve(a,h),onSuccess:()=>{P.invalidateQueries(["contract-approvals"]),g(null)}}),M=W({mutationFn:({id:a,reason:h})=>B.reject(a,h),onSuccess:()=>{P.invalidateQueries(["contract-approvals"]),j(null)}}),_=W({mutationFn:({id:a,position:h})=>B.sign(a,h),onSuccess:a=>{P.invalidateQueries(["contract-approvals"]),p(null),a.data?.all_signed&&alert("Todas las firmas han sido completadas. El contrato ha sido aprobado.")},onError:a=>{alert(a.response?.data?.error||"Error al firmar el documento")}}),N=R?.data?.data||[],o=R?.data?.meta?.total_pending||0,x=R?.data?.meta?.total_pending_approvals||0,v=R?.data?.meta?.total_pending_signatures||0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Aprobaciones de Contratos"}),e.jsx("p",{className:"text-gray-500",children:"Aprobación multinivel de contratos según monto"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(k,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-100",children:e.jsx(K,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:o}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Pendientes"})]})]})})}),e.jsx(k,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100",children:e.jsx(te,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:x}),e.jsx("p",{className:"text-sm text-gray-500",children:"Por Aprobar"})]})]})})}),e.jsx(k,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100",children:e.jsx(L,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:v}),e.jsx("p",{className:"text-sm text-gray-500",children:"Por Firmar"})]})]})})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>t("pending"),className:`px-4 py-2 font-medium text-sm border-b-2 -mb-px ${s==="pending"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Pendientes",o>0&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-yellow-100 text-yellow-800 rounded-full",children:o})]}),e.jsx("button",{onClick:()=>t("history"),className:`px-4 py-2 font-medium text-sm border-b-2 -mb-px ${s==="history"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Historial"})]})}),X?e.jsx("div",{className:"grid gap-4",children:[1,2].map(a=>e.jsx(k,{className:"animate-pulse",children:e.jsx(T,{className:"p-4 h-48"})},a))}):N.length===0?e.jsx(k,{children:e.jsx(T,{className:"p-8 text-center",children:s==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-12 w-12 text-green-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay aprobaciones pendientes"}),e.jsx("p",{className:"text-gray-500",children:"Todos los contratos están al día"})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sin historial"}),e.jsx("p",{className:"text-gray-500",children:"No has procesado ningún contrato aún"})]})})}):e.jsx("div",{className:"grid gap-4",children:N.map(a=>e.jsx(Ne,{contract:a,onApprove:g,onReject:j,onSign:p,onViewDocument:$},a.id))}),e.jsx(I,{isOpen:!!d,onClose:()=>g(null),title:"Aprobar Contrato",size:"md",children:d&&e.jsx(ve,{contract:d,onConfirm:a=>F.mutate({id:d.id,notes:a}),onCancel:()=>g(null),isLoading:F.isPending})}),e.jsx(I,{isOpen:!!c,onClose:()=>j(null),title:"Rechazar Contrato",size:"md",children:c&&e.jsx(ye,{contract:c,onConfirm:a=>M.mutate({id:c.id,reason:a}),onCancel:()=>j(null),isLoading:M.isPending})}),e.jsx(I,{isOpen:!!b,onClose:()=>p(null),title:"Firmar Documento",size:"lg",children:b&&e.jsx(we,{contract:b,onConfirm:a=>_.mutate({id:b.id,position:a}),onCancel:()=>p(null),isLoading:_.isPending})}),e.jsx(I,{isOpen:!!n,onClose:C,title:`Documento: ${n?.contract_number||""}`,size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[n&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Contrato:"}),e.jsx("p",{className:"font-medium",children:n.title})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Tercero:"}),e.jsx("p",{className:"font-medium",children:n.third_party?.display_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Monto:"}),e.jsx("p",{className:"font-medium text-green-600",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:n.currency||"COP"}).format(n.amount)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(O,{variant:n.status,children:n.status_label})]})]})}),w?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-500",children:"Cargando documento..."})]}):m?e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",style:{height:"60vh"},children:e.jsx("iframe",{src:m,className:"w-full h-full",title:"Contract Document"})}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No se pudo cargar el documento"})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs(u,{variant:"secondary",onClick:()=>{if(m){const a=document.createElement("a");a.href=m,a.download=`${n?.contract_number||"contrato"}.pdf`,a.click()}},disabled:!m,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Descargar PDF"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"secondary",onClick:C,children:"Cerrar"}),n?.can_approve&&e.jsxs(e.Fragment,{children:[e.jsxs(u,{variant:"danger",onClick:()=>{C(),j(n)},children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"Rechazar"]}),e.jsxs(u,{onClick:()=>{C(),g(n)},children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Aprobar"]})]}),n?.can_sign&&e.jsxs(u,{onClick:()=>{C(),p(n)},className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Firmar"]})]})]})]})})]})}export{Te as default};
