import{j as e,u as be,a as ge,b as G}from"./vendor-query-2ZprUnmA.js";import{r as c,u as $e,a as ke,d as Ye,N as Ie}from"./vendor-router-CyR0tpch.js";import{v as I,p as Ge,u as He,c as se,t as ve}from"./index-BZdgbJnB.js";import{C as A,c as Y}from"./Card-DbNYCSnq.js";import{B as y}from"./Button-DOJd5Ro7.js";import{B as ue}from"./Badge-Cu_cxnAa.js";import{M as te}from"./Modal-DzLd-7Tu.js";import{I as je}from"./Input-WTtiBIO6.js";import{S as le}from"./Select-Cleilj96.js";import{u as fe,$ as Ke,j as Je,P as pe,G as We,a0 as Xe,a1 as Be,n as De,a2 as ze,V as de,a3 as Qe,X as Se,Z as Ee,Q as re,F as ne,U as Ze,m as ee,a4 as Fe,a5 as ae,p as he,d as Re,O as _e,a6 as es,D as Oe,c as ss,_ as as,A as ts}from"./vendor-icons-BeDautqo.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const rs=["Lu","Ma","Mi","Ju","Vi","Sá","Do"],ns=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];function ls(t){const j=t.getFullYear(),D=String(t.getMonth()+1).padStart(2,"0"),b=String(t.getDate()).padStart(2,"0");return`${j}-${D}-${b}`}function we(t,j){return t.getFullYear()===j.getFullYear()&&t.getMonth()===j.getMonth()&&t.getDate()===j.getDate()}function Ue({value:t,onChange:j,label:D,min:b,bookedDates:h=[],required:w,error:m}){const[x,i]=c.useState(!1),[C,_]=c.useState(()=>t?new Date(t+"T00:00:00"):b?new Date(b+"T00:00:00"):new Date),g=c.useRef(null);c.useEffect(()=>{const p=O=>{g.current&&!g.current.contains(O.target)&&i(!1)};return x&&document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[x]),c.useEffect(()=>{t&&_(new Date(t+"T00:00:00"))},[t]);const d=b?new Date(b+"T00:00:00"):null,S=p=>h.some(O=>we(O,p)),$=p=>{const O=p.getDay();return O===0||O===6},H=p=>!!(d&&p<d&&!we(p,d)||$(p)||S(p)),P=p=>{if(!t)return!1;const O=new Date(t+"T00:00:00");return we(p,O)},F=p=>{H(p)||(j(ls(p)),i(!1))},z=()=>{_(new Date(C.getFullYear(),C.getMonth()-1,1))},L=()=>{_(new Date(C.getFullYear(),C.getMonth()+1,1))},T=C.getFullYear(),u=C.getMonth();let n=new Date(T,u,1).getDay()-1;n<0&&(n=6);const v=new Date(T,u+1,0).getDate(),M=[];for(let p=0;p<n;p++)M.push(null);for(let p=1;p<=v;p++)M.push(new Date(T,u,p));const X=t?new Date(t+"T00:00:00").toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"}):"";return e.jsxs("div",{className:"w-full relative",ref:g,children:[D&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:D}),e.jsxs("div",{className:`w-full px-3 py-2 border rounded-lg text-gray-900 cursor-pointer flex items-center justify-between
          focus-within:ring-2 focus-within:ring-primary-500 focus-within:border-transparent
          ${m?"border-red-300":"border-gray-300"}
          ${t?"":"text-gray-400"}
        `,onClick:()=>i(!x),children:[e.jsx("span",{className:t?"text-gray-900":"text-gray-400",children:X||"Seleccionar fecha"}),e.jsx(fe,{className:"w-4 h-4 text-gray-400"})]}),w&&e.jsx("input",{type:"text",value:t||"",required:!0,tabIndex:-1,className:"sr-only",onChange:()=>{}}),x&&e.jsxs("div",{className:"absolute z-50 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-3 w-[300px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{type:"button",onClick:z,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-medium text-sm text-gray-900",children:[ns[u]," ",T]}),e.jsx("button",{type:"button",onClick:L,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Je,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0 mb-1",children:rs.map(p=>e.jsx("div",{className:"text-center text-xs font-medium text-gray-500 py-1",children:p},p))}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:M.map((p,O)=>{if(!p)return e.jsx("div",{className:"h-9"},`empty-${O}`);const U=H(p),E=S(p),W=$(p),Z=P(p),ie=we(p,new Date);return e.jsxs("button",{type:"button",onClick:()=>F(p),disabled:U,title:E?"Día ya solicitado":W?"Fin de semana":U?"No disponible":"",className:`
                    h-9 w-full text-sm rounded-md relative flex items-center justify-center
                    ${Z?"bg-primary-500 text-white font-bold":ie?"bg-primary-50 text-primary-700 font-medium":""}
                    ${!U&&!Z?"hover:bg-primary-100 cursor-pointer":""}
                    ${U&&!E?"text-gray-300 cursor-not-allowed":""}
                    ${E?"cursor-not-allowed":""}
                  `,children:[e.jsx("span",{className:E&&!Z?"text-red-400 line-through decoration-red-500 decoration-2":"",children:p.getDate()}),E&&e.jsx("span",{className:"absolute -bottom-0.5 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-red-400"})]},p.getDate())})}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100 flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-red-400 line-through decoration-red-500 decoration-2",children:"15"}),e.jsx("span",{children:"Ya solicitado"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-gray-300",children:"S"}),e.jsx("span",{children:"No disponible"})]})]})]})]})}const Ve=[{value:"vacation",label:"Vacaciones"},{value:"personal",label:"Día Personal"},{value:"sick",label:"Enfermedad"},{value:"bereavement",label:"Duelo"},{value:"unpaid",label:"Sin Goce"}],is=[{value:"",label:"Todos"},{value:"draft",label:"Borrador"},{value:"pending",label:"Solicitada"},{value:"approved",label:"Aprobada"},{value:"enjoyed",label:"Disfrutada"},{value:"rejected",label:"Rechazada"},{value:"cancelled",label:"Cancelada"}];function cs({onClose:t,onSuccess:j,balance:D,bookedRanges:b=[]}){const[h,w]=c.useState(1),[m,x]=c.useState({vacation_type:"vacation",start_date:"",end_date:"",days_requested:"",reason:""}),[i,C]=c.useState(null),[_,g]=c.useState(null),[d,S]=c.useState(null),[$,H]=c.useState(!1),[P,F]=c.useState(""),[z,L]=c.useState(null),T=be(),u=ke(),{data:l}=ge({queryKey:["vacation-template"],queryFn:async()=>(await Ge.list({category:"vacation"})).data?.data?.[0]||null}),n=l,v=(()=>{const a=[];for(const r of b){if(!r.start_date||!r.end_date)continue;const o=new Date(r.start_date+"T00:00:00"),f=new Date(r.end_date+"T00:00:00"),k=new Date(o);for(;k<=f;)a.push(new Date(k)),k.setDate(k.getDate()+1)}return a})(),M=G({mutationFn:a=>I.create(a),onSuccess:async a=>{const r=a.data?.data,o=a.data?.document;if(C(r),g(o),F(""),r?.id&&r?.pdf_ready)try{const f=await I.downloadDocument(r.id),k=new Blob([f.data],{type:"application/pdf"});S(URL.createObjectURL(k))}catch(f){console.error("Error loading PDF:",f),S(null)}else S(null);w(2)},onError:a=>{const r=a.response?.data,o=a.response?.status;console.error("Vacation create error:",{status:o,data:r,message:a.message}),r?.missing_fields&&Array.isArray(r.missing_fields)?(L(r.missing_fields),F(r.message||"Faltan datos requeridos")):Array.isArray(r?.errors)&&r.errors.length>0?(F(r.error?`${r.error}: ${r.errors.join(". ")}`:r.errors.join(". ")),L(null)):r?.error?(F(r.error),L(null)):(F(`Error al crear la solicitud (${o||"sin respuesta"}): ${a.message}`),L(null))}}),X=G({mutationFn:a=>I.signDocument(a),onSuccess:a=>{g(a.data?.document),C(a.data?.data),O()},onError:a=>{F(a.response?.data?.error||"Error al firmar el documento")}}),p=G({mutationFn:a=>I.submit(a),onSuccess:a=>{C(a.data?.data),w(3),T.invalidateQueries(["vacations"])},onError:a=>{F(a.response?.data?.error||"Error al enviar la solicitud")}}),O=async()=>{if(i?.id&&i?.pdf_ready)try{const a=await I.downloadDocument(i.id),r=new Blob([a.data],{type:"application/pdf"});d&&URL.revokeObjectURL(d),S(URL.createObjectURL(r))}catch(a){console.error("Error reloading PDF:",a)}};c.useEffect(()=>{if(h!==2||!i?.id||i?.pdf_ready)return;let a=!1;const r=async()=>{try{const f=await I.get(i.id),k=f.data?.data,K=f.data?.document;if(!a&&k?.pdf_ready){C(k),g(K);const Q=await I.downloadDocument(i.id),R=new Blob([Q.data],{type:"application/pdf"});a||S(URL.createObjectURL(R))}}catch(f){console.error("Error polling document status:",f)}},o=setInterval(r,3e3);return r(),()=>{a=!0,clearInterval(o)}},[h,i?.id,i?.pdf_ready]);const U=a=>{const r=a%19,o=Math.floor(a/100),f=a%100,k=Math.floor(o/4),K=o%4,Q=Math.floor((o+8)/25),R=Math.floor((o-Q+1)/3),q=(19*r+o-k-R+15)%30,Ne=Math.floor(f/4),s=f%4,N=(32+2*K+2*Ne-q-s)%7,J=Math.floor((r+11*q+22*N)/451),xe=Math.floor((q+N-7*J+114)/31),ce=(q+N-7*J+114)%31+1;return new Date(a,xe-1,ce)},E=a=>{const r=new Date(a),o=r.getDay();return o===0?r.setDate(r.getDate()+1):o!==1&&r.setDate(r.getDate()+(8-o)),r},W=a=>{const r=[],o=U(a);r.push(new Date(a,0,1)),r.push(new Date(a,4,1)),r.push(new Date(a,6,20)),r.push(new Date(a,7,7)),r.push(new Date(a,11,8)),r.push(new Date(a,11,25)),r.push(E(new Date(a,0,6))),r.push(E(new Date(a,2,19))),r.push(E(new Date(a,5,29))),r.push(E(new Date(a,7,15))),r.push(E(new Date(a,9,12))),r.push(E(new Date(a,10,1))),r.push(E(new Date(a,10,11)));const f=new Date(o);f.setDate(o.getDate()-3),r.push(f);const k=new Date(o);k.setDate(o.getDate()-2),r.push(k);const K=new Date(o);K.setDate(o.getDate()+39),r.push(E(K));const Q=new Date(o);Q.setDate(o.getDate()+60),r.push(E(Q));const R=new Date(o);return R.setDate(o.getDate()+68),r.push(E(R)),r},Z=(a,r)=>{const o=a.toISOString().split("T")[0];return r.some(f=>f.toISOString().split("T")[0]===o)},ie=(a,r)=>{let o=0;const f=new Date(a),k=new Date(r),K=f.getFullYear(),Q=k.getFullYear();let R=[];for(let q=K;q<=Q;q++)R=R.concat(W(q));for(;f<=k;){const q=f.getDay();q!==0&&q!==6&&!Z(f,R)&&o++,f.setDate(f.getDate()+1)}return o};c.useEffect(()=>{if(m.start_date&&m.end_date){const a=new Date(m.start_date+"T00:00:00"),r=new Date(m.end_date+"T00:00:00");if(r>=a){const o=ie(a,r);x(f=>({...f,days_requested:o.toString()}))}}},[m.start_date,m.end_date]);const V=(()=>{if(!m.start_date||!m.end_date||!b.length)return null;const a=new Date(m.start_date+"T00:00:00"),r=new Date(m.end_date+"T00:00:00");if(r<a)return null;for(const o of b){const f=new Date(o.start_date+"T00:00:00"),k=new Date(o.end_date+"T00:00:00");if(a<=k&&r>=f){const K=a>f?a:f,Q=r<k?r:k,R=[],q=new Date(K);for(;q<=Q;)q.getDay()!==0&&q.getDay()!==6&&R.push(q.toLocaleDateString("es-ES",{day:"numeric",month:"short"})),q.setDate(q.getDate()+1);if(R.length>0)return{requestNumber:o.request_number,days:R}}}return null})();c.useEffect(()=>()=>{d&&URL.revokeObjectURL(d)},[d]);const Te=a=>{a.preventDefault(),!V&&M.mutate(m)},B=()=>{F(""),i?.id&&X.mutate(i.id)},qe=()=>{F(""),i?.id&&p.mutate(i.id)},Le=()=>{T.invalidateQueries(["vacations"]),j?.(),t()},ye=()=>{d&&window.open(d,"_blank")},oe=_?.employee_signed||!1,me=i?.pdf_ready===!1,Pe=oe||me;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-6",children:[1,2,3].map(a=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${h>=a?"bg-primary-500 text-white":"bg-gray-200 text-gray-500"}`,children:h>a?e.jsx(re,{className:"w-5 h-5"}):a}),a<3&&e.jsx("div",{className:`w-12 h-1 mx-1 ${h>a?"bg-primary-500":"bg-gray-200"}`})]},a))}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-4 mb-6",children:[e.jsx("span",{className:h>=1?"text-primary-600 font-medium":"",children:"Datos"}),e.jsx("span",{className:h>=2?"text-primary-600 font-medium":"",children:"Firmar"}),e.jsx("span",{className:h>=3?"text-primary-600 font-medium":"",children:"Enviado"})]}),h===1&&e.jsxs("form",{onSubmit:Te,className:"space-y-4",children:[n&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:n.name}),e.jsx("p",{className:"text-sm text-blue-700",children:"Se generará el documento oficial para tu firma"}),n.signatories_count>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-blue-600",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsxs("span",{children:[n.signatories_count," firmantes requeridos"]})]})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg flex items-center justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Días disponibles para solicitar:"}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:Math.floor(D?.available||0)})]}),e.jsx(le,{label:"Tipo de Solicitud",options:Ve,value:m.vacation_type,onChange:a=>x({...m,vacation_type:a.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Ue,{label:"Fecha Inicio",value:m.start_date,min:new Date().toISOString().split("T")[0],bookedDates:v,onChange:a=>{x(r=>({...r,start_date:a})),F(""),L(null)},required:!0}),e.jsx(Ue,{label:"Fecha Fin",value:m.end_date,min:m.start_date||new Date().toISOString().split("T")[0],bookedDates:v,onChange:a=>{x(r=>({...r,end_date:a})),F(""),L(null)},required:!0})]}),e.jsx(je,{label:"Días Solicitados",type:"number",step:"0.5",min:"0.5",value:m.days_requested,onChange:a=>x({...m,days_requested:a.target.value}),required:!0}),parseFloat(m.days_requested)>(D?.available||0)&&e.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center gap-2 text-amber-700",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Los días solicitados exceden tu saldo disponible"})]}),V&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-red-800",children:["Fechas en conflicto con ",V.requestNumber]}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Ya tienes una solicitud que incluye: ",e.jsx("strong",{children:V.days.join(", ")})]}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"Selecciona fechas que no se solapen con solicitudes existentes."})]})]})}),P&&!z&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:P})]}),z&&z.length>0&&e.jsx("div",{className:"p-4 bg-amber-50 border border-amber-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-amber-800 mb-2",children:"Faltan datos requeridos para generar la solicitud"}),e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Por favor complete los siguientes datos antes de continuar:"}),e.jsx("ul",{className:"text-sm text-amber-700 space-y-1 mb-4",children:z.map((a,r)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),e.jsx("span",{children:a.label||a.field}),a.source==="employee"&&e.jsx("span",{className:"text-xs text-amber-500",children:"(Perfil del empleado)"}),a.source==="organization"&&e.jsx("span",{className:"text-xs text-amber-500",children:"(Configuración de la empresa)"})]},r))}),z.some(a=>a.source==="employee")&&e.jsx(y,{type:"button",variant:"secondary",size:"sm",onClick:()=>u("/profile"),children:"Ir a mi Perfil para completar datos"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo (opcional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3,value:m.reason,onChange:a=>x({...m,reason:a.target.value}),placeholder:"Describe el motivo de tu solicitud..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:t,children:"Cancelar"}),e.jsx(y,{type:"submit",loading:M.isPending,disabled:!!V,children:"Continuar"})]})]}),h===2&&i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"font-medium text-gray-900",children:["Solicitud ",i.request_number]}),e.jsx(ue,{status:i.status})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("p",{className:"font-medium",children:Ve.find(a=>a.value===i.vacation_type)?.label})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Fechas:"}),e.jsxs("p",{className:"font-medium",children:[new Date(i.start_date).toLocaleDateString("es-ES")," - ",new Date(i.end_date).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Días:"}),e.jsx("p",{className:"font-bold text-primary-600",children:i.days_requested})]})]})]}),d?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Documento de Solicitud"}),e.jsxs(y,{variant:"ghost",size:"sm",onClick:ye,children:[e.jsx(Fe,{className:"w-4 h-4"}),"Abrir en nueva pestaña"]})]}),e.jsx("iframe",{src:d,className:"w-full h-[400px] border-0",title:"Vista previa del documento"})]}):i?.pdf_ready===!1?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-amber-50 border-amber-200",children:[e.jsx(ae,{className:"w-8 h-8 animate-spin mx-auto text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-700 font-medium",children:"Generando documento..."}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"El PDF se está generando. Se cargará automáticamente cuando esté listo."})]}):e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(ae,{className:"w-8 h-8 animate-spin mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]}),e.jsxs("div",{className:"p-4 bg-white border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Firmas Requeridas"]}),e.jsx("div",{className:"space-y-3",children:_?.signatures?.map((a,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${a.signed?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:a.signed?e.jsx(re,{className:"w-5 h-5"}):r+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.label}),a.signed&&e.jsxs("p",{className:"text-xs text-green-600",children:["Firmado por ",a.signed_by," - ",new Date(a.signed_at).toLocaleString("es-ES")]})]})]}),a.signatory_type_code==="employee"&&!a.signed&&e.jsxs(y,{size:"sm",onClick:B,loading:X.isPending,children:[e.jsx(de,{className:"w-4 h-4"}),"Firmar"]}),a.signatory_type_code!=="employee"&&!a.signed&&e.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-200 rounded",children:"Pendiente"})]},r))})]}),P&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:P})]}),me&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"Documento pendiente de generación"}),e.jsx("p",{className:"mt-1",children:"Puedes enviar la solicitud ahora. El documento se generará y firmará posteriormente."})]})]}),!me&&!oe&&e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-amber-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-medium",children:"Debes firmar el documento antes de enviar"}),e.jsx("p",{className:"mt-1",children:'Haz clic en el botón "Firmar" junto a tu nombre para continuar.'})]})]}),!me&&oe&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3",children:[e.jsx(re,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"¡Documento firmado!"}),e.jsx("p",{className:"mt-1",children:"Ahora puedes enviar la solicitud para aprobación del supervisor y RRHH."})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx(y,{variant:"secondary",onClick:()=>w(1),children:"Volver"}),e.jsxs(y,{onClick:qe,loading:p.isPending,disabled:!Pe,children:[e.jsx(Qe,{className:"w-4 h-4"}),"Enviar Solicitud"]})]})]}),h===3&&i&&e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(re,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"¡Solicitud Enviada!"}),e.jsxs("p",{className:"text-gray-600",children:["Tu solicitud ",e.jsx("span",{className:"font-medium",children:i.request_number})," ha sido enviada correctamente."]}),d&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Documento firmado:"}),e.jsxs(y,{variant:"secondary",onClick:ye,children:[e.jsx(ze,{className:"w-4 h-4"}),"Ver Documento PDF"]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Próximos pasos:"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Tu supervisor recibirá la solicitud para aprobación y firma"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Recursos Humanos revisará y firmará la solicitud"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Recibirás notificación cuando sea aprobada"})]})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(y,{onClick:Le,children:"Cerrar"})})]})]})}function ds({vacation:t,onSubmit:j,onCancel:D,onDelete:b,onView:h,onDownload:w,onSign:m}){const x={vacation:"Vacaciones",personal:"Día Personal",sick:"Enfermedad",bereavement:"Duelo",unpaid:"Sin Goce"};return e.jsx(A,{className:"hover:shadow-md transition-shadow",children:e.jsxs(Y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-50 rounded-lg",children:e.jsx(fe,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:x[t.vacation_type]||t.vacation_type}),e.jsx("p",{className:"text-sm text-gray-500",children:t.request_number}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[new Date(t.start_date).toLocaleDateString("es-ES")," - ",new Date(t.end_date).toLocaleDateString("es-ES")]}),e.jsxs("p",{className:"text-sm font-medium text-primary-600 mt-1",children:[t.days_requested," días"]})]})]}),e.jsx(ue,{status:t.status})]}),e.jsxs("div",{className:"flex justify-end gap-1 mt-4 pt-4 border-t border-gray-100",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>h(t),title:"Ver detalles",children:e.jsx(De,{className:"w-4 h-4"})}),t.pdf_ready&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>w(t.id),title:"Descargar documento",children:e.jsx(ze,{className:"w-4 h-4"})}),t.status==="draft"&&t.needs_employee_signature&&e.jsxs(y,{variant:"secondary",size:"sm",onClick:()=>m(t),title:"Firmar documento",children:[e.jsx(de,{className:"w-4 h-4"}),"Firmar"]}),t.status==="draft"&&!t.needs_employee_signature&&e.jsx(y,{variant:"primary",size:"sm",onClick:()=>j(t.id),title:"Enviar solicitud",children:e.jsx(Qe,{className:"w-4 h-4"})}),["draft","pending"].includes(t.status)&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>D(t.id),title:"Cancelar solicitud",children:e.jsx(Se,{className:"w-4 h-4"})}),t.can_delete&&e.jsx(y,{variant:"danger",size:"sm",onClick:()=>b(t.id),title:"Eliminar solicitud",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]})})}function os({vacation:t,onClose:j,onDownload:D,onRefresh:b}){const[h,w]=c.useState(null),[m,x]=c.useState(!1),[i,C]=c.useState(null),[_,g]=c.useState(null),[d,S]=c.useState(""),$=be(),H={vacation:"Vacaciones",personal:"Día Personal",sick:"Enfermedad",bereavement:"Duelo",unpaid:"Sin Goce"},P=async()=>{try{const u=await I.get(t.id);C(u.data?.data),g(u.data?.document)}catch(u){console.error("Error fetching vacation detail:",u)}};c.useEffect(()=>{P()},[t.id]);const F=G({mutationFn:u=>I.signDocument(u),onSuccess:u=>{g(u.data?.document),S(""),$.invalidateQueries(["vacations"]),h&&(URL.revokeObjectURL(h),w(null)),L(),P()},onError:u=>{S(u.response?.data?.error||"Error al firmar el documento")}}),z=()=>{S(""),F.mutate(t.id)};c.useEffect(()=>(t.pdf_ready&&t.id&&L(),()=>{h&&URL.revokeObjectURL(h)}),[t.id,t.pdf_ready]);const L=async()=>{x(!0);try{const u=await I.downloadDocument(t.id),l=new Blob([u.data],{type:"application/pdf"});w(URL.createObjectURL(l))}catch(u){console.error("Error loading PDF:",u)}finally{x(!1)}},T=()=>{h&&window.open(h,"_blank")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Número:"}),e.jsx("p",{className:"font-medium",children:t.request_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Estado:"}),e.jsx("div",{className:"mt-1",children:e.jsx(ue,{status:t.status})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Tipo:"}),e.jsx("p",{className:"font-medium",children:H[t.vacation_type]||t.vacation_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Días:"}),e.jsx("p",{className:"font-bold text-primary-600",children:t.days_requested})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Fechas:"}),e.jsxs("p",{className:"font-medium",children:[new Date(t.start_date).toLocaleDateString("es-ES")," - ",new Date(t.end_date).toLocaleDateString("es-ES")]})]})]}),t.reason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 block mb-1",children:"Motivo:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded-lg",children:t.reason})]}),t.decision_reason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 block mb-1",children:"Comentario del aprobador:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded-lg",children:t.decision_reason})]}),t.has_document&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-primary-600"}),"Documento de Solicitud"]}),m?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(ae,{className:"w-8 h-8 animate-spin mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]}):h?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Vista Previa del Documento"}),e.jsxs(y,{variant:"ghost",size:"sm",onClick:T,children:[e.jsx(Fe,{className:"w-4 h-4"}),"Abrir en nueva pestaña"]})]}),e.jsx("iframe",{src:h,className:"w-full h-[350px] border-0",title:"Vista previa del documento"})]}):t.pdf_ready===!1?e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-amber-50 border-amber-200",children:[e.jsx(ee,{className:"w-8 h-8 mx-auto text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-700 font-medium",children:"Documento pendiente de generación"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"El PDF se generará próximamente"})]}):e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-gray-50",children:[e.jsx(ne,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No se pudo cargar el documento"})]}),_?.signatures&&_.signatures.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-white border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Firmas del Documento"]}),e.jsx("div",{className:"space-y-3",children:_.signatures.map((u,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${u.signed?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:u.signed?e.jsx(re,{className:"w-5 h-5"}):u.position||l+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:u.label}),e.jsxs("p",{className:"text-xs text-gray-500",children:[u.signatory_type_code==="employee"&&"Empleado Solicitante",u.signatory_type_code==="supervisor"&&"Supervisor Directo",u.signatory_type_code==="hr"&&"Recursos Humanos"]}),u.signed&&e.jsxs("p",{className:"text-xs text-green-600 mt-0.5",children:["Firmado por ",u.signed_by," - ",new Date(u.signed_at).toLocaleString("es-ES")]})]})]}),u.signatory_type_code==="employee"&&!u.signed&&e.jsxs(y,{size:"sm",onClick:z,loading:F.isPending,children:[e.jsx(de,{className:"w-4 h-4"}),"Firmar"]}),u.signatory_type_code!=="employee"&&!u.signed&&e.jsx("span",{className:"text-xs text-amber-600 px-2 py-1 bg-amber-100 rounded",children:"Pendiente"})]},l))}),d&&e.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:d})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[t.pdf_ready&&e.jsxs(y,{variant:"secondary",onClick:()=>D(t.id),children:[e.jsx(ze,{className:"w-4 h-4"}),"Descargar PDF"]}),e.jsx(y,{onClick:j,children:"Cerrar"})]})]})}function ms(){const[t,j]=c.useState(!1),[D,b]=c.useState(!1),[h,w]=c.useState(null),[m,x]=c.useState(""),i=be(),C=$e(),_=ke();c.useEffect(()=>{C.state?.openNew&&(j(!0),_(C.pathname,{replace:!0,state:{}}))},[C.state,C.pathname,_]);const{data:g,isLoading:d}=ge({queryKey:["vacations",{status:m}],queryFn:()=>I.list({status:m||void 0})}),S=G({mutationFn:n=>I.submit(n),onSuccess:()=>{i.invalidateQueries(["vacations"])}}),$=G({mutationFn:n=>I.cancel(n),onSuccess:()=>{i.invalidateQueries(["vacations"])}}),H=G({mutationFn:n=>I.delete(n),onSuccess:()=>{i.invalidateQueries(["vacations"])},onError:n=>{alert(n.response?.data?.error||"Error al eliminar la solicitud")}}),P=G({mutationFn:n=>I.signDocument(n),onSuccess:()=>{i.invalidateQueries(["vacations"]),alert("Documento firmado exitosamente. Ahora puedes enviar la solicitud.")},onError:n=>{const v=n.response?.data?.error||"Error al firmar el documento";n.response?.data?.action_required?.type==="configure_signature"?window.confirm("No tienes firma digital configurada. ¿Deseas configurarla ahora?")&&_("/profile"):alert(v)}}),F=n=>{window.confirm("¿Estás seguro de que deseas eliminar esta solicitud? Esta acción no se puede deshacer.")&&H.mutate(n)},z=n=>{P.mutate(n.id)},L=g?.data?.data||[],T=g?.data?.meta?.vacation_balance||{},u=n=>{w(n),b(!0)},l=async n=>{try{const v=await I.downloadDocument(n),M=new Blob([v.data],{type:"application/pdf"}),X=window.URL.createObjectURL(M);window.open(X,"_blank")}catch(v){console.error("Error downloading document:",v),alert("Error al descargar el documento")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Vacaciones"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona tus solicitudes de vacaciones"})]}),e.jsxs(y,{onClick:()=>j(!0),children:[e.jsx(pe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(A,{className:"bg-blue-50 border-blue-200",children:e.jsx(Y,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(We,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:Math.floor((T.accrued||0)-(T.enjoyed||0))}),e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Días por Contrato"}),e.jsx("p",{className:"text-xs text-blue-500",children:"Acumulados - Disfrutados"})]})]})})}),e.jsx(A,{className:"bg-amber-50 border-amber-200",children:e.jsx(Y,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-amber-100 rounded-xl",children:e.jsx(Xe,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:Math.floor(T.scheduled||0)}),e.jsx("p",{className:"text-sm text-amber-700 font-medium",children:"Días Programados"}),e.jsx("p",{className:"text-xs text-amber-500",children:"Aprobados sin disfrutar"})]})]})})}),e.jsx(A,{className:"bg-green-50 border-green-300 ring-2 ring-green-200",children:e.jsx(Y,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx(pe,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:Math.floor(T.available||0)}),e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Días Vacaciones"}),e.jsx("p",{className:"text-xs text-green-500",children:"Para solicitar"})]})]})})})]}),e.jsx(A,{children:e.jsx(Y,{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Be,{className:"w-4 h-4 text-gray-400"}),e.jsx(le,{options:is,value:m,onChange:n=>x(n.target.value),className:"w-48"})]})})}),d?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(n=>e.jsx(A,{className:"animate-pulse",children:e.jsx(Y,{className:"p-4",children:e.jsx("div",{className:"h-24 bg-gray-100 rounded"})})},n))}):L.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map(n=>e.jsx(ds,{vacation:n,onSubmit:v=>S.mutate(v),onCancel:v=>$.mutate(v),onDelete:F,onView:u,onDownload:l,onSign:z},n.id))}):e.jsx(A,{children:e.jsxs(Y,{className:"py-12 text-center",children:[e.jsx(fe,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tienes solicitudes de vacaciones"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Crea tu primera solicitud de vacaciones"}),e.jsxs(y,{onClick:()=>j(!0),children:[e.jsx(pe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})}),e.jsx(te,{isOpen:t,onClose:()=>j(!1),title:"Nueva Solicitud de Vacaciones",size:"xl",children:e.jsx(cs,{onClose:()=>j(!1),onSuccess:()=>i.invalidateQueries(["vacations"]),balance:T,bookedRanges:T?.booked_ranges||[]})}),e.jsx(te,{isOpen:D,onClose:()=>b(!1),title:"Detalle de Solicitud",size:"xl",children:h&&e.jsx(os,{vacation:h,onClose:()=>b(!1),onDownload:l})})]})}const xs=[{value:"bank",label:"Entidad Bancaria / Crédito"},{value:"visa",label:"Trámite de Visa"},{value:"rental",label:"Arrendamiento / Inmobiliaria"},{value:"government",label:"Trámite Gubernamental"},{value:"legal",label:"Proceso Legal"},{value:"other",label:"Otro"}],us=[{value:"es",label:"Español"},{value:"en",label:"Inglés"}],ps=[{value:"",label:"Todos los estados"},{value:"pending",label:"Pendiente"},{value:"processing",label:"En Proceso"},{value:"completed",label:"Completado"},{value:"rejected",label:"Rechazado"},{value:"cancelled",label:"Cancelado"}],Ce={employment:"Certificación Laboral",salary:"Con Salario",position:"Certificación de Cargo",full:"Certificación Completa",custom:"Personalizada"},Ae={bank:"Entidad Bancaria",visa:"Trámite de Visa",rental:"Arrendamiento",government:"Trámite Gubernamental",legal:"Proceso Legal",other:"Otro"},Me={employment:1,salary:2,position:1,full:3,custom:3};function hs({onSubmit:t,onCancel:j,loading:D,initialType:b,availableTypes:h}){const w=h?.length>0?h:[],m=b&&w.find(g=>g.value===b)?b:w[0]?.value||"employment",[x,i]=c.useState({certification_type:m,purpose:"bank",purpose_details:"",language:"es",addressee:"",special_instructions:""});c.useEffect(()=>{b&&w.find(g=>g.value===b)&&i(g=>({...g,certification_type:b}))},[b,w]);const C=g=>{g.preventDefault(),t(x)},_=x.certification_type;return w.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_e,{className:"w-5 h-5 text-amber-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"No hay tipos de certificación configurados"}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"El administrador debe configurar los tipos de certificación y asociar cada uno a un template antes de poder crear solicitudes."})]})]})}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(y,{variant:"secondary",onClick:j,children:"Cerrar"})})]}):e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx(le,{label:"Tipo de Certificación",options:w,value:x.certification_type,onChange:g=>i({...x,certification_type:g.target.value}),required:!0}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Tiempo estimado: ",Me[_]," día",Me[_]>1?"s":""," hábil",Me[_]>1?"es":""]})]})}),e.jsx(le,{label:"Propósito",options:xs,value:x.purpose,onChange:g=>i({...x,purpose:g.target.value}),required:!0}),x.purpose==="other"&&e.jsx(je,{label:"Especifique el propósito",value:x.purpose_details,onChange:g=>i({...x,purpose_details:g.target.value}),placeholder:"Describa el propósito de la certificación...",required:!0}),e.jsx(le,{label:"Idioma",options:us,value:x.language,onChange:g=>i({...x,language:g.target.value})}),e.jsx(je,{label:"Dirigido a (opcional)",value:x.addressee,onChange:g=>i({...x,addressee:g.target.value}),placeholder:"Ej: A quien corresponda, Banco XYZ, Embajada..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Instrucciones especiales (opcional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3,value:x.special_instructions,onChange:g=>i({...x,special_instructions:g.target.value}),placeholder:"Información adicional o requisitos especiales..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:j,children:"Cancelar"}),e.jsx(y,{type:"submit",loading:D,children:"Solicitar Certificación"})]})]})}const gs={pending:e.jsx(he,{className:"w-4 h-4 text-yellow-500"}),processing:e.jsx(he,{className:"w-4 h-4 text-blue-500 animate-pulse"}),completed:e.jsx(re,{className:"w-4 h-4 text-green-500"}),rejected:e.jsx(ee,{className:"w-4 h-4 text-red-500"}),cancelled:e.jsx(Se,{className:"w-4 h-4 text-gray-400"})};function js({onClose:t,onNavigateToTemplate:j}){const[D,b]=c.useState([]),[h,w]=c.useState(!1),[m,x]=c.useState(null),[i,C]=c.useState({code:"",label:"",description:"",template_id:""}),_=be(),{data:g,isLoading:d}=ge({queryKey:["admin-certification-templates"],queryFn:()=>ve.list({category:"certification",status:"active"})}),S=g?.data?.data||[];c.useEffect(()=>{if(S.length>0){const l=S.filter(n=>n.certification_type).map(n=>({code:n.certification_type,label:n.certification_type_label||Ce[n.certification_type]||n.certification_type,description:"",template_id:n.id,template_name:n.name,variables:n.variables||[]}));b(l)}},[S]);const $=l=>S.filter(n=>!n.certification_type||n.id===l),H=S.filter(l=>!l.certification_type),P=()=>{if(!i.code||!i.template_id){alert("Debe ingresar un código y seleccionar un template");return}if(D.find(n=>n.code===i.code)){alert("Ya existe un tipo con ese código");return}const l=S.find(n=>n.id===i.template_id);b([...D,{...i,template_name:l?.name,variables:l?.variables||[]}]),C({code:"",label:"",description:"",template_id:""})},F=l=>{b(D.filter(n=>n.code!==l)),m===l&&x(null)},z=l=>{x(m===l?null:l)},L=(l,n)=>{const v=S.find(M=>M.id===n);b(D.map(M=>M.code===l?{...M,template_id:n,template_name:v?.name,variables:v?.variables||[]}:M))},T=(l,n)=>{b(D.map(v=>v.code===l?{...v,label:n}:v))},u=async()=>{w(!0);try{for(const l of S){const n=D.find(v=>v.template_id===l.id);l.certification_type&&!n?await ve.update(l.id,{template:{certification_type:null,certification_type_label:null}}):l.certification_type&&n&&l.certification_type!==n.code&&await ve.update(l.id,{template:{certification_type:n.code,certification_type_label:n.label}})}for(const l of D)l.template_id&&await ve.update(l.template_id,{template:{certification_type:l.code,certification_type_label:l.label}});_.invalidateQueries(["certification-available-types"]),_.invalidateQueries(["admin-certification-templates"]),alert("Configuración guardada exitosamente"),t()}catch(l){console.error("Error saving certification types:",l),alert("Error al guardar: "+(l.response?.data?.error||l.message))}finally{w(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Configure los tipos de certificación disponibles. Cada tipo debe tener un template asociado."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Tipos Configurados"}),D.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No hay tipos configurados"}):e.jsx("div",{className:"space-y-2",children:D.map(l=>e.jsx("div",{className:`p-3 border rounded-lg ${m===l.code?"bg-blue-50 border-blue-300":"bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-sm font-mono bg-gray-200 px-2 py-0.5 rounded",children:l.code}),m===l.code?e.jsx("input",{type:"text",value:l.label,onChange:n=>T(l.code,n.target.value),className:"flex-1 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Etiqueta"}):e.jsx("span",{className:"font-medium",children:l.label})]}),m===l.code?e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Template asociado:"}),e.jsx("select",{value:l.template_id,onChange:n=>L(l.code,n.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:$(l.template_id).map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))})]}):e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-600",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsxs("button",{onClick:()=>j(l.template_id),className:"text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1",title:"Ir al template",children:[l.template_name,e.jsx(Fe,{className:"w-3 h-3"})]})]}),l.variables?.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Variables requeridas:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.variables.slice(0,5).map((n,v)=>e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:n},v)),l.variables.length>5&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",l.variables.length-5," más"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>z(l.code),className:`p-1 rounded ${m===l.code?"text-blue-600 bg-blue-100":"text-gray-400 hover:text-blue-600 hover:bg-blue-50"}`,title:m===l.code?"Cerrar edición":"Editar",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>F(l.code),className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded",title:"Eliminar",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]})},l.code))})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Agregar Nuevo Tipo"}),H.length===0&&S.length>0?e.jsx("p",{className:"text-sm text-amber-600",children:"Todos los templates de certificación ya tienen un tipo asignado. Para agregar más tipos, primero suba nuevos templates de certificación."}):d?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(ae,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Cargando templates..."})]}):S.length===0?e.jsx("p",{className:"text-sm text-amber-600",children:'No hay templates de certificación disponibles. Primero debe subir templates con categoría "certification" desde Administración → Templates.'}):e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(je,{label:"Código",value:i.code,onChange:l=>C({...i,code:l.target.value.toLowerCase().replace(/\s/g,"_")}),placeholder:"ej: employment, salary"}),e.jsx(je,{label:"Etiqueta",value:i.label,onChange:l=>C({...i,label:l.target.value}),placeholder:"ej: Certificación Laboral"}),e.jsx("div",{className:"col-span-2",children:e.jsx(le,{label:"Template Asociado",options:[{value:"",label:"Seleccione un template..."},...H.map(l=>({value:l.id,label:l.name}))],value:i.template_id,onChange:l=>C({...i,template_id:l.target.value})})}),e.jsx("div",{className:"col-span-2",children:e.jsxs(y,{type:"button",variant:"secondary",onClick:P,disabled:!i.code||!i.template_id,children:[e.jsx(pe,{className:"w-4 h-4"}),"Agregar Tipo"]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(y,{variant:"ghost",onClick:t,children:"Cancelar"}),e.jsxs(y,{onClick:u,loading:h,children:[e.jsx(as,{className:"w-4 h-4"}),"Guardar Configuración"]})]})]})}function bs(){const[t,j]=c.useState(!1),[D,b]=c.useState(!1),[h,w]=c.useState(!1),[m,x]=c.useState(!1),[i,C]=c.useState(null),[_,g]=c.useState(null),[d,S]=c.useState(null),[$,H]=c.useState(""),[P,F]=c.useState(""),[z,L]=c.useState(null),[T,u]=c.useState(null),[l,n]=c.useState(null),[v,M]=c.useState(null),[X,p]=c.useState(null),[O,U]=c.useState(null),E=be(),W=ke(),Z=$e(),{isHR:ie,isAdmin:V}=He();c.useEffect(()=>{Z.state?.openNew&&(j(!0),W(Z.pathname,{replace:!0,state:{}}))},[Z.state,Z.pathname,W]);const{data:Te}=ge({queryKey:["certification-available-types"],queryFn:()=>se.getAvailableTypes(),staleTime:300*1e3}),B=Te?.data?.data||[],qe=[{value:"",label:"Todos los tipos"},...B.map(s=>({value:s.value,label:s.label}))],{data:Le,isLoading:ye}=ge({queryKey:["certifications",{status:$,type:P}],queryFn:()=>se.list({status:$||void 0,type:P||void 0})}),oe=G({mutationFn:s=>se.create(s),onSuccess:()=>{E.invalidateQueries(["certifications"]),j(!1)}}),me=G({mutationFn:s=>se.cancel(s),onSuccess:()=>{E.invalidateQueries(["certifications"])}}),Pe=G({mutationFn:s=>se.generateDocument(s),onSuccess:()=>{E.invalidateQueries(["certifications"]),L(null)},onError:s=>{console.error("Error generating document:",s),L(null);const N=s.response?.data;N?.error_type==="missing_variables"?(C({message:N.error,missingData:N.missing_data,actions:N.action_required||[]}),w(!0)):alert(N?.error||"Error al generar documento")}}),a=G({mutationFn:s=>se.delete(s),onSuccess:()=>{E.invalidateQueries(["certifications"]),g(null)},onError:s=>{console.error("Error deleting certification:",s),alert(s.response?.data?.error||"Error al eliminar certificación")}}),r=G({mutationFn:s=>se.signDocument(s),onSuccess:s=>{E.invalidateQueries(["certifications"]),n(null);const N=s.data.document;N.all_signed?alert("Documento firmado y completado exitosamente"):alert(`Documento firmado. Firmas pendientes: ${N.pending_signatures.join(", ")}`)},onError:s=>{console.error("Error signing document:",s),n(null);const N=s.response?.data;N?.action_required?.type==="configure_signature"?confirm("No tienes firma digital configurada. ¿Deseas configurarla ahora?")&&W("/profile"):alert(N?.error||"Error al firmar documento")}}),o=Le?.data?.data||[],f=o.filter(s=>s.is_mine).some(s=>["pending","processing"].includes(s.status)),k=s=>{S(s),b(!0)},K=async s=>{L(s),Pe.mutate(s)},Q=async s=>{if(s.response?.data instanceof Blob)try{const N=await s.response.data.text();return JSON.parse(N)}catch{return null}return s.response?.data},R=async s=>{try{u(s.id);const N=await se.downloadDocument(s.id),J=new Blob([N.data],{type:"application/pdf"}),xe=URL.createObjectURL(J),ce=document.createElement("a");ce.href=xe,ce.download=`${s.request_number}.pdf`,document.body.appendChild(ce),ce.click(),document.body.removeChild(ce),URL.revokeObjectURL(xe)}catch(N){console.error("Error downloading document:",N);const J=await Q(N);alert(J?.error||J?.message||"Error al descargar documento")}finally{u(null)}},q=async s=>{try{p(s.id);const N=await se.downloadDocument(s.id),J=new Blob([N.data],{type:"application/pdf"}),xe=URL.createObjectURL(J);M(xe)}catch(N){console.error("Error previewing document:",N);const J=await Q(N);alert(J?.error||J?.message||"Error al previsualizar documento")}finally{p(null)}},Ne=()=>{v&&URL.revokeObjectURL(v),M(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Certificaciones"}),e.jsx("p",{className:"text-gray-500",children:"Solicita certificaciones laborales para distintos trámites"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[V&&e.jsxs(y,{variant:"secondary",onClick:()=>x(!0),title:"Configurar tipos de certificación",children:[e.jsx(Re,{className:"w-4 h-4"}),"Configurar Tipos"]}),e.jsxs(y,{onClick:()=>j(!0),disabled:B.length===0||f,title:B.length===0?"No hay tipos de certificación disponibles":f?"Certificados en trámite":"",children:[e.jsx(pe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})]}),e.jsx(A,{children:e.jsx(Y,{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Be,{className:"w-4 h-4 text-gray-400"}),e.jsx(le,{options:ps,value:$,onChange:s=>H(s.target.value),className:"w-48"}),e.jsx(le,{options:qe,value:P,onChange:s=>F(s.target.value),className:"w-56"})]})})}),B.length>0&&!f?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[B.find(s=>s.value==="employment")&&e.jsx(A,{className:"bg-blue-50 border-blue-200 cursor-pointer hover:shadow-md hover:border-blue-300 transition-all",onClick:()=>{U("employment"),j(!0)},children:e.jsx(Y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Certificación Laboral"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Confirma tu vínculo laboral actual"})]})]})})}),B.find(s=>s.value==="salary")&&e.jsx(A,{className:"bg-green-50 border-green-200 cursor-pointer hover:shadow-md hover:border-green-300 transition-all",onClick:()=>{U("salary"),j(!0)},children:e.jsx(Y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Con Información Salarial"}),e.jsx("p",{className:"text-sm text-green-700",children:"Incluye detalles de tu compensación"})]})]})})}),B.find(s=>s.value==="full")&&e.jsx(A,{className:"bg-purple-50 border-purple-200 cursor-pointer hover:shadow-md hover:border-purple-300 transition-all",onClick:()=>{U("full"),j(!0)},children:e.jsx(Y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-purple-900",children:"Certificación Completa"}),e.jsx("p",{className:"text-sm text-purple-700",children:"Incluye toda tu información laboral"})]})]})})}),B.find(s=>s.value==="position")&&e.jsx(A,{className:"bg-amber-50 border-amber-200 cursor-pointer hover:shadow-md hover:border-amber-300 transition-all",onClick:()=>{U("position"),j(!0)},children:e.jsx(Y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-8 h-8 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"Certificación de Cargo"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Detalla cargo y responsabilidades"})]})]})})}),B.find(s=>s.value==="custom")&&e.jsx(A,{className:"bg-gray-50 border-gray-200 cursor-pointer hover:shadow-md hover:border-gray-300 transition-all",onClick:()=>{U("custom"),j(!0)},children:e.jsx(Y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-8 h-8 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Certificación Personalizada"}),e.jsx("p",{className:"text-sm text-gray-700",children:"Contenido según necesidad"})]})]})})})]}):e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"w-6 h-6 text-amber-600 flex-shrink-0"}),e.jsx("div",{children:f?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"Los certificados existentes configurados ya están en trámite"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Por favor esperar que sean finalizados para solicitar otro certificado."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"No hay tipos de certificación disponibles"}),e.jsx("p",{className:"text-sm text-amber-700",children:V?"Configura los tipos de certificación y asocia cada uno a un template.":"Contacta al administrador para configurar los templates de certificación."})]})})]}),V&&!f&&e.jsxs(y,{variant:"secondary",size:"sm",onClick:()=>x(!0),className:"flex-shrink-0",children:[e.jsx(Re,{className:"w-4 h-4"}),"Configurar Tipos"]})]})}),e.jsxs(A,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-fixed",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[15%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"w-[18%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"w-[17%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Propósito"}),e.jsx("th",{className:"w-[12%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"w-[10%] px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Días"}),e.jsx("th",{className:"w-[13%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"w-[15%] px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:ye?[...Array(3)].map((s,N)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-28"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8 mx-auto"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16 mx-auto"})})]},N)):o.length>0?o.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"text-sm font-mono text-primary-600 bg-primary-50 px-2 py-0.5 rounded",children:s.request_number})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:Ce[s.certification_type]||s.certification_type})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600 truncate block",children:Ae[s.purpose]||s.purpose})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[gs[s.status],e.jsx(ue,{status:s.status})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm text-gray-600",children:s.estimated_days})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(fe,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"short"})})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>k(s),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 rounded transition-colors",title:"Ver detalle",children:e.jsx(De,{className:"w-4 h-4"})}),(ie||V)&&s.status==="pending"&&!s.document_uuid&&e.jsx("button",{onClick:()=>K(s.id),disabled:z===s.id,className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:opacity-50",title:"Generar documento",children:z===s.id?e.jsx(ae,{className:"w-4 h-4 animate-spin"}):e.jsx(es,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.can_download&&e.jsx("button",{onClick:()=>q(s),disabled:X===s.id,className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:opacity-50",title:"Previsualizar",children:X===s.id?e.jsx(ae,{className:"w-4 h-4 animate-spin"}):e.jsx(De,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.can_download&&e.jsx("button",{onClick:()=>R(s),disabled:T===s.id,className:"p-1.5 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded transition-colors disabled:opacity-50",title:"Descargar",children:T===s.id?e.jsx(ae,{className:"w-4 h-4 animate-spin"}):e.jsx(Oe,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.pending_signatures?.length>0&&(ie||V)&&e.jsx("button",{onClick:()=>{n(s.id),r.mutate(s.id)},disabled:l===s.id,className:"p-1.5 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors disabled:opacity-50",title:`Firmar documento (Pendiente: ${s.document_info?.pending_signatures?.join(", ")})`,children:l===s.id?e.jsx(ae,{className:"w-4 h-4 animate-spin"}):e.jsx(de,{className:"w-4 h-4"})}),s.document_uuid&&!s.document_info?.pdf_ready&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs text-blue-700 bg-blue-50 rounded",title:"El PDF se está generando",children:[e.jsx(ae,{className:"w-3 h-3 mr-1 animate-spin"}),"PDF pendiente"]}),s.document_uuid&&s.document_info?.pdf_ready&&!s.document_info?.can_download&&!(ie||V)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs text-amber-700 bg-amber-50 rounded",title:`Pendiente: ${s.document_info?.pending_signatures?.join(", ")}`,children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),"Firma pendiente"]}),["pending","processing"].includes(s.status)&&!V&&e.jsx("button",{onClick:()=>me.mutate(s.id),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Cancelar",children:e.jsx(Se,{className:"w-4 h-4"})}),V&&e.jsx("button",{onClick:()=>g(s),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Eliminar",children:e.jsx(Ee,{className:"w-4 h-4"})})]})})]},s.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-4 py-12 text-center",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-base font-medium text-gray-900 mb-1",children:"No tienes solicitudes de certificaciones"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Solicita una certificación laboral para tus trámites"}),e.jsxs(y,{size:"sm",onClick:()=>j(!0),disabled:B.length===0||f,children:[e.jsx(pe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})})})]})}),o.length>0&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("p",{className:"text-sm text-gray-500",children:[o.length," solicitud",o.length!==1?"es":""]})})]}),e.jsx(te,{isOpen:t,onClose:()=>{j(!1),U(null)},title:"Nueva Solicitud de Certificación",size:"lg",children:e.jsx(hs,{onSubmit:s=>oe.mutate(s),onCancel:()=>{j(!1),U(null)},loading:oe.isPending,initialType:O,availableTypes:B})}),e.jsx(te,{isOpen:D,onClose:()=>b(!1),title:"Detalle de Certificación",size:"md",children:d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Número:"}),e.jsx("span",{className:"font-medium",children:d.request_number})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(ue,{status:d.status})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("span",{children:Ce[d.certification_type]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Propósito:"}),e.jsx("span",{children:Ae[d.purpose]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Tiempo estimado:"}),e.jsxs("span",{children:[d.estimated_days," día",d.estimated_days>1?"s":""," hábil",d.estimated_days>1?"es":""]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha solicitud:"}),e.jsx("span",{children:new Date(d.created_at).toLocaleDateString("es-ES")})]}),d.language&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Idioma:"}),e.jsx("span",{children:d.language==="es"?"Español":"Inglés"})]}),d.status==="completed"&&d.completed_at&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha completado:"}),e.jsx("span",{className:"text-green-600 font-medium",children:new Date(d.completed_at).toLocaleDateString("es-ES")})]}),d.status==="rejected"&&d.rejection_reason&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"Motivo de rechazo:"}),e.jsx("p",{className:"text-red-700",children:d.rejection_reason})]}),d.processed_by&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Procesado por:"}),e.jsx("p",{className:"text-gray-600",children:d.processed_by.name})]}),d.document_uuid&&d.document_info?.can_download&&e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsxs(y,{className:"w-full",variant:"primary",onClick:()=>q(d),loading:X===d.id,children:[e.jsx(De,{className:"w-4 h-4"}),"Previsualizar Documento"]}),e.jsxs(y,{className:"w-full",variant:"secondary",onClick:()=>R(d),loading:T===d.id,children:[e.jsx(Oe,{className:"w-4 h-4"}),"Descargar Certificación"]})]})]})}),e.jsx(te,{isOpen:h,onClose:()=>w(!1),title:"No se puede generar el documento",size:"md",children:i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(_e,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Información faltante"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:i.message})]})]}),i.missingData?.by_source?.employee?.length>0&&e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-amber-800 mb-2",children:"Datos del empleado requeridos:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-amber-700 space-y-1",children:i.missingData.by_source.employee.map((s,N)=>e.jsx("li",{children:s.field_label||s.field},N))})]}),i.missingData?.by_source?.organization?.length>0&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-2",children:"Datos de la organización requeridos:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-blue-700 space-y-1",children:i.missingData.by_source.organization.map((s,N)=>e.jsx("li",{children:s.field_label||s.field},N))})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t",children:[i.actions?.map((s,N)=>e.jsxs(y,{variant:N===0?"primary":"secondary",className:"w-full justify-center",onClick:()=>{w(!1),s.type==="edit_employee"&&s.employee_id?W(`/hr/employees?edit=${s.employee_id}`):s.type==="edit_organization"?W("/admin/organization"):s.type==="configure_mappings"&&W("/admin/variable-mappings")},children:[e.jsx(Fe,{className:"w-4 h-4"}),s.label,s.employee_name&&` (${s.employee_name})`]},N)),e.jsx(y,{variant:"ghost",className:"w-full justify-center",onClick:()=>w(!1),children:"Cerrar"})]})]})}),e.jsx(te,{isOpen:!!_,onClose:()=>g(null),title:"Eliminar Certificación",size:"sm",children:_&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(_e,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"¿Eliminar esta certificación?"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Esta acción no se puede deshacer. Se eliminará permanentemente la solicitud"," ",e.jsx("strong",{children:_.request_number}),"."]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("span",{className:"font-medium",children:Ce[_.certification_type]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(ue,{status:_.status})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(y,{variant:"ghost",className:"flex-1",onClick:()=>g(null),children:"Cancelar"}),e.jsxs(y,{variant:"danger",className:"flex-1",loading:a.isPending,onClick:()=>a.mutate(_.id),children:[e.jsx(Ee,{className:"w-4 h-4"}),"Eliminar"]})]})]})}),e.jsx(te,{isOpen:!!v,onClose:Ne,title:"Previsualización de Documento",size:"full",children:e.jsxs("div",{className:"flex flex-col h-[80vh]",children:[v&&e.jsx("iframe",{src:v,className:"w-full flex-1 border rounded-lg bg-gray-100",title:"Vista previa del documento"}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t mt-4",children:e.jsxs(y,{variant:"secondary",onClick:Ne,children:[e.jsx(Se,{className:"w-4 h-4"}),"Cerrar"]})})]})}),e.jsx(te,{isOpen:m,onClose:()=>x(!1),title:"Configurar Tipos de Certificación",size:"lg",children:e.jsx(js,{onClose:()=>{x(!1),E.invalidateQueries(["certification-available-types"])},onNavigateToTemplate:s=>{x(!1),W(`/admin/templates/${s}`)}})})]})}const fs=[{id:"vacations",name:"Vacaciones",icon:fe,path:"/hr/my-requests/vacations"},{id:"certifications",name:"Certificaciones",icon:ts,path:"/hr/my-requests/certifications"}];function qs(){const{tab:t}=Ye(),j=ke();if(!t)return e.jsx(Ie,{to:"/hr/my-requests/vacations",replace:!0});if(!["vacations","certifications"].includes(t))return e.jsx(Ie,{to:"/hr/my-requests/vacations",replace:!0});const b=t;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:fs.map(h=>{const w=h.icon,m=b===h.id;return e.jsxs("button",{onClick:()=>j(h.path),className:`
                  group inline-flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm
                  ${m?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx(w,{className:`w-5 h-5 ${m?"text-primary-500":"text-gray-400 group-hover:text-gray-500"}`}),h.name]},h.id)})})}),e.jsxs("div",{children:[b==="vacations"&&e.jsx(ms,{}),b==="certifications"&&e.jsx(bs,{})]})]})}export{qs as default};
