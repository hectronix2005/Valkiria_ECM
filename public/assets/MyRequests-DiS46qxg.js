import{b as Ee,u as je,c as M,j as e}from"./vendor-query-BtlmzfbD.js";import{r as c,u as Te,a as fe,d as Ue,N as Pe}from"./vendor-router-CyR0tpch.js";import{v as P,p as Ve,u as Oe,c as B}from"./index-CVfkkGsc.js";import{C as S,c as q}from"./Card-CVFC4agM.js";import{B as p}from"./Button-C8xCGhNf.js";import{B as ie}from"./Badge-CLufSCSl.js";import{M as ae}from"./Modal-it_GQaMG.js";import{I as ue}from"./Input-DPOK3q6H.js";import{S as te}from"./Select-DLsgzIyk.js";import{P as pe,z as Ae,_ as Be,$ as ze,t as Ne,m as ge,a0 as ke,Q as ce,a1 as Re,X as be,Y as Se,O as Y,F as K,U as Qe,l as Q,a2 as Fe,a3 as ne,o as de,J as De,a4 as $e,D as qe,A as Ge}from"./vendor-icons-BMeEPn6p.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const Le=[{value:"vacation",label:"Vacaciones"},{value:"personal",label:"Día Personal"},{value:"sick",label:"Enfermedad"},{value:"bereavement",label:"Duelo"},{value:"unpaid",label:"Sin Goce"}],He=[{value:"",label:"Todos"},{value:"draft",label:"Borrador"},{value:"pending",label:"Solicitada"},{value:"approved",label:"Aprobada"},{value:"enjoyed",label:"Disfrutada"},{value:"rejected",label:"Rechazada"},{value:"cancelled",label:"Cancelada"}];function Ye({onClose:r,onSuccess:g,balance:E}){const[d,N]=c.useState(1),[n,h]=c.useState({vacation_type:"vacation",start_date:"",end_date:"",days_requested:"",reason:""}),[l,j]=c.useState(null),[y,i]=c.useState(null),[o,L]=c.useState(null),[re,f]=c.useState(!1),[v,_]=c.useState(""),[T,z]=c.useState(null),$=Ee(),U=fe(),{data:W}=je({queryKey:["vacation-template"],queryFn:async()=>(await Ve.list({category:"vacation"})).data?.data?.[0]||null}),k=W,m=M({mutationFn:a=>P.create(a),onSuccess:async a=>{const t=a.data?.data,x=a.data?.document;if(j(t),i(x),_(""),t?.id&&t?.pdf_ready)try{const b=await P.downloadDocument(t.id),R=new Blob([b.data],{type:"application/pdf"});L(URL.createObjectURL(R))}catch(b){console.error("Error loading PDF:",b),L(null)}else L(null);N(2)},onError:a=>{const t=a.response?.data;t?.missing_fields&&Array.isArray(t.missing_fields)?(z(t.missing_fields),_(t.message||"Faltan datos requeridos")):Array.isArray(t?.errors)?(_(t.errors.join(", ")),z(null)):(_(t?.error||"Error al crear la solicitud"),z(null))}}),w=M({mutationFn:a=>P.signDocument(a),onSuccess:a=>{i(a.data?.document),j(a.data?.data),oe()},onError:a=>{_(a.response?.data?.error||"Error al firmar el documento")}}),X=M({mutationFn:a=>P.submit(a),onSuccess:a=>{j(a.data?.data),N(3),$.invalidateQueries(["vacations"])},onError:a=>{_(a.response?.data?.error||"Error al enviar la solicitud")}}),oe=async()=>{if(l?.id&&l?.pdf_ready)try{const a=await P.downloadDocument(l.id),t=new Blob([a.data],{type:"application/pdf"});o&&URL.revokeObjectURL(o),L(URL.createObjectURL(t))}catch(a){console.error("Error reloading PDF:",a)}},O=a=>{const t=a%19,x=Math.floor(a/100),b=a%100,R=Math.floor(x/4),H=x%4,A=Math.floor((x+8)/25),I=Math.floor((x-A+1)/3),C=(19*t+x-R-I+15)%30,s=Math.floor(b/4),u=b%4,V=(32+2*H+2*s-C-u)%7,ee=Math.floor((t+11*C+22*V)/451),se=Math.floor((C+V-7*ee+114)/31),Ie=(C+V-7*ee+114)%31+1;return new Date(a,se-1,Ie)},D=a=>{const t=new Date(a),x=t.getDay();return x===0?t.setDate(t.getDate()+1):x!==1&&t.setDate(t.getDate()+(8-x)),t},G=a=>{const t=[],x=O(a);t.push(new Date(a,0,1)),t.push(new Date(a,4,1)),t.push(new Date(a,6,20)),t.push(new Date(a,7,7)),t.push(new Date(a,11,8)),t.push(new Date(a,11,25)),t.push(D(new Date(a,0,6))),t.push(D(new Date(a,2,19))),t.push(D(new Date(a,5,29))),t.push(D(new Date(a,7,15))),t.push(D(new Date(a,9,12))),t.push(D(new Date(a,10,1))),t.push(D(new Date(a,10,11)));const b=new Date(x);b.setDate(x.getDate()-3),t.push(b);const R=new Date(x);R.setDate(x.getDate()-2),t.push(R);const H=new Date(x);H.setDate(x.getDate()+39),t.push(D(H));const A=new Date(x);A.setDate(x.getDate()+60),t.push(D(A));const I=new Date(x);return I.setDate(x.getDate()+68),t.push(D(I)),t},le=(a,t)=>{const x=a.toISOString().split("T")[0];return t.some(b=>b.toISOString().split("T")[0]===x)},me=(a,t)=>{let x=0;const b=new Date(a),R=new Date(t),H=b.getFullYear(),A=R.getFullYear();let I=[];for(let C=H;C<=A;C++)I=I.concat(G(C));for(;b<=R;){const C=b.getDay();C!==0&&C!==6&&!le(b,I)&&x++,b.setDate(b.getDate()+1)}return x};c.useEffect(()=>{if(n.start_date&&n.end_date){const a=new Date(n.start_date+"T00:00:00"),t=new Date(n.end_date+"T00:00:00");if(t>=a){const x=me(a,t);h(b=>({...b,days_requested:x.toString()}))}}},[n.start_date,n.end_date]),c.useEffect(()=>()=>{o&&URL.revokeObjectURL(o)},[o]);const J=a=>{a.preventDefault(),m.mutate(n)},ye=()=>{_(""),l?.id&&w.mutate(l.id)},F=()=>{_(""),l?.id&&X.mutate(l.id)},ve=()=>{$.invalidateQueries(["vacations"]),g?.(),r()},he=()=>{o&&window.open(o,"_blank")},xe=y?.employee_signed||!1,Z=l?.pdf_ready===!1,we=xe||Z;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-6",children:[1,2,3].map(a=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${d>=a?"bg-primary-500 text-white":"bg-gray-200 text-gray-500"}`,children:d>a?e.jsx(Y,{className:"w-5 h-5"}):a}),a<3&&e.jsx("div",{className:`w-12 h-1 mx-1 ${d>a?"bg-primary-500":"bg-gray-200"}`})]},a))}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-4 mb-6",children:[e.jsx("span",{className:d>=1?"text-primary-600 font-medium":"",children:"Datos"}),e.jsx("span",{className:d>=2?"text-primary-600 font-medium":"",children:"Firmar"}),e.jsx("span",{className:d>=3?"text-primary-600 font-medium":"",children:"Enviado"})]}),d===1&&e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[k&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3",children:[e.jsx(K,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:k.name}),e.jsx("p",{className:"text-sm text-blue-700",children:"Se generará el documento oficial para tu firma"}),k.signatories_count>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-blue-600",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsxs("span",{children:[k.signatories_count," firmantes requeridos"]})]})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg flex items-center justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Días disponibles para solicitar:"}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:Math.floor(E?.available||0)})]}),e.jsx(te,{label:"Tipo de Solicitud",options:Le,value:n.vacation_type,onChange:a=>h({...n,vacation_type:a.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(ue,{label:"Fecha Inicio",type:"date",value:n.start_date,min:new Date().toISOString().split("T")[0],onChange:a=>{h({...n,start_date:a.target.value}),_(""),z(null)},required:!0}),e.jsx(ue,{label:"Fecha Fin",type:"date",value:n.end_date,min:n.start_date||new Date().toISOString().split("T")[0],onChange:a=>{h({...n,end_date:a.target.value}),_(""),z(null)},required:!0})]}),e.jsx(ue,{label:"Días Solicitados",type:"number",step:"0.5",min:"0.5",value:n.days_requested,onChange:a=>h({...n,days_requested:a.target.value}),required:!0}),parseFloat(n.days_requested)>(E?.available||0)&&e.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center gap-2 text-amber-700",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Los días solicitados exceden tu saldo disponible"})]}),v&&!T&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:v})]}),T&&T.length>0&&e.jsx("div",{className:"p-4 bg-amber-50 border border-amber-300 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-amber-800 mb-2",children:"Faltan datos requeridos para generar la solicitud"}),e.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Por favor complete los siguientes datos antes de continuar:"}),e.jsx("ul",{className:"text-sm text-amber-700 space-y-1 mb-4",children:T.map((a,t)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full"}),e.jsx("span",{children:a.label||a.field}),a.source==="employee"&&e.jsx("span",{className:"text-xs text-amber-500",children:"(Perfil del empleado)"}),a.source==="organization"&&e.jsx("span",{className:"text-xs text-amber-500",children:"(Configuración de la empresa)"})]},t))}),T.some(a=>a.source==="employee")&&e.jsx(p,{type:"button",variant:"secondary",size:"sm",onClick:()=>U("/profile"),children:"Ir a mi Perfil para completar datos"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo (opcional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3,value:n.reason,onChange:a=>h({...n,reason:a.target.value}),placeholder:"Describe el motivo de tu solicitud..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:r,children:"Cancelar"}),e.jsx(p,{type:"submit",loading:m.isPending,children:"Continuar"})]})]}),d===2&&l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"font-medium text-gray-900",children:["Solicitud ",l.request_number]}),e.jsx(ie,{status:l.status})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("p",{className:"font-medium",children:Le.find(a=>a.value===l.vacation_type)?.label})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Fechas:"}),e.jsxs("p",{className:"font-medium",children:[new Date(l.start_date).toLocaleDateString("es-ES")," - ",new Date(l.end_date).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Días:"}),e.jsx("p",{className:"font-bold text-primary-600",children:l.days_requested})]})]})]}),o?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Documento de Solicitud"}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:he,children:[e.jsx(Fe,{className:"w-4 h-4"}),"Abrir en nueva pestaña"]})]}),e.jsx("iframe",{src:o,className:"w-full h-[400px] border-0",title:"Vista previa del documento"})]}):l?.pdf_ready===!1?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-amber-50 border-amber-200",children:[e.jsx(Q,{className:"w-8 h-8 mx-auto text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-700 font-medium",children:"El documento está pendiente de generación"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"El PDF se generará próximamente. Puedes continuar con el proceso."})]}):e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(ne,{className:"w-8 h-8 animate-spin mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]}),e.jsxs("div",{className:"p-4 bg-white border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Firmas Requeridas"]}),e.jsx("div",{className:"space-y-3",children:y?.signatures?.map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${a.signed?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:a.signed?e.jsx(Y,{className:"w-5 h-5"}):t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.label}),a.signed&&e.jsxs("p",{className:"text-xs text-green-600",children:["Firmado por ",a.signed_by," - ",new Date(a.signed_at).toLocaleString("es-ES")]})]})]}),a.signatory_type_code==="employee"&&!a.signed&&e.jsxs(p,{size:"sm",onClick:ye,loading:w.isPending,children:[e.jsx(ce,{className:"w-4 h-4"}),"Firmar"]}),a.signatory_type_code!=="employee"&&!a.signed&&e.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-200 rounded",children:"Pendiente"})]},t))})]}),v&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:v})]}),Z&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"Documento pendiente de generación"}),e.jsx("p",{className:"mt-1",children:"Puedes enviar la solicitud ahora. El documento se generará y firmará posteriormente."})]})]}),!Z&&!xe&&e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-amber-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-medium",children:"Debes firmar el documento antes de enviar"}),e.jsx("p",{className:"mt-1",children:'Haz clic en el botón "Firmar" junto a tu nombre para continuar.'})]})]}),!Z&&xe&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3",children:[e.jsx(Y,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"¡Documento firmado!"}),e.jsx("p",{className:"mt-1",children:"Ahora puedes enviar la solicitud para aprobación del supervisor y RRHH."})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx(p,{variant:"secondary",onClick:()=>N(1),children:"Volver"}),e.jsxs(p,{onClick:F,loading:X.isPending,disabled:!we,children:[e.jsx(Re,{className:"w-4 h-4"}),"Enviar Solicitud"]})]})]}),d===3&&l&&e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Y,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"¡Solicitud Enviada!"}),e.jsxs("p",{className:"text-gray-600",children:["Tu solicitud ",e.jsx("span",{className:"font-medium",children:l.request_number})," ha sido enviada correctamente."]}),o&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Documento firmado:"}),e.jsxs(p,{variant:"secondary",onClick:he,children:[e.jsx(ke,{className:"w-4 h-4"}),"Ver Documento PDF"]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Próximos pasos:"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Tu supervisor recibirá la solicitud para aprobación y firma"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Recursos Humanos revisará y firmará la solicitud"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Recibirás notificación cuando sea aprobada"})]})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(p,{onClick:ve,children:"Cerrar"})})]})]})}function Ke({vacation:r,onSubmit:g,onCancel:E,onDelete:d,onView:N,onDownload:n,onSign:h}){const l={vacation:"Vacaciones",personal:"Día Personal",sick:"Enfermedad",bereavement:"Duelo",unpaid:"Sin Goce"};return e.jsx(S,{className:"hover:shadow-md transition-shadow",children:e.jsxs(q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-50 rounded-lg",children:e.jsx(Ne,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:l[r.vacation_type]||r.vacation_type}),e.jsx("p",{className:"text-sm text-gray-500",children:r.request_number}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[new Date(r.start_date).toLocaleDateString("es-ES")," - ",new Date(r.end_date).toLocaleDateString("es-ES")]}),e.jsxs("p",{className:"text-sm font-medium text-primary-600 mt-1",children:[r.days_requested," días"]})]})]}),e.jsx(ie,{status:r.status})]}),e.jsxs("div",{className:"flex justify-end gap-1 mt-4 pt-4 border-t border-gray-100",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>N(r),title:"Ver detalles",children:e.jsx(ge,{className:"w-4 h-4"})}),r.pdf_ready&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>n(r.id),title:"Descargar documento",children:e.jsx(ke,{className:"w-4 h-4"})}),r.status==="draft"&&r.needs_employee_signature&&e.jsxs(p,{variant:"secondary",size:"sm",onClick:()=>h(r),title:"Firmar documento",children:[e.jsx(ce,{className:"w-4 h-4"}),"Firmar"]}),r.status==="draft"&&!r.needs_employee_signature&&e.jsx(p,{variant:"primary",size:"sm",onClick:()=>g(r.id),title:"Enviar solicitud",children:e.jsx(Re,{className:"w-4 h-4"})}),["draft","pending"].includes(r.status)&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>E(r.id),title:"Cancelar solicitud",children:e.jsx(be,{className:"w-4 h-4"})}),r.can_delete&&e.jsx(p,{variant:"danger",size:"sm",onClick:()=>d(r.id),title:"Eliminar solicitud",children:e.jsx(Se,{className:"w-4 h-4"})})]})]})})}function We({vacation:r,onClose:g,onDownload:E}){const[d,N]=c.useState(null),[n,h]=c.useState(!1),[l,j]=c.useState(null),[y,i]=c.useState(null),o={vacation:"Vacaciones",personal:"Día Personal",sick:"Enfermedad",bereavement:"Duelo",unpaid:"Sin Goce"};c.useEffect(()=>{(async()=>{try{const v=await P.get(r.id);j(v.data?.data),i(v.data?.document)}catch(v){console.error("Error fetching vacation detail:",v)}})()},[r.id]),c.useEffect(()=>(r.pdf_ready&&r.id&&L(),()=>{d&&URL.revokeObjectURL(d)}),[r.id,r.pdf_ready]);const L=async()=>{h(!0);try{const f=await P.downloadDocument(r.id),v=new Blob([f.data],{type:"application/pdf"});N(URL.createObjectURL(v))}catch(f){console.error("Error loading PDF:",f)}finally{h(!1)}},re=()=>{d&&window.open(d,"_blank")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Número:"}),e.jsx("p",{className:"font-medium",children:r.request_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Estado:"}),e.jsx("div",{className:"mt-1",children:e.jsx(ie,{status:r.status})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Tipo:"}),e.jsx("p",{className:"font-medium",children:o[r.vacation_type]||r.vacation_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Días:"}),e.jsx("p",{className:"font-bold text-primary-600",children:r.days_requested})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Fechas:"}),e.jsxs("p",{className:"font-medium",children:[new Date(r.start_date).toLocaleDateString("es-ES")," - ",new Date(r.end_date).toLocaleDateString("es-ES")]})]})]}),r.reason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 block mb-1",children:"Motivo:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded-lg",children:r.reason})]}),r.decision_reason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 block mb-1",children:"Comentario del aprobador:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded-lg",children:r.decision_reason})]}),r.has_document&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-primary-600"}),"Documento de Solicitud"]}),n?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(ne,{className:"w-8 h-8 animate-spin mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]}):d?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Vista Previa del Documento"}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:re,children:[e.jsx(Fe,{className:"w-4 h-4"}),"Abrir en nueva pestaña"]})]}),e.jsx("iframe",{src:d,className:"w-full h-[350px] border-0",title:"Vista previa del documento"})]}):r.pdf_ready===!1?e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-amber-50 border-amber-200",children:[e.jsx(Q,{className:"w-8 h-8 mx-auto text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-700 font-medium",children:"Documento pendiente de generación"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"El PDF se generará próximamente"})]}):e.jsxs("div",{className:"border rounded-lg p-6 text-center bg-gray-50",children:[e.jsx(K,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No se pudo cargar el documento"})]}),y?.signatures&&y.signatures.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-white border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Firmas del Documento"]}),e.jsx("div",{className:"space-y-3",children:y.signatures.map((f,v)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${f.signed?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:f.signed?e.jsx(Y,{className:"w-5 h-5"}):f.position||v+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:f.label}),e.jsxs("p",{className:"text-xs text-gray-500",children:[f.signatory_type_code==="employee"&&"Empleado Solicitante",f.signatory_type_code==="supervisor"&&"Supervisor Directo",f.signatory_type_code==="hr"&&"Recursos Humanos"]}),f.signed&&e.jsxs("p",{className:"text-xs text-green-600 mt-0.5",children:["Firmado por ",f.signed_by_name," - ",new Date(f.signed_at).toLocaleString("es-ES")]})]})]}),!f.signed&&e.jsx("span",{className:"text-xs text-amber-600 px-2 py-1 bg-amber-100 rounded",children:"Pendiente"})]},v))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r.pdf_ready&&e.jsxs(p,{variant:"secondary",onClick:()=>E(r.id),children:[e.jsx(ke,{className:"w-4 h-4"}),"Descargar PDF"]}),e.jsx(p,{onClick:g,children:"Cerrar"})]})]})}function Xe(){const[r,g]=c.useState(!1),[E,d]=c.useState(!1),[N,n]=c.useState(null),[h,l]=c.useState(""),j=Ee(),y=Te(),i=fe();c.useEffect(()=>{y.state?.openNew&&(g(!0),i(y.pathname,{replace:!0,state:{}}))},[y.state,y.pathname,i]);const{data:o,isLoading:L}=je({queryKey:["vacations",{status:h}],queryFn:()=>P.list({status:h||void 0})}),re=M({mutationFn:m=>P.submit(m),onSuccess:()=>{j.invalidateQueries(["vacations"])}}),f=M({mutationFn:m=>P.cancel(m),onSuccess:()=>{j.invalidateQueries(["vacations"])}}),v=M({mutationFn:m=>P.delete(m),onSuccess:()=>{j.invalidateQueries(["vacations"])},onError:m=>{alert(m.response?.data?.error||"Error al eliminar la solicitud")}}),_=M({mutationFn:m=>P.signDocument(m),onSuccess:()=>{j.invalidateQueries(["vacations"]),alert("Documento firmado exitosamente. Ahora puedes enviar la solicitud.")},onError:m=>{const w=m.response?.data?.error||"Error al firmar el documento";m.response?.data?.action_required?.type==="configure_signature"?window.confirm("No tienes firma digital configurada. ¿Deseas configurarla ahora?")&&i("/profile"):alert(w)}}),T=m=>{window.confirm("¿Estás seguro de que deseas eliminar esta solicitud? Esta acción no se puede deshacer.")&&v.mutate(m)},z=m=>{_.mutate(m.id)},$=o?.data?.data||[],U=o?.data?.meta?.vacation_balance||{},W=m=>{n(m),d(!0)},k=async m=>{try{const w=await P.downloadDocument(m),X=new Blob([w.data],{type:"application/pdf"}),oe=window.URL.createObjectURL(X);window.open(oe,"_blank")}catch(w){console.error("Error downloading document:",w),alert("Error al descargar el documento")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Vacaciones"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona tus solicitudes de vacaciones"})]}),e.jsxs(p,{onClick:()=>g(!0),children:[e.jsx(pe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(S,{className:"bg-blue-50 border-blue-200",children:e.jsx(q,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(Ae,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:Math.floor((U.accrued||0)-(U.enjoyed||0))}),e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Días por Contrato"}),e.jsx("p",{className:"text-xs text-blue-500",children:"Acumulados - Disfrutados"})]})]})})}),e.jsx(S,{className:"bg-amber-50 border-amber-200",children:e.jsx(q,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-amber-100 rounded-xl",children:e.jsx(Be,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:Math.floor(U.scheduled||0)}),e.jsx("p",{className:"text-sm text-amber-700 font-medium",children:"Días Programados"}),e.jsx("p",{className:"text-xs text-amber-500",children:"Aprobados sin disfrutar"})]})]})})}),e.jsx(S,{className:"bg-green-50 border-green-300 ring-2 ring-green-200",children:e.jsx(q,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx(pe,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:Math.floor(U.available||0)}),e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Días Vacaciones"}),e.jsx("p",{className:"text-xs text-green-500",children:"Para solicitar"})]})]})})})]}),e.jsx(S,{children:e.jsx(q,{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ze,{className:"w-4 h-4 text-gray-400"}),e.jsx(te,{options:He,value:h,onChange:m=>l(m.target.value),className:"w-48"})]})})}),L?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(m=>e.jsx(S,{className:"animate-pulse",children:e.jsx(q,{className:"p-4",children:e.jsx("div",{className:"h-24 bg-gray-100 rounded"})})},m))}):$.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:$.map(m=>e.jsx(Ke,{vacation:m,onSubmit:w=>re.mutate(w),onCancel:w=>f.mutate(w),onDelete:T,onView:W,onDownload:k,onSign:z},m.id))}):e.jsx(S,{children:e.jsxs(q,{className:"py-12 text-center",children:[e.jsx(Ne,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tienes solicitudes de vacaciones"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Crea tu primera solicitud de vacaciones"}),e.jsxs(p,{onClick:()=>g(!0),children:[e.jsx(pe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})}),e.jsx(ae,{isOpen:r,onClose:()=>g(!1),title:"Nueva Solicitud de Vacaciones",size:"xl",children:e.jsx(Ye,{onClose:()=>g(!1),onSuccess:()=>j.invalidateQueries(["vacations"]),balance:U})}),e.jsx(ae,{isOpen:E,onClose:()=>d(!1),title:"Detalle de Solicitud",size:"xl",children:N&&e.jsx(We,{vacation:N,onClose:()=>d(!1),onDownload:k})})]})}const Je=[{value:"employment",label:"Certificación Laboral Básica"},{value:"salary",label:"Certificación con Salario"},{value:"position",label:"Certificación de Cargo"},{value:"full",label:"Certificación Completa"},{value:"custom",label:"Certificación Personalizada"}],Ze=[{value:"bank",label:"Entidad Bancaria / Crédito"},{value:"visa",label:"Trámite de Visa"},{value:"rental",label:"Arrendamiento / Inmobiliaria"},{value:"government",label:"Trámite Gubernamental"},{value:"legal",label:"Proceso Legal"},{value:"other",label:"Otro"}],es=[{value:"es",label:"Español"},{value:"en",label:"Inglés"}],ss=[{value:"",label:"Todos los estados"},{value:"pending",label:"Pendiente"},{value:"processing",label:"En Proceso"},{value:"completed",label:"Completado"},{value:"rejected",label:"Rechazado"},{value:"cancelled",label:"Cancelado"}],_e={employment:"Certificación Laboral",salary:"Con Salario",position:"Certificación de Cargo",full:"Certificación Completa",custom:"Personalizada"},Me={bank:"Entidad Bancaria",visa:"Trámite de Visa",rental:"Arrendamiento",government:"Trámite Gubernamental",legal:"Proceso Legal",other:"Otro"},Ce={employment:1,salary:2,position:1,full:3,custom:3};function as({onSubmit:r,onCancel:g,loading:E,initialType:d,availableTypes:N}){const n=N?.length>0?N:Je,h=d&&n.find(o=>o.value===d)?d:n[0]?.value||"employment",[l,j]=c.useState({certification_type:h,purpose:"bank",purpose_details:"",language:"es",addressee:"",special_instructions:""});c.useEffect(()=>{d&&n.find(o=>o.value===d)&&j(o=>({...o,certification_type:d}))},[d,n]);const y=o=>{o.preventDefault(),r(l)},i=l.certification_type;return e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx(te,{label:"Tipo de Certificación",options:n,value:l.certification_type,onChange:o=>j({...l,certification_type:o.target.value}),required:!0}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Tiempo estimado: ",Ce[i]," día",Ce[i]>1?"s":""," hábil",Ce[i]>1?"es":""]})]})}),e.jsx(te,{label:"Propósito",options:Ze,value:l.purpose,onChange:o=>j({...l,purpose:o.target.value}),required:!0}),l.purpose==="other"&&e.jsx(ue,{label:"Especifique el propósito",value:l.purpose_details,onChange:o=>j({...l,purpose_details:o.target.value}),placeholder:"Describa el propósito de la certificación...",required:!0}),e.jsx(te,{label:"Idioma",options:es,value:l.language,onChange:o=>j({...l,language:o.target.value})}),e.jsx(ue,{label:"Dirigido a (opcional)",value:l.addressee,onChange:o=>j({...l,addressee:o.target.value}),placeholder:"Ej: A quien corresponda, Banco XYZ, Embajada..."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Instrucciones especiales (opcional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3,value:l.special_instructions,onChange:o=>j({...l,special_instructions:o.target.value}),placeholder:"Información adicional o requisitos especiales..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:g,children:"Cancelar"}),e.jsx(p,{type:"submit",loading:E,children:"Solicitar Certificación"})]})]})}const ts={pending:e.jsx(de,{className:"w-4 h-4 text-yellow-500"}),processing:e.jsx(de,{className:"w-4 h-4 text-blue-500 animate-pulse"}),completed:e.jsx(Y,{className:"w-4 h-4 text-green-500"}),rejected:e.jsx(Q,{className:"w-4 h-4 text-red-500"}),cancelled:e.jsx(be,{className:"w-4 h-4 text-gray-400"})};function rs(){const[r,g]=c.useState(!1),[E,d]=c.useState(!1),[N,n]=c.useState(!1),[h,l]=c.useState(null),[j,y]=c.useState(null),[i,o]=c.useState(null),[L,re]=c.useState(""),[f,v]=c.useState(""),[_,T]=c.useState(null),[z,$]=c.useState(null),[U,W]=c.useState(null),[k,m]=c.useState(null),[w,X]=c.useState(null),[oe,O]=c.useState(null),D=Ee(),G=fe(),le=Te(),{isHR:me,isAdmin:J}=Oe();c.useEffect(()=>{le.state?.openNew&&(g(!0),G(le.pathname,{replace:!0,state:{}}))},[le.state,le.pathname,G]);const{data:ye}=je({queryKey:["certification-available-types"],queryFn:()=>B.getAvailableTypes(),staleTime:300*1e3}),F=ye?.data?.data||[],ve=[{value:"",label:"Todos los tipos"},...F.map(s=>({value:s.value,label:s.label}))],{data:he,isLoading:xe}=je({queryKey:["certifications",{status:L,type:f}],queryFn:()=>B.list({status:L||void 0,type:f||void 0})}),Z=M({mutationFn:s=>B.create(s),onSuccess:()=>{D.invalidateQueries(["certifications"]),g(!1)}}),we=M({mutationFn:s=>B.cancel(s),onSuccess:()=>{D.invalidateQueries(["certifications"])}}),a=M({mutationFn:s=>B.generateDocument(s),onSuccess:()=>{D.invalidateQueries(["certifications"]),T(null)},onError:s=>{console.error("Error generating document:",s),T(null);const u=s.response?.data;u?.error_type==="missing_variables"?(l({message:u.error,missingData:u.missing_data,actions:u.action_required||[]}),n(!0)):alert(u?.error||"Error al generar documento")}}),t=M({mutationFn:s=>B.delete(s),onSuccess:()=>{D.invalidateQueries(["certifications"]),y(null)},onError:s=>{console.error("Error deleting certification:",s),alert(s.response?.data?.error||"Error al eliminar certificación")}}),x=M({mutationFn:s=>B.signDocument(s),onSuccess:s=>{D.invalidateQueries(["certifications"]),W(null);const u=s.data.document;u.all_signed?alert("Documento firmado y completado exitosamente"):alert(`Documento firmado. Firmas pendientes: ${u.pending_signatures.join(", ")}`)},onError:s=>{console.error("Error signing document:",s),W(null);const u=s.response?.data;u?.action_required?.type==="configure_signature"?confirm("No tienes firma digital configurada. ¿Deseas configurarla ahora?")&&G("/profile"):alert(u?.error||"Error al firmar documento")}}),b=he?.data?.data||[],R=s=>{o(s),d(!0)},H=async s=>{T(s),a.mutate(s)},A=async s=>{try{$(s.id);const u=await B.downloadDocument(s.id),V=new Blob([u.data],{type:"application/pdf"}),ee=URL.createObjectURL(V),se=document.createElement("a");se.href=ee,se.download=`${s.request_number}.pdf`,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(ee)}catch(u){console.error("Error downloading document:",u),alert("Error al descargar documento")}finally{$(null)}},I=async s=>{try{X(s.id);const u=await B.downloadDocument(s.id),V=new Blob([u.data],{type:"application/pdf"}),ee=URL.createObjectURL(V);m(ee)}catch(u){console.error("Error previewing document:",u);const V=u.response?.data;V?.error?alert(V.error):alert("Error al previsualizar documento")}finally{X(null)}},C=()=>{k&&URL.revokeObjectURL(k),m(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Certificaciones"}),e.jsx("p",{className:"text-gray-500",children:"Solicita certificaciones laborales para distintos trámites"})]}),e.jsxs(p,{onClick:()=>g(!0),disabled:F.length===0,title:F.length===0?"No hay tipos de certificación disponibles":"",children:[e.jsx(pe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]}),e.jsx(S,{children:e.jsx(q,{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ze,{className:"w-4 h-4 text-gray-400"}),e.jsx(te,{options:ss,value:L,onChange:s=>re(s.target.value),className:"w-48"}),e.jsx(te,{options:ve,value:f,onChange:s=>v(s.target.value),className:"w-56"})]})})}),F.length>0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[F.find(s=>s.value==="employment")&&e.jsx(S,{className:"bg-blue-50 border-blue-200 cursor-pointer hover:shadow-md hover:border-blue-300 transition-all",onClick:()=>{O("employment"),g(!0)},children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Certificación Laboral"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Confirma tu vínculo laboral actual"})]})]})})}),F.find(s=>s.value==="salary")&&e.jsx(S,{className:"bg-green-50 border-green-200 cursor-pointer hover:shadow-md hover:border-green-300 transition-all",onClick:()=>{O("salary"),g(!0)},children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Con Información Salarial"}),e.jsx("p",{className:"text-sm text-green-700",children:"Incluye detalles de tu compensación"})]})]})})}),F.find(s=>s.value==="full")&&e.jsx(S,{className:"bg-purple-50 border-purple-200 cursor-pointer hover:shadow-md hover:border-purple-300 transition-all",onClick:()=>{O("full"),g(!0)},children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-purple-900",children:"Certificación Completa"}),e.jsx("p",{className:"text-sm text-purple-700",children:"Incluye toda tu información laboral"})]})]})})}),F.find(s=>s.value==="position")&&e.jsx(S,{className:"bg-amber-50 border-amber-200 cursor-pointer hover:shadow-md hover:border-amber-300 transition-all",onClick:()=>{O("position"),g(!0)},children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-8 h-8 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"Certificación de Cargo"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Detalla cargo y responsabilidades"})]})]})})}),F.find(s=>s.value==="custom")&&e.jsx(S,{className:"bg-gray-50 border-gray-200 cursor-pointer hover:shadow-md hover:border-gray-300 transition-all",onClick:()=>{O("custom"),g(!0)},children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-8 h-8 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Certificación Personalizada"}),e.jsx("p",{className:"text-sm text-gray-700",children:"Contenido según necesidad"})]})]})})})]}):e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{className:"w-6 h-6 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"No hay tipos de certificación disponibles"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Contacta al administrador para configurar los templates de certificación."})]})]})}),e.jsxs(S,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-fixed",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[15%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"w-[18%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"w-[17%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Propósito"}),e.jsx("th",{className:"w-[12%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"w-[10%] px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Días"}),e.jsx("th",{className:"w-[13%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"w-[15%] px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:xe?[...Array(3)].map((s,u)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-28"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8 mx-auto"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16 mx-auto"})})]},u)):b.length>0?b.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"text-sm font-mono text-primary-600 bg-primary-50 px-2 py-0.5 rounded",children:s.request_number})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:_e[s.certification_type]||s.certification_type})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600 truncate block",children:Me[s.purpose]||s.purpose})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[ts[s.status],e.jsx(ie,{status:s.status})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm text-gray-600",children:s.estimated_days})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"short"})})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>R(s),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 rounded transition-colors",title:"Ver detalle",children:e.jsx(ge,{className:"w-4 h-4"})}),(me||J)&&s.status==="pending"&&!s.document_uuid&&e.jsx("button",{onClick:()=>H(s.id),disabled:_===s.id,className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:opacity-50",title:"Generar documento",children:_===s.id?e.jsx(ne,{className:"w-4 h-4 animate-spin"}):e.jsx($e,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.can_download&&e.jsx("button",{onClick:()=>I(s),disabled:w===s.id,className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:opacity-50",title:"Previsualizar",children:w===s.id?e.jsx(ne,{className:"w-4 h-4 animate-spin"}):e.jsx(ge,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.can_download&&e.jsx("button",{onClick:()=>A(s),disabled:z===s.id,className:"p-1.5 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded transition-colors disabled:opacity-50",title:"Descargar",children:z===s.id?e.jsx(ne,{className:"w-4 h-4 animate-spin"}):e.jsx(qe,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.pending_signatures?.length>0&&(me||J)&&e.jsx("button",{onClick:()=>{W(s.id),x.mutate(s.id)},disabled:U===s.id,className:"p-1.5 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors disabled:opacity-50",title:`Firmar documento (Pendiente: ${s.document_info?.pending_signatures?.join(", ")})`,children:U===s.id?e.jsx(ne,{className:"w-4 h-4 animate-spin"}):e.jsx(ce,{className:"w-4 h-4"})}),s.document_uuid&&!s.document_info?.can_download&&!(me||J)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs text-amber-700 bg-amber-50 rounded",title:`Pendiente: ${s.document_info?.pending_signatures?.join(", ")}`,children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Firma pendiente"]}),["pending","processing"].includes(s.status)&&!J&&e.jsx("button",{onClick:()=>we.mutate(s.id),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Cancelar",children:e.jsx(be,{className:"w-4 h-4"})}),J&&e.jsx("button",{onClick:()=>y(s),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Eliminar",children:e.jsx(Se,{className:"w-4 h-4"})})]})})]},s.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-4 py-12 text-center",children:[e.jsx(K,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-base font-medium text-gray-900 mb-1",children:"No tienes solicitudes de certificaciones"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Solicita una certificación laboral para tus trámites"}),e.jsxs(p,{size:"sm",onClick:()=>g(!0),disabled:F.length===0,children:[e.jsx(pe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})})})]})}),b.length>0&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("p",{className:"text-sm text-gray-500",children:[b.length," solicitud",b.length!==1?"es":""]})})]}),e.jsx(ae,{isOpen:r,onClose:()=>{g(!1),O(null)},title:"Nueva Solicitud de Certificación",size:"lg",children:e.jsx(as,{onSubmit:s=>Z.mutate(s),onCancel:()=>{g(!1),O(null)},loading:Z.isPending,initialType:oe,availableTypes:F})}),e.jsx(ae,{isOpen:E,onClose:()=>d(!1),title:"Detalle de Certificación",size:"md",children:i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Número:"}),e.jsx("span",{className:"font-medium",children:i.request_number})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(ie,{status:i.status})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("span",{children:_e[i.certification_type]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Propósito:"}),e.jsx("span",{children:Me[i.purpose]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Tiempo estimado:"}),e.jsxs("span",{children:[i.estimated_days," día",i.estimated_days>1?"s":""," hábil",i.estimated_days>1?"es":""]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha solicitud:"}),e.jsx("span",{children:new Date(i.created_at).toLocaleDateString("es-ES")})]}),i.language&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Idioma:"}),e.jsx("span",{children:i.language==="es"?"Español":"Inglés"})]}),i.status==="completed"&&i.completed_at&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha completado:"}),e.jsx("span",{className:"text-green-600 font-medium",children:new Date(i.completed_at).toLocaleDateString("es-ES")})]}),i.status==="rejected"&&i.rejection_reason&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"Motivo de rechazo:"}),e.jsx("p",{className:"text-red-700",children:i.rejection_reason})]}),i.processed_by&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Procesado por:"}),e.jsx("p",{className:"text-gray-600",children:i.processed_by.name})]}),i.document_uuid&&i.document_info?.can_download&&e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsxs(p,{className:"w-full",variant:"primary",onClick:()=>I(i),loading:w===i.id,children:[e.jsx(ge,{className:"w-4 h-4"}),"Previsualizar Documento"]}),e.jsxs(p,{className:"w-full",variant:"secondary",onClick:()=>A(i),loading:z===i.id,children:[e.jsx(qe,{className:"w-4 h-4"}),"Descargar Certificación"]})]})]})}),e.jsx(ae,{isOpen:N,onClose:()=>n(!1),title:"No se puede generar el documento",size:"md",children:h&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(De,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Información faltante"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:h.message})]})]}),h.missingData?.by_source?.employee?.length>0&&e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-amber-800 mb-2",children:"Datos del empleado requeridos:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-amber-700 space-y-1",children:h.missingData.by_source.employee.map((s,u)=>e.jsx("li",{children:s.field_label||s.field},u))})]}),h.missingData?.by_source?.organization?.length>0&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-2",children:"Datos de la organización requeridos:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-blue-700 space-y-1",children:h.missingData.by_source.organization.map((s,u)=>e.jsx("li",{children:s.field_label||s.field},u))})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t",children:[h.actions?.map((s,u)=>e.jsxs(p,{variant:u===0?"primary":"secondary",className:"w-full justify-center",onClick:()=>{n(!1),s.type==="edit_employee"&&s.employee_id?G(`/hr/employees?edit=${s.employee_id}`):s.type==="edit_organization"?G("/admin/organization"):s.type==="configure_mappings"&&G("/admin/variable-mappings")},children:[e.jsx(Fe,{className:"w-4 h-4"}),s.label,s.employee_name&&` (${s.employee_name})`]},u)),e.jsx(p,{variant:"ghost",className:"w-full justify-center",onClick:()=>n(!1),children:"Cerrar"})]})]})}),e.jsx(ae,{isOpen:!!j,onClose:()=>y(null),title:"Eliminar Certificación",size:"sm",children:j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(De,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"¿Eliminar esta certificación?"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Esta acción no se puede deshacer. Se eliminará permanentemente la solicitud"," ",e.jsx("strong",{children:j.request_number}),"."]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("span",{className:"font-medium",children:_e[j.certification_type]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(ie,{status:j.status})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(p,{variant:"ghost",className:"flex-1",onClick:()=>y(null),children:"Cancelar"}),e.jsxs(p,{variant:"danger",className:"flex-1",loading:t.isPending,onClick:()=>t.mutate(j.id),children:[e.jsx(Se,{className:"w-4 h-4"}),"Eliminar"]})]})]})}),e.jsx(ae,{isOpen:!!k,onClose:C,title:"Previsualización de Documento",size:"full",children:e.jsxs("div",{className:"flex flex-col h-[80vh]",children:[k&&e.jsx("iframe",{src:k,className:"w-full flex-1 border rounded-lg bg-gray-100",title:"Vista previa del documento"}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t mt-4",children:e.jsxs(p,{variant:"secondary",onClick:C,children:[e.jsx(be,{className:"w-4 h-4"}),"Cerrar"]})})]})})]})}const ls=[{id:"vacations",name:"Vacaciones",icon:Ne,path:"/hr/my-requests/vacations"},{id:"certifications",name:"Certificaciones",icon:Ge,path:"/hr/my-requests/certifications"}];function bs(){const{tab:r}=Ue(),g=fe();if(!r)return e.jsx(Pe,{to:"/hr/my-requests/vacations",replace:!0});if(!["vacations","certifications"].includes(r))return e.jsx(Pe,{to:"/hr/my-requests/vacations",replace:!0});const d=r;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:ls.map(N=>{const n=N.icon,h=d===N.id;return e.jsxs("button",{onClick:()=>g(N.path),className:`
                  group inline-flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm
                  ${h?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx(n,{className:`w-5 h-5 ${h?"text-primary-500":"text-gray-400 group-hover:text-gray-500"}`}),N.name]},N.id)})})}),e.jsxs("div",{children:[d==="vacations"&&e.jsx(Xe,{}),d==="certifications"&&e.jsx(rs,{})]})]})}export{bs as default};
