import{b as ee,u as T,c as D,j as e}from"./vendor-query-BtlmzfbD.js";import{r as o}from"./vendor-router-CyR0tpch.js";import{b as f,c as P}from"./index-5OztEUYJ.js";import{C as m,c as x}from"./Card-CVFC4agM.js";import{B as r}from"./Button-Dg2kNfoC.js";import{B as G}from"./Badge-Cv3EzJhT.js";import{M as Q}from"./Modal-C9cDBtd4.js";import{o as B,a4 as V,r as R,A as k,J as O,g as se,F as U,D as ae,m as te,a5 as ie}from"./vendor-icons-BXQn8V43.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";function $({request:t,type:c,onApprove:N,onReject:l,onView:v,showActions:n=!0}){const a=c==="vacation",p=a?R:k;return e.jsx(m,{className:"hover:shadow-md transition-shadow",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${a?"bg-blue-50":"bg-purple-50"}`,children:e.jsx(p,{className:`w-6 h-6 ${a?"text-blue-600":"text-purple-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.employee?.name||"Empleado"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.employee?.department," • ",t.employee?.job_title]})]}),e.jsx(G,{status:t.status})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Solicitud:"})," ",t.request_number]}),a?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",t.vacation_type]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Fechas:"})," ",new Date(t.start_date).toLocaleDateString("es-ES")," -"," ",new Date(t.end_date).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsxs("p",{className:"text-sm font-medium text-primary-600",children:[Math.floor(t.days_requested)," días solicitados"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium text-green-600",children:Math.floor(t.employee?.available_vacation_days||0)})," días disponibles"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," Certificación ",t.certification_type]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Propósito:"})," ",t.purpose]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Tiempo estimado: ",t.estimated_days," días"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>v(t,c),children:[e.jsx(te,{className:"w-4 h-4"}),"Detalle"]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1"}),e.jsxs(r,{variant:"danger",size:"sm",onClick:()=>l(t,c),children:[e.jsx(ie,{className:"w-4 h-4"}),"Rechazar"]}),e.jsxs(r,{variant:"success",size:"sm",onClick:()=>N(t,c),children:[e.jsx(O,{className:"w-4 h-4"}),"Aprobar"]})]})]})]})]})})})}function je(){const[t,c]=o.useState("pending"),[N,l]=o.useState(!1),[v,n]=o.useState(!1),[a,p]=o.useState(null),[g,F]=o.useState(null),[b,A]=o.useState(""),h=ee(),{data:H,isLoading:K}=T({queryKey:["approvals","pending"],queryFn:()=>f.list({status:"pending"})}),{data:I,isLoading:J}=T({queryKey:["approvals","history"],queryFn:()=>f.list({status:"history"}),enabled:t==="history"}),X=D({mutationFn:({id:s})=>f.approve(s,{}),onSuccess:()=>{h.invalidateQueries(["approvals"]),h.invalidateQueries(["approvals-count"])}}),z=D({mutationFn:({id:s,reason:i})=>f.reject(s,i),onSuccess:()=>{h.invalidateQueries(["approvals"]),h.invalidateQueries(["approvals-count"]),l(!1),A("")}}),E=D({mutationFn:s=>P.generateDocument(s),onSuccess:s=>{h.invalidateQueries(["approvals"]),alert("Documento generado exitosamente"),s.data?.data?.certification&&p(i=>({...i,document_uuid:s.data.data.certification.document_uuid,status:s.data.data.certification.status}))},onError:s=>{alert(s.response?.data?.error||"Error al generar documento")}}),W=async s=>{try{const i=await P.downloadDocument(s),Z=new Blob([i.data],{type:"application/pdf"}),q=window.URL.createObjectURL(Z),u=document.createElement("a");u.href=q,u.download=`certificacion-${s}.pdf`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(q)}catch(i){alert(i.response?.data?.error||"Error al descargar documento")}},j=H?.data?.data||{vacation_requests:[],certification_requests:[]},w=I?.data?.data||{vacation_requests:[],certification_requests:[]},C=(j.vacation_requests?.length||0)+(j.certification_requests?.length||0),M=(w.vacation_requests?.length||0)+(w.certification_requests?.length||0),_=(s,i)=>{window.confirm("¿Estás seguro de aprobar esta solicitud?")&&X.mutate({id:s.id,type:i})},S=(s,i)=>{p(s),F(i),l(!0)},L=(s,i)=>{p(s),F(i),n(!0)},Y=()=>{if(!b.trim()){alert("Debes proporcionar un motivo de rechazo");return}z.mutate({id:a.id,reason:b})},d=t==="pending"?j:w,y=t==="pending"?K:J;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Aprobaciones"}),e.jsx("p",{className:"text-gray-500",children:"Administra las solicitudes de vacaciones y certificaciones"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>c("pending"),className:`py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${t==="pending"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(B,{className:"w-4 h-4"}),"Pendientes",C>0&&e.jsx("span",{className:"bg-danger-500 text-white text-xs px-2 py-0.5 rounded-full",children:C})]}),e.jsxs("button",{onClick:()=>c("history"),className:`py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${t==="history"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(V,{className:"w-4 h-4"}),"Historial",t==="history"&&M>0&&e.jsx("span",{className:"bg-gray-200 text-gray-700 text-xs px-2 py-0.5 rounded-full",children:M})]})]})}),t==="pending"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"p-3 bg-yellow-50 rounded-xl",children:e.jsx(B,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Pendientes"})]})]})}),e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-xl",children:e.jsx(R,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.vacation_requests?.length||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"Vacaciones"})]})]})}),e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-xl",children:e.jsx(k,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.certification_requests?.length||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"Certificaciones"})]})]})})]}),y&&e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(m,{className:"animate-pulse",children:e.jsx(x,{className:"p-4",children:e.jsx("div",{className:"h-24 bg-gray-100 rounded"})})},s))}),!y&&d.vacation_requests?.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-blue-600"}),"Solicitudes de Vacaciones"]}),e.jsx("div",{className:"space-y-4",children:d.vacation_requests.map(s=>e.jsx($,{request:s,type:"vacation",onApprove:_,onReject:S,onView:L,showActions:t==="pending"},s.id))})]}),!y&&d.certification_requests?.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-purple-600"}),"Solicitudes de Certificación"]}),e.jsx("div",{className:"space-y-4",children:d.certification_requests.map(s=>e.jsx($,{request:s,type:"certification",onApprove:_,onReject:S,onView:L,showActions:t==="pending"},s.id))})]}),!y&&d.vacation_requests?.length===0&&d.certification_requests?.length===0&&e.jsx(m,{children:e.jsx(x,{className:"py-12 text-center",children:t==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-16 h-16 mx-auto text-green-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"¡Todo al día!"}),e.jsx("p",{className:"text-gray-500",children:"No tienes solicitudes pendientes de aprobación"})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sin historial"}),e.jsx("p",{className:"text-gray-500",children:"Aún no hay solicitudes procesadas"})]})})}),e.jsx(Q,{isOpen:N,onClose:()=>l(!1),title:"Rechazar Solicitud",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600",children:["Por favor, proporciona el motivo del rechazo para la solicitud"," ",e.jsx("span",{className:"font-medium",children:a?.request_number}),"."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo del Rechazo *"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:4,value:b,onChange:s=>A(s.target.value),placeholder:"Explica el motivo del rechazo...",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(r,{variant:"secondary",onClick:()=>l(!1),children:"Cancelar"}),e.jsx(r,{variant:"danger",onClick:Y,loading:z.isPending,children:"Confirmar Rechazo"})]})]})}),e.jsx(Q,{isOpen:v,onClose:()=>n(!1),title:"Detalle de Solicitud",size:"lg",children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:a.employee?.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.employee?.department," • ",a.employee?.job_title]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Número de Solicitud"}),e.jsx("p",{className:"font-medium",children:a.request_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Estado"}),e.jsx(G,{status:a.status})]}),g==="vacation"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tipo"}),e.jsx("p",{className:"font-medium",children:a.vacation_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Días Solicitados"}),e.jsx("p",{className:"font-medium text-primary-600",children:a.days_requested})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fecha Inicio"}),e.jsx("p",{className:"font-medium",children:new Date(a.start_date).toLocaleDateString("es-ES")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Fecha Fin"}),e.jsx("p",{className:"font-medium",children:new Date(a.end_date).toLocaleDateString("es-ES")})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tipo de Certificación"}),e.jsx("p",{className:"font-medium",children:a.certification_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Propósito"}),e.jsx("p",{className:"font-medium",children:a.purpose})]})]})]}),a.reason&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Motivo"}),e.jsx("p",{className:"p-3 bg-gray-50 rounded-lg text-gray-700",children:a.reason})]}),a.status==="pending"&&e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(r,{variant:"secondary",onClick:()=>n(!1),children:"Cerrar"}),e.jsx(r,{variant:"danger",onClick:()=>{n(!1),S(a,g)},children:"Rechazar"}),e.jsx(r,{variant:"success",onClick:()=>{n(!1),_(a,g)},children:"Aprobar"})]}),a.status!=="pending"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[g==="certification"&&a.status==="approved"&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Generacion de Documento"]}),a.document_uuid?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Documento generado"}),e.jsxs(r,{size:"sm",onClick:()=>W(a.id),children:[e.jsx(ae,{className:"w-4 h-4"}),"Descargar PDF"]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Genera el documento de certificacion para el empleado"}),e.jsxs(r,{size:"sm",onClick:()=>E.mutate(a.id),loading:E.isPending,children:[e.jsx(U,{className:"w-4 h-4"}),"Generar Documento"]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(r,{variant:"secondary",onClick:()=>n(!1),children:"Cerrar"})})]})]})})]})}export{je as default};
