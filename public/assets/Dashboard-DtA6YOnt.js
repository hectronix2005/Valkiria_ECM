import{u as w,j as e}from"./vendor-query-BtlmzfbD.js";import{a as ee,r as E,L as l}from"./vendor-router-CyR0tpch.js";import{u as se,P as ae,g as V,v as te,c as re,b as ie,d as ne}from"./index-CF4M424s.js";import{C as p,a as j,b as v,c as g}from"./Card-CVFC4agM.js";import{B as L}from"./Badge-CLufSCSl.js";import{B as c}from"./Button-C8xCGhNf.js";import{M as ce}from"./Modal-it_GQaMG.js";import{t as C,o as le,j as B,A as S,u as k,p as P,F as oe,U as de,v as u,P as $,D as xe,w as I,m as me}from"./vendor-icons-BMeEPn6p.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";function f({title:a,value:r,icon:i,color:x,subtitle:d,href:n,onClick:t}){const m={blue:"bg-blue-50 text-blue-600",green:"bg-green-50 text-green-600",yellow:"bg-yellow-50 text-yellow-600",purple:"bg-purple-50 text-purple-600",indigo:"bg-indigo-50 text-indigo-600",orange:"bg-orange-50 text-orange-600"},o=e.jsx(p,{className:n||t?"cursor-pointer hover:shadow-md transition-shadow":"",children:e.jsxs(g,{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${m[x]}`,children:e.jsx(i,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r}),e.jsx("p",{className:"text-sm text-gray-500",children:a}),d&&e.jsx("p",{className:"text-xs text-gray-400",children:d})]}),(n||t)&&e.jsx(u,{className:"w-4 h-4 text-gray-400"})]})});return n?e.jsx(l,{to:n,children:o}):t?e.jsx("div",{onClick:t,children:o}):o}function y({title:a,description:r,icon:i,href:x,color:d,onClick:n,state:t}){const m={blue:"bg-blue-500 hover:bg-blue-600",green:"bg-green-500 hover:bg-green-600",purple:"bg-purple-500 hover:bg-purple-600",indigo:"bg-indigo-500 hover:bg-indigo-600",orange:"bg-orange-500 hover:bg-orange-600"},o=e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-8 h-8"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:a}),e.jsx("p",{className:"text-sm opacity-80",children:r})]}),e.jsx(u,{className:"w-5 h-5"})]});return n?e.jsx("button",{onClick:n,className:`flex items-center gap-4 p-4 rounded-xl text-white transition-colors ${m[d]} w-full text-left`,children:o}):e.jsx(l,{to:x,state:t,className:`flex items-center gap-4 p-4 rounded-xl text-white transition-colors ${m[d]}`,children:o})}function G({request:a,type:r}){const i=r==="vacation",x=i?C:S;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg",children:e.jsx(x,{className:"w-4 h-4 text-gray-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:i?`${a.days_requested} días`:a.certification_type}),e.jsx("p",{className:"text-xs text-gray-500",children:a.request_number})]}),e.jsx(L,{status:a.status})]})}function he({document:a,onPreview:r,onSign:i}){a.signatures?.filter(n=>n.status==="pending")?.length;const x=a.signatures?.filter(n=>n.status==="signed")?.length||0,d=a.signatures?.length||0;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-amber-50 rounded-lg border border-amber-100",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg",children:e.jsx(k,{className:"w-4 h-4 text-amber-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[x,"/",d," firmas completadas"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>r(a),children:e.jsx(me,{className:"w-4 h-4"})}),a.can_sign&&e.jsxs(c,{variant:"primary",size:"sm",onClick:()=>i(a),children:[e.jsx(I,{className:"w-4 h-4"}),"Firmar"]})]})]})}function pe({contract:a}){return e.jsxs(l,{to:"/legal/contracts",className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg",children:e.jsx(P,{className:"w-4 h-4 text-indigo-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500",children:a.third_party?.name||"Sin tercero"})]}),e.jsx(L,{status:a.status})]})}function Se(){const{user:a,isHR:r,isSupervisor:i,isAdmin:x,hasPermission:d}=se(),n=ee(),[t,m]=E.useState(null),[o,M]=E.useState(null),[H,O]=E.useState(!1),N=d("legal")||d("contracts")||a?.permissions?.some(s=>s.level>=ae.LEGAL)||x,{data:Q}=w({queryKey:["vacations","recent"],queryFn:()=>te.list({per_page:5})}),{data:T}=w({queryKey:["certifications","recent"],queryFn:()=>re.list({per_page:5})}),{data:J}=w({queryKey:["approvals"],queryFn:()=>ie.list(),enabled:r||i}),{data:W}=w({queryKey:["pending-signatures"],queryFn:()=>V.pendingSignatures()}),{data:X}=w({queryKey:["contracts","recent"],queryFn:()=>ne.list({per_page:5}),enabled:N}),R=Q?.data?.data||[],A=T?.data?.data||[],q=J?.data?.data||{vacation_requests:[],certification_requests:[]},_=W?.data?.data||[],F=X?.data?.data||[],U=(q.vacation_requests?.length||0)+(q.certification_requests?.length||0),Y=async s=>{m(s),O(!0);try{const b=await V.download(s.id),D=new Blob([b.data],{type:"application/pdf"}),h=URL.createObjectURL(D);M(h)}catch(b){console.error("Error loading preview:",b)}finally{O(!1)}},z=()=>{o&&URL.revokeObjectURL(o),m(null),M(null)},K=s=>{n(`/documents/${s.id}/sign`)},Z=async()=>{if(t)try{const s=await V.download(t.id),b=new Blob([s.data],{type:"application/pdf"}),D=URL.createObjectURL(b),h=window.document.createElement("a");h.href=D,h.download=t.file_name||`${t.name}.pdf`,window.document.body.appendChild(h),h.click(),window.document.body.removeChild(h),URL.revokeObjectURL(D)}catch(s){console.error("Error downloading:",s)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Bienvenid@, ",a?.first_name]}),e.jsx("p",{className:"text-gray-500",children:"Aquí tienes un resumen de tu actividad"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(f,{title:"Días de vacaciones",value:Math.floor(a?.vacation?.days_available??0),icon:C,color:"blue",subtitle:a?.vacation?.days_pending>a?.vacation?.days_available?`${Math.floor(a?.vacation?.days_pending)} pendientes`:"Disponibles",href:"/hr/my-requests/vacations"}),e.jsx(f,{title:"Solicitudes pendientes",value:R.filter(s=>s.status==="pending").length,icon:le,color:"yellow",href:"/hr/my-requests/vacations"}),(r||i)&&e.jsx(f,{title:"Por aprobar",value:U,icon:B,color:"green",href:"/hr/approvals"}),e.jsx(f,{title:"Certificaciones",value:A.filter(s=>s.status==="completed").length,icon:S,color:"purple",subtitle:"Completadas",href:"/hr/my-requests/certifications"}),_.length>0&&e.jsx(f,{title:"Firmas pendientes",value:_.length,icon:k,color:"orange",subtitle:"Documentos por firmar",href:"/documents"}),N&&e.jsx(f,{title:"Contratos",value:F.length,icon:P,color:"indigo",subtitle:"Activos",href:"/legal/contracts"})]}),e.jsxs(p,{children:[e.jsx(j,{children:e.jsx(v,{children:"Acciones Rápidas"})}),e.jsx(g,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[e.jsx(y,{title:"Nueva Solicitud de Vacaciones",description:"Solicita días libres",icon:C,href:"/hr/my-requests/vacations",state:{openNew:!0},color:"blue"}),e.jsx(y,{title:"Solicitar Certificación",description:"Certificado laboral",icon:S,href:"/hr/my-requests/certifications",state:{openNew:!0},color:"green"}),e.jsx(y,{title:"Mis Documentos",description:"Ver y firmar documentos",icon:oe,href:"/documents",color:"purple"}),N&&e.jsx(y,{title:"Gestión de Contratos",description:"Contratos y terceros",icon:P,href:"/legal/contracts",color:"indigo"}),(r||i)&&e.jsx(y,{title:"Aprobar Solicitudes",description:`${U} pendientes`,icon:B,href:"/hr/approvals",color:"orange"}),r&&e.jsx(y,{title:"Gestión de Empleados",description:"Administrar personal",icon:de,href:"/hr/employees",color:"blue"})]})})]}),_.length>0&&e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-amber-500"}),"Documentos Pendientes de tu Firma"]}),e.jsx(l,{to:"/documents",children:e.jsxs(c,{variant:"ghost",size:"sm",children:["Ver todos",e.jsx(u,{className:"w-4 h-4 ml-1"})]})})]}),e.jsx(g,{children:e.jsx("div",{className:"space-y-2",children:_.slice(0,5).map(s=>e.jsx(he,{document:s,onPreview:Y,onSign:K},s.id))})})]}),e.jsxs("div",{className:`grid grid-cols-1 ${N?"lg:grid-cols-3":"lg:grid-cols-2"} gap-6`,children:[e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(v,{children:"Mis Solicitudes de Vacaciones"}),e.jsx(l,{to:"/hr/my-requests/vacations",children:e.jsxs(c,{variant:"ghost",size:"sm",children:["Ver todas",e.jsx(u,{className:"w-4 h-4 ml-1"})]})})]}),e.jsx(g,{children:R.length>0?e.jsx("div",{className:"space-y-2",children:R.slice(0,5).map(s=>e.jsx(G,{request:s,type:"vacation"},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(C,{className:"w-12 h-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No tienes solicitudes de vacaciones"}),e.jsx(l,{to:"/hr/my-requests/vacations",children:e.jsxs(c,{variant:"primary",size:"sm",className:"mt-4",children:[e.jsx($,{className:"w-4 h-4"}),"Nueva Solicitud"]})})]})})]}),r||i?e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(v,{children:"Pendientes de Aprobación"}),e.jsx(l,{to:"/hr/approvals",children:e.jsxs(c,{variant:"ghost",size:"sm",children:["Ver todas",e.jsx(u,{className:"w-4 h-4 ml-1"})]})})]}),e.jsx(g,{children:U>0?e.jsxs("div",{className:"space-y-2",children:[q.vacation_requests?.slice(0,3).map(s=>e.jsxs(l,{to:"/hr/approvals",className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-lg border border-yellow-100 hover:bg-yellow-100 transition-colors",children:[e.jsx(C,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.employee?.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.days_requested," días"]})]}),e.jsx(L,{status:"pending"})]},s.id)),q.certification_requests?.slice(0,2).map(s=>e.jsxs(l,{to:"/hr/approvals",className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-lg border border-yellow-100 hover:bg-yellow-100 transition-colors",children:[e.jsx(S,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.employee?.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Certificación ",s.certification_type]})]}),e.jsx(L,{status:"pending"})]},s.id))]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(B,{className:"w-12 h-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No hay solicitudes pendientes"})]})})]}):e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(v,{children:"Mis Certificaciones"}),e.jsx(l,{to:"/hr/my-requests/certifications",children:e.jsxs(c,{variant:"ghost",size:"sm",children:["Ver todas",e.jsx(u,{className:"w-4 h-4 ml-1"})]})})]}),e.jsx(g,{children:A.length>0?e.jsx("div",{className:"space-y-2",children:A.slice(0,5).map(s=>e.jsx(G,{request:s,type:"certification"},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(S,{className:"w-12 h-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No tienes certificaciones solicitadas"}),e.jsx(l,{to:"/hr/my-requests/certifications",children:e.jsxs(c,{variant:"primary",size:"sm",className:"mt-4",children:[e.jsx($,{className:"w-4 h-4"}),"Nueva Certificación"]})})]})})]}),N&&e.jsxs(p,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsx(v,{children:"Contratos Recientes"}),e.jsx(l,{to:"/legal/contracts",children:e.jsxs(c,{variant:"ghost",size:"sm",children:["Ver todos",e.jsx(u,{className:"w-4 h-4 ml-1"})]})})]}),e.jsx(g,{children:F.length>0?e.jsx("div",{className:"space-y-2",children:F.slice(0,5).map(s=>e.jsx(pe,{contract:s},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No hay contratos recientes"}),e.jsx(l,{to:"/legal/contracts",children:e.jsxs(c,{variant:"primary",size:"sm",className:"mt-4",children:[e.jsx($,{className:"w-4 h-4"}),"Nuevo Contrato"]})})]})})]})]}),e.jsx(ce,{isOpen:!!t,onClose:z,title:t?.name||"Vista Previa",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[H?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):o?e.jsx("iframe",{src:o,className:"w-full h-[70vh] border rounded-lg",title:"Document Preview"}):e.jsx("div",{className:"flex items-center justify-center h-96 text-gray-500",children:"No se pudo cargar el documento"}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-500",children:t?.signatures&&e.jsxs("span",{children:[t.signatures.filter(s=>s.status==="signed").length,"/",t.signatures.length," firmas completadas"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"secondary",onClick:Z,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Descargar"]}),t?.can_sign&&e.jsxs(c,{variant:"primary",onClick:()=>{z(),K(t)},children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Firmar Documento"]}),e.jsx(c,{variant:"ghost",onClick:z,children:"Cerrar"})]})]})]})})]})}export{Se as default};
