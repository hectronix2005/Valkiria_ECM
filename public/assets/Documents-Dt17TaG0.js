import{u as fe,a as Ne,b as ie,j as e}from"./vendor-query-2ZprUnmA.js";import{r as i}from"./vendor-router-CyR0tpch.js";import{u as ve,g as o}from"./index-2EkhUpJ2.js";import{C as b,c as C}from"./Card-DbNYCSnq.js";import{B as n}from"./Button-C7qsOZ-2.js";import{M as z}from"./Modal-5XVQlMCF.js";import{a7 as we,Q as de,V as U,F as q,m as be,e as Ce,X as ce,an as T,h as _e,q as De,n as ke,D as oe,Z as _,a8 as Se,j as Ee,p as Fe,af as Le,ag as Pe,ah as ze}from"./vendor-icons-7sl6YsZj.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const d={draft:{label:"Borrador",color:"bg-gray-100 text-gray-700",icon:q},pending_signatures:{label:"Pendiente de firmas",color:"bg-amber-100 text-amber-700",icon:U},completed:{label:"Completado",color:"bg-green-100 text-green-700",icon:de},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-700",icon:we}},M={contract:"Contrato",certification:"Certificación",vacation:"Vacaciones",other:"Otro"};function Ve(){const{isAdmin:O}=ve(),D=fe(),[m,R]=i.useState(1),[a,g]=i.useState(null),[me,x]=i.useState(!1),[xe,j]=i.useState(!1),[k,y]=i.useState(null),[A,B]=i.useState(null),[f,Q]=i.useState(""),[N,V]=i.useState(""),[v,$]=i.useState(""),[S,ue]=i.useState("created_at"),[E,I]=i.useState("desc"),{data:X,isLoading:K,isError:he}=Ne({queryKey:["generated-documents",m],queryFn:()=>o.list({page:m,per_page:20})}),[Z,G]=i.useState(null),[u,H]=i.useState(null),[J,W]=i.useState(null),pe=ie({mutationFn:s=>o.sign(s),onSuccess:()=>{D.invalidateQueries(["generated-documents"]),D.invalidateQueries(["pending-signatures"]),x(!1),g(null),alert("Documento firmado exitosamente")},onError:s=>{alert(s.response?.data?.error||"Error al firmar el documento")},onSettled:()=>G(null)}),Y=ie({mutationFn:s=>o.delete(s),onSuccess:()=>{D.invalidateQueries(["generated-documents"]),j(!1),y(null),x(!1),g(null)},onError:s=>{alert(s.response?.data?.error||"Error al eliminar el documento")}}),ee=s=>{window.confirm("¿Firmar este documento?")&&(G(s.id),pe.mutate(s.id))},se=async s=>{try{W(s.id);const t=await o.download(s.id),r=new Blob([t.data],{type:"application/pdf"}),l=URL.createObjectURL(r);H(l)}catch(t){alert("Error al previsualizar el documento"),console.error("Preview error:",t)}finally{W(null)}},te=()=>{u&&URL.revokeObjectURL(u),H(null)},F=X?.data?.data||[],ae=X?.data?.meta||{},w=ae.total_pages||1,L=F.filter(s=>{if(f){const t=f.toLowerCase(),r=(s.name||"").toLowerCase().includes(t),l=(s.employee_name||s.requested_by||"").toLowerCase().includes(t),c=(s.template_name||"").toLowerCase().includes(t);if(!r&&!l&&!c)return!1}return!(N&&s.status!==N||v&&s.template_category!==v)}).sort((s,t)=>{let r,l;switch(S){case"employee_name":r=(s.employee_name||s.requested_by||"").toLowerCase(),l=(t.employee_name||t.requested_by||"").toLowerCase();break;case"template_name":r=(s.template_name||"").toLowerCase(),l=(t.template_name||"").toLowerCase();break;case"template_category":r=M[s.template_category]||s.template_category||"",l=M[t.template_category]||t.template_category||"";break;case"status":r=d[s.status]?.label||s.status||"",l=d[t.status]?.label||t.status||"";break;case"created_at":r=s.created_at?new Date(s.created_at).getTime():0,l=t.created_at?new Date(t.created_at).getTime():0;break;default:r=s.created_at?new Date(s.created_at).getTime():0,l=t.created_at?new Date(t.created_at).getTime():0}return r<l?E==="asc"?-1:1:r>l?E==="asc"?1:-1:0}),h=s=>{S===s?I(t=>t==="asc"?"desc":"asc"):(ue(s),I("asc"))},ge=()=>{Q(""),V(""),$("")},re=f||N||v,p=({column:s})=>S!==s?e.jsx(Le,{className:"w-3 h-3 text-gray-400"}):E==="asc"?e.jsx(Pe,{className:"w-3 h-3 text-primary-600"}):e.jsx(ze,{className:"w-3 h-3 text-primary-600"}),je=async s=>{g(s),x(!0);try{const t=await o.get(s.id);g(t.data?.data||s)}catch(t){console.error("Error fetching document detail:",t)}},le=s=>{y(s),j(!0)},ye=()=>{k&&Y.mutate(k.id)},ne=async s=>{try{B(s.id);const t=await o.download(s.id),r=new Blob([t.data],{type:"application/pdf"}),l=window.URL.createObjectURL(r),c=window.document.createElement("a");c.href=l,c.download=s.file_name||`${s.name}.pdf`,window.document.body.appendChild(c),c.click(),window.document.body.removeChild(c),window.URL.revokeObjectURL(l)}catch(t){alert("Error al descargar el documento"),console.error("Download error:",t)}finally{B(null)}},P=s=>s?new Date(s).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return K?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Documentos"})}),e.jsx(b,{children:e.jsx(C,{className:"p-8",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))})})})]}):he?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Documentos"})}),e.jsx(b,{children:e.jsxs(C,{className:"p-8 text-center",children:[e.jsx(be,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Error al cargar los documentos"})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Documentos"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Documentos generados desde templates"})]})}),e.jsx(b,{children:e.jsxs(C,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por empleado, documento...",value:f,onChange:s=>Q(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsxs("select",{value:N,onChange:s=>V(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"draft",children:"Borrador"}),e.jsx("option",{value:"pending_signatures",children:"Pendiente de firmas"}),e.jsx("option",{value:"completed",children:"Completado"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]}),e.jsxs("select",{value:v,onChange:s=>$(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Tipo de documento"}),e.jsx("option",{value:"contract",children:"Contrato"}),e.jsx("option",{value:"certification",children:"Certificación"}),e.jsx("option",{value:"vacation",children:"Vacaciones"}),e.jsx("option",{value:"other",children:"Otro"})]}),re&&e.jsxs("button",{onClick:ge,className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg flex items-center gap-1",children:[e.jsx(ce,{className:"w-4 h-4"}),"Limpiar"]})]}),!K&&F.length>0&&e.jsxs("div",{className:"mt-3 text-sm text-gray-500",children:["Mostrando ",e.jsx("strong",{children:L.length})," de ",e.jsx("strong",{children:F.length})," documentos"]})]})}),e.jsx(b,{children:e.jsx(C,{className:"p-0",children:L.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(T,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay documentos"}),e.jsx("p",{className:"text-gray-500",children:re?"No se encontraron documentos con los filtros aplicados":"Los documentos generados desde templates apareceran aqui"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>h("employee_name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Empleado",e.jsx(p,{column:"employee_name"})]})}),e.jsx("th",{onClick:()=>h("template_name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Documento",e.jsx(p,{column:"template_name"})]})}),e.jsx("th",{onClick:()=>h("template_category"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Tipo",e.jsx(p,{column:"template_category"})]})}),e.jsx("th",{onClick:()=>h("created_at"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Fecha Creación",e.jsx(p,{column:"created_at"})]})}),e.jsx("th",{onClick:()=>h("status"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Estado",e.jsx(p,{column:"status"})]})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:L.map(s=>{const t=d[s.status]||d.draft,r=t.icon;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(_e,{className:"w-4 h-4 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:s.employee_name||s.requested_by||"-"}),s.employee_number&&e.jsx("p",{className:"text-xs text-gray-500",children:s.employee_number})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-900",children:s.name}),s.template_name&&e.jsx("p",{className:"text-xs text-gray-500",children:s.template_name})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 rounded text-xs text-gray-700",children:[e.jsx(De,{className:"w-3 h-3"}),M[s.template_category]||s.template_category||"Otro"]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600",children:P(s.created_at)}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${t.color}`,children:[e.jsx(r,{className:"w-3.5 h-3.5"}),t.label]})}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>je(s),title:"Ver detalles",children:e.jsx(ke,{className:"w-4 h-4"})}),s.pdf_ready&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>se(s),loading:J===s.id,title:"Previsualizar PDF",className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:e.jsx(T,{className:"w-4 h-4"})}),s.can_sign&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>ee(s),loading:Z===s.id,title:"Firmar documento",className:"text-purple-600 hover:text-purple-700 hover:bg-purple-50",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>ne(s),loading:A===s.id,title:"Descargar PDF",children:e.jsx(oe,{className:"w-4 h-4"})}),O&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>le(s),title:"Eliminar documento",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(_,{className:"w-4 h-4"})})]})})]},s.id)})})]})})})}),w>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Pagina ",m," de ",w," (",ae.total_count," documentos)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"secondary",size:"sm",onClick:()=>R(s=>Math.max(1,s-1)),disabled:m===1,children:[e.jsx(Se,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs(n,{variant:"secondary",size:"sm",onClick:()=>R(s=>Math.min(w,s+1)),disabled:m===w,children:["Siguiente",e.jsx(Ee,{className:"w-4 h-4"})]})]})]}),e.jsx(z,{isOpen:me,onClose:()=>x(!1),title:"Detalle del Documento",size:"lg",children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.name}),a.template_name&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Template: ",a.template_name]})]})]}),e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium ${d[a.status]?.color||"bg-gray-100 text-gray-700"}`,children:d[a.status]?.label||a.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Creado"}),e.jsx("p",{className:"text-sm font-medium",children:P(a.created_at)})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Solicitado por"}),e.jsx("p",{className:"text-sm font-medium",children:a.requested_by||"-"})]}),a.file_name&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg col-span-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Archivo"}),e.jsx("p",{className:"text-sm font-medium",children:a.file_name})]})]}),a.status==="pending_signatures"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Firmas"}),e.jsx("div",{className:"space-y-2",children:(a.signatures||[]).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="signed"?e.jsx(de,{className:"w-4 h-4 text-green-500"}):e.jsx(Fe,{className:"w-4 h-4 text-amber-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.signatory_label||s.label}),e.jsx("p",{className:"text-xs text-gray-500",children:s.status==="signed"?`Firmado por ${s.signed_by_name||"-"}`:s.user_name||"Pendiente"})]})]}),s.signed_at&&e.jsx("span",{className:"text-xs text-gray-400",children:P(s.signed_at)})]},t))})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx("div",{children:O&&e.jsxs(n,{variant:"danger",onClick:()=>le(a),children:[e.jsx(_,{className:"w-4 h-4"}),"Eliminar"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{variant:"secondary",onClick:()=>x(!1),children:"Cerrar"}),a.can_sign&&e.jsxs(n,{onClick:()=>ee(a),loading:Z===a.id,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(U,{className:"w-4 h-4"}),"Firmar"]}),e.jsxs(n,{variant:"secondary",onClick:()=>se(a),loading:J===a.id,children:[e.jsx(T,{className:"w-4 h-4"}),"Previsualizar"]}),e.jsxs(n,{onClick:()=>ne(a),loading:A===a.id,children:[e.jsx(oe,{className:"w-4 h-4"}),"Descargar PDF"]})]})]})]})}),e.jsx(z,{isOpen:xe,onClose:()=>{j(!1),y(null)},title:"Confirmar eliminacion",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 rounded-lg",children:[e.jsx(_,{className:"w-8 h-8 text-red-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Esta seguro que desea eliminar el documento:"}),e.jsx("p",{className:"font-medium text-gray-900 mt-1",children:k?.name})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Esta accion no se puede deshacer. El archivo PDF sera eliminado permanentemente."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(n,{variant:"secondary",onClick:()=>{j(!1),y(null)},children:"Cancelar"}),e.jsxs(n,{variant:"danger",onClick:ye,loading:Y.isPending,children:[e.jsx(_,{className:"w-4 h-4"}),"Eliminar"]})]})]})}),e.jsx(z,{isOpen:!!u,onClose:te,title:"Previsualización de Documento",size:"full",children:e.jsxs("div",{className:"flex flex-col h-[80vh]",children:[u&&e.jsx("iframe",{src:u,className:"w-full flex-1 border rounded-lg bg-gray-100",title:"Vista previa del documento"}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t mt-4",children:e.jsxs(n,{variant:"secondary",onClick:te,children:[e.jsx(ce,{className:"w-4 h-4"}),"Cerrar"]})})]})})]})}export{Ve as default};
