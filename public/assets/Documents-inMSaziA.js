import{b as re,u as le,c as ne,j as e}from"./vendor-query-BtlmzfbD.js";import{r as n}from"./vendor-router-CyR0tpch.js";import{u as ce,g as S}from"./index-6Qpfv-KC.js";import{C as N,c as v}from"./Card-CVFC4agM.js";import{B as c}from"./Button-Cc42oWsS.js";import{M as K}from"./Modal-CNSDagQP.js";import{a5 as ie,I as oe,J as de,F as L,l as me,e as xe,X as ue,am as pe,g as he,s as ge,m as je,D as W,W as w,a6 as ye,i as fe,ad as Ne,ae as ve,af as we}from"./vendor-icons-YtD_Ipmm.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const o={draft:{label:"Borrador",color:"bg-gray-100 text-gray-700",icon:L},pending_signatures:{label:"Pendiente de firmas",color:"bg-amber-100 text-amber-700",icon:de},completed:{label:"Completado",color:"bg-green-100 text-green-700",icon:oe},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-700",icon:ie}},E={contract:"Contrato",certification:"Certificación",vacation:"Vacaciones",other:"Otro"};function Te(){const{isAdmin:F}=ce(),G=re(),[d,T]=n.useState(1),[a,M]=n.useState(null),[H,u]=n.useState(!1),[Y,p]=n.useState(!1),[b,h]=n.useState(null),[q,P]=n.useState(null),[g,A]=n.useState(""),[j,B]=n.useState(""),[y,O]=n.useState(""),[C,Z]=n.useState("created_at"),[_,z]=n.useState("desc"),{data:R,isLoading:U,isError:ee}=le({queryKey:["generated-documents",d],queryFn:()=>S.list({page:d,per_page:20})}),V=ne({mutationFn:s=>S.delete(s),onSuccess:()=>{G.invalidateQueries(["generated-documents"]),p(!1),h(null),u(!1),M(null)},onError:s=>{alert(s.response?.data?.error||"Error al eliminar el documento")}}),D=R?.data?.data||[],Q=R?.data?.meta||{},f=Q.total_pages||1,k=D.filter(s=>{if(g){const t=g.toLowerCase(),r=(s.name||"").toLowerCase().includes(t),l=(s.employee_name||s.requested_by||"").toLowerCase().includes(t),i=(s.template_name||"").toLowerCase().includes(t);if(!r&&!l&&!i)return!1}return!(j&&s.status!==j||y&&s.template_category!==y)}).sort((s,t)=>{let r,l;switch(C){case"employee_name":r=(s.employee_name||s.requested_by||"").toLowerCase(),l=(t.employee_name||t.requested_by||"").toLowerCase();break;case"template_name":r=(s.template_name||"").toLowerCase(),l=(t.template_name||"").toLowerCase();break;case"template_category":r=E[s.template_category]||s.template_category||"",l=E[t.template_category]||t.template_category||"";break;case"status":r=o[s.status]?.label||s.status||"",l=o[t.status]?.label||t.status||"";break;case"created_at":r=s.created_at?new Date(s.created_at).getTime():0,l=t.created_at?new Date(t.created_at).getTime():0;break;default:r=s.created_at?new Date(s.created_at).getTime():0,l=t.created_at?new Date(t.created_at).getTime():0}return r<l?_==="asc"?-1:1:r>l?_==="asc"?1:-1:0}),m=s=>{C===s?z(t=>t==="asc"?"desc":"asc"):(Z(s),z("asc"))},se=()=>{A(""),B(""),O("")},I=g||j||y,x=({column:s})=>C!==s?e.jsx(Ne,{className:"w-3 h-3 text-gray-400"}):_==="asc"?e.jsx(ve,{className:"w-3 h-3 text-primary-600"}):e.jsx(we,{className:"w-3 h-3 text-primary-600"}),te=s=>{M(s),u(!0)},$=s=>{h(s),p(!0)},ae=()=>{b&&V.mutate(b.id)},X=async s=>{try{P(s.id);const t=await S.download(s.id),r=new Blob([t.data],{type:"application/pdf"}),l=window.URL.createObjectURL(r),i=window.document.createElement("a");i.href=l,i.download=s.file_name||`${s.name}.pdf`,window.document.body.appendChild(i),i.click(),window.document.body.removeChild(i),window.URL.revokeObjectURL(l)}catch(t){alert("Error al descargar el documento"),console.error("Download error:",t)}finally{P(null)}},J=s=>s?new Date(s).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return U?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Documentos"})}),e.jsx(N,{children:e.jsx(v,{className:"p-8",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))})})})]}):ee?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Documentos"})}),e.jsx(N,{children:e.jsxs(v,{className:"p-8 text-center",children:[e.jsx(me,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Error al cargar los documentos"})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Documentos"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Documentos generados desde templates"})]})}),e.jsx(N,{children:e.jsxs(v,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por empleado, documento...",value:g,onChange:s=>A(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsxs("select",{value:j,onChange:s=>B(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"draft",children:"Borrador"}),e.jsx("option",{value:"pending_signatures",children:"Pendiente de firmas"}),e.jsx("option",{value:"completed",children:"Completado"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]}),e.jsxs("select",{value:y,onChange:s=>O(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Tipo de documento"}),e.jsx("option",{value:"contract",children:"Contrato"}),e.jsx("option",{value:"certification",children:"Certificación"}),e.jsx("option",{value:"vacation",children:"Vacaciones"}),e.jsx("option",{value:"other",children:"Otro"})]}),I&&e.jsxs("button",{onClick:se,className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg flex items-center gap-1",children:[e.jsx(ue,{className:"w-4 h-4"}),"Limpiar"]})]}),!U&&D.length>0&&e.jsxs("div",{className:"mt-3 text-sm text-gray-500",children:["Mostrando ",e.jsx("strong",{children:k.length})," de ",e.jsx("strong",{children:D.length})," documentos"]})]})}),e.jsx(N,{children:e.jsx(v,{className:"p-0",children:k.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(pe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay documentos"}),e.jsx("p",{className:"text-gray-500",children:I?"No se encontraron documentos con los filtros aplicados":"Los documentos generados desde templates apareceran aqui"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>m("employee_name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Empleado",e.jsx(x,{column:"employee_name"})]})}),e.jsx("th",{onClick:()=>m("template_name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Documento",e.jsx(x,{column:"template_name"})]})}),e.jsx("th",{onClick:()=>m("template_category"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Tipo",e.jsx(x,{column:"template_category"})]})}),e.jsx("th",{onClick:()=>m("created_at"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Fecha Creación",e.jsx(x,{column:"created_at"})]})}),e.jsx("th",{onClick:()=>m("status"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Estado",e.jsx(x,{column:"status"})]})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:k.map(s=>{const t=o[s.status]||o.draft,r=t.icon;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(he,{className:"w-4 h-4 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:s.employee_name||s.requested_by||"-"}),s.employee_number&&e.jsx("p",{className:"text-xs text-gray-500",children:s.employee_number})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-900",children:s.name}),s.template_name&&e.jsx("p",{className:"text-xs text-gray-500",children:s.template_name})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 rounded text-xs text-gray-700",children:[e.jsx(ge,{className:"w-3 h-3"}),E[s.template_category]||s.template_category||"Otro"]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600",children:J(s.created_at)}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${t.color}`,children:[e.jsx(r,{className:"w-3.5 h-3.5"}),t.label]})}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>te(s),title:"Ver detalles",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>X(s),loading:q===s.id,title:"Descargar PDF",children:e.jsx(W,{className:"w-4 h-4"})}),F&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>$(s),title:"Eliminar documento",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(w,{className:"w-4 h-4"})})]})})]},s.id)})})]})})})}),f>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Pagina ",d," de ",f," (",Q.total_count," documentos)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>T(s=>Math.max(1,s-1)),disabled:d===1,children:[e.jsx(ye,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>T(s=>Math.min(f,s+1)),disabled:d===f,children:["Siguiente",e.jsx(fe,{className:"w-4 h-4"})]})]})]}),e.jsx(K,{isOpen:H,onClose:()=>u(!1),title:"Detalle del Documento",size:"lg",children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.name}),a.template_name&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Template: ",a.template_name]})]})]}),e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium ${o[a.status]?.color||"bg-gray-100 text-gray-700"}`,children:o[a.status]?.label||a.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Creado"}),e.jsx("p",{className:"text-sm font-medium",children:J(a.created_at)})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Solicitado por"}),e.jsx("p",{className:"text-sm font-medium",children:a.requested_by||"-"})]}),a.file_name&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg col-span-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Archivo"}),e.jsx("p",{className:"text-sm font-medium",children:a.file_name})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx("div",{children:F&&e.jsxs(c,{variant:"danger",onClick:()=>$(a),children:[e.jsx(w,{className:"w-4 h-4"}),"Eliminar"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(c,{variant:"secondary",onClick:()=>u(!1),children:"Cerrar"}),e.jsxs(c,{onClick:()=>X(a),loading:q===a.id,children:[e.jsx(W,{className:"w-4 h-4"}),"Descargar PDF"]})]})]})]})}),e.jsx(K,{isOpen:Y,onClose:()=>{p(!1),h(null)},title:"Confirmar eliminacion",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 rounded-lg",children:[e.jsx(w,{className:"w-8 h-8 text-red-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Esta seguro que desea eliminar el documento:"}),e.jsx("p",{className:"font-medium text-gray-900 mt-1",children:b?.name})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Esta accion no se puede deshacer. El archivo PDF sera eliminado permanentemente."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(c,{variant:"secondary",onClick:()=>{p(!1),h(null)},children:"Cancelar"}),e.jsxs(c,{variant:"danger",onClick:ae,loading:V.isPending,children:[e.jsx(w,{className:"w-4 h-4"}),"Eliminar"]})]})]})})]})}export{Te as default};
