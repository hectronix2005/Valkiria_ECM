import{b as me,u as xe,c as Z,j as e}from"./vendor-query-BtlmzfbD.js";import{r as l}from"./vendor-router-CyR0tpch.js";import{u as ue,g as p}from"./index-CcQ4VEwy.js";import{C as w,c as b}from"./Card-CVFC4agM.js";import{B as i}from"./Button-C8xCGhNf.js";import{M as ee}from"./Modal-it_GQaMG.js";import{a6 as pe,O as te,Q as M,F as q,l as he,e as ge,X as je,am as ye,g as fe,p as Ne,m as ve,D as se,Y as C,a7 as we,i as be,o as Ce,ae as _e,af as De,ag as Se}from"./vendor-icons-BMeEPn6p.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const o={draft:{label:"Borrador",color:"bg-gray-100 text-gray-700",icon:q},pending_signatures:{label:"Pendiente de firmas",color:"bg-amber-100 text-amber-700",icon:M},completed:{label:"Completado",color:"bg-green-100 text-green-700",icon:te},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-700",icon:pe}},T={contract:"Contrato",certification:"Certificación",vacation:"Vacaciones",other:"Otro"};function Oe(){const{isAdmin:P}=ue(),_=me(),[d,A]=l.useState(1),[a,h]=l.useState(null),[ae,m]=l.useState(!1),[re,g]=l.useState(!1),[D,j]=l.useState(null),[O,z]=l.useState(null),[y,B]=l.useState(""),[f,Q]=l.useState(""),[N,R]=l.useState(""),[S,ne]=l.useState("created_at"),[k,U]=l.useState("desc"),{data:V,isLoading:$,isError:le}=xe({queryKey:["generated-documents",d],queryFn:()=>p.list({page:d,per_page:20})}),[I,X]=l.useState(null),ie=Z({mutationFn:s=>p.sign(s),onSuccess:()=>{_.invalidateQueries(["generated-documents"]),_.invalidateQueries(["pending-signatures"]),m(!1),h(null),alert("Documento firmado exitosamente")},onError:s=>{alert(s.response?.data?.error||"Error al firmar el documento")},onSettled:()=>X(null)}),K=Z({mutationFn:s=>p.delete(s),onSuccess:()=>{_.invalidateQueries(["generated-documents"]),g(!1),j(null),m(!1),h(null)},onError:s=>{alert(s.response?.data?.error||"Error al eliminar el documento")}}),Y=s=>{window.confirm("¿Firmar este documento?")&&(X(s.id),ie.mutate(s.id))},E=V?.data?.data||[],G=V?.data?.meta||{},v=G.total_pages||1,F=E.filter(s=>{if(y){const t=y.toLowerCase(),r=(s.name||"").toLowerCase().includes(t),n=(s.employee_name||s.requested_by||"").toLowerCase().includes(t),c=(s.template_name||"").toLowerCase().includes(t);if(!r&&!n&&!c)return!1}return!(f&&s.status!==f||N&&s.template_category!==N)}).sort((s,t)=>{let r,n;switch(S){case"employee_name":r=(s.employee_name||s.requested_by||"").toLowerCase(),n=(t.employee_name||t.requested_by||"").toLowerCase();break;case"template_name":r=(s.template_name||"").toLowerCase(),n=(t.template_name||"").toLowerCase();break;case"template_category":r=T[s.template_category]||s.template_category||"",n=T[t.template_category]||t.template_category||"";break;case"status":r=o[s.status]?.label||s.status||"",n=o[t.status]?.label||t.status||"";break;case"created_at":r=s.created_at?new Date(s.created_at).getTime():0,n=t.created_at?new Date(t.created_at).getTime():0;break;default:r=s.created_at?new Date(s.created_at).getTime():0,n=t.created_at?new Date(t.created_at).getTime():0}return r<n?k==="asc"?-1:1:r>n?k==="asc"?1:-1:0}),x=s=>{S===s?U(t=>t==="asc"?"desc":"asc"):(ne(s),U("asc"))},ce=()=>{B(""),Q(""),R("")},H=y||f||N,u=({column:s})=>S!==s?e.jsx(_e,{className:"w-3 h-3 text-gray-400"}):k==="asc"?e.jsx(De,{className:"w-3 h-3 text-primary-600"}):e.jsx(Se,{className:"w-3 h-3 text-primary-600"}),oe=async s=>{h(s),m(!0);try{const t=await p.get(s.id);h(t.data?.data||s)}catch(t){console.error("Error fetching document detail:",t)}},J=s=>{j(s),g(!0)},de=()=>{D&&K.mutate(D.id)},W=async s=>{try{z(s.id);const t=await p.download(s.id),r=new Blob([t.data],{type:"application/pdf"}),n=window.URL.createObjectURL(r),c=window.document.createElement("a");c.href=n,c.download=s.file_name||`${s.name}.pdf`,window.document.body.appendChild(c),c.click(),window.document.body.removeChild(c),window.URL.revokeObjectURL(n)}catch(t){alert("Error al descargar el documento"),console.error("Download error:",t)}finally{z(null)}},L=s=>s?new Date(s).toLocaleDateString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return $?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Documentos"})}),e.jsx(w,{children:e.jsx(b,{className:"p-8",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))})})})]}):le?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Documentos"})}),e.jsx(w,{children:e.jsxs(b,{className:"p-8 text-center",children:[e.jsx(he,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Error al cargar los documentos"})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Documentos"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Documentos generados desde templates"})]})}),e.jsx(w,{children:e.jsxs(b,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por empleado, documento...",value:y,onChange:s=>B(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsxs("select",{value:f,onChange:s=>Q(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"draft",children:"Borrador"}),e.jsx("option",{value:"pending_signatures",children:"Pendiente de firmas"}),e.jsx("option",{value:"completed",children:"Completado"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]}),e.jsxs("select",{value:N,onChange:s=>R(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Tipo de documento"}),e.jsx("option",{value:"contract",children:"Contrato"}),e.jsx("option",{value:"certification",children:"Certificación"}),e.jsx("option",{value:"vacation",children:"Vacaciones"}),e.jsx("option",{value:"other",children:"Otro"})]}),H&&e.jsxs("button",{onClick:ce,className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg flex items-center gap-1",children:[e.jsx(je,{className:"w-4 h-4"}),"Limpiar"]})]}),!$&&E.length>0&&e.jsxs("div",{className:"mt-3 text-sm text-gray-500",children:["Mostrando ",e.jsx("strong",{children:F.length})," de ",e.jsx("strong",{children:E.length})," documentos"]})]})}),e.jsx(w,{children:e.jsx(b,{className:"p-0",children:F.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(ye,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay documentos"}),e.jsx("p",{className:"text-gray-500",children:H?"No se encontraron documentos con los filtros aplicados":"Los documentos generados desde templates apareceran aqui"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>x("employee_name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Empleado",e.jsx(u,{column:"employee_name"})]})}),e.jsx("th",{onClick:()=>x("template_name"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Documento",e.jsx(u,{column:"template_name"})]})}),e.jsx("th",{onClick:()=>x("template_category"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Tipo",e.jsx(u,{column:"template_category"})]})}),e.jsx("th",{onClick:()=>x("created_at"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Fecha Creación",e.jsx(u,{column:"created_at"})]})}),e.jsx("th",{onClick:()=>x("status"),className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 select-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Estado",e.jsx(u,{column:"status"})]})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:F.map(s=>{const t=o[s.status]||o.draft,r=t.icon;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(fe,{className:"w-4 h-4 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:s.employee_name||s.requested_by||"-"}),s.employee_number&&e.jsx("p",{className:"text-xs text-gray-500",children:s.employee_number})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-900",children:s.name}),s.template_name&&e.jsx("p",{className:"text-xs text-gray-500",children:s.template_name})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 rounded text-xs text-gray-700",children:[e.jsx(Ne,{className:"w-3 h-3"}),T[s.template_category]||s.template_category||"Otro"]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-600",children:L(s.created_at)}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${t.color}`,children:[e.jsx(r,{className:"w-3.5 h-3.5"}),t.label]})}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>oe(s),title:"Ver detalles",children:e.jsx(ve,{className:"w-4 h-4"})}),s.can_sign&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>Y(s),loading:I===s.id,title:"Firmar documento",className:"text-purple-600 hover:text-purple-700 hover:bg-purple-50",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>W(s),loading:O===s.id,title:"Descargar PDF",children:e.jsx(se,{className:"w-4 h-4"})}),P&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>J(s),title:"Eliminar documento",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(C,{className:"w-4 h-4"})})]})})]},s.id)})})]})})})}),v>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Pagina ",d," de ",v," (",G.total_count," documentos)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"secondary",size:"sm",onClick:()=>A(s=>Math.max(1,s-1)),disabled:d===1,children:[e.jsx(we,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs(i,{variant:"secondary",size:"sm",onClick:()=>A(s=>Math.min(v,s+1)),disabled:d===v,children:["Siguiente",e.jsx(be,{className:"w-4 h-4"})]})]})]}),e.jsx(ee,{isOpen:ae,onClose:()=>m(!1),title:"Detalle del Documento",size:"lg",children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.name}),a.template_name&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Template: ",a.template_name]})]})]}),e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium ${o[a.status]?.color||"bg-gray-100 text-gray-700"}`,children:o[a.status]?.label||a.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Creado"}),e.jsx("p",{className:"text-sm font-medium",children:L(a.created_at)})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Solicitado por"}),e.jsx("p",{className:"text-sm font-medium",children:a.requested_by||"-"})]}),a.file_name&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg col-span-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Archivo"}),e.jsx("p",{className:"text-sm font-medium",children:a.file_name})]})]}),a.status==="pending_signatures"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Firmas"}),e.jsx("div",{className:"space-y-2",children:(a.signatures||[]).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="signed"?e.jsx(te,{className:"w-4 h-4 text-green-500"}):e.jsx(Ce,{className:"w-4 h-4 text-amber-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.signatory_label||s.label}),e.jsx("p",{className:"text-xs text-gray-500",children:s.status==="signed"?`Firmado por ${s.signed_by_name||"-"}`:s.user_name||"Pendiente"})]})]}),s.signed_at&&e.jsx("span",{className:"text-xs text-gray-400",children:L(s.signed_at)})]},t))})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx("div",{children:P&&e.jsxs(i,{variant:"danger",onClick:()=>J(a),children:[e.jsx(C,{className:"w-4 h-4"}),"Eliminar"]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{variant:"secondary",onClick:()=>m(!1),children:"Cerrar"}),a.can_sign&&e.jsxs(i,{onClick:()=>Y(a),loading:I===a.id,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(M,{className:"w-4 h-4"}),"Firmar"]}),e.jsxs(i,{onClick:()=>W(a),loading:O===a.id,children:[e.jsx(se,{className:"w-4 h-4"}),"Descargar PDF"]})]})]})]})}),e.jsx(ee,{isOpen:re,onClose:()=>{g(!1),j(null)},title:"Confirmar eliminacion",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 rounded-lg",children:[e.jsx(C,{className:"w-8 h-8 text-red-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Esta seguro que desea eliminar el documento:"}),e.jsx("p",{className:"font-medium text-gray-900 mt-1",children:D?.name})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Esta accion no se puede deshacer. El archivo PDF sera eliminado permanentemente."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(i,{variant:"secondary",onClick:()=>{g(!1),j(null)},children:"Cancelar"}),e.jsxs(i,{variant:"danger",onClick:de,loading:K.isPending,children:[e.jsx(C,{className:"w-4 h-4"}),"Eliminar"]})]})]})})]})}export{Oe as default};
