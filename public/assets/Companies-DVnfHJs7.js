import{b as S,u as q,c as j,j as e}from"./vendor-query-BtlmzfbD.js";import{r as o}from"./vendor-router-CyR0tpch.js";import{i as d}from"./index-Mzey8L91.js";import{C as b,c as v}from"./Card-CVFC4agM.js";import{B as g}from"./Button-C8xCGhNf.js";import{I as C}from"./Input-DPOK3q6H.js";import{P as w,e as D,B as E,ao as F,ap as L,aq as T,Y as B,X as P,l as A,Z as I}from"./vendor-icons-BMeEPn6p.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";function $({company:l,isOpen:N,onClose:r}){const m=S(),i=!!l,[t,x]=o.useState({name:l?.name||"",nit:l?.nit||""}),[u,n]=o.useState(""),p=j({mutationFn:s=>d.create(s),onSuccess:()=>{m.invalidateQueries(["companies"]),r()},onError:s=>{n(s.response?.data?.error||s.response?.data?.errors?.join(", ")||"Error al crear compañía")}}),h=j({mutationFn:s=>d.update(l.id,s),onSuccess:()=>{m.invalidateQueries(["companies"]),r()},onError:s=>{n(s.response?.data?.error||s.response?.data?.errors?.join(", ")||"Error al actualizar compañía")}}),f=s=>{if(s.preventDefault(),n(""),!t.name.trim()){n("El nombre es requerido");return}i?h.mutate(t):p.mutate(t)};return N?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:i?"Editar Compañía":"Nueva Compañía"}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:f,className:"p-4 space-y-4",children:[u&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:u})]}),e.jsx(C,{label:"Nombre",value:t.name,onChange:s=>x({...t,name:s.target.value}),placeholder:"Ej: Mi Empresa S.A.S.",required:!0}),e.jsx(C,{label:"NIT",value:t.nit,onChange:s=>x({...t,nit:s.target.value}),placeholder:"Ej: 900123456-7"}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(g,{type:"button",variant:"secondary",onClick:r,children:"Cancelar"}),e.jsxs(g,{type:"submit",loading:p.isPending||h.isPending,children:[e.jsx(I,{className:"w-4 h-4"}),i?"Guardar Cambios":"Crear Compañía"]})]})]})]})}):null}function J(){const l=S(),[N,r]=o.useState(!1),[m,i]=o.useState(null),[t,x]=o.useState(""),{data:u,isLoading:n}=q({queryKey:["companies"],queryFn:()=>d.list()}),p=j({mutationFn:a=>d.delete(a),onSuccess:()=>l.invalidateQueries(["companies"]),onError:a=>{alert(a.response?.data?.error||"Error al eliminar")}}),h=j({mutationFn:({id:a,active:Q})=>d.update(a,{active:Q}),onSuccess:()=>l.invalidateQueries(["companies"])}),f=a=>{i(a),r(!0)},s=a=>{h.mutate({id:a.id,active:!a.active})},M=a=>{confirm(`¿Está seguro de eliminar la compañía "${a.name}"?`)&&p.mutate(a.id)},k=()=>{r(!1),i(null)},c=u?.data?.data||[],y=t?c.filter(a=>a.name.toLowerCase().includes(t.toLowerCase())||a.nit&&a.nit.toLowerCase().includes(t.toLowerCase())):c;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Compañías"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona las compañías disponibles para asociar a plantillas"})]}),e.jsxs(g,{onClick:()=>r(!0),children:[e.jsx(w,{className:"w-4 h-4"}),"Nueva Compañía"]})]}),e.jsx(b,{children:e.jsx(v,{className:"p-4",children:e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar compañías...",value:t,onChange:a=>x(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})})})}),e.jsx(b,{children:e.jsx(v,{className:"p-0",children:n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay compañías"}),e.jsx("p",{className:"text-gray-500 mb-4",children:c.length===0?"Crea tu primera compañía para asociarla a plantillas":"No se encontraron compañías con los filtros aplicados"}),c.length===0&&e.jsxs(g,{onClick:()=>r(!0),children:[e.jsx(w,{className:"w-4 h-4"}),"Crear Compañía"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nombre"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NIT"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:y.map(a=>e.jsxs("tr",{className:`${a.active?"":"opacity-50 bg-gray-50"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-primary-500"}),e.jsx("span",{className:"font-medium",children:a.name})]})}),e.jsx("td",{className:"px-4 py-3",children:a.nit?e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:a.nit}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>s(a),className:`p-1 rounded ${a.active?"text-green-600":"text-gray-400"}`,title:a.active?"Desactivar":"Activar",children:a.active?e.jsx(F,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>f(a),className:"p-1.5 hover:bg-gray-100 rounded text-gray-600",title:"Editar",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(a),className:"p-1.5 hover:bg-red-50 rounded text-red-500",title:"Eliminar",children:e.jsx(B,{className:"w-4 h-4"})})]})})]},a.id))})]})})})}),c.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["Mostrando ",y.length," de ",c.length," compañías"]}),e.jsx($,{company:m,isOpen:N,onClose:k})]})}export{J as default};
