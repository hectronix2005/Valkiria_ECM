import{b as Q,u as $,c as u,j as e}from"./vendor-query-BtlmzfbD.js";import{r as d}from"./vendor-router-CyR0tpch.js";import{k as c}from"./index-D5WmqZkX.js";import{B as r}from"./Button-C8xCGhNf.js";import{I as w}from"./Input-DPOK3q6H.js";import{M as C}from"./Modal-it_GQaMG.js";import{B as E}from"./Badge-CLufSCSl.js";import{B as m,P as h,U as D,O as S,e as z,aq as A,Y as I,l as O}from"./vendor-icons-BMeEPn6p.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";function X(){const[t,k]=d.useState(""),[_,n]=d.useState(!1),[s,l]=d.useState(null),[x,o]=d.useState(""),[g,i]=d.useState(""),p=Q(),{data:j,isLoading:q}=$({queryKey:["departments"],queryFn:()=>c.list()}),N=u({mutationFn:a=>c.create({name:a}),onSuccess:()=>{p.invalidateQueries(["departments"]),n(!1),o(""),i("")},onError:a=>{i(a.response?.data?.error||"Error al crear departamento")}}),y=u({mutationFn:({id:a,name:P})=>c.update(a,{name:P}),onSuccess:()=>{p.invalidateQueries(["departments"]),l(null)},onError:a=>{alert(a.response?.data?.error||"Error al actualizar departamento")}}),B=u({mutationFn:a=>c.delete(a),onSuccess:()=>{p.invalidateQueries(["departments"])},onError:a=>{alert(a.response?.data?.error||"Error al eliminar departamento")}}),b=j?.data?.data||[],f=j?.data?.meta||{},v=b.filter(a=>a.name.toLowerCase().includes(t.toLowerCase())||a.code.toLowerCase().includes(t.toLowerCase())),M=a=>{a.preventDefault(),x.trim()&&N.mutate(x.trim())},F=a=>{a.preventDefault(),s&&s.newName?.trim()&&y.mutate({id:s.id,name:s.newName.trim()})},L=a=>{if(a.employee_count>0){alert(`No se puede eliminar "${a.name}" porque tiene ${a.employee_count} empleados asignados.`);return}confirm(`¿Estás seguro de eliminar el departamento "${a.name}"?`)&&B.mutate(a.id)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(m,{className:"w-6 h-6 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Departamentos"}),e.jsx("p",{className:"text-gray-500",children:"Gestión de departamentos y áreas"})]})]}),e.jsxs(r,{onClick:()=>n(!0),children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Nuevo Departamento"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:e.jsx(m,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f.total||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"Departamentos"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(D,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f.total_employees||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"Empleados Total"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(S,{className:"h-5 w-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.filter(a=>a.is_configured).length}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configurados"})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar departamentos...",value:t,onChange:a=>k(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:q?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Cargando..."}):v.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(m,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:t?"No se encontraron departamentos":"No hay departamentos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:t?"Intenta con otra búsqueda":"Crea el primer departamento para comenzar"}),!t&&e.jsxs(r,{onClick:()=>n(!0),children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Crear Departamento"]})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Departamento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empleados"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:v.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-50 rounded-lg",children:e.jsx(m,{className:"h-4 w-4 text-indigo-600"})}),e.jsx("span",{className:"font-medium text-gray-900",children:a.name})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"text-sm text-gray-600 bg-gray-100 px-2 py-1 rounded",children:a.code})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(D,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:a.employee_count})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:a.is_configured?e.jsx(E,{variant:"success",children:"Configurado"}):e.jsx(E,{variant:"warning",children:"Sin configurar"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>l({...a,newName:a.name}),className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",title:"Editar",children:e.jsx(A,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>L(a),className:`p-1.5 rounded ${a.employee_count>0?"text-gray-300 cursor-not-allowed":"text-gray-400 hover:text-red-600 hover:bg-red-50"}`,title:a.employee_count>0?"No se puede eliminar (tiene empleados)":"Eliminar",disabled:a.employee_count>0,children:e.jsx(I,{className:"h-4 w-4"})})]})})]},a.id))})]})}),e.jsx(C,{isOpen:_,onClose:()=>{n(!1),o(""),i("")},title:"Nuevo Departamento",children:e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsx(w,{label:"Nombre del Departamento",value:x,onChange:a=>{o(a.target.value),i("")},placeholder:"Ej: Recursos Humanos",autoFocus:!0,required:!0}),g&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(O,{className:"h-4 w-4"}),g]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(r,{type:"button",variant:"secondary",onClick:()=>{n(!1),o(""),i("")},children:"Cancelar"}),e.jsxs(r,{type:"submit",loading:N.isPending,children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Crear"]})]})]})}),e.jsx(C,{isOpen:!!s,onClose:()=>l(null),title:"Editar Departamento",children:s&&e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsx(w,{label:"Nombre del Departamento",value:s.newName,onChange:a=>l({...s,newName:a.target.value}),placeholder:"Nombre del departamento",autoFocus:!0,required:!0}),s.employee_count>0&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-amber-700",children:["Este departamento tiene ",e.jsx("strong",{children:s.employee_count})," empleados. Al cambiar el nombre, se actualizará en todos los registros."]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(r,{type:"button",variant:"secondary",onClick:()=>l(null),children:"Cancelar"}),e.jsxs(r,{type:"submit",loading:y.isPending,children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Guardar"]})]})]})})]})}export{X as default};
