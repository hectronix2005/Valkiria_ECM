import{b as Se,u as ye,c as q,j as e}from"./vendor-query-BtlmzfbD.js";import{r as u,u as Me,a as ke,d as Re,N as Fe}from"./vendor-router-CyR0tpch.js";import{v as T,p as Oe,u as Ue,c as O}from"./index-D3UX-zL7.js";import{C,c as k}from"./Card-CVFC4agM.js";import{B as g}from"./Button-Cc42oWsS.js";import{B as le}from"./Badge-Cv3EzJhT.js";import{M as X}from"./Modal-CNSDagQP.js";import{I as me}from"./Input-DPOK3q6H.js";import{S as G}from"./Select-BdXL_iJq.js";import{P as xe,x as Ve,Z as Ae,_ as Te,p as Ne,$ as Ee,m as be,J as ue,a0 as ze,X as fe,W as Ce,I as Z,F as re,U as Be,l as W,a1 as Ie,a2 as oe,q as ne,z as we,a3 as Qe,D as qe,A as $e}from"./vendor-icons-YtD_Ipmm.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const Pe=[{value:"vacation",label:"Vacaciones"},{value:"personal",label:"Día Personal"},{value:"sick",label:"Enfermedad"},{value:"bereavement",label:"Duelo"},{value:"unpaid",label:"Sin Goce"}],Ge=[{value:"",label:"Todos"},{value:"draft",label:"Borrador"},{value:"pending",label:"Solicitada"},{value:"approved",label:"Aprobada"},{value:"enjoyed",label:"Disfrutada"},{value:"rejected",label:"Rechazada"},{value:"cancelled",label:"Cancelada"}];function He({onClose:c,onSuccess:b,balance:P}){const[o,p]=u.useState(1),[i,j]=u.useState({vacation_type:"vacation",start_date:"",end_date:"",days_requested:"",reason:""}),[t,h]=u.useState(null),[w,n]=u.useState(null),[l,_]=u.useState(null),[J,ee]=u.useState(!1),[U,D]=u.useState(""),V=Se(),{data:H}=ye({queryKey:["vacation-template"],queryFn:async()=>(await Oe.list({category:"vacation"})).data?.data?.[0]||null}),z=H,L=q({mutationFn:a=>T.create(a),onSuccess:async a=>{const r=a.data?.data,m=a.data?.document;if(h(r),n(m),D(""),r?.id&&r?.pdf_ready)try{const y=await T.downloadDocument(r.id),E=new Blob([y.data],{type:"application/pdf"});_(URL.createObjectURL(E))}catch(y){console.error("Error loading PDF:",y),_(null)}else _(null);p(2)},onError:a=>{const r=a.response?.data?.errors;Array.isArray(r)?D(r.join(", ")):D(a.response?.data?.error||"Error al crear la solicitud")}}),A=q({mutationFn:a=>T.signDocument(a),onSuccess:a=>{n(a.data?.document),h(a.data?.data),d()},onError:a=>{D(a.response?.data?.error||"Error al firmar el documento")}}),M=q({mutationFn:a=>T.submit(a),onSuccess:a=>{h(a.data?.data),p(3),V.invalidateQueries(["vacations"])},onError:a=>{D(a.response?.data?.error||"Error al enviar la solicitud")}}),d=async()=>{if(t?.id&&t?.pdf_ready)try{const a=await T.downloadDocument(t.id),r=new Blob([a.data],{type:"application/pdf"});l&&URL.revokeObjectURL(l),_(URL.createObjectURL(r))}catch(a){console.error("Error reloading PDF:",a)}},f=a=>{const r=a%19,m=Math.floor(a/100),y=a%100,E=Math.floor(m/4),Q=m%4,F=Math.floor((m+8)/25),I=Math.floor((m-F+1)/3),S=(19*r+m-E-I+15)%30,he=Math.floor(y/4),ge=y%4,te=(32+2*Q+2*he-S-ge)%7,s=Math.floor((r+11*S+22*te)/451),x=Math.floor((S+te-7*s+114)/31),$=(S+te-7*s+114)%31+1;return new Date(a,x-1,$)},N=a=>{const r=new Date(a),m=r.getDay();return m===0?r.setDate(r.getDate()+1):m!==1&&r.setDate(r.getDate()+(8-m)),r},ie=a=>{const r=[],m=f(a);r.push(new Date(a,0,1)),r.push(new Date(a,4,1)),r.push(new Date(a,6,20)),r.push(new Date(a,7,7)),r.push(new Date(a,11,8)),r.push(new Date(a,11,25)),r.push(N(new Date(a,0,6))),r.push(N(new Date(a,2,19))),r.push(N(new Date(a,5,29))),r.push(N(new Date(a,7,15))),r.push(N(new Date(a,9,12))),r.push(N(new Date(a,10,1))),r.push(N(new Date(a,10,11)));const y=new Date(m);y.setDate(m.getDate()-3),r.push(y);const E=new Date(m);E.setDate(m.getDate()-2),r.push(E);const Q=new Date(m);Q.setDate(m.getDate()+39),r.push(N(Q));const F=new Date(m);F.setDate(m.getDate()+60),r.push(N(F));const I=new Date(m);return I.setDate(m.getDate()+68),r.push(N(I)),r},R=(a,r)=>{const m=a.toISOString().split("T")[0];return r.some(y=>y.toISOString().split("T")[0]===m)},Y=(a,r)=>{let m=0;const y=new Date(a),E=new Date(r),Q=y.getFullYear(),F=E.getFullYear();let I=[];for(let S=Q;S<=F;S++)I=I.concat(ie(S));for(;y<=E;){const S=y.getDay();S!==0&&S!==6&&!R(y,I)&&m++,y.setDate(y.getDate()+1)}return m};u.useEffect(()=>{if(i.start_date&&i.end_date){const a=new Date(i.start_date+"T00:00:00"),r=new Date(i.end_date+"T00:00:00");if(r>=a){const m=Y(a,r);j(y=>({...y,days_requested:m.toString()}))}}},[i.start_date,i.end_date]),u.useEffect(()=>()=>{l&&URL.revokeObjectURL(l)},[l]);const B=a=>{a.preventDefault(),L.mutate(i)},se=()=>{D(""),t?.id&&A.mutate(t.id)},ce=()=>{D(""),t?.id&&M.mutate(t.id)},K=()=>{V.invalidateQueries(["vacations"]),b?.(),c()},pe=()=>{l&&window.open(l,"_blank")},v=w?.employee_signed||!1,ae=t?.pdf_ready===!1,ve=v||ae;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 mb-6",children:[1,2,3].map(a=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${o>=a?"bg-primary-500 text-white":"bg-gray-200 text-gray-500"}`,children:o>a?e.jsx(Z,{className:"w-5 h-5"}):a}),a<3&&e.jsx("div",{className:`w-12 h-1 mx-1 ${o>a?"bg-primary-500":"bg-gray-200"}`})]},a))}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-4 mb-6",children:[e.jsx("span",{className:o>=1?"text-primary-600 font-medium":"",children:"Datos"}),e.jsx("span",{className:o>=2?"text-primary-600 font-medium":"",children:"Firmar"}),e.jsx("span",{className:o>=3?"text-primary-600 font-medium":"",children:"Enviado"})]}),o===1&&e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[z&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:z.name}),e.jsx("p",{className:"text-sm text-blue-700",children:"Se generará el documento oficial para tu firma"}),z.signatories_count>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-blue-600",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsxs("span",{children:[z.signatories_count," firmantes requeridos"]})]})]})]}),e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg flex items-center justify-between",children:[e.jsx("span",{className:"text-green-700",children:"Días disponibles para solicitar:"}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:Math.floor(P?.available||0)})]}),e.jsx(G,{label:"Tipo de Solicitud",options:Pe,value:i.vacation_type,onChange:a=>j({...i,vacation_type:a.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(me,{label:"Fecha Inicio",type:"date",value:i.start_date,min:new Date().toISOString().split("T")[0],onChange:a=>{j({...i,start_date:a.target.value}),D("")},required:!0}),e.jsx(me,{label:"Fecha Fin",type:"date",value:i.end_date,min:i.start_date||new Date().toISOString().split("T")[0],onChange:a=>{j({...i,end_date:a.target.value}),D("")},required:!0})]}),e.jsx(me,{label:"Días Solicitados",type:"number",step:"0.5",min:"0.5",value:i.days_requested,onChange:a=>j({...i,days_requested:a.target.value}),required:!0}),parseFloat(i.days_requested)>(P?.available||0)&&e.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center gap-2 text-amber-700",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Los días solicitados exceden tu saldo disponible"})]}),U&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:U})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo (opcional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3,value:i.reason,onChange:a=>j({...i,reason:a.target.value}),placeholder:"Describe el motivo de tu solicitud..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(g,{type:"button",variant:"secondary",onClick:c,children:"Cancelar"}),e.jsx(g,{type:"submit",loading:L.isPending,children:"Continuar"})]})]}),o===2&&t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"font-medium text-gray-900",children:["Solicitud ",t.request_number]}),e.jsx(le,{status:t.status})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("p",{className:"font-medium",children:Pe.find(a=>a.value===t.vacation_type)?.label})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Fechas:"}),e.jsxs("p",{className:"font-medium",children:[new Date(t.start_date).toLocaleDateString("es-ES")," - ",new Date(t.end_date).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Días:"}),e.jsx("p",{className:"font-bold text-primary-600",children:t.days_requested})]})]})]}),l?e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Documento de Solicitud"}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:pe,children:[e.jsx(Ie,{className:"w-4 h-4"}),"Abrir en nueva pestaña"]})]}),e.jsx("iframe",{src:l,className:"w-full h-[400px] border-0",title:"Vista previa del documento"})]}):t?.pdf_ready===!1?e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-amber-50 border-amber-200",children:[e.jsx(W,{className:"w-8 h-8 mx-auto text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-700 font-medium",children:"El documento está pendiente de generación"}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"El PDF se generará próximamente. Puedes continuar con el proceso."})]}):e.jsxs("div",{className:"border rounded-lg p-8 text-center bg-gray-50",children:[e.jsx(oe,{className:"w-8 h-8 animate-spin mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Cargando documento..."})]}),e.jsxs("div",{className:"p-4 bg-white border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Firmas Requeridas"]}),e.jsx("div",{className:"space-y-3",children:w?.signatures?.map((a,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${a.signed?"bg-green-500 text-white":"bg-gray-300 text-gray-600"}`,children:a.signed?e.jsx(Z,{className:"w-5 h-5"}):r+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.label}),a.signed&&e.jsxs("p",{className:"text-xs text-green-600",children:["Firmado por ",a.signed_by," - ",new Date(a.signed_at).toLocaleString("es-ES")]})]})]}),a.signatory_type_code==="employee"&&!a.signed&&e.jsxs(g,{size:"sm",onClick:se,loading:A.isPending,children:[e.jsx(ue,{className:"w-4 h-4"}),"Firmar"]}),a.signatory_type_code!=="employee"&&!a.signed&&e.jsx("span",{className:"text-xs text-gray-500 px-2 py-1 bg-gray-200 rounded",children:"Pendiente"})]},r))})]}),U&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:U})]}),ae&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3",children:[e.jsx(W,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"Documento pendiente de generación"}),e.jsx("p",{className:"mt-1",children:"Puedes enviar la solicitud ahora. El documento se generará y firmará posteriormente."})]})]}),!ae&&!v&&e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-3",children:[e.jsx(W,{className:"w-5 h-5 text-amber-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-medium",children:"Debes firmar el documento antes de enviar"}),e.jsx("p",{className:"mt-1",children:'Haz clic en el botón "Firmar" junto a tu nombre para continuar.'})]})]}),!ae&&v&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"¡Documento firmado!"}),e.jsx("p",{className:"mt-1",children:"Ahora puedes enviar la solicitud para aprobación del supervisor y RRHH."})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx(g,{variant:"secondary",onClick:()=>p(1),children:"Volver"}),e.jsxs(g,{onClick:ce,loading:M.isPending,disabled:!ve,children:[e.jsx(ze,{className:"w-4 h-4"}),"Enviar Solicitud"]})]})]}),o===3&&t&&e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Z,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"¡Solicitud Enviada!"}),e.jsxs("p",{className:"text-gray-600",children:["Tu solicitud ",e.jsx("span",{className:"font-medium",children:t.request_number})," ha sido enviada correctamente."]}),l&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Documento firmado:"}),e.jsxs(g,{variant:"secondary",onClick:pe,children:[e.jsx(Ee,{className:"w-4 h-4"}),"Ver Documento PDF"]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Próximos pasos:"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Tu supervisor recibirá la solicitud para aprobación y firma"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Recursos Humanos revisará y firmará la solicitud"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{children:"Recibirás notificación cuando sea aprobada"})]})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(g,{onClick:K,children:"Cerrar"})})]})]})}function Ye({vacation:c,onSubmit:b,onCancel:P,onDelete:o,onView:p,onDownload:i,onSign:j}){const t={vacation:"Vacaciones",personal:"Día Personal",sick:"Enfermedad",bereavement:"Duelo",unpaid:"Sin Goce"};return e.jsx(C,{className:"hover:shadow-md transition-shadow",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-50 rounded-lg",children:e.jsx(Ne,{className:"w-5 h-5 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t[c.vacation_type]||c.vacation_type}),e.jsx("p",{className:"text-sm text-gray-500",children:c.request_number}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[new Date(c.start_date).toLocaleDateString("es-ES")," - ",new Date(c.end_date).toLocaleDateString("es-ES")]}),e.jsxs("p",{className:"text-sm font-medium text-primary-600 mt-1",children:[c.days_requested," días"]})]})]}),e.jsx(le,{status:c.status})]}),e.jsxs("div",{className:"flex justify-end gap-1 mt-4 pt-4 border-t border-gray-100",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>p(c),title:"Ver detalles",children:e.jsx(be,{className:"w-4 h-4"})}),c.pdf_ready&&e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>i(c.id),title:"Descargar documento",children:e.jsx(Ee,{className:"w-4 h-4"})}),c.status==="draft"&&c.needs_employee_signature&&e.jsxs(g,{variant:"secondary",size:"sm",onClick:()=>j(c),title:"Firmar documento",children:[e.jsx(ue,{className:"w-4 h-4"}),"Firmar"]}),c.status==="draft"&&!c.needs_employee_signature&&e.jsx(g,{variant:"primary",size:"sm",onClick:()=>b(c.id),title:"Enviar solicitud",children:e.jsx(ze,{className:"w-4 h-4"})}),["draft","pending"].includes(c.status)&&e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>P(c.id),title:"Cancelar solicitud",children:e.jsx(fe,{className:"w-4 h-4"})}),c.can_delete&&e.jsx(g,{variant:"danger",size:"sm",onClick:()=>o(c.id),title:"Eliminar solicitud",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})})}function Ke(){const[c,b]=u.useState(!1),[P,o]=u.useState(!1),[p,i]=u.useState(null),[j,t]=u.useState(""),h=Se(),w=Me(),n=ke();u.useEffect(()=>{w.state?.openNew&&(b(!0),n(w.pathname,{replace:!0,state:{}}))},[w.state,w.pathname,n]);const{data:l,isLoading:_}=ye({queryKey:["vacations",{status:j}],queryFn:()=>T.list({status:j||void 0})}),J=q({mutationFn:d=>T.submit(d),onSuccess:()=>{h.invalidateQueries(["vacations"])}}),ee=q({mutationFn:d=>T.cancel(d),onSuccess:()=>{h.invalidateQueries(["vacations"])}}),U=q({mutationFn:d=>T.delete(d),onSuccess:()=>{h.invalidateQueries(["vacations"])},onError:d=>{alert(d.response?.data?.error||"Error al eliminar la solicitud")}}),D=q({mutationFn:d=>T.signDocument(d),onSuccess:()=>{h.invalidateQueries(["vacations"]),alert("Documento firmado exitosamente. Ahora puedes enviar la solicitud.")},onError:d=>{const f=d.response?.data?.error||"Error al firmar el documento";d.response?.data?.action_required?.type==="configure_signature"?window.confirm("No tienes firma digital configurada. ¿Deseas configurarla ahora?")&&n("/profile"):alert(f)}}),V=d=>{window.confirm("¿Estás seguro de que deseas eliminar esta solicitud? Esta acción no se puede deshacer.")&&U.mutate(d)},H=d=>{D.mutate(d.id)},z=l?.data?.data||[],L=l?.data?.meta?.vacation_balance||{},A=d=>{i(d),o(!0)},M=async d=>{try{const f=await T.downloadDocument(d),N=new Blob([f.data],{type:"application/pdf"}),ie=window.URL.createObjectURL(N);window.open(ie,"_blank")}catch(f){console.error("Error downloading document:",f),alert("Error al descargar el documento")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Vacaciones"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona tus solicitudes de vacaciones"})]}),e.jsxs(g,{onClick:()=>b(!0),children:[e.jsx(xe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(C,{className:"bg-blue-50 border-blue-200",children:e.jsx(k,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(Ve,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:Math.floor((L.accrued||0)-(L.enjoyed||0))}),e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Días por Contrato"}),e.jsx("p",{className:"text-xs text-blue-500",children:"Acumulados - Disfrutados"})]})]})})}),e.jsx(C,{className:"bg-amber-50 border-amber-200",children:e.jsx(k,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-amber-100 rounded-xl",children:e.jsx(Ae,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:Math.floor(L.scheduled||0)}),e.jsx("p",{className:"text-sm text-amber-700 font-medium",children:"Días Programados"}),e.jsx("p",{className:"text-xs text-amber-500",children:"Aprobados sin disfrutar"})]})]})})}),e.jsx(C,{className:"bg-green-50 border-green-300 ring-2 ring-green-200",children:e.jsx(k,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx(xe,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:Math.floor(L.available||0)}),e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Días Vacaciones"}),e.jsx("p",{className:"text-xs text-green-500",children:"Para solicitar"})]})]})})})]}),e.jsx(C,{children:e.jsx(k,{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Te,{className:"w-4 h-4 text-gray-400"}),e.jsx(G,{options:Ge,value:j,onChange:d=>t(d.target.value),className:"w-48"})]})})}),_?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(d=>e.jsx(C,{className:"animate-pulse",children:e.jsx(k,{className:"p-4",children:e.jsx("div",{className:"h-24 bg-gray-100 rounded"})})},d))}):z.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:z.map(d=>e.jsx(Ye,{vacation:d,onSubmit:f=>J.mutate(f),onCancel:f=>ee.mutate(f),onDelete:V,onView:A,onDownload:M,onSign:H},d.id))}):e.jsx(C,{children:e.jsxs(k,{className:"py-12 text-center",children:[e.jsx(Ne,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tienes solicitudes de vacaciones"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Crea tu primera solicitud de vacaciones"}),e.jsxs(g,{onClick:()=>b(!0),children:[e.jsx(xe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})}),e.jsx(X,{isOpen:c,onClose:()=>b(!1),title:"Nueva Solicitud de Vacaciones",size:"xl",children:e.jsx(He,{onClose:()=>b(!1),onSuccess:()=>h.invalidateQueries(["vacations"]),balance:L})}),e.jsx(X,{isOpen:P,onClose:()=>o(!1),title:"Detalle de Solicitud",size:"md",children:p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Número:"}),e.jsx("span",{className:"font-medium",children:p.request_number})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(le,{status:p.status})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("span",{children:p.vacation_type})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Fechas:"}),e.jsxs("span",{children:[new Date(p.start_date).toLocaleDateString("es-ES")," - ",new Date(p.end_date).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Días:"}),e.jsx("span",{className:"font-medium text-primary-600",children:p.days_requested})]}),p.reason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-1",children:"Motivo:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded-lg",children:p.reason})]}),p.decision_reason&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-1",children:"Comentario del aprobador:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-3 rounded-lg",children:p.decision_reason})]}),p.pdf_ready&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(g,{variant:"secondary",className:"w-full",onClick:()=>M(p.id),children:[e.jsx(Ee,{className:"w-4 h-4"}),"Descargar Documento"]})})]})})]})}const We=[{value:"employment",label:"Certificación Laboral Básica"},{value:"salary",label:"Certificación con Salario"},{value:"position",label:"Certificación de Cargo"},{value:"full",label:"Certificación Completa"},{value:"custom",label:"Certificación Personalizada"}],Xe=[{value:"bank",label:"Entidad Bancaria / Crédito"},{value:"visa",label:"Trámite de Visa"},{value:"rental",label:"Arrendamiento / Inmobiliaria"},{value:"government",label:"Trámite Gubernamental"},{value:"legal",label:"Proceso Legal"},{value:"other",label:"Otro"}],Ze=[{value:"digital",label:"Digital (PDF)"},{value:"physical",label:"Física (Impresa)"},{value:"both",label:"Digital y Física"}],Je=[{value:"es",label:"Español"},{value:"en",label:"Inglés"}],es=[{value:"",label:"Todos los estados"},{value:"pending",label:"Pendiente"},{value:"processing",label:"En Proceso"},{value:"completed",label:"Completado"},{value:"rejected",label:"Rechazado"},{value:"cancelled",label:"Cancelado"}],_e={employment:"Certificación Laboral",salary:"Con Salario",position:"Certificación de Cargo",full:"Certificación Completa",custom:"Personalizada"},Le={bank:"Entidad Bancaria",visa:"Trámite de Visa",rental:"Arrendamiento",government:"Trámite Gubernamental",legal:"Proceso Legal",other:"Otro"},De={employment:1,salary:2,position:1,full:3,custom:3};function ss({onSubmit:c,onCancel:b,loading:P,initialType:o,availableTypes:p}){const i=p?.length>0?p:We,j=o&&i.find(l=>l.value===o)?o:i[0]?.value||"employment",[t,h]=u.useState({certification_type:j,purpose:"bank",purpose_details:"",language:"es",delivery_method:"digital",addressee:"",include_salary:j==="salary"||j==="full",include_position:!0,include_start_date:!0,include_department:!1,special_instructions:""});u.useEffect(()=>{o&&i.find(l=>l.value===o)&&h(l=>({...l,certification_type:o,include_salary:o==="salary"||o==="full"}))},[o,i]);const w=l=>{l.preventDefault(),c(t)},n=t.certification_type;return e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx(G,{label:"Tipo de Certificación",options:i,value:t.certification_type,onChange:l=>{const _=l.target.value,J=_==="salary"||_==="full"?t.include_salary:!1;h({...t,certification_type:_,include_salary:J})},required:!0}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Tiempo estimado: ",De[n]," día",De[n]>1?"s":""," hábil",De[n]>1?"es":""]})]})}),e.jsx(G,{label:"Propósito",options:Xe,value:t.purpose,onChange:l=>h({...t,purpose:l.target.value}),required:!0}),t.purpose==="other"&&e.jsx(me,{label:"Especifique el propósito",value:t.purpose_details,onChange:l=>h({...t,purpose_details:l.target.value}),placeholder:"Describa el propósito de la certificación...",required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(G,{label:"Idioma",options:Je,value:t.language,onChange:l=>h({...t,language:l.target.value})}),e.jsx(G,{label:"Método de Entrega",options:Ze,value:t.delivery_method,onChange:l=>h({...t,delivery_method:l.target.value})})]}),e.jsx(me,{label:"Dirigido a (opcional)",value:t.addressee,onChange:l=>h({...t,addressee:l.target.value}),placeholder:"Ej: A quien corresponda, Banco XYZ, Embajada..."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Información a incluir"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:t.include_start_date,onChange:l=>h({...t,include_start_date:l.target.checked}),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm",children:"Fecha de ingreso"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:t.include_position,onChange:l=>h({...t,include_position:l.target.checked}),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm",children:"Cargo actual"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:t.include_department,onChange:l=>h({...t,include_department:l.target.checked}),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm",children:"Departamento"})]}),(t.certification_type==="salary"||t.certification_type==="full")&&e.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:t.include_salary,onChange:l=>h({...t,include_salary:l.target.checked}),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-sm",children:"Información salarial"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Instrucciones especiales (opcional)"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3,value:t.special_instructions,onChange:l=>h({...t,special_instructions:l.target.value}),placeholder:"Información adicional o requisitos especiales..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(g,{type:"button",variant:"secondary",onClick:b,children:"Cancelar"}),e.jsx(g,{type:"submit",loading:P,children:"Solicitar Certificación"})]})]})}const as={pending:e.jsx(ne,{className:"w-4 h-4 text-yellow-500"}),processing:e.jsx(ne,{className:"w-4 h-4 text-blue-500 animate-pulse"}),completed:e.jsx(Z,{className:"w-4 h-4 text-green-500"}),rejected:e.jsx(W,{className:"w-4 h-4 text-red-500"}),cancelled:e.jsx(fe,{className:"w-4 h-4 text-gray-400"})};function ts(){const[c,b]=u.useState(!1),[P,o]=u.useState(!1),[p,i]=u.useState(!1),[j,t]=u.useState(null),[h,w]=u.useState(null),[n,l]=u.useState(null),[_,J]=u.useState(""),[ee,U]=u.useState(""),[D,V]=u.useState(null),[H,z]=u.useState(null),[L,A]=u.useState(null),[M,d]=u.useState(null),[f,N]=u.useState(null),[ie,R]=u.useState(null),Y=Se(),B=ke(),se=Me(),{isHR:ce,isAdmin:K}=Ue();u.useEffect(()=>{se.state?.openNew&&(b(!0),B(se.pathname,{replace:!0,state:{}}))},[se.state,se.pathname,B]);const{data:pe}=ye({queryKey:["certification-available-types"],queryFn:()=>O.getAvailableTypes(),staleTime:300*1e3}),v=pe?.data?.data||[],ae=[{value:"",label:"Todos los tipos"},...v.map(s=>({value:s.value,label:s.label}))],{data:ve,isLoading:a}=ye({queryKey:["certifications",{status:_,type:ee}],queryFn:()=>O.list({status:_||void 0,type:ee||void 0})}),r=q({mutationFn:s=>O.create(s),onSuccess:()=>{Y.invalidateQueries(["certifications"]),b(!1)}}),m=q({mutationFn:s=>O.cancel(s),onSuccess:()=>{Y.invalidateQueries(["certifications"])}}),y=q({mutationFn:s=>O.generateDocument(s),onSuccess:()=>{Y.invalidateQueries(["certifications"]),V(null)},onError:s=>{console.error("Error generating document:",s),V(null);const x=s.response?.data;x?.error_type==="missing_variables"?(t({message:x.error,missingData:x.missing_data,actions:x.action_required||[]}),i(!0)):alert(x?.error||"Error al generar documento")}}),E=q({mutationFn:s=>O.delete(s),onSuccess:()=>{Y.invalidateQueries(["certifications"]),w(null)},onError:s=>{console.error("Error deleting certification:",s),alert(s.response?.data?.error||"Error al eliminar certificación")}}),Q=q({mutationFn:s=>O.signDocument(s),onSuccess:s=>{Y.invalidateQueries(["certifications"]),A(null);const x=s.data.document;x.all_signed?alert("Documento firmado y completado exitosamente"):alert(`Documento firmado. Firmas pendientes: ${x.pending_signatures.join(", ")}`)},onError:s=>{console.error("Error signing document:",s),A(null);const x=s.response?.data;x?.action_required?.type==="configure_signature"?confirm("No tienes firma digital configurada. ¿Deseas configurarla ahora?")&&B("/profile"):alert(x?.error||"Error al firmar documento")}}),F=ve?.data?.data||[],I=s=>{l(s),o(!0)},S=async s=>{V(s),y.mutate(s)},he=async s=>{try{z(s.id);const x=await O.downloadDocument(s.id),$=new Blob([x.data],{type:"application/pdf"}),je=URL.createObjectURL($),de=document.createElement("a");de.href=je,de.download=`${s.request_number}.pdf`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(je)}catch(x){console.error("Error downloading document:",x),alert("Error al descargar documento")}finally{z(null)}},ge=async s=>{try{N(s.id);const x=await O.downloadDocument(s.id),$=new Blob([x.data],{type:"application/pdf"}),je=URL.createObjectURL($);d(je)}catch(x){console.error("Error previewing document:",x);const $=x.response?.data;$?.error?alert($.error):alert("Error al previsualizar documento")}finally{N(null)}},te=()=>{M&&URL.revokeObjectURL(M),d(null)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Certificaciones"}),e.jsx("p",{className:"text-gray-500",children:"Solicita certificaciones laborales para distintos trámites"})]}),e.jsxs(g,{onClick:()=>b(!0),disabled:v.length===0,title:v.length===0?"No hay tipos de certificación disponibles":"",children:[e.jsx(xe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]}),e.jsx(C,{children:e.jsx(k,{className:"py-3",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Te,{className:"w-4 h-4 text-gray-400"}),e.jsx(G,{options:es,value:_,onChange:s=>J(s.target.value),className:"w-48"}),e.jsx(G,{options:ae,value:ee,onChange:s=>U(s.target.value),className:"w-56"})]})})}),v.length>0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[v.find(s=>s.value==="employment")&&e.jsx(C,{className:"bg-blue-50 border-blue-200 cursor-pointer hover:shadow-md hover:border-blue-300 transition-all",onClick:()=>{R("employment"),b(!0)},children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Certificación Laboral"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Confirma tu vínculo laboral actual"})]})]})})}),v.find(s=>s.value==="salary")&&e.jsx(C,{className:"bg-green-50 border-green-200 cursor-pointer hover:shadow-md hover:border-green-300 transition-all",onClick:()=>{R("salary"),b(!0)},children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Con Información Salarial"}),e.jsx("p",{className:"text-sm text-green-700",children:"Incluye detalles de tu compensación"})]})]})})}),v.find(s=>s.value==="full")&&e.jsx(C,{className:"bg-purple-50 border-purple-200 cursor-pointer hover:shadow-md hover:border-purple-300 transition-all",onClick:()=>{R("full"),b(!0)},children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-purple-900",children:"Certificación Completa"}),e.jsx("p",{className:"text-sm text-purple-700",children:"Incluye toda tu información laboral"})]})]})})}),v.find(s=>s.value==="position")&&e.jsx(C,{className:"bg-amber-50 border-amber-200 cursor-pointer hover:shadow-md hover:border-amber-300 transition-all",onClick:()=>{R("position"),b(!0)},children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"Certificación de Cargo"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Detalla cargo y responsabilidades"})]})]})})}),v.find(s=>s.value==="custom")&&e.jsx(C,{className:"bg-gray-50 border-gray-200 cursor-pointer hover:shadow-md hover:border-gray-300 transition-all",onClick:()=>{R("custom"),b(!0)},children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Certificación Personalizada"}),e.jsx("p",{className:"text-sm text-gray-700",children:"Contenido según necesidad"})]})]})})})]}):e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{className:"w-6 h-6 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-900",children:"No hay tipos de certificación disponibles"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Contacta al administrador para configurar los templates de certificación."})]})]})}),e.jsxs(C,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-fixed",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[15%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"w-[18%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"w-[17%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Propósito"}),e.jsx("th",{className:"w-[12%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"w-[10%] px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Días"}),e.jsx("th",{className:"w-[13%] px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"w-[15%] px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:a?[...Array(3)].map((s,x)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-28"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8 mx-auto"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16 mx-auto"})})]},x)):F.length>0?F.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"text-sm font-mono text-primary-600 bg-primary-50 px-2 py-0.5 rounded",children:s.request_number})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:_e[s.certification_type]||s.certification_type})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600 truncate block",children:Le[s.purpose]||s.purpose})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[as[s.status],e.jsx(le,{status:s.status})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm text-gray-600",children:s.estimated_days})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"short"})})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>I(s),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 rounded transition-colors",title:"Ver detalle",children:e.jsx(be,{className:"w-4 h-4"})}),(ce||K)&&s.status==="pending"&&!s.document_uuid&&e.jsx("button",{onClick:()=>S(s.id),disabled:D===s.id,className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:opacity-50",title:"Generar documento",children:D===s.id?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):e.jsx(Qe,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.can_download&&e.jsx("button",{onClick:()=>ge(s),disabled:f===s.id,className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:opacity-50",title:"Previsualizar",children:f===s.id?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):e.jsx(be,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.can_download&&e.jsx("button",{onClick:()=>he(s),disabled:H===s.id,className:"p-1.5 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded transition-colors disabled:opacity-50",title:"Descargar",children:H===s.id?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):e.jsx(qe,{className:"w-4 h-4"})}),s.document_uuid&&s.document_info?.pending_signatures?.length>0&&(ce||K)&&e.jsx("button",{onClick:()=>{A(s.id),Q.mutate(s.id)},disabled:L===s.id,className:"p-1.5 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded transition-colors disabled:opacity-50",title:`Firmar documento (Pendiente: ${s.document_info?.pending_signatures?.join(", ")})`,children:L===s.id?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):e.jsx(ue,{className:"w-4 h-4"})}),s.document_uuid&&!s.document_info?.can_download&&!(ce||K)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs text-amber-700 bg-amber-50 rounded",title:`Pendiente: ${s.document_info?.pending_signatures?.join(", ")}`,children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"Firma pendiente"]}),["pending","processing"].includes(s.status)&&!K&&e.jsx("button",{onClick:()=>m.mutate(s.id),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Cancelar",children:e.jsx(fe,{className:"w-4 h-4"})}),K&&e.jsx("button",{onClick:()=>w(s),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Eliminar",children:e.jsx(Ce,{className:"w-4 h-4"})})]})})]},s.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-4 py-12 text-center",children:[e.jsx(re,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-base font-medium text-gray-900 mb-1",children:"No tienes solicitudes de certificaciones"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Solicita una certificación laboral para tus trámites"}),e.jsxs(g,{size:"sm",onClick:()=>b(!0),disabled:v.length===0,children:[e.jsx(xe,{className:"w-4 h-4"}),"Nueva Solicitud"]})]})})})]})}),F.length>0&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-100 bg-gray-50",children:e.jsxs("p",{className:"text-sm text-gray-500",children:[F.length," solicitud",F.length!==1?"es":""]})})]}),e.jsx(X,{isOpen:c,onClose:()=>{b(!1),R(null)},title:"Nueva Solicitud de Certificación",size:"lg",children:e.jsx(ss,{onSubmit:s=>r.mutate(s),onCancel:()=>{b(!1),R(null)},loading:r.isPending,initialType:ie,availableTypes:v})}),e.jsx(X,{isOpen:P,onClose:()=>o(!1),title:"Detalle de Certificación",size:"md",children:n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Número:"}),e.jsx("span",{className:"font-medium",children:n.request_number})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(le,{status:n.status})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("span",{children:_e[n.certification_type]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Propósito:"}),e.jsx("span",{children:Le[n.purpose]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Tiempo estimado:"}),e.jsxs("span",{children:[n.estimated_days," día",n.estimated_days>1?"s":""," hábil",n.estimated_days>1?"es":""]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha solicitud:"}),e.jsx("span",{children:new Date(n.created_at).toLocaleDateString("es-ES")})]}),n.language&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Idioma:"}),e.jsx("span",{children:n.language==="es"?"Español":"Inglés"})]}),n.delivery_method&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Entrega:"}),e.jsxs("span",{children:[n.delivery_method==="digital"&&"Digital (PDF)",n.delivery_method==="physical"&&"Física (Impresa)",n.delivery_method==="both"&&"Digital y Física"]})]}),n.status==="completed"&&n.completed_at&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha completado:"}),e.jsx("span",{className:"text-green-600 font-medium",children:new Date(n.completed_at).toLocaleDateString("es-ES")})]}),n.status==="rejected"&&n.rejection_reason&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"Motivo de rechazo:"}),e.jsx("p",{className:"text-red-700",children:n.rejection_reason})]}),n.processed_by&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 mt-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Procesado por:"}),e.jsx("p",{className:"text-gray-600",children:n.processed_by.name})]}),n.document_uuid&&n.document_info?.can_download&&e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsxs(g,{className:"w-full",variant:"primary",onClick:()=>ge(n),loading:f===n.id,children:[e.jsx(be,{className:"w-4 h-4"}),"Previsualizar Documento"]}),e.jsxs(g,{className:"w-full",variant:"secondary",onClick:()=>he(n),loading:H===n.id,children:[e.jsx(qe,{className:"w-4 h-4"}),"Descargar Certificación"]})]})]})}),e.jsx(X,{isOpen:p,onClose:()=>i(!1),title:"No se puede generar el documento",size:"md",children:j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(we,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Información faltante"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:j.message})]})]}),j.missingData?.by_source?.employee?.length>0&&e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-amber-800 mb-2",children:"Datos del empleado requeridos:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-amber-700 space-y-1",children:j.missingData.by_source.employee.map((s,x)=>e.jsx("li",{children:s.field_label||s.field},x))})]}),j.missingData?.by_source?.organization?.length>0&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-2",children:"Datos de la organización requeridos:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-blue-700 space-y-1",children:j.missingData.by_source.organization.map((s,x)=>e.jsx("li",{children:s.field_label||s.field},x))})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t",children:[j.actions?.map((s,x)=>e.jsxs(g,{variant:x===0?"primary":"secondary",className:"w-full justify-center",onClick:()=>{i(!1),s.type==="edit_employee"&&s.employee_id?B(`/hr/employees?edit=${s.employee_id}`):s.type==="edit_organization"?B("/admin/organization"):s.type==="configure_mappings"&&B("/admin/variable-mappings")},children:[e.jsx(Ie,{className:"w-4 h-4"}),s.label,s.employee_name&&` (${s.employee_name})`]},x)),e.jsx(g,{variant:"ghost",className:"w-full justify-center",onClick:()=>i(!1),children:"Cerrar"})]})]})}),e.jsx(X,{isOpen:!!h,onClose:()=>w(null),title:"Eliminar Certificación",size:"sm",children:h&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(we,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"¿Eliminar esta certificación?"}),e.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Esta acción no se puede deshacer. Se eliminará permanentemente la solicitud"," ",e.jsx("strong",{children:h.request_number}),"."]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Tipo:"}),e.jsx("span",{className:"font-medium",children:_e[h.certification_type]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx(le,{status:h.status})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(g,{variant:"ghost",className:"flex-1",onClick:()=>w(null),children:"Cancelar"}),e.jsxs(g,{variant:"danger",className:"flex-1",loading:E.isPending,onClick:()=>E.mutate(h.id),children:[e.jsx(Ce,{className:"w-4 h-4"}),"Eliminar"]})]})]})}),e.jsx(X,{isOpen:!!M,onClose:te,title:"Previsualización de Documento",size:"full",children:e.jsxs("div",{className:"flex flex-col h-[80vh]",children:[M&&e.jsx("iframe",{src:M,className:"w-full flex-1 border rounded-lg bg-gray-100",title:"Vista previa del documento"}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t mt-4",children:e.jsxs(g,{variant:"secondary",onClick:te,children:[e.jsx(fe,{className:"w-4 h-4"}),"Cerrar"]})})]})})]})}const rs=[{id:"vacations",name:"Vacaciones",icon:Ne,path:"/hr/my-requests/vacations"},{id:"certifications",name:"Certificaciones",icon:$e,path:"/hr/my-requests/certifications"}];function js(){const{tab:c}=Re(),b=ke();if(!c)return e.jsx(Fe,{to:"/hr/my-requests/vacations",replace:!0});if(!["vacations","certifications"].includes(c))return e.jsx(Fe,{to:"/hr/my-requests/vacations",replace:!0});const o=c;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:rs.map(p=>{const i=p.icon,j=o===p.id;return e.jsxs("button",{onClick:()=>b(p.path),className:`
                  group inline-flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm
                  ${j?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx(i,{className:`w-5 h-5 ${j?"text-primary-500":"text-gray-400 group-hover:text-gray-500"}`}),p.name]},p.id)})})}),e.jsxs("div",{children:[o==="vacations"&&e.jsx(Ke,{}),o==="certifications"&&e.jsx(ts,{})]})]})}export{js as default};
