import{b as xe,u as P,c as S,j as e}from"./vendor-query-BtlmzfbD.js";import{r as u}from"./vendor-router-CyR0tpch.js";import{L as R,l as b,k as pe}from"./index-CpR3368I.js";import{B as p}from"./Button-Cc42oWsS.js";import{I as A}from"./Input-DPOK3q6H.js";import{M as q}from"./Modal-CNSDagQP.js";import{B as U}from"./Badge-Cv3EzJhT.js";import{H as ge,U as T,b as he,d as fe,S as _,n as ve,P as z,e as je,y as be,B as ye,aq as Ne,ah as we,ag as Le,W as Ce,l as Ee,I as J,h as W,i as X}from"./vendor-icons-YtD_Ipmm.js";import"./vendor-react-Cgg2GOmP.js";import"./vendor-axios-B9ygI19o.js";const y={5:"bg-purple-100 text-purple-800 border-purple-200",4:"bg-blue-100 text-blue-800 border-blue-200",3:"bg-green-100 text-green-800 border-green-200",2:"bg-gray-100 text-gray-800 border-gray-200",1:"bg-slate-100 text-slate-600 border-slate-200"},$=[{id:"general",name:"General",icon:ge,description:"Módulos generales del sistema",submodules:[{id:"dashboard",name:"Inicio / Dashboard",functions:[{id:"view",name:"Ver dashboard",defaultLevels:[1,2,3,4,5]},{id:"view_stats",name:"Ver estadísticas",defaultLevels:[2,3,4,5]}]},{id:"documents",name:"Documentos",functions:[{id:"view",name:"Ver documentos",defaultLevels:[1,2,3,4,5]},{id:"create",name:"Crear documentos",defaultLevels:[2,3,4,5]},{id:"edit",name:"Editar documentos",defaultLevels:[3,4,5]},{id:"delete",name:"Eliminar documentos",defaultLevels:[4,5]},{id:"download",name:"Descargar documentos",defaultLevels:[1,2,3,4,5]}]},{id:"folders",name:"Carpetas",functions:[{id:"view",name:"Ver carpetas",defaultLevels:[1,2,3,4,5]},{id:"create",name:"Crear carpetas",defaultLevels:[2,3,4,5]},{id:"edit",name:"Editar carpetas",defaultLevels:[3,4,5]},{id:"delete",name:"Eliminar carpetas",defaultLevels:[4,5]}]},{id:"profile",name:"Mi Perfil",functions:[{id:"view",name:"Ver perfil",defaultLevels:[1,2,3,4,5]},{id:"edit",name:"Editar perfil",defaultLevels:[1,2,3,4,5]},{id:"change_password",name:"Cambiar contraseña",defaultLevels:[1,2,3,4,5]},{id:"manage_signatures",name:"Gestionar firmas",defaultLevels:[2,3,4,5]}]}]},{id:"hr",name:"Recursos Humanos",icon:T,description:"Gestión de recursos humanos",submodules:[{id:"my_requests",name:"Mis Solicitudes",functions:[{id:"view",name:"Ver mis solicitudes",defaultLevels:[1,2,3,4,5]},{id:"create_vacation",name:"Solicitar vacaciones",defaultLevels:[2,3,4,5]},{id:"create_certification",name:"Solicitar certificaciones",defaultLevels:[2,3,4,5]},{id:"cancel",name:"Cancelar solicitudes",defaultLevels:[2,3,4,5]}]},{id:"organigrama",name:"Organigrama",functions:[{id:"view",name:"Ver organigrama",defaultLevels:[1,2,3,4,5]}]},{id:"approvals",name:"Aprobaciones",functions:[{id:"view",name:"Ver aprobaciones pendientes",defaultLevels:[3,4,5]},{id:"approve",name:"Aprobar solicitudes",defaultLevels:[3,4,5]},{id:"reject",name:"Rechazar solicitudes",defaultLevels:[3,4,5]}]},{id:"employees",name:"Empleados",functions:[{id:"view",name:"Ver empleados",defaultLevels:[3,4,5]},{id:"create",name:"Crear empleados",defaultLevels:[3,5]},{id:"edit",name:"Editar empleados",defaultLevels:[3,5]},{id:"view_balance",name:"Ver saldo vacaciones",defaultLevels:[3,4,5]},{id:"generate_docs",name:"Generar documentos",defaultLevels:[3,5]},{id:"create_account",name:"Crear cuenta de usuario",defaultLevels:[3,5]}]},{id:"hr_documents",name:"Documentación HR",functions:[{id:"view",name:"Ver documentación",defaultLevels:[3,5]},{id:"manage_variables",name:"Gestionar variables",defaultLevels:[3,5]}]},{id:"hr_dashboard",name:"Dashboard HR",functions:[{id:"view",name:"Ver dashboard HR",defaultLevels:[3,5]},{id:"export",name:"Exportar reportes",defaultLevels:[3,5]}]}]},{id:"legal",name:"Gestión Legal",icon:he,description:"Contratos y terceros",submodules:[{id:"contracts",name:"Contratos",functions:[{id:"view",name:"Ver contratos",defaultLevels:[4,5]},{id:"create",name:"Crear contratos",defaultLevels:[4,5]},{id:"edit",name:"Editar contratos",defaultLevels:[4,5]},{id:"delete",name:"Eliminar contratos",defaultLevels:[5]},{id:"submit",name:"Enviar a aprobación",defaultLevels:[4,5]},{id:"generate_doc",name:"Generar documento",defaultLevels:[4,5]},{id:"sign",name:"Firmar contratos",defaultLevels:[4,5]}]},{id:"legal_approvals",name:"Aprobaciones Legales",functions:[{id:"view",name:"Ver aprobaciones",defaultLevels:[4,5]},{id:"approve",name:"Aprobar contratos",defaultLevels:[4,5]},{id:"reject",name:"Rechazar contratos",defaultLevels:[4,5]}]},{id:"third_parties",name:"Terceros",functions:[{id:"view",name:"Ver terceros",defaultLevels:[4,5]},{id:"create",name:"Crear terceros",defaultLevels:[4,5]},{id:"edit",name:"Editar terceros",defaultLevels:[4,5]},{id:"delete",name:"Eliminar terceros",defaultLevels:[5]},{id:"manage_types",name:"Gestionar tipos",defaultLevels:[5]}]}]},{id:"system",name:"Sistema",icon:fe,description:"Configuración del sistema",submodules:[{id:"settings",name:"Configuración",functions:[{id:"view",name:"Ver configuración",defaultLevels:[5]},{id:"edit",name:"Editar configuración",defaultLevels:[5]}]},{id:"users",name:"Usuarios",functions:[{id:"view",name:"Ver usuarios",defaultLevels:[5]},{id:"create",name:"Crear usuarios",defaultLevels:[5]},{id:"edit",name:"Editar usuarios",defaultLevels:[5]},{id:"delete",name:"Eliminar usuarios",defaultLevels:[5]},{id:"toggle_active",name:"Activar/Desactivar",defaultLevels:[5]},{id:"assign_roles",name:"Asignar roles",defaultLevels:[5]},{id:"manage_permissions",name:"Gestionar permisos",defaultLevels:[5]}]},{id:"departments",name:"Áreas / Departamentos",functions:[{id:"view",name:"Ver áreas",defaultLevels:[5]},{id:"create",name:"Crear áreas",defaultLevels:[5]},{id:"edit",name:"Editar áreas",defaultLevels:[5]},{id:"delete",name:"Eliminar áreas",defaultLevels:[5]}]},{id:"templates",name:"Templates",functions:[{id:"view",name:"Ver templates",defaultLevels:[5]},{id:"create",name:"Crear templates",defaultLevels:[5]},{id:"edit",name:"Editar templates",defaultLevels:[5]},{id:"delete",name:"Eliminar templates",defaultLevels:[5]},{id:"upload",name:"Subir archivos",defaultLevels:[5]},{id:"manage_signatories",name:"Gestionar firmantes",defaultLevels:[5]},{id:"manage_variables",name:"Gestionar variables",defaultLevels:[5]}]}]}];function _e({checked:m,onChange:h,disabled:f,level:k}){const N={5:"checked:bg-purple-500 checked:border-purple-500",4:"checked:bg-blue-500 checked:border-blue-500",3:"checked:bg-green-500 checked:border-green-500",2:"checked:bg-gray-500 checked:border-gray-500",1:"checked:bg-slate-400 checked:border-slate-400"};return e.jsx("input",{type:"checkbox",checked:m,onChange:h,disabled:f,className:`w-5 h-5 rounded border-2 border-gray-300 cursor-pointer transition-colors
        ${N[k]||""}
        ${f?"opacity-50 cursor-not-allowed":"hover:border-gray-400"}
      `})}function ke({permissions:m,onChange:h}){const[f,k]=u.useState(["general","hr","legal","system"]),[N,D]=u.useState([]),V=a=>{k(t=>t.includes(a)?t.filter(l=>l!==a):[...t,a])},w=a=>{D(t=>t.includes(a)?t.filter(l=>l!==a):[...t,a])},v=(a,t,l,r)=>{const i=`${a}.${t}.${l}`;return m[i]?.includes(r)??!1},C=(a,t,l,r)=>{const i=`${a}.${t}.${l}`,c=m[i]||[],o=c.includes(r)?c.filter(d=>d!==r):[...c,r].sort((d,g)=>d-g);h({...m,[i]:o})},x=a=>{const t={...m};$.forEach(l=>{l.submodules.forEach(r=>{r.functions.forEach(i=>{const c=`${l.id}.${r.id}.${i.id}`,o=t[c]||[];o.includes(a)?t[c]=o.filter(d=>d!==a):t[c]=[...o,a].sort((d,g)=>d-g)})})}),h(t)},L=(a,t)=>{const l=$.find(i=>i.id===a);if(!l)return;const r={...m};l.submodules.forEach(i=>{i.functions.forEach(c=>{const o=`${a}.${i.id}.${c.id}`,d=r[o]||[];d.includes(t)?r[o]=d.filter(g=>g!==t):r[o]=[...d,t].sort((g,G)=>g-G)})}),h(r)},F=()=>{const a={};$.forEach(t=>{t.submodules.forEach(l=>{l.functions.forEach(r=>{const i=`${t.id}.${l.id}.${r.id}`;a[i]=[...r.defaultLevels]})})}),h(a)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"sticky top-0 bg-white z-10 pb-2 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Configuración de Permisos por Nivel"}),e.jsx(p,{variant:"secondary",size:"sm",onClick:F,children:"Restaurar Predeterminados"})]}),e.jsxs("div",{className:"grid grid-cols-[1fr_repeat(5,60px)] gap-2 items-center text-center",children:[e.jsx("div",{className:"text-left text-xs font-medium text-gray-500 uppercase",children:"Módulo / Función"}),[5,4,3,2,1].map(a=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("button",{onClick:()=>x(a),className:`px-2 py-1 text-xs font-bold rounded-full border transition-colors hover:opacity-80 ${y[a]}`,title:`Toggle todos nivel ${a}`,children:["N",a]}),e.jsx("span",{className:"text-[10px] text-gray-500 mt-0.5",children:R[a]})]},a))]})]}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:$.map(a=>{const t=a.icon,l=f.includes(a.id);return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>V(a.id),children:[l?e.jsx(W,{className:"w-4 h-4 text-gray-400"}):e.jsx(X,{className:"w-4 h-4 text-gray-400"}),e.jsx(t,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:a.name}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:a.description})]}),e.jsx("div",{className:"flex gap-1",onClick:r=>r.stopPropagation(),children:[5,4,3,2,1].map(r=>e.jsx("button",{onClick:()=>L(a.id,r),className:`w-6 h-6 rounded text-[10px] font-bold border transition-colors hover:opacity-80 ${y[r]}`,title:`Toggle ${a.name} para nivel ${r}`,children:r},r))})]}),l&&e.jsx("div",{className:"border-t border-gray-200",children:a.submodules.map(r=>{const i=N.includes(`${a.id}.${r.id}`);return e.jsxs("div",{className:"border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 pl-10 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>w(`${a.id}.${r.id}`),children:[i?e.jsx(W,{className:"w-3 h-3 text-gray-400"}):e.jsx(X,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"flex-1 font-medium text-gray-700 text-sm",children:r.name})]}),i&&e.jsx("div",{className:"bg-white",children:r.functions.map(c=>e.jsxs("div",{className:"grid grid-cols-[1fr_repeat(5,60px)] gap-2 items-center p-2 pl-16 hover:bg-gray-50 text-center",children:[e.jsx("div",{className:"text-left text-sm text-gray-600",children:c.name}),[5,4,3,2,1].map(o=>e.jsx("div",{className:"flex justify-center",children:e.jsx(_e,{checked:v(a.id,r.id,c.id,o),onChange:()=>C(a.id,r.id,c.id,o),level:o})},o))]},c.id))})]},r.id)})})]},a.id)})})]})}function qe(){const[m,h]=u.useState(""),[f,k]=u.useState(""),[N,D]=u.useState(""),[V,w]=u.useState(!1),[v,C]=u.useState(null),[x,L]=u.useState(null),[F,a]=u.useState(!1),[t,l]=u.useState(()=>{const s={};return $.forEach(n=>{n.submodules.forEach(j=>{j.functions.forEach(E=>{const ue=`${n.id}.${j.id}.${E.id}`;s[ue]=[...E.defaultLevels]})})}),s}),[r,i]=u.useState({email:"",first_name:"",last_name:"",department:"",title:"",role_names:["employee"]}),[c,o]=u.useState(""),d=xe(),{data:g,isLoading:G}=P({queryKey:["admin-users",m,f,N],queryFn:()=>b.list({search:m||void 0,level:f||void 0,status:N||void 0,per_page:100})}),{data:Y}=P({queryKey:["admin-roles"],queryFn:()=>b.getRoles()}),{data:Z}=P({queryKey:["admin-users-stats"],queryFn:()=>b.getStats()}),{data:ee}=P({queryKey:["admin-departments"],queryFn:()=>pe.list({status:"active",per_page:100})}),Q=S({mutationFn:s=>b.create(s),onSuccess:()=>{d.invalidateQueries(["admin-users"]),d.invalidateQueries(["admin-users-stats"]),w(!1),M()},onError:s=>{o(s.response?.data?.error||"Error al crear usuario")}}),B=S({mutationFn:({id:s,data:n})=>b.update(s,n),onSuccess:()=>{d.invalidateQueries(["admin-users"]),C(null),M()},onError:s=>{o(s.response?.data?.error||"Error al actualizar usuario")}}),se=S({mutationFn:s=>b.toggleActive(s),onSuccess:()=>{d.invalidateQueries(["admin-users"]),d.invalidateQueries(["admin-users-stats"])},onError:s=>{alert(s.response?.data?.error||"Error al cambiar estado")}}),O=S({mutationFn:({id:s,roleNames:n})=>b.assignRoles(s,n),onSuccess:()=>{d.invalidateQueries(["admin-users"]),L(null)},onError:s=>{alert(s.response?.data?.error||"Error al asignar roles")}}),ae=S({mutationFn:s=>b.delete(s),onSuccess:()=>{d.invalidateQueries(["admin-users"]),d.invalidateQueries(["admin-users-stats"])},onError:s=>{alert(s.response?.data?.error||"Error al eliminar usuario")}}),H=g?.data?.data||[],K=Y?.data?.data||[],I=Z?.data?.data||{},re=ee?.data?.data||[],M=()=>{i({email:"",first_name:"",last_name:"",department:"",title:"",role_names:["employee"]}),o("")},te=s=>{s.preventDefault(),Q.mutate(r)},ie=s=>{s.preventDefault(),B.mutate({id:v.id,data:r})},ne=s=>{i({email:s.email,first_name:s.first_name,last_name:s.last_name,department:s.department||"",title:s.title||"",role_names:s.roles||["employee"]}),C(s)},le=s=>{confirm(`¿Estás seguro de eliminar al usuario "${s.full_name}"? Esta acción no se puede deshacer.`)&&ae.mutate(s.id)},de=s=>{const n=s.active?"desactivar":"activar";confirm(`¿Estás seguro de ${n} al usuario "${s.full_name}"?`)&&se.mutate(s.id)},oe=s=>{i(n=>{const j=n.role_names||[];return j.includes(s)?{...n,role_names:j.filter(E=>E!==s)}:{...n,role_names:[...j,s]}})},ce=(s,n)=>{O.mutate({id:s.id,roleNames:n})},me=()=>{console.log("Saving permissions:",t),a(!1),alert("Permisos guardados correctamente")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(_,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Usuarios"}),e.jsx("p",{className:"text-gray-500",children:"Gestión de usuarios y niveles de permisos"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"secondary",onClick:()=>a(!0),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Gestionar Permisos"]}),e.jsxs(p,{onClick:()=>w(!0),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Nuevo Usuario"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(T,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:I.total||0}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total"})]})]})}),[5,4,3,2,1].map(s=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${y[s]}`,children:e.jsx(_,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:I.by_level?.[s]||0}),e.jsx("p",{className:"text-xs text-gray-500",children:R[s]})]})]})},s))]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(je,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre o email...",value:m,onChange:s=>h(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("select",{value:f,onChange:s=>k(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[e.jsx("option",{value:"",children:"Todos los niveles"}),[5,4,3,2,1].map(s=>e.jsxs("option",{value:s,children:["Nivel ",s," - ",R[s]]},s))]}),e.jsxs("select",{value:N,onChange:s=>D(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"active",children:"Activos"}),e.jsx("option",{value:"inactive",children:"Inactivos"})]})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg border border-purple-200 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Niveles de Permisos"]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:[5,4,3,2,1].map(s=>e.jsxs("div",{className:`px-3 py-1.5 rounded-full text-sm font-medium border ${y[s]}`,children:[e.jsxs("span",{className:"font-bold",children:["Nivel ",s]})," - ",R[s]]},s))})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:G?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Cargando..."}):H.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(T,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:m?"No se encontraron usuarios":"No hay usuarios"}),e.jsx("p",{className:"text-gray-500 mb-4",children:m?"Intenta con otra búsqueda":"Crea el primer usuario para comenzar"}),!m&&e.jsxs(p,{onClick:()=>w(!0),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Crear Usuario"]})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Departamento"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nivel"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Roles"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:H.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-medium ${s.permission_level===5?"bg-purple-500":s.permission_level===4?"bg-blue-500":s.permission_level===3?"bg-green-500":s.permission_level===2?"bg-gray-500":"bg-slate-400"}`,children:[s.first_name?.[0],s.last_name?.[0]]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.full_name}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),s.email]})]})]})}),e.jsx("td",{className:"px-4 py-3",children:s.department?e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),s.department]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-bold border ${y[s.permission_level]||y[1]}`,children:s.permission_level})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:s.roles?.map(n=>e.jsx(U,{variant:n==="admin"?"danger":"default",size:"sm",children:n},n))})}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.active?e.jsx(U,{variant:"success",children:"Activo"}):e.jsx(U,{variant:"secondary",children:"Inactivo"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>L(s),className:"p-1.5 text-purple-500 hover:text-purple-700 hover:bg-purple-50 rounded",title:"Asignar roles",children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>ne(s),className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",title:"Editar",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>de(s),className:`p-1.5 rounded ${s.active?"text-amber-500 hover:text-amber-700 hover:bg-amber-50":"text-green-500 hover:text-green-700 hover:bg-green-50"}`,title:s.active?"Desactivar":"Activar",children:s.active?e.jsx(we,{className:"h-4 w-4"}):e.jsx(Le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>le(s),className:"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded",title:"Eliminar",children:e.jsx(Ce,{className:"h-4 w-4"})})]})})]},s.id))})]})}),e.jsx(q,{isOpen:V||!!v,onClose:()=>{w(!1),C(null),M()},title:v?"Editar Usuario":"Nuevo Usuario",size:"lg",children:e.jsxs("form",{onSubmit:v?ie:te,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(A,{label:"Nombre",value:r.first_name,onChange:s=>i({...r,first_name:s.target.value}),placeholder:"Juan",required:!0}),e.jsx(A,{label:"Apellido",value:r.last_name,onChange:s=>i({...r,last_name:s.target.value}),placeholder:"Pérez",required:!0})]}),e.jsx(A,{label:"Email",type:"email",value:r.email,onChange:s=>i({...r,email:s.target.value}),placeholder:"juan.perez@empresa.com",required:!0,disabled:!!v}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departamento"}),e.jsxs("select",{value:r.department,onChange:s=>i({...r,department:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[e.jsx("option",{value:"",children:"Seleccionar departamento"}),re.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})]}),e.jsx(A,{label:"Cargo",value:r.title,onChange:s=>i({...r,title:s.target.value}),placeholder:"Analista"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Roles (determinan el nivel de permisos)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:K.map(s=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${r.role_names?.includes(s.name)?"bg-purple-50 border-purple-300":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"checkbox",checked:r.role_names?.includes(s.name),onChange:()=>oe(s.name),className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-bold rounded ${y[s.level]}`,children:s.level}),e.jsx("span",{className:"font-medium text-gray-900",children:s.display_name})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:s.description})]})]},s.name))})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm bg-red-50 p-3 rounded-lg",children:[e.jsx(Ee,{className:"h-4 w-4"}),c]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:()=>{w(!1),C(null),M()},children:"Cancelar"}),e.jsx(p,{type:"submit",loading:Q.isPending||B.isPending,children:v?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Guardar"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Crear"]})})]})]})}),e.jsx(q,{isOpen:!!x,onClose:()=>L(null),title:`Asignar Roles - ${x?.full_name}`,children:x&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Selecciona los roles para este usuario. El nivel de permisos será determinado por el rol de mayor nivel."}),e.jsx("div",{className:"space-y-2",children:K.map(s=>{const n=x.roles?.includes(s.name);return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${n?"bg-purple-50 border-purple-300":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>{const j=n?x.roles.filter(E=>E!==s.name):[...x.roles||[],s.name];L({...x,roles:j})},className:"w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`px-2 py-0.5 text-xs font-bold rounded ${y[s.level]}`,children:["Nivel ",s.level]}),e.jsx("span",{className:"font-medium text-gray-900",children:s.display_name})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:s.description})]})]},s.name)})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{variant:"secondary",onClick:()=>L(null),children:"Cancelar"}),e.jsxs(p,{onClick:()=>ce(x,x.roles),loading:O.isPending,children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Guardar Roles"]})]})]})}),e.jsx(q,{isOpen:F,onClose:()=>a(!1),title:"Gestión de Permisos del Sistema",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-purple-900 flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Configuración de Permisos por Nivel"]}),e.jsx("p",{className:"text-sm text-purple-700 mt-1",children:"Define qué funcionalidades puede acceder cada nivel de usuario. Los cambios afectarán a todos los usuarios según su nivel de permisos."})]}),e.jsx(ke,{permissions:t,onChange:l}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{variant:"secondary",onClick:()=>a(!1),children:"Cancelar"}),e.jsxs(p,{onClick:me,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Guardar Permisos"]})]})]})})]})}export{qe as default};
